define.Class("wysiwyg.viewer.managers.PageManager",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.utilize(["core.managers.serverfacade.CorsRESTClient"]),b.binds(["_getPagesList","_createPageElements","createPage","_loadAllPages","_createMasterPage","_handleSinglePageData"]),b.methods({initialize:function(){W.Managers&&W.Managers.list&&W.Managers.list.push({target:"Pages"}),this._restClient=new this.imports.CorsRESTClient,this._loadedPages=[],this._loadingPages=[],this._loadingPagesTrialCounter={},this._getPagesList()&&this._getPagesList().pages.each(function(a){this._loadingPagesTrialCounter[a.pageId]=0}.bind(this)),this._callBacksForPageCreation={},this._TIME_BETWEEN_PAGES_RETRIEVAL=3e3},isReady:function(){return!0},clone:function(){return new this.$class},_getPagesList:function(){if(!window.publicModel||!window.publicModel.pageList)return void 0;var a=window.publicModel.pageList;return a.pages=a.pages.map(this._handleSinglePageData),a},_handleSinglePageData:function(a){return a},getMainPage:function(){return this._getPagesList().mainPageId},getMasterPageData:function(a){this._requestPageJson(this._getPagesList().masterPage,a)},getPageData:function(a,b){if(!a||!a.urls)throw"page is not listed in the pages list or it does not have url";if("function"!=typeof b)throw"callback ["+b+"] supplied is not a function";this._requestPageJson(a.urls,b,a)},_requestPageJson:function(a,b,c){this._restClient.get(a[0],void 0,{onSuccess:b,onError:this._getErrorCallbackForUrl(a,b,c)})},_getErrorCallbackForUrl:function(a,b,c){if(1==a.length)return function(){c&&this._loadingPages.splice(this._loadingPages.indexOf(c.pageId),1),LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","_requestPageJson")}.bind(this);var d=a.clone();return d.splice(0,1),function(){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",d[0]),this._requestPageJson(d,b,c)}.bind(this)},_buildComponentProperties:function(a){if(!a)return{};var b={id:a.id,comp:a.componentType,skin:"wysiwyg.viewer.components.PagesContainer"==a.componentType?"wysiwyg.viewer.skins.screenwidthcontainer.BlankScreen":a.skin,styleId:a.styleId};return a.dataQuery&&(b.dataQuery=0!=a.dataQuery.indexOf("#")?"#"+a.dataQuery:a.dataQuery),a.propertyQuery&&(b.propertyQuery=0!=a.propertyQuery.indexOf("#")?"#"+a.propertyQuery:a.propertyQuery),a.layout&&(b.width=a.layout.width,b.height=a.layout.height,b.x=a.layout.x,b.y=a.layout.y),b},_addAnchors:function(a){if(a&&a.id&&a.layout&&a.layout.anchors){var b={};b[a.id]=a.layout.anchors,W.Layout.appendSavedAnchor(b)}},_createElement:function(a){var b=new Element("div");return b.set(this._buildComponentProperties(a)),this._addAnchors(a),b},_createPageElements:function(a){var b=this._createElement(a);return a.components&&a.components.each(function(a){b.grab(this._createPageElements(a))}.bind(this)),b},createPage:function(a){var b=this._getJsonForString(a),c=b.data||b.payload.data;this._setInitDataForPage(c);var d=b.structure||b.payload.structure,e=this._createPageElements(d);this._attachPageWhenReady(e,d.id)},_attachPageWhenReady:function(a,b){$(b)?(this._attachPage(a,b),this._loadedPages.push(b),W.Utils.callLater(this._callBacksForPageCreation[b].method,[],this._callBacksForPageCreation[b].scope,10),this.fireEvent("PAGE_LOADED",b)):W.Utils.callLater(this._attachPageWhenReady,[a,b],this,10)},_setInitDataForPage:function(a){var b=this.dataFixer.fix(a);W.Data.addDataItemsForPage(b.document_data),W.ComponentData.addDataItemsForPage(b.component_properties),W.Theme.addDataItemsForPage(b.theme_data)},_setInitData:function(a){var b=this.dataFixer.fix(a);W.Data.addDataItems(b.document_data),W.ComponentData.addDataItems(b.component_properties),W.Theme.addDataItems(b.theme_data)},_attachPageContentToWixifiedPage:function(a,b){var c=a.getLogic();a.empty(),b.getChildren().each(function(b){a.grab(b,"bottom")}),b.get("styleId")!=a.get("styleId")?(a.set("styleId",b.get("styleId")),W.Theme.getStyle(b.get("styleId"),function(a){c.setStyle(a)})):a.get("skin")!==b.get("skin")&&(a.set("skin",b.get("skin")),W.Skins.getSkin(b.get("skin"),function(a){var b=new a;c.setSkin(b)})),b.get("dataQuery")!=a.get("dataQuery")&&(a.set("dataQuery",b.get("dataQuery")),c.setDataByQuery(b.get("dataQuery"),function(){})),b.get("propertyQuery")!=a.get("propertyQuery")&&(a.set("propertyQuery",b.get("propertyQuery")),W.Data.getDataByQuery(b.get("propertyQuery"),c.setComponentProperties))},_attachPage:function(a,b){var c=$(b);c.getLogic?this._attachPageContentToWixifiedPage(c,a):a.replaces(c)},_attachMasterPage:function(a){$$("body")[0].grab(a,"top")},_createSiteStructureNode:function(){var a=new Element("div");return a.set({id:"SITE_STRUCTURE",comp:"wysiwyg.viewer.components.WSiteStructure",skin:"mobile.core.skins.InlineSkin","class":"SITE_STRUCTURE"}),a},_getJsonForString:function(a){return"string"==typeof a?JSON.decode(a):a},_createStubPage:function(a){var b=new Element("div");return b.set({id:a.pageId,comp:"mobile.core.components.Page",skin:"mobile.core.skins.InlineSkin",dataQuery:"#"+a.pageId}),b},_addPagesStubs:function(){Object.each(this._getPagesList().pages,function(a){$("SITE_PAGES").grab(this._createStubPage(a))}.bind(this))},_createMasterPage:function(a){var b=this._getJsonForString(a),c=b.data||b.payload.data;this._setInitData(c);var d=this._createSiteStructureNode(),e=b.structure||b.payload.structure;e.children.each(function(a){d.grab(this._createPageElements(a))}.bind(this)),this._attachMasterPage(d),this.fireEvent("MASTER_PAGE_WAS_LOADED"),this._addPagesStubs()},_loadSinglePage:function(a){this.getPageData(a,this.createPage)},_loadAllPages:function(a){this.addEvent("PAGE_LOADED",function(b){a.erase(b),0===a.length&&(this._allPagesAreLoaded=!0)}.bind(this)),a.each(function(a){this.loadPageById(a)}.bind(this))},isPageLoaded:function(a){return this._isOldPageVersion()||this._loadedPages.contains(a)||this._loadingPages.contains(a)},loadPageById:function(a,b,c){var d=this._getPageDataById(a);this._loadedPages.contains(a)||this._loadingPages.contains(a)||(this._loadingPagesTrialCounter[a]++,this._loadingPages.push(a),this._callBacksForPageCreation[a]={method:b,scope:c},this._loadSinglePage(d))},_getPageDataById:function(a){return this._getPagesList().pages.first(function(b){return b.pageId===a})},_isOldPageVersion:function(){return!this._getPagesList()},isPageLoadingCompleted:function(){return!!this._allPagesAreLoaded},loadSite:function(){this._isOldPageVersion()?W.Data.getDataByQuery("#SITE_STRUCTURE",function(a){var b="preview"!=viewMode;W.Viewer.setSite($("SITE_STRUCTURE"),a,b)}):resource.getResources(["dataFixer"],function(a){this.dataFixer=a.dataFixer,this._loadSiteNewVersion()}.bind(this))},_loadAllPagesLazily:function(){var a=this._getNextUnloadedPage();a&&(this.loadPageById(a.pageId),W.Utils.callLater(this._loadAllPagesLazily,[],this,3e3))},_getNextUnloadedPage:function(){return this._getPagesList().pages.first(function(a){return!this.isPageLoaded(a.pageId)&&this._loadingPagesTrialCounter[a.pageId]<=3}.bind(this))},_getPagesToLoad:function(){var a=this.getMainPage();this._isPageReal(a)||(a=this._getPagesList().pages[0].pageId);var b=[a],c=W.Utils.hash.getHashParts(),d="zoom"===c.id?c.extData.match("([^/]+)/([^/]+)")[1]:c.id;return d&&d!==this.getMainPage()&&this._isPageReal(d)&&b.push(d),b},_isPageReal:function(a){return this._getPagesList().pages.some(function(b){return b.pageId===a})},_loadSiteNewVersion:function(){this._loadAllPages(this._getPagesToLoad()),this.getMasterPageData(this._createMasterPage),W.Utils.callLater(this._loadAllPagesLazily,[],this,15e3)}})}),define.Class("wysiwyg.viewer.managers.SiteMembersManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.resources(["W.Viewer"]),b.binds(["_initializeAPI","openSiteMembersPopup","closeSiteMembersPopup"]),b.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"}}),b.methods({initialize:function(){var a=this.resources.W.Viewer.getAppDataHandler().getSiteMembersData();this.setData(a)},isReady:function(){return!0},setData:function(a){this._smData=a,a&&this._loadScriptAndInitAPI()},_loadScriptAndInitAPI:function(){if(window.SiteMembers)this._initializeAPI();else{var a=window.serviceTopology.scriptsLocationMap,b=a.sitemembers;this.injects().Viewer.loadExternalScript(b+"/SiteMembers.js",function(){this._initializeAPI(),this._checkQueryStringForFormOpen(),this._preloadMemberDetails()}.bind(this))}},_initializeAPI:function(){var a=W.Config.getServiceTopologyProperty("siteMembersUrl"),b="siteMembers",c=window.SiteMembers,d=this.getCollectionId();if(d){var e=W.Config.getMetaSiteId();window[b]=new c(d,a,b,e),this._api=window[b],this._token=this.getData().smtoken,this._apiReady=!0}else LOG.reportError("Site members - collection Id is undefined? ["+d+"]",this.$className,"_initializeAPI")},_checkQueryStringForFormOpen:function(){var a=this.injects().Utils,b=a.getQueryParam("intent");if(b&&!this._queryStringHandled){if(!this.injects().Viewer.isSiteReady()||!this.isApiReady())return a.callLater(this._checkQueryStringForFormOpen,[],this,500),void 0;this.openSiteMembersPopup({intent:b}),this._queryStringHandled=!0}},_preloadMemberDetails:function(){this.getMemberDetails(function(a){this._memberDetails=a}.bind(this))},getData:function(){return this._smData||{}},getCollectionId:function(){return this.getData().smcollectionId||this.getData().id},getCollectionOwner:function(){return this.getData().owner},getCollectionType:function(){return this.getData().collectionType||this.getData().type},isServiceProvisioned:function(){return!!this._smData},isApiReady:function(){return this._apiReady},login:function(a,b,c,d,e){this._apiReady?this._api.login(a,b,c,d,e):e&&e({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},register:function(a,b,c,d){this._apiReady?this._api.register(a,b,c,d):d&&d({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},updateMemberDetails:function(a,b,c){this._apiReady?this._token?this._api.updateMemberDetails(this._token,a,b,c):c&&c({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):c&&c({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},getMemberDetails:function(a,b){this._memberDetails?a(this._memberDetails):this._apiReady?this._token?this._api.getMemberDetails(this._token,a,b):b&&b({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):b&&b({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},applyForMembership:function(a,b,c,d){this._apiReady?this._api.apply(a,b,c,d):d&&d({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},logout:function(){return this._apiReady?(delete this._token,this._api.logout()):void 0},getToken:function(){return this._token},isLoggedIn:function(){var a=this._getAuthenticationState();return a==this.AUTH_STATES.AUTH},isNotAuthenticatedWithCookie:function(){if(this.isLoggedIn())return!1;var a=this._getAuthenticationState();return a==this.AUTH_STATES.NO_AUTH_WITH_COOKIE},_getAuthenticationState:function(){var a=!!this._token,b=this._api?this._api.isSessionValid():!1;return a?this.AUTH_STATES.AUTH:!a&&b?this.AUTH_STATES.NO_AUTH_WITH_COOKIE:a||b?void 0:this.AUTH_STATES.NO_AUTH_WITHOUT_COOKIE},openSiteMembersPopup:function(a){var b=a&&a.intent,c=a&&a.authCallback;b||(b=this.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER);var d=[this.INTENTS.LOGIN,this.INTENTS.REGISTER];if(d.contains(b)&&this.isLoggedIn())this.injects().SiteMembers.getMemberDetails(function(a){this.reportAuthStatusChange(c,!0,a)}.bind(this));else{var e=this.injects().SiteMembers;this._siteMembersContainer&&this.closeSiteMembersPopup(),e.isApiReady()&&!this._siteMembersContainer&&W.Components.createComponent("wysiwyg.viewer.components.sm.SMContainer","wysiwyg.viewer.skins.sm.SMContainerSkin",null,a,function(){},function(a){this._siteMembersContainer=a;var b=a.getViewNode();b.setStyle("opacity","0.0");var c=this.injects().Viewer.getSiteNode();b.insertInto(c),new Fx.Tween(b,{duration:"short",link:"ignore"}).start("opacity","1.0")}.bind(this))}},closeSiteMembersPopup:function(){if(this._siteMembersContainer){var a=this._siteMembersContainer.getViewNode(),b=new Fx.Tween(a,{duration:"short",link:"chain"});b.addEvent("complete",function(){b.removeEvent("complete",arguments.callee),a.removeFromDOM()}.bind(this)),b.start("opacity","0.0"),delete this._siteMembersContainer}},reportAuthStatusChange:function(a,b,c){a&&a({authResponse:b,data:c})}})}),define.Class("wysiwyg.viewer.utils.ComponentSequencer",function(a){a.inherits("bootstrap.utils.Events"),a.resources(["W.Data"]),a.fields({_pendingElements:[],_createdElements:[],_reusedElements:[],_notifiedOnReady:[],_preExistingElements:[]}),a.methods({initialize:function(){},resolveItem:function(){},createComponents:function(a,b){this._resolveRefList(b,function(b){this._createCompsFromDataList(a,b)}.bind(this))},reset:function(){this._pendingElements.forEach(function(a){a.removeEvent(Constants.ComponentEvents.READY)}),this._pendingElements=[],this._createdElements=[],this._reusedElements=[],this._preExistingElements=[],this._notifiedOnReady=[]},_resolveRefList:function(a,b){var c="array"===typeOf(a)?a:a.get("items"),d=[],e=c.length;if(c.length)for(var f=0;f<c.length;f++)this._resolveCompData(c[f],f,function(a,c){d[c]=a,e--,0===e&&b(d)});else b([])},_resolveCompData:function(a,b,c){"string"===typeOf(a)?this.resources.W.Data.getDataByQuery(a,function(a){c(a,b)}):c(a,b)},_createCompsFromDataList:function(a,b){this._preExistingElements=a.getChildren().slice(0),this._allSetup=!1,this._pendingElements=[],this._createdElements=[],this._reusedElements=[],this._notifiedOnReady=[];for(var c=0;c<b.length;c++)this._setupComponent(a,c,b);this._preExistingElements.forEach(function(a){this._reusedElements.contains(a)||this._removeElement(a)}.bind(this)),this._createdElements.forEach(function(b){a.appendChild(b)}),this._allSetup=!0,this._checkIfAllDone()},_setupComponent:function(a,b,c){var d,e=c[b],f=this._findReusableComponent(this._preExistingElements,e);f?(d="reuse",this._reusedElements.push(f)):(d="create",f=this.createComponent(a,e,b,c)),this._createdElements.push(f),this._notifyOnComponentReadyIfNeeded(d,f,b)},createComponent:function(a,b,c,d){var e,f=this.resolveItem(b,c,d),g=typeOf(f),h=this._getCompStyle(a);return"element"===g?(e=f,e.getLogic||e.hasAttribute("comp")||this._supplyMinimalLogic(e,b),a.adopt(e)):(e=new Element("div"),e.setAttribute("comp",f.comp),e.setAttribute("skin",f.skin),f.styleId&&e.setAttribute("styleId",f.styleId),"data"in f&&(b=f.data),this._pendingElements.push(e),this._listenToInnerComponentReady(e,c),a.adopt(e),e.wixify(f.args||{},b,void 0,void 0,h)),e},_notifyOnComponentReadyIfNeeded:function(a,b,c){this._notifiedOnReady.contains(b)||this._pendingElements.contains(b)||(this._notifiedOnReady.push(b),this.fireEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,{method:a,compView:b,index:c}))},_supplyMinimalLogic:function(a,b){var c={getDataItem:function(){return b},getIsDisplayed:function(){return!0},dispose:function(){b=null}};a.getLogic=function(){return c}},_onAllComponentsReady:function(){var a=this._createdElements.slice(0);this._createdElements=[],this._reusedElements=[],this._preExistingElements=[],this.fireEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,{elements:a})},_removeElement:function(a){a.getLogic&&a.getLogic().dispose(),a.destroy()},_findReusableComponent:function(a,b){for(var c,d=0;d<a.length;d++)if(c=a[d],c.getLogic&&this._dataItemsIdentical(b,c.getLogic().getDataItem()))return c},_dataItemsIdentical:function(a,b){if(a===b)return!0;if(a.get&&b.get&&a.hasField("id")&&b.hasField("id")){var c=a.get("id"),d=b.get("id");return c&&d&&c===d}return!1},_getCompStyle:function(a){var b;if(!this._style){for(b=a;b&&!b.getLogic;)b=b.getParent();if(b&&b.getLogic&&b.getLogic()&&b.getLogic().getStyle)return b.getLogic().getStyle()}},_listenToInnerComponentReady:function(a,b){a.addEvent(Constants.ComponentEvents.READY,function(){this._pendingElements.erase(a),this._notifyOnComponentReadyIfNeeded("create",a,b),this._checkIfAllDone()}.bind(this))},isPending:function(){return this._pendingElements.length>0},_checkIfAllDone:function(){this._allSetup!==!0||this.isPending()||this._onAllComponentsReady()}})}),define.Class("wysiwyg.viewer.utils.GalleryUtils",function(a){a.methods({createActionQueue:function(a,b){var c=[];return function(d){for(d&&c.push(d);c.length>0&&a()===!0;){c.length>b&&c.splice(0,c.length-b);var e=c.shift();e&&e.call()}}},createMinimalGalleryDisplayer:function(a,b){var c=Number.random(0,99999).toString(36),d={getViewNode:function(){return a},getRef:function(){return c},getDataItem:function(){return b},setOwner:function(){},invalidateSize:function(){},setSize:function(b,c){var d={width:b,height:c};a.setStyles(d)},dispose:function(){a.destroy(),a=null}};a.getLogic=function(){return d}}})}),define.Class("wysiwyg.viewer.utils.MatrixTransitions",function(a){var b=a;b.utilize(["wysiwyg.viewer.utils.TransitionUtils"]),b.binds(["_matrixCrossFade","_crossFade","_shrinkFade","_vertSwipe","_horizSwipe","_transitionSequence","_transitionSequenceGenerator","_generalTransition","_destroyHolder","_rotateDiagonalTiming","_noTransition","_timingDiagonalWave"]),b.fields({_transitionUtils:null,_sequenceIndex:0,_positioningFunc:null,_itemsContainer:null}),b.methods({initialize:function(){this._transitionUtils=new this.imports.TransitionUtils},setupTransitionMap:function(a,b){this._positioningFunc=a,this._itemsContainer=b;var c={crossFadeAllAtOnce:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingAllAtOnce)),crossFadeSequential:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),crossFadeHorizWave:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),crossFadeVertWave:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),crossFadeDiagonal:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingDiagonalWave)),shrinkFadeAllAtOnce:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingAllAtOnce)),shrinkFadeSequential:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),shrinkFadeHorizWave:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),shrinkFadeVertWave:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),shrinkFadeDiagonal:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingDiagonalWave)),vertSwipeAllAtOnce:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),vertSwipeWave:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),vertSwipeAlternate:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),horizSwipeAllAtOnce:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),horizSwipeWave:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),horizSwipeAlternate:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),seq_crossFade_All:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingAllAtOnce)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingHorizontalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingVerticalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_shrink_All:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingAllAtOnce)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingHorizontalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingVerticalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),swipe_horiz_All:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),swipe_vert_All:this._transitionSequence([this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),seq_crossFade_Horiz:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingHorizontalWave)))]),seq_crossFade_Vert:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingVerticalWave)))]),seq_crossFade_Seq:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingSequential)))]),seq_crossFade_Diagonal:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_shrink_Horiz:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingHorizontalWave)))]),seq_shrink_Vert:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingVerticalWave)))]),seq_shrink_Seq:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingSequential)))]),seq_shrink_Diagonal:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_swipe_alternate:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),seq_swipe_vert_wave:this._transitionSequence([this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection))]),seq_swipe_horiz_wave:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection))])};c.none=this._generalTransition(this._matrixCrossFadePrepare,this._noTransition),this._transitionMap=c,c.seq_random=this._transitionSequenceGenerator(this._transitionRandomPicker(this.getTransitionList()))},getTransition:function(a){return this._transitionMap[a]},getTransitionList:function(){var a=[];for(var b in this._transitionMap)a.push(b);return a},_generalTransition:function(a,b){return function(c,d,e,f,g,h,i){var j=a(c,d,e,f,this._itemsContainer,this._positioningFunc);b(j,e,f,g,h,i)}.bind(this)},_transitionSequence:function(a){return function(b,c,d,e,f,g,h){this._sequenceIndex=this._sequenceIndex<a.length?this._sequenceIndex:0;var i=a[this._sequenceIndex++],j="function"===typeOf(i)?i:transMap[i];j(b,c,d,e,f,g,h)}.bind(this)},_transitionSequenceGenerator:function(a){return function(b,c,d,e,f,g,h){var i=a(this._sequenceIndex);i(b,c,d,e,f,g,h)}.bind(this)},_transitionRandomPicker:function(a){return function(){var b=a[parseInt(Math.random()*a.length)];return this._transitionMap[b]}.bind(this)},_destroyHolder:function(a,b){var c=a.children[0];if(c){this._itemsContainer.adopt(c);var d=this._positioningFunc(b);c.setStyles({position:"absolute",left:d.left+"px",top:d.top+"px"})}a.destroy()},_matrixCrossFadePrepare:function(a,b,c,d,e,f){var g,h,i,j,k=[];e.empty();for(var l=c*d,m=0;l>m;m++)g=new Element("div"),e.adopt(g),h=a[m]||new Element("div"),i=b[m]||new Element("div"),g.adopt(i,h),a[m]||i.setStyles({opacity:"0.0"}),h.setStyles({left:"0px",top:"0px"}),i.setStyles({left:"0px",top:"0px"}),k.push(g),j=f(m),g.setStyles({position:"absolute",left:j.left+"px",top:j.top+"px"});return k},_noTransition:function(a,b,c,d,e,f){a.forEach(this._destroyHolder),f()},_crossFade:function(a,b){var c=this;return function(d,e,f,g,h,i){for(var j=d.length,k=0;k<d.length;k++)!function(){var g=k;setTimeout(function(){var b=d[g].children[1],e=d[g].children[0];a(b,e,0,h,function(){c._destroyHolder(d[g],g),j--,0>=j&&i()})},b(g,1e3*h,e,f))}()}},_matrixCrossFade:function(a){return this._crossFade(this._transitionUtils.getTransition(Constants.TransitionTypes.CROSS_FADE),a)},_shrinkFade:function(a){return this._crossFade(this._transitionUtils.getTransition(Constants.TransitionTypes.SHRINK_FADE),a)},_vertSwipePrepare:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p=[];e.empty(),o=f(d*c).top;for(var q=0;c>q;q++){g=new Element("div"),e.adopt(g),m=new Element("div"),g.adopt(m),n=new Element("div"),g.adopt(n),m.setStyles({position:"absolute",top:"0px",height:o+"px"}),n.setStyles({position:"absolute",top:o+"px",height:o+"px"});for(var r=0;d>r;r++)k=r*c+q,l=f(k),h=a[k]||new Element("div"),i=b[k]||new Element("div"),n.adopt(i),m.adopt(h),h.setStyles({left:"0px",top:l.top+"px"}),i.setStyles({left:"0px",top:l.top+"px"});p.push(g),j=f(q),g.setStyles({position:"absolute",left:j.left+"px"})}return p},_horizSwipePrepare:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p=[];e.empty(),l=f(c-1),o=l.left+l.width;for(var q=0;d>q;q++){g=new Element("div"),e.adopt(g),m=new Element("div"),g.adopt(m),n=new Element("div"),g.adopt(n),m.setStyles({position:"absolute",left:"0px",width:o+"px"}),n.setStyles({position:"absolute",left:o+"px",width:o+"px"});for(var r=0;c>r;r++)k=q*c+r,l=f(k),h=a[k]||new Element("div"),i=b[k]||new Element("div"),n.adopt(i),m.adopt(h),h.setStyles({top:"0px",left:l.left+"px"}),i.setStyles({top:"0px",left:l.left+"px"});p.push(g),j=f(q*c),g.setStyles({position:"absolute",top:j.top+"px"})}return p},_vertSwipe:function(a,b){var c=this._transitionUtils.getTransition(Constants.TransitionTypes.SWIPE_VERTICAL),d=this;return function(e,f,g,h,i,j){for(var k=e.length,l=0;l<e.length;l++)!function(){var g=l;setTimeout(function(){b(c,e,g,h,i,function(){for(var a=e[g].children[1].children,b=a.length-1;b>=0;b--){var c=a[b];d._itemsContainer.adopt(c);var h=d._positioningFunc(b*f+g);c.setStyles({position:"absolute",left:h.left+"px",top:h.top+"px"})}e[g].destroy(),k--,0>=k&&j()})},a(g,1e3*i,e.length))}()}},_horizSwipe:function(a,b){var c=this._transitionUtils.getTransition(Constants.TransitionTypes.SWIPE_HORIZONTAL),d=this;return function(e,f,g,h,i,j){for(var k=e.length,l=0;l<e.length;l++)!function(){var g=l;setTimeout(function(){b(c,e,g,h,i,function(){for(var a=e[g].children[1].children,b=a.length-1;b>=0;b--){var c=a[b];d._itemsContainer.adopt(c);var h=d._positioningFunc(g*f+b);c.setStyles({position:"absolute",left:h.left+"px",top:h.top+"px"})}e[g].destroy(),k--,0>=k&&j()})},a(g,1e3*i,e.length))}()}},_swipeSingleDirection:function(a,b,c,d,e,f){a(b[c].children[0],b[c].children[1],d,e,f)},_swipeAlternate:function(a,b,c,d,e,f){0===c%2?a(b[c].children[0],b[c].children[1],d,e,f):(d=0==d?1:0,a(b[c].children[0],b[c].children[1],d,e,f))},_timingAllAtOnce:function(){return 0},_timingSequential:function(a,b,c,d){return a/(c*d)*b},_timingHorizontalWave:function(a,b,c){var d=a%c;return Math.floor((a-d)/c),d/c*b},_timingVerticalWave:function(a,b,c,d){var e=a%c,f=Math.floor((a-e)/c);return f/d*b},_reverseTiming:function(a){return function(b,c){return c-a.apply(this,arguments)}},_standardDiagonalDistFunc:function(a,b){return Math.sqrt(a*a+b*b)},_timingDiagonalWave:function(a,b,c,d,e){e=e||this._standardDiagonalDistFunc;
var f=a%c,g=Math.floor((a-f)/c),h=e(f,g,c,d),i=Math.sqrt(c*c+d*d);return h/i*b},_timingSwipeAllAtOnce:function(){return 0},_timingSwipeWave:function(a,b,c){return(.6+.4*a/c)*b},_rotateDiagonalTiming:function(a,b){var c,d=this;return c=0>=b||b>3?this._standardDiagonalDistFunc:1==b?function(a,b,c){return d._standardDiagonalDistFunc(c-a,b)}:2==b?function(a,b,c,e){return d._standardDiagonalDistFunc(c-a,e-b)}:function(a,b,c,e){return d._standardDiagonalDistFunc(a,e-b)},function(b,d,e,f){return a(b,d,e,f,c)}}})}),define.Class("wysiwyg.viewer.utils.MessageViewController",function(a){var b=a;b.binds(["_showMessageBox","_messageBoxClosed"]),b.inherits("bootstrap.managers.BaseManager"),b.methods({initialize:function(){this._messagesQueue=[],this.BETWEEN_MESSAGES_DELAY=700},_initIfNeededMessageView:function(a){this._messageBox?a&&a():this._messageBox=W.Components.createComponent("wysiwyg.viewer.components.MessageView","wysiwyg.viewer.skins.MessageViewSkin",null,null,function(){$$("body").adopt(this._messageBox),this._messageBox.getLogic().addEvent("complete",this._messageBoxClosed)}.bind(this),a)},showError:function(a,b){var c={};c.msgTitle=a,c.msgBody=b,this._messagesQueue.push(c),this._initIfNeededMessageView(this._showMessageBox)},showMessage:function(a,b,c){var d={};d.msgTitle=a,d.msgBody=b,d.cb=c,this._messagesQueue.push(d),this._initIfNeededMessageView(this._showMessageBox)},_showMessageBox:function(){this._messagesQueue.length>0&&!this._messageBox.getLogic().visible()&&this._messageBox.getLogic().showMessage(this._messagesQueue.shift())},_messageBoxClosed:function(){setTimeout(function(){this._showMessageBox()}.bind(this),this.BETWEEN_MESSAGES_DELAY)},kill:function(){this._messageBox&&(this._messageBox.dispose(),this._messageBox.removeFromDOM())},isReady:function(){return!0},clone:function(a){return this.parent(a)}})}),define.Class("wysiwyg.viewer.utils.TransitionHandler",function(a){a.binds(["_swipeHorizontalTransition","_swipeHorizontalTransitionFullScreen","_swipeVerticalTransition","_swipeVerticalTransitionFullScreen","_noTransition","_inOutTransition","_crossFadeTransition","_shrinkFadeTransition","_trackCallback"]),a.fields({_useCSS3:!1,_frameRateTrackingActive:!1,_frameRateCount:0,_trackStartTime:0}),a.resources(["W.Utils"]),a.methods({initialize:function(){this._Tween=this.resources.W.Utils.Tween},getTransition:function(a){switch(a){case Constants.TransitionTypes.SWIPE_HORIZONTAL:return this._swipeHorizontalTransition;case Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN:return this._swipeHorizontalTransitionFullScreen;case Constants.TransitionTypes.SWIPE_VERTICAL:return this._swipeVerticalTransition;case Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN:return this._swipeVerticalTransitionFullScreen;case Constants.TransitionTypes.CROSS_FADE:return this._crossFadeTransition;case Constants.TransitionTypes.SHRINK_FADE:return this._shrinkFadeTransition;case Constants.TransitionTypes.OUT_IN:return this._inOutTransition;case Constants.TransitionTypes.NONE:default:return this._noTransition}},_noTransition:function(a,b,c,d,e){e()},_swipeHorizontalTransition:function(a,b,c,d,e){var f=a.getWidth();this._swipeHorizontalTransitionCommon(a,b,c,d,f,e)},_swipeHorizontalTransitionFullScreen:function(a,b,c,d,e){var f=a.getContentRect(),g=Math.max($(document).getSize().x-f.left,f.right),h=g-b.getContentRect(b).left;this._swipeHorizontalTransitionCommon(a,b,c,d,h,e)},_swipeHorizontalTransitionCommon:function(a,b,c,d,e,f){var g=a.getParent(),h=this.injects().Utils.getCSSBrowserFeature("animation"),i=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),j={};a.setStyles({position:"absolute"}),b.setStyles({position:"absolute"}),0!==c&&(e=-e),b.setStyle("left",e+"px"),b.setStyle("top","0px"),this._useCSS3&&h?(j.left=e+"px",j["margin-left"]=String(-e)+"px",j[h]="swipeHoriz "+d+"s",j[i]="ease-in-out",g.setStyles(j),setTimeout(function(){g.setStyle(h,""),g.setStyles({left:"0px","margin-left":"0px"}),b.setStyles({left:"0px"}),f()},1e3*d)):this._Tween.to(g,d,{left:String(-e),ease:"strong_easeInOut",onComplete:function(){b.setStyles({left:"0px"}),g.setStyles({top:"0px",left:"0px"}),f()}})},_swipeVerticalTransition:function(a,b,c,d,e){var f=a.getHeight();this._swipeVerticalTransitionCommon(a,b,c,d,f,e)},_swipeVerticalTransitionFullScreen:function(a,b,c,d,e){var f=a.getCoordinates().top+b.getHeight();this._swipeVerticalTransitionCommon(a,b,c,d,f,e)},_swipeVerticalTransitionCommon:function(a,b,c,d,e,f){var g=a.getParent(),h=this.injects().Utils.getCSSBrowserFeature("animation"),i=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),j={};a.setStyles({position:"absolute"}),b.setStyles({position:"absolute"}),0!==c&&(e=-e),b.setStyle("top",e+"px"),b.setStyle("left","0px"),this._useCSS3&&h?(j.top=e+"px",j["margin-top"]=String(-e)+"px",j[h]="swipeVert "+d+"s",j[i]="ease-in-out",g.setStyles(j),setTimeout(function(){g.setStyle(h,""),g.setStyles({top:"0px","margin-top":"0px"}),b.setStyles({top:"0px"}),f()},1e3*d)):this._Tween.to(g,d,{top:String(-e),ease:"strong_easeInOut",onComplete:function(){b.setStyles({top:"0px"}),g.setStyles({top:"0px",left:"0px"}),f()}})},_crossFadeTransition:function(a,b,c,d,e){var f=this.injects().Utils.getCSSBrowserFeature("animation");a.setStyles({position:"absolute"}),b.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0"}),this._useCSS3&&f?(a.setStyle(f,"fadeOut "+d+"s"),b.setStyle(f,"fadeIn "+d+"s"),setTimeout(function(){b.setStyle(f,""),a.setStyle(f,""),b.setStyles({position:"absolute"}),e()},1e3*d)):(a.setStyles({opacity:"1.0"}),b.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(a,d,{opacity:0,ease:"swing"}),this._Tween.to(b,d,{opacity:1,ease:"swing",onComplete:function(){e()}}))},_shrinkFadeTransition:function(a,b,c,d,e){var f=a.getCoordinates(),g=a.getParent();a.setStyles({position:"absolute",top:"0px",left:"0px"}),b.setStyles({position:"absolute",top:"0px",left:"0px"});var h=new Element("div");h.setStyles({position:"absolute",width:f.width+"px",height:f.height+"px",overflow:"hidden"}),g.adopt(h),h.adopt(a),this._Tween.to(h,d,{top:parseInt(f.height/2)+"px",left:parseInt(f.width/2)+"px",width:"0px",height:"0px",ease:"swing",onComplete:function(){h.getParent().adopt(a),h.destroy(),e()}})},_inOutTransition:function(a,b,c,d,e){var f=this.injects().Utils.getCSSBrowserFeature("animation");a.setStyles({position:"absolute"}),b.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0",visibility:"visible"}),this._useCSS3&&f?(a.setStyle(f,"fadeOut "+d+"s"),b.setStyle(f,"fadeIn "+d+"s "+d+"s"),setTimeout(function(){a.setStyle(f,""),a.setStyles({opacity:"0.0"}),setTimeout(function(){b.setStyle(f,""),b.setStyles({opacity:"1.0"}),b.setStyles({position:"absolute"}),e()},1e3*d)},1e3*d)):(a.setStyles({opacity:"1.0"}),b.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(a,1.2*d,{opacity:0,ease:"strong_easeOut"}),this._Tween.to(b,d,{opacity:1,ease:"strong_easeIn",onComplete:function(){e()}}))},_startTracking:function(){this._frameRateTrackingActive=!0,this._frameRateCount=0,this._trackStartTime=(new Date).getTime(),window.requestAnimFrame(this._trackCallback)},_stopTracking:function(){this._frameRateTrackingActive=!1,((new Date).getTime()-this._trackStartTime)/1e3},_trackCallback:function(){this._frameRateCount++,this._frameRateTrackingActive&&window.requestAnimFrame(this._trackCallback)}})}),define.Class("wysiwyg.viewer.utils.TransitionUtils",function(a){var b=a;b.binds(["_swipeHorizontalTransition","_swipeHorizontalTransitionFullScreen","_swipeVerticalTransition","_swipeVerticalTransitionFullScreen","_noTransition","_inOutTransition","_crossFadeTransition","_shrinkFadeTransition","_trackCallback"]),b.fields({_useCSS3:!1,_frameRateTrackingActive:!1,_frameRateCount:0,_trackStartTime:0}),b.resources(["W.Config"]),b.methods({initialize:function(){this._Tween=W.Utils.Tween},getTransition:function(a){if(this.resources.W.Config.mobileConfig.isMobileOrTablet())return this._noTransition;switch(a){case Constants.TransitionTypes.SWIPE_HORIZONTAL:return this._swipeHorizontalTransition;case Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN:return this._swipeHorizontalTransitionFullScreen;case Constants.TransitionTypes.SWIPE_VERTICAL:return this._swipeVerticalTransition;case Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN:return this._swipeVerticalTransitionFullScreen;case Constants.TransitionTypes.CROSS_FADE:return this._crossFadeTransition;case Constants.TransitionTypes.SHRINK_FADE:return this._shrinkFadeTransition;case Constants.TransitionTypes.OUT_IN:return this._inOutTransition;case Constants.TransitionTypes.NONE:default:return this._noTransition}},_noTransition:function(a,b,c,d,e){e()},_swipeHorizontalTransition:function(a,b,c,d,e){var f=a.getWidth();this._swipeHorizontalTransitionCommon(a,b,c,d,f,e)},_swipeHorizontalTransitionFullScreen:function(a,b,c,d,e){var f=a.getContentRect(),g=Math.max($(document).getSize().x-f.left,f.right),h=g-b.getContentRect(b).left;this._swipeHorizontalTransitionCommon(a,b,c,d,h,e)},_swipeHorizontalTransitionCommon:function(a,b,c,d,e,f){var g=a.getParent(),h=this.injects().Utils.getCSSBrowserFeature("animation"),i=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),j={};a.setStyles({position:"absolute"}),b.setStyles({position:"absolute"}),0!==c&&(e=-e),b.setStyle("left",e+"px"),this._useCSS3&&h?(j.left=e+"px",j["margin-left"]=String(-e)+"px",j[h]="swipeHoriz "+d+"s",j[i]="ease-in-out",g.setStyles(j),setTimeout(function(){g.setStyle(h,""),g.setStyles({left:"0px","margin-left":"0px"}),b.setStyles({left:"0px"}),f()},1e3*d)):this._Tween.to(g,d,{left:String(-e),ease:"strong_easeInOut",onComplete:function(){b.setStyles({left:"0px"}),g.setStyles({top:"0px",left:"0px"}),f()}})},_swipeVerticalTransition:function(a,b,c,d,e){var f=a.getHeight();this._swipeVerticalTransitionCommon(a,b,c,d,f,e)},_swipeVerticalTransitionFullScreen:function(a,b,c,d,e){var f=a.getCoordinates().top+b.getHeight();this._swipeVerticalTransitionCommon(a,b,c,d,f,e)},_swipeVerticalTransitionCommon:function(a,b,c,d,e,f){var g=a.getParent(),h=this.injects().Utils.getCSSBrowserFeature("animation"),i=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),j={};a.setStyles({position:"absolute"}),b.setStyles({position:"absolute"}),0!==c&&(e=-e),b.setStyle("top",e+"px"),this._useCSS3&&h?(j.top=e+"px",j["margin-top"]=String(-e)+"px",j[h]="swipeVert "+d+"s",j[i]="ease-in-out",g.setStyles(j),setTimeout(function(){g.setStyle(h,""),g.setStyles({top:"0px","margin-top":"0px"}),b.setStyles({top:"0px"}),f()},1e3*d)):this._Tween.to(g,d,{top:String(-e),ease:"strong_easeInOut",onComplete:function(){b.setStyles({top:"0px"}),g.setStyles({top:"0px",left:"0px"}),f()}})},_crossFadeTransition:function(a,b,c,d,e){var f=this.injects().Utils.getCSSBrowserFeature("animation");a.setStyles({position:"absolute"}),b.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0"}),this._useCSS3&&f?(a.setStyle(f,"fadeOut "+d+"s"),b.setStyle(f,"fadeIn "+d+"s"),setTimeout(function(){b.setStyle(f,""),a.setStyle(f,""),b.setStyles({position:"absolute"}),e()},1e3*d)):(a.setStyles({opacity:"1.0"}),b.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(a,d,{opacity:0,ease:"swing"}),this._Tween.to(b,d,{opacity:1,ease:"swing",onComplete:function(){e()}}))},_shrinkFadeTransition:function(a,b,c,d,e){var f=a.getCoordinates(),g=a.getParent();a.setStyles({position:"absolute",top:"0px",left:"0px"}),b.setStyles({position:"absolute",top:"0px",left:"0px"});var h=new Element("div");h.setStyles({position:"absolute",width:f.width+"px",height:f.height+"px",overflow:"hidden"}),g.adopt(h),h.adopt(a),this._Tween.to(h,d,{top:parseInt(f.height/2)+"px",left:parseInt(f.width/2)+"px",width:"0px",height:"0px",ease:"swing",onComplete:function(){h.getParent().adopt(a),h.destroy(),e()}})},_inOutTransition:function(a,b,c,d,e){var f=this.injects().Utils.getCSSBrowserFeature("animation");a.setStyles({position:"absolute"}),b.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0",visibility:"visible"}),this._useCSS3&&f?(a.setStyle(f,"fadeOut "+d+"s"),b.setStyle(f,"fadeIn "+d+"s "+d+"s"),setTimeout(function(){a.setStyle(f,""),a.setStyles({opacity:"0.0"}),setTimeout(function(){b.setStyle(f,""),b.setStyles({opacity:"1.0"}),b.setStyles({position:"absolute"}),e()},1e3*d)},1e3*d)):(a.setStyles({opacity:"1.0"}),b.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(a,1.2*d,{opacity:0,ease:"strong_easeOut"}),this._Tween.to(b,d,{opacity:1,ease:"strong_easeIn",onComplete:function(){e()}}))},_startTracking:function(){this._frameRateTrackingActive=!0,this._frameRateCount=0,this._trackStartTime=(new Date).getTime(),window.requestAnimFrame(this._trackCallback)},_stopTracking:function(){this._frameRateTrackingActive=!1,((new Date).getTime()-this._trackStartTime)/1e3},_trackCallback:function(){this._frameRateCount++,this._frameRateTrackingActive&&window.requestAnimFrame(this._trackCallback)}})}),define.component("wysiwyg.viewer.components.AdminLogin",function(a){var b=a;b.inherits("wysiwyg.viewer.components.PasswordLogin"),b.binds(["centerDialog","_onSubmit","_reportError","_invalidateErrorState","_onKeyPress"]),b.skinParts({blockingLayer:{type:"htmlElement"},passwordInput:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},submitButton:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.PasswordLogin.Close"},favIcon:{type:"htmlElement"},header:{type:"htmlElement"},dialog:{type:"htmlElement"}}),b.dataTypes(["Text"]),b.states(["normal","confirm"]),b.methods({initialize:function(a,b,c){this.isVolatile=!0,this._userApi=!window.userApi&&window.UserApi?window.UserApi.getInstance().init({orgDocID:"",usersDomain:window.usersDomain||'https://users.wix.com/wix-users";',corsEnabled:!0,dontHandShake:!0,urlThatUserRedirectedFrom:""}):window.userApi,this.parent(a,b,c),this.VIEWER_STRINGS.LOGIN_HEADER="Login to edit your site",this.ERR_MAP={9975:this.VIEWER_STRINGS.LOGIN_ERR_GENERAL,9972:this.VIEWER_STRINGS.LOGIN_ERR_WRONG_PASSWORD}},_validatePassword:function(a,b,c){var d=this._validateInput(a);if(d)c(d);else{var e=window.rendererModel,f=e.metaSiteId,g=e.siteId,h=window.siteHeader.userId;this.injects().Config.getServiceTopologyProperty("serverName");var i=!1,j=this.injects().Config.getServiceTopologyProperty("htmlEditorUrl")+"/editor/web/renderer/edit/"+g+"?metaSiteId="+f;if(!this._userApi)return this._reportError(this.VIEWER_STRINGS.LOGIN_ERR_GENERAL),void 0;this._userApi.loginByGuid(h,a,i,function(){c(this.VIEWER_STRINGS.LOGIN_ERR_GENERAL)}.bind(this),function(a){var d=a.success;if(d)b(),(this.injects().Viewer.isPublicMode()||this._debugMode)&&window.open(j,"_blank");else{var e=this.ERR_MAP[a.errorCode]||this.ERR_MAP[9975];c(e)}}.bind(this))}},_onSubmit:function(){this.injects().Viewer.isPublicMode()?this.parent():this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this._skinParts.submitButton},this)},_validateInput:function(a){var b=a.length;return 4>b||b>15?this.ERR_MAP["9972"]:0==a.test(/^[a-zA-Z0-9_\-!@#$%^&*]+$/)?this.ERR_MAP["9972"]:null}})}),define.component("wysiwyg.viewer.components.AdminLoginButton",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteButton"),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),b.propertiesSchemaType("ButtonProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)}})}),define.component("wysiwyg.viewer.components.AudioPlayer",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_play","_pause","_stop","_setVolume","_onApiLoaded","_createAudioPlayer","_soundManagerReady"]),b.resources(["scriptLoader","W.Config"]),b.skinParts({playButton:{type:"htmlElement"},stopButton:{type:"htmlElement"},pauseButton:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"AUDIO_REPLACE_AUDIO",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"audio"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"audio"},commandParameterDataRef:"SELF"}}}),b.states(["loading","stopped","playing"]),b.dataTypes(["AudioPlayer"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setState("loading"),this._loadApi()},_onAllSkinPartsReady:function(){this.$class._audioManagerWasLoaded&&this.setState("stopped"),this._createAudioPlayer()},_createAudioPlayer:function(){return this.$class._audioManagerWasLoaded?(this._skinParts.playButton.addEvent("click",this._play),this._skinParts.stopButton.addEvent("click",this._stop),this._skinParts.pauseButton.addEvent("click",this._pause),this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),this.$class._audioManagerWasLoaded&&(this._audio=this._createAudioObject()),!this.injects().Viewer.getPreviewMode()&&this.getIsDisplayed()&&this._data.get("autoPlay")&&this._play(),void 0):(W.Utils.callLater(this._createAudioPlayer,null,this,10),void 0)},_onModeChange:function(a){this._isInPreviewMode(a)&&this.getIsDisplayed()&&this._data.get("autoPlay")&&this._fileWasSet()?this._play():this._stop()},_fileWasSet:function(){return this._data.get("uri").length>0},_isInPreviewMode:function(a){return a.toLowerCase()===Constants.ViewManager.VIEW_MODE_PREVIEW.toLowerCase()},_play:function(){if(this._fileWasSet()){this.setState("playing");var a={volume:this._data.get("volume")};this._data.get("loop")&&(a.onfinish=this._play),this._audio&&this._audio.play(a)}},_pause:function(){this._fileWasSet()&&(this.setState("stopped"),this._audio.pause())},_stop:function(){this._fileWasSet()&&this._audio&&(this.setState("stopped"),this._audio.stop(),this._audio.destruct(),this._audio=this._createAudioObject())},_createAudioObject:function(){return soundManager.createSound({id:this._view.getAttribute("id"),url:this._getFullUrl(this._data.get("uri"))})},_getFullUrl:function(a){if(-1===a.indexOf("http://")){var b=window.serviceTopology.staticAudioUrl;return"/"!==b[b.length-1]&&(b+="/"),b+=a}return a},_setVolume:function(a){var b=a.value||100;this._audio.volume=b/100},_onDataChange:function(a){this.parent(a),this._stop()},_getSoundManagerFolder:function(){var a=this.resources.W.Config.getServiceTopologyProperty("scriptsRoot");return"/"!==a[a.length-1]&&(a+="/"),a+="resources/wysiwyg/media/soundmanager2/"},_onApiLoaded:function(){soundManager=new SoundManager,soundManager.setup({url:this._getSoundManagerFolder(),onready:this._soundManagerReady}),soundManager.beginDelayedInit()},_soundManagerReady:function(){this.$class._audioManagerWasLoaded=!0,this.$class._soundManagerReadyCallbacks&&this.$class._soundManagerReadyCallbacks.forEach(function(a){a()})},_loadApi:function(){SM2_DEFER=!0,this.$class.audioApiLoaded||(this.$class.audioApiLoaded=!0,this.resources.scriptLoader.loadResource({url:this._getSoundManagerFolder()+"soundmanager2-nodebug-jsmin.js"},{onLoad:this._onApiLoaded,onFailed:function(){LOG.reportError("failed to load soundmanager2")}})),this.$class._soundManagerReadyCallbacks=this.$class._soundManagerReadyCallbacks||[],this.$class._soundManagerReadyCallbacks.push(this.setState.bind(this,"stopped"))},onPageVisibilityChange:function(a){"editor"!==window.viewMode&&(a||"playing"!==this.getState()?a&&this._data.get("autoPlay")&&"playing"!==this.getState()&&this._play():this._pause())}})}),define.component("wysiwyg.viewer.components.ClipArt",function(a){var b=a;b.inherits("wysiwyg.viewer.components.WPhoto"),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*"}}),b.propertiesSchemaType("WPhotoProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"CLIP_ART_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"clipart"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"clipart"}}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setComponentProperty("displayMode","stretch",!0)}})}),define.component("wysiwyg.viewer.components.ContactForm",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onButtonClick","_sendEmailCompleted"]),b.skinParts({nameLabel:{type:"htmlElement"},name:{type:"htmlElement"},emailLabel:{type:"htmlElement"},email:{type:"htmlElement"},subjectLabel:{type:"htmlElement"},subject:{type:"htmlElement"},messageLabel:{type:"htmlElement"},message:{type:"htmlElement"},notifications:{type:"htmlElement"},send:{type:"htmlElement"}}),b.dataTypes(["ContactForm"]),b.states(["editing","errors","processing"]),b.fields({Resources:{en:{CONTACT_FORM_LABEL_NAME:"Name",CONTACT_FORM_LABEL_EMAIL:"Email",CONTACT_FORM_LABEL_SUBJECT:"Subject",CONTACT_FORM_LABEL_MESSAGE:"Message",CONTACT_FORM_LABEL_SENDING:"Sending...",CONTACT_FORM_LABEL_SENT_SUCCESSFULLY:"Your email was sent successfully!",CONTACT_FORM_BUTTON_SEND:"Send",CONTACT_FORM_ERROR_NAME_MISSING:"Please add your name",CONTACT_FORM_ERROR_EMAIL_INVALID:"Please add a valid email",CONTACT_FORM_ERROR_MESSAGE_MISSING:"Please add a message",CONTACT_FORM_ERROR_OWNER_NOT_DEFINED:"Owner email address not set",CONTACT_FORM_ERROR_GENERAL:"Error sending email, please try again later",CONTACT_FORM_EMAIL_SUBJECT:"New message via your Wix website, from - ",CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT:"<no subject>",CONTACT_FORM_EMAIL_HTML_TEMPLATE:"<strong>You have a new message</strong><br/>via: WIX___THE_CURRENT_WEBSITE___<br/><br/><strong>Message details:</strong><br/>From: WIX___SENDER_NAME___<br/>Email: WIX___SENDER_EMAIL___<br/>Date: WIX___FORMATTED_DATE___<br/>Subject: WIX___MESSAGE_SUBJECT___<br/><br/><strong>Message:</strong><br/>WIX___MESSAGE_BODY___<br/><br/><br/>Thank you for using Wix.com!",CONTACT_FORM_EMAIL_TEXT_TEMPLATE:"You have a new message\nvia: WIX___THE_CURRENT_WEBSITE___\n\nMessage details:\nFrom: WIX___SENDER_NAME___\nEmail: WIX___SENDER_EMAIL___\nDate: WIX___FORMATTED_DATE___\nSubject: WIX___MESSAGE_SUBJECT___\n\nMessage:\nWIX___MESSAGE_BODY___\n\n\nThank you for using Wix.com!",PREMIUM_CONTACT_FORM_LABEL_NAME:"Name",PREMIUM_CONTACT_FORM_LABEL_EMAIL:"Email",PREMIUM_CONTACT_FORM_LABEL_SUBJECT:"Subject",PREMIUM_CONTACT_FORM_LABEL_MESSAGE:"Message",PREMIUM_CONTACT_FORM_LABEL_SENDING:"Sending...",PREMIUM_CONTACT_FORM_LABEL_SENT_SUCCESSFULLY:"Your email was sent successfully!",PREMIUM_CONTACT_FORM_BUTTON_SEND:"Send",PREMIUM_CONTACT_FORM_ERROR_NAME_MISSING:"Please add your name",PREMIUM_CONTACT_FORM_ERROR_EMAIL_INVALID:"Please add a valid email",PREMIUM_CONTACT_FORM_ERROR_MESSAGE_MISSING:"Please add a message",PREMIUM_CONTACT_FORM_ERROR_OWNER_NOT_DEFINED:"Owner email address not set",PREMIUM_CONTACT_FORM_ERROR_GENERAL:"Error sending email, please try again later",PREMIUM_CONTACT_FORM_EMAIL_SUBJECT:"New message via your website, from - ",PREMIUM_CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT:"<no subject>",PREMIUM_CONTACT_FORM_EMAIL_HTML_TEMPLATE:"<strong>You have a new message</strong><br/>via: WIX___THE_CURRENT_WEBSITE___<br/><br/><strong>Message details:</strong><br/>From: WIX___SENDER_NAME___<br/>Email: WIX___SENDER_EMAIL___<br/>Date: WIX___FORMATTED_DATE___<br/>Subject: WIX___MESSAGE_SUBJECT___<br/><br/><strong>Message:</strong><br/>WIX___MESSAGE_BODY___<br/><br/><br/>Thank you!",PREMIUM_CONTACT_FORM_EMAIL_TEXT_TEMPLATE:"You have a new message\nvia: WIX___THE_CURRENT_WEBSITE___\n\nMessage details:\nFrom: WIX___SENDER_NAME___\nEmail: WIX___SENDER_EMAIL___\nDate: WIX___FORMATTED_DATE___\nSubject: WIX___MESSAGE_SUBJECT___\n\nMessage:\nWIX___MESSAGE_BODY___\n\n\nThank you!"},get:function(a,b){return this.en[b]}}}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._lists={enabled:!1,storeId:null,accessToken:null},this._metaSiteId=null,this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},_onAllSkinPartsReady:function(){function a(a){if(this.set("placeholder",a),window.Modernizr&&!window.Modernizr.input.placeholder){var b=function(){var a=this;""==a.get("value")&&a.get("placeholder")&&(a.addClass("isPlaceholder"),a.set("value",a.get("placeholder")))}.bind(this),c=function(){var a=this;a.hasClass("isPlaceholder")&&(a.removeClass("isPlaceholder"),a.set("value",""))}.bind(this);this.hasPlaceholder||(this.hasPlaceholder=!0,this.addEvent("focus",c),this.addEvent("blur",b)),b()}}this.setHeight(this._skin._height||180),this.setState("editing"),this._skinParts.send.addEvent("click",this._onButtonClick),this._skinParts.send.enable=function(){this.removeProperty("disabled")}.bind(this._skinParts.send),this._skinParts.send.disable=function(){this.set("disabled","true")}.bind(this._skinParts.send),this._skinParts.name.setPlaceholder=a.bind(this._skinParts.name),this._skinParts.email.setPlaceholder=a.bind(this._skinParts.email),this._skinParts.subject.setPlaceholder=a.bind(this._skinParts.subject)},render:function(){this._skinParts.nameLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_NAME"))),this._skinParts.emailLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_EMAIL"))),this._skinParts.subjectLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SUBJECT"))),this._skinParts.messageLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_MESSAGE"))),this._skin.hidePlaceholders!==!0&&(this._skinParts.name.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_NAME"))),this._skinParts.email.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_EMAIL"))),this._skinParts.subject.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SUBJECT")))),this._skinParts.send.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_BUTTON_SEND")))},_prepareForRender:function(){try{if(this._metaSiteId=rendererModel.metaSiteId,this._metaSiteId||(this._metaSiteId="dc853130-4fb2-464f-878d-3b6667dc4f97"),this._lists.enabled){var a=rendererModel.serviceMappings;for(var b in a)if("WixLists"==a[b].applicationType){this._lists.storeId=a[b].idInApp;break}}}catch(c){}return this.parent()},_onButtonClick:function(){try{var a={name:this._skinParts.name.get("value").trim(),email:this._skinParts.email.get("value").trim(),subject:this._skinParts.subject.get("value").trim(),message:this._skinParts.message.get("value").trim()};this._validateForm(a),this._submitForm(a,this._metaSiteId,this._getWebsiteUrl(),new Date)}catch(b){this._skinParts.send.enable(),this.setState("errors"),this._setNotificationMessage("validation-error"==b.type?b.message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_GENERAL")))}},_getWebsiteUrl:function(){var a=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname));return this._isPreviewMode()?a:window.publicModel&&publicModel.externalBaseUrl||a},_isPreviewMode:function(){return"site"!=this.injects().Viewer.getViewMode()},_addPremiumPrefixToIdIfNeeded:function(a){return this.injects().Viewer.isPremiumUser()&&(a="PREMIUM_"+a),a},_validateForm:function(a){if(a.name.length<1)throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_NAME_MISSING"))};var b=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!b.test(a.email))throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_EMAIL_INVALID"))};if(a.message.length<1)throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_MESSAGE_MISSING"))};var c=this._data.get("toEmailAddress");if(!c||0==c.trim())throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_OWNER_NOT_DEFINED"))}},_submitForm:function(a,b,c,d){this.setState("processing"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SENDING"))),this._skinParts.send.disable(),0==a.subject.length&&(a.subject=this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT")));var e=this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_SUBJECT")),f=this._formatMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_HTML_TEMPLATE")),a,c,!0,d),g=this._formatMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_TEXT_TEMPLATE")),a,c,!1,d),h=this._data.get("toEmailAddress"),i=this._data.get("bccEmailAddress");e+=a.email,this.sendEmail([{address:h,personal:h}],[],i?[{address:i,personal:i}]:[],{address:a.email,personal:a.name},e,f,g,b,this._sendEmailCompleted);try{this._createListEntry(a)}catch(j){}},_sendEmailCompleted:function(a){this._skinParts.send.enable(),a?(this.setState("editing"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SENT_SUCCESSFULLY"))),this._cleanForm()):(this.setState("errors"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_GENERAL"))))},_cleanForm:function(){this._skinParts.name.set("value",""),this._skinParts.email.set("value",""),this._skinParts.subject.set("value",""),this._skinParts.message.set("value","")},_formatMessage:function(a,b,c,d,e){var f=function(a){return a?String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a},g=function(a){return d?f(a):a},h=a;return h=h.replace(/WIX___THE_CURRENT_WEBSITE___/g,c),h=h.replace("WIX___SENDER_NAME___",g(b.name)),h=h.replace("WIX___SENDER_EMAIL___",b.email),h=h.replace("WIX___MESSAGE_SUBJECT___",g(b.subject)),h=h.replace("WIX___MESSAGE_BODY___",g(b.message)),h=h.replace("WIX___FORMATTED_DATE___",this._formatDate(e))},_formatDate:function(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=a.getDate(),d=a.getMonth(),e=a.getFullYear();return(10>c?"0":"")+c+" "+b[d]+" "+e},_setNotificationMessage:function(a){this._skinParts.notifications.set("text",a),""==a.trim()?this._skinParts.notifications.collapse():this._skinParts.notifications.uncollapse()},sendEmail:function(a,b,c,d,e,f,g,h,i){var j={to:a,cc:b,bcc:c,from:d,subject:e,htmlMessage:f,plainTextMessage:g,metaSiteId:h},k=this.injects(),l=k.Config.getServiceTopologyProperty("emailServer"),m=this._isPreviewMode();m&&(l+="Secured");var n=[];n.push(l),n.push("?accept=json&contentType=json"),n.push("&appUrl="+encodeURIComponent(window.location.href)),m&&n.push("&wixSession="+k.CookiesManager.getCookie("wixSession")),this._sendJsonCORS(n.join(""),j,"POST",i)},_sendJsonCORS:function(a,b,c,d){var e=function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?(c.open(a,b,!0),c.withCredentials="true"):"undefined"!=typeof XDomainRequest&&(c=new XDomainRequest,c.open(a,b),c.setRequestHeader=function(){}),c},f=function(a){if(!h.responseText)return{success:!1,errorDescription:"Invalid ajax response, no responseText",errorCode:-9001};var b=JSON.parse?JSON.parse:eval;
try{return b(a)}catch(c){return{success:!1,errorDescription:"Invalid JSON object",errorCode:-9e3}}},g=function(a){return a.errorDescription+" ("+a.errorCode+")"},h=e(c,a);h.onabort=function(){d(!1,"request aborted")},h.ontimeout=function(){d(!1,"request timeout")},h.onerror=function(){d(!1,g(f(h.responseText)))},h.onload=function(){var a=f(h.responseText);d(a.success,a.success?a:g(a))},h.setRequestHeader("Content-Type","application/json"),h.send(JSON.encode(b))},_createListEntry:function(a){if(this._lists.enabled&&this._lists.storeId){var b=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)),c="/apps/lists/1/stores/"+this._lists.storeId+"/collections/ContactForms,online",d={_type:"BasicForms.ContactForm",name:a.name,email:a.email,subject:a.subject,message:a.message,createdAt:(new Date).getTime(),sourceForm:this._view.get("id")},e=function(){var a=function(){}.bind(this),e=new Request.JSON({url:b+c,urlEncoded:!1,headers:{"If-Modified-Since":"Sat, 1 Jan 2005 00:00:00 GMT","Content-Type":"application/json; charset=utf-8",Accept:"application/json",AccessToken:this._lists.accessToken},onSuccess:a,onFailure:a});e.post(JSON.encode(d))}.bind(this);this._validateListAccessToken(e)}},_validateListAccessToken:function(a){if(this._lists.enabled){if(this._lists.accessToken)return a(),void 0;var b=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)),c="/apps/lists/1/auth/contact-forms?storeId="+this._lists.storeId,d=function(b){try{b.success&&(this._lists.accessToken=b.payload,a())}catch(c){}}.bind(this),e=function(){},f=new Request.JSON({url:b+c,urlEncoded:!1,headers:{"If-Modified-Since":"Sat, 1 Jan 2005 00:00:00 GMT",Accept:"application/json"},onSuccess:d,onFailure:e});f.get()}}})}),define.component("wysiwyg.viewer.components.Displayer",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({image:{type:"core.components.Image",dataRefField:"*",optional:!1},imageWrapper:{type:"htmlElement",optional:!1},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1},rolloverHitArea:{type:"htmlElement",optional:!0}}),b.binds(["_onMouseOver","_onMouseOut","_onZoomClick","_onImageStateChange","_onOwnerPropsChanged"]),b.traits(["wysiwyg.common.components.traits.LinkableComponent","wysiwyg.common.components.traits.SelectableOption"]),b.states({general:["loading","normal","rollover"],transitionPhase:["noTransition","transIn","transOut"],linkableComponent:["link","noLink"],selectState:["selected","unselected"]}),b.dataTypes(["Image"]),b.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE],_parentList:null,_owner:null,_expandEnabled:!0,_debugMode:!1,_lastSetSizeParams:null}),b.methods({initialize:function(a,b,c){this._NO_LINK_PROPAGATION=!0,b.setStyle("visibility","hidden"),this.parent(a,b,c)},render:function(){this._refreshImage(),this.parent()},setOwner:function(a){if(this._owner&&this._owner.getComponentProperties().removeEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this._owner=a,this._parentList=this._owner.getDataItem(),this._owner.getComponentProperties().addEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this._onOwnerPropsChanged(),this._debugMode){var b=this._data.get("id"),c=this._parentList.getData().items.indexOf("#"+b),d=new Element("div");this._debugMode=!1,d.set("text",String(c)),d.setStyles({position:"relative",top:"-20px"}),this.getViewNode().adopt(d)}},_onOwnerPropsChanged:function(){this._isDisposed||this._owner&&this._owner._isDisposed||(this._galleryImageOnClickAction=this._owner.getComponentProperties().hasField("galleryImageOnClickAction")?this._owner.getComponentProperty("galleryImageOnClickAction"):this._owner.getComponentProperty("expandEnabled")===!0?"zoomMode":"disabled",this._skinParts.link.set("text",this._owner.getComponentProperty("goToLinkText")),this._isImageClickable()||-1==this.getState().indexOf("rollover")||this.setState("rollover","general"),this._updateParts())},setParentList:function(a){this._parentList=a},_setupParts:function(){var a=this._skinParts.rollOverHitArea||this._view,b=this._skinParts.zoom||this._skinParts.imageWrapper;this._skinParts.image.addEvent("stateChange",this._onImageStateChange),b.addEvent(Constants.CoreEvents.CLICK,this._onZoomClick),a.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onMouseOver),a.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onMouseOut);var c={overflow:"hidden","text-overflow":"ellipsis"};this._skinParts.title.setStyles(c),this._skinParts.description.setStyles(c)},_updateParts:function(){if(this._skinParts){this._skinParts.image.getDataItem&&this._data&&this._data!==this._skinParts.image.getDataItem()&&this._skinParts.image.setDataItem(this._data),this._skinParts.title.set("text",this._data.get("title")),this._skinParts.description.set("text",this._data.get("description"));var a=this._skinParts.zoom||this._skinParts.imageWrapper;a.setStyle("cursor",this._isImageClickable()?"pointer":"default"),"goToLink"!==this._galleryImageOnClickAction&&this._isImageLinked()?this._skinParts.link.setStyle("display","block"):this._skinParts.link.setStyle("display","none")}},_onImageStateChange:function(a){switch(a.newState){case"loading":this.setState("loading","general");break;case"loaded":this.setState("normal","general")}},_onMouseOver:function(){this._isImageClickable()&&-1!=this.getState().indexOf("normal")&&this.setState("rollover","general")},_onMouseOut:function(){this._isImageClickable()&&-1!=this.getState().indexOf("rollover")&&this.setState("normal","general")},zoom:function(){var a=this._data.get("id"),b=this._parentList.getData().items.indexOf("#"+a);this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._parentList,currentIndex:b,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.injects().Viewer.getDefaultGetHashPartsFunction("Image")})},goToLink:function(){if(this._skinParts.link.click)this._skinParts.link.click();else{var a=document.createEvent("HTMLEvents");a.initEvent("click",!0,!0),this._skinParts.link.dispatchEvent(a)}},_onZoomClick:function(a){a.rightClick===!1&&("zoomMode"==this._galleryImageOnClickAction?this.zoom():"goToLink"==this._galleryImageOnClickAction&&this.goToLink())},setSize:function(a,b,c){var d,e;if((!this._lastSetSizeParams||this._lastSetSizeParams[0]!==a||this._lastSetSizeParams[1]!==b||this._lastSetSizeParams[2]!==c)&&this._componentReady&&this._skinParts){switch(this._skinParts.image.checkVisibility(),d=this._skin.widthDiff||0,e=this._skin.heightDiff||0,c=c||"clipImage"){case"clipImage":this._clipImage(a,b,d,e);break;case"flexibleHeight":this._setFlexibleHeight(a,b,d,e);break;case"flexibleWidth":this._setFlexibleWidth(a,b,d,e,!0);break;case"flexibleWidthFixed":this._setFlexibleWidth(a,b,d,e,!1)}this._refreshImage(),this._lastSetSizeParams=[arguments[0],arguments[1],arguments[2]]}},invalidateSize:function(){this._lastSetSizeParams=null},getWidthDiff:function(){return this._skin.widthDiff||0},getHeightDiff:function(){return this._skin.heightDiff||0},_refreshImage:function(){this._componentReady&&(this._skinParts.image._invalidate("size"),this._skinParts.image._renderIfReady())},_clipImage:function(a,b,c,d){c=this._skin.widthDiff||0,d=this._skin.heightDiff||0;var e=a-c,f=b-d;this._setWrapperSize(e,f),this._setDisplayerSize(a,b)},_setFlexibleHeight:function(a,b,c,d){c=this._skin.widthDiff||0,d=this._skin.heightDiff||0;var e=a-c,f=Math.floor(e/this._getAspectRatio());this._setWrapperSize(e,f-d),this._setDisplayerSize(a,f)},_setFlexibleWidth:function(a,b,c,d,e){c=this._skin.widthDiff||0,d=this._skin.heightDiff||0;var f,g=0,h=0,i=b-d,j=i*this._getAspectRatio();!e&&j>a-c&&(f=(a-c)/j,j=a-c,i=f*i),e||(g=Math.floor((a-j-c)/2),h=Math.floor(b-i-d)/2),this._view.setStyle("width",String(j+c)+"px"),this._setWrapperSize(j,i,g,h),e?this._setDisplayerSize(j,b):this._setDisplayerSize(a,b)},_getAspectRatio:function(){var a=this._skinParts.image.getDataItem(),b=parseInt(a.get("width"))/parseInt(this._data.get("height"));return b},_setWrapperSize:function(a,b,c,d){c=c||0,d=d||0;var e=0>b?0:b,f=0>a?0:a;this._skinParts.imageWrapper.setStyles({width:String(f)+"px",height:String(e)+"px","margin-left":String(c)+"px","margin-right":String(c)+"px","margin-top":String(d)+"px","margin-bottom":String(d)+"px"})},_setDisplayerSize:function(a,b){this._view.setStyles({width:String(a)+"px",height:String(b)+"px"}),this.setWidth(a),this.setHeight(b),this.fireEvent("autoSized")},_onDataChange:function(){this.parent(),this._updateParts()},_onAllSkinPartsReady:function(){this.parent(),this._view.setStyle("visibility","visible"),this._updateParts(),this._setupParts()},_onResize:function(){this.parent(),this._refreshImage()},getImageRef:function(){var a="";return this._skinParts&&(a=String(this._skinParts.image.getDataItem().get("id"))),a},isImageLoading:function(){var a=!1;return this._componentReady&&(a=-1!=this._skinParts.image.getState().indexOf("loading")),a},dispose:function(){this._owner&&this._owner.getComponentProperties().removeEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this.parent()},_isImageLinked:function(){var a=this.getDataItem().get("href");return!!a},_isImageClickable:function(){return"goToLink"===this._galleryImageOnClickAction?this._isImageLinked():"disabled"!==this._galleryImageOnClickAction},setSelected:function(a){this.setState(a?"selected":"unselected","selectState")}})}),define.component("wysiwyg.viewer.components.EbayItemsBySeller",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({iFrameHolder:{type:"htmlElement"}}),b.propertiesSchemaType("EbayItemsBySellerProperties"),b.binds(["_applyThemeColors"]),b.states(["hasContent","noContent"]),b.dataTypes(["EbayItemsBySeller"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}},_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED]}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this.addEvent("resizeEnd",this._onResizeEnd),this._iframe=null},options:{width:0,height:0,url:""},render:function(){var a=this._data.get("sellerId");if(this.setState(a?"hasContent":"noContent"),a){var b=this._createUrl(a,this._data.get("registrationSite"),this._prepareOptions()),c=this._createIFrame(b.width,b.height);this.injects().Utils.prepareIFrameForWrite(c,function(a,c){c.write('<html><body style="margin:0px;"><div><script type="text/javascript" src="'+b.url+'"></script></div></body></html>'),a.setStyles({height:b.height,width:b.width})})}},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},dispose:function(){this._style.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors),this.parent()},_applyThemeColors:function(a){var b=["fontColor","borderColor","headerColor","backgroundColor","linkColor"];for(var c in a.properties)if(b.indexOf(c)>-1)return this._renderIfReady(),void 0},_onResizeEnd:function(){this._renderIfReady()},_prepareOptions:function(){var a=this.injects().Skins,b=this._skin.className,c=a.getSkinParamValue(b,"fontColor",this._style).getHex(!1),d=a.getSkinParamValue(b,"borderColor",this._style).getHex(!1),e=a.getSkinParamValue(b,"headerColor",this._style).getHex(!1),f=a.getSkinParamValue(b,"backgroundColor",this._style).getHex(!1),g=a.getSkinParamValue(b,"linkColor",this._style).getHex(!1);return{width:this._view.getWidth(),height:this._view.getHeight(),headerImage:this.getComponentProperty("headerImage"),fontColor:c.replace("#",""),borderColor:d.replace("#",""),headerColor:e.replace("#",""),backgroundColor:f.replace("#",""),linkColor:g.replace("#","")}},_createUrl:function(a,b,c){var d=Math.floor((c.height-100)/70),e={Australia:"15",Austria:"16",Belgium_Dutch:"123",Belgium_French:"23",Canada:"2",CanadaFrench:"210",China:"223",eBayMotors:"100",France:"71",Germany:"77",HongKong:"201",India:"203",Ireland:"205",Italy:"101",Malaysia:"207",Netherlands:"146",Philippines:"211",Poland:"212",Singapore:"216",Spain:"186",Sweden:"218",Switzerland:"193",Taiwan:"196",UK:"3",US:"0",findId:function(a){var b=this[a];return b||(b=0),b}},f=this.urlCreator("http://lapi.ebay.com/ws/eBayISAPI.dll").addParam("EKServer").addParam("ai","aj|kvpqvqlvxwkl").addParam("bdrcolor",c.borderColor).addParam("fntcolor",c.fontColor).addParam("hdrcolor",c.headerColor).addParam("hdrimage",c.headerImage).addParam("lnkcolor",c.linkColor).addParam("tbgcolor",c.backgroundColor).addParam("si",a).addParam("sid",a).addParam("num",d).addParam("width",c.width).addParam("cid","0").addParam("eksize","1").addParam("encode","UTF-8").addParam("endcolor","FF0000").addParam("endtime","y").addParam("fbgcolor","FFFFFF").addParam("fs","0").addParam("hdrsrch","n").addParam("img","y").addParam("logo","6").addParam("numbid","n").addParam("paypal","n").addParam("popup","y").addParam("prvd","9").addParam("r0","3").addParam("shipcost","y").addParam("siteid",e.findId(b)).addParam("sort","MetaEndSort").addParam("sortby","endtime").addParam("sortdir","asc").addParam("srchdesc","n").addParam("title","").addParam("tlecolor","FFFFFF").addParam("tlefs","0").addParam("tlfcolor","000000").addParam("toolid","10004").addParam("track","5335838312");return c.url=f.toString(),c},_createIFrame:function(){var a=new IFrame;return a.width=this.options.width,a.height=this.options.height,this._iframe?a.replaces(this._iframe):a.insertInto(this._skinParts.iFrameHolder),this._iframe=a,a},urlCreator:function(a){return{_baseUrl:a,_params:[],addParam:function(a,b){return this._params.push({key:a,value:b}),this},toString:function(){var a=[];a.push(this._baseUrl),this._params.length>0&&a.push("?");for(var b=0;b<this._params.length;b++){var c=this._params[b];b>0&&a.push("&"),a.push(c.key),c.value&&(a.push("="),a.push(encodeURIComponent(c.value)))}return a.join("")}}}})}),define.component("wysiwyg.viewer.components.FiveGridLine",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({line:{type:"htmlElement"},lineCnt:{type:"htmlElement",optional:!0},leftKnobCnt:{type:"htmlElement",optional:!0},leftKnob:{type:"htmlElement",optional:!0},middleKnobCnt:{type:"htmlElement",optional:!0},middleKnob:{type:"htmlElement",optional:!0},rightKnobCnt:{type:"htmlElement",optional:!0},rightKnob:{type:"htmlElement",optional:!0}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Theme.setProperty("WEB_THEME_DIRECTORY","viewer"),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},render:function(){this.getHeight()},setWidth:function(a){this._getNumberOfKnobs(),this.width=a,this.parent(a)},_getNumberOfKnobs:function(){var a=0;return this._skinParts&&(this._skinParts.rightKnob&&a++,this._skinParts.leftKnob&&a++,this._skinParts.middleKnob&&a++),a}})}),define.component("wysiwyg.viewer.components.FlashComponent",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils"]),b.binds(["_enforceDisplayMode"]),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.skinParts({flashContainer:{type:"htmlElement"},link:{type:"htmlElement",optional:!1},mouseEventCatcher:{type:"htmlElement"},noFlashImgContainer:{type:"htmlElement"},noFlashImg:{type:"core.components.Image",dataRefField:"placeHolderImage",argObject:{cropMode:"full"}}}),b.dataTypes(["FlashComponent"]),b.states({linkableComponent:["link","noLink"]}),b.propertiesSchemaType("FlashComponentProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GENERAL_CHANGE",command:"WEditorCommands.OpenFlashDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenFlashDialog"}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._noFlashMode=!0,this._params={},this._attributes={},this._params.quality="high",this._params.bgcolor="#FAFAFA",this._params.allowscriptaccess="always",this._params.allowfullscreen="true",this._params.wMode="transparent",this._params.scale="exactFit",this._params.flashVars="",this._attributes.align="middle"},render:function(){this._createFlashEmbed(),this.parent()},_createFlashEmbed:function(a){var b=this._data.get("uri");if(b||this._uri||(this._mediaWidth=this._mediaWidth||this.getWidth(),this._mediaHeight=this._mediaHeight||this.getHeight()),a&&this._uri||b&&b!=this._uri){this._uri=b,this._mediaWidth=this._data.get("width"),this._mediaHeight=this._data.get("height");var c=this.injects().Config.getServiceTopologyProperty("staticMediaUrl")+"/"+this._uri;this._skinParts.flashContainer.empty(),this._embedDivID=this.resources.W.Utils.getUniqueId("ExtSWF"),this._embedDIV=new Element("DIV",{id:this._embedDivID}),this._skinParts.flashContainer.adopt(this._embedDIV),this._params.play=this.injects().Viewer.isPublicMode()||this._inPreviewMode?"true":"false",this._params.autoplay=this.injects().Viewer.isPublicMode()||this._inPreviewMode?"true":"false",this._flashObj=swfobject.embedSWF(c,this._embedDivID,"100%","100%","10.0.0","playerProductInstall.swf",null,this._params,this._attributes,function(a){a.success&&(this._noFlashMode=!1,this._skinParts.noFlashImgContainer.collapse(),this._embedCreated=!0),this._enforceDisplayMode()}.bind(this))}var d=this.getComponentProperty("displayMode");d!=this._displayMode&&(this._displayMode=d,this._enforceDisplayMode())},_editModeChanged:function(a){this._inPreviewMode="PREVIEW"==a,this._createFlashEmbed(!0)},_onResize:function(){this.isReady()&&this._embedCreated&&this._enforceDisplayMode()},_enforceDisplayMode:function(){var a=this._displayMode||this.getComponentProperty("displayMode");"fit"==a?this._width!=this.getWidth()?(this._width=this.getWidth(),this._height=this._width*(this._mediaHeight/this._mediaWidth)):(this._height=this.getHeight(),this._width=this._height*(this._mediaWidth/this._mediaHeight)):"stretch"==a?(this._width=this.getWidth(),this._height=this.getHeight()):(this._width=this._mediaWidth,this._height=this._mediaHeight),this.setWidth(this._width,!0,!1),this.setHeight(this._height,!0,!1),this.getViewNode().setStyles({width:this._width+"px",height:this._height+"px"}),this._noFlashMode&&this._skinParts.noFlashImg.setSize(this._width,this._height,"px"),this._wCheckForSizeChangeAndFireAutoSized(1)},_onDataChange:function(a){this.parent(),this.fireEvent("propertyChanged",a.getData().displayMode)}})}),define.component("wysiwyg.viewer.components.FlickrBadgeWidget",function(a){var b=a;b.utilize(["core.utils.css.Color"]),b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({iframe:{type:"htmlElement"},overlay:{type:"htmlElement"},overlayClick:{type:"htmlElement"}}),b.binds(["_applyThemeColors","_updateIframeDimensions"]),b.states([]),b.dataTypes(["FlickrBadgeWidget"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}},_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],_backgroundColor:void 0,_backgroundAlpha:void 0,_borderColor:void 0,_borderAlpha:void 0,_currentDimensions:{w:-1,h:-1},_totalSizeSamplingAttempts:10,_sizeSamplingAttemptsCount:0}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=1e3,this._disableResizeHandlers(),this._resizableSides=[],this._iframeDimensions={w:0,h:0}},_disableResizeHandlers:function(){this._resizableSides=[]},_onStyleReady:function(){this.parent(),this._applyThemeColors({propName:"borderColor"}),this._applyThemeColors({propName:"backgroundColor"}),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},_applyThemeColors:function(a){var b,c,d;for(var e in a.properties)b=this.injects().Skins.getSkinParamValue(this._skin.className,e,this._style),c=b.getHex(!1),d=b.getAlpha(),"borderColor"==e&&(this._borderColor=c,this._borderAlpha=d),"backgroundColor"==e&&(this._backgroundColor=c,this._backgroundAlpha=d);this._tryRender()},render:function(){this._updateFrameSize(),this._clearFrame(),this.callLater(this._fillFrame,[],100)},_onResizeEnd:function(){this._tryRender()},_clearFrame:function(){var a=this._getFrame();void 0!==a&&(a.src="about:blank")},_getFrame:function(){return this._skinParts?this._skinParts.iframe:void 0},_getOverlay:function(){return this._skinParts?this._skinParts.overlayClick:void 0},_updateFrameSize:function(a,b){var c;a=a||this._view.getWidth()-1,b=b||this._view.getHeight()-1,c=this._getFrame(),c&&c.set({width:a,height:b})},_fillFrame:function(){var a,b={};b.userID=this._data.get("userId"),b.userName=this._data.get("userName"),b.tag=this._data.get("tag"),b.imageCount=this._data.get("imageCount"),b.whichImages=this._data.get("whichImages"),b.imageSize=this._data.get("imageSize"),b.layoutOrientation=this._data.get("layoutOrientation");var c=this._getFlickrEmbedCode(b),d=this._getFrame();void 0!==d&&(this.injects().Utils.prepareIFrameForWrite(d,function(a,b){b.write(c)}.bind(this)),a="http://www.flickr.com/photos/"+b.userID+"/",this._getOverlay().set("href",a),this._sizeSamplingAttemptsCount=0,this.callLater(this._updateIframeDimensions,[],1e3))},_updateIframeDimensions:function(){this._sizeSamplingAttemptsCount++;var a=this._sampleIframeDimensions();a&&(a.w!=this._currentDimensions.w||a.h!=this._currentDimensions.h)&&(this._currentDimensions.w=a.w,this._currentDimensions.h=a.h,this.setWidth(this._currentDimensions.w+5),this.setHeight(this._currentDimensions.h+5),this._updateFrameSize(this._currentDimensions.w+5,this._currentDimensions.h+5),this._wCheckForSizeChangeAndFireAutoSized(0)),this._sizeSamplingAttemptsCount<this._totalSizeSamplingAttempts&&this.callLater(this._updateIframeDimensions,[],500)},_sampleIframeDimensions:function(){var a,b,c=this._getFrame();if(void 0!=c){if(Browser.ie){var d=this._data.get("imageSize")+this._data.get("layoutOrientation");switch(d){case"sv":a=130,b=83+75*this._data.get("imageCount");break;case"tv":a=130,b=83+67*this._data.get("imageCount");break;case"mv":a=260,b=83+160*this._data.get("imageCount");break;case"sh":a=55+75*this._data.get("imageCount"),b=130;break;case"th":a=55+100*this._data.get("imageCount"),b=122;break;case"mh":a=55+240*this._data.get("imageCount"),b=215}}else{var e=c.contentWindow.document.getElementById("flickr_badge_uber_wrapper");e&&(a=e.clientWidth,b=e.clientHeight)}0==isNaN(a)&&0==isNaN(b)&&(this._iframeDimensions.w=a,this._iframeDimensions.h=b)}return this._iframeDimensions},_rgbToHex:function(a){var b;return b=new this.imports.Color(a),b.getHex(!1)},_getFlickrEmbedCode:function(a){var b,c,d="";return void 0!==a.tag&&""!==a.tag?(c="user_tag",b="&tag="+a.tag):(c="user",b=""),Browser.ie&&(d="a:link{color:"+this._backgroundColor+"}a:visited{color:"+this._backgroundColor+"}"),'<style type="text/css">#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}#flickr_badge_icon {display:block !important; margin:0 !important; border: 1px solid rgb(0, 0, 0) !important;}#flickr_icon_td {padding:0 5px 0 0 !important;}.flickr_badge_image {text-align:center !important;}.flickr_badge_image img {border: 1px solid black !important;}#flickr_badge_uber_wrapper {width:150px;}#flickr_www {display:block; text-align:center; padding:0 10px 0 10px !important; font: 11px Arial, Helvetica, Sans serif !important; color:#3993ff !important;}#flickr_badge_uber_wrapper a:hover,#flickr_badge_uber_wrapper a:link,#flickr_badge_uber_wrapper a:active,#flickr_badge_uber_wrapper a:visited {text-decoration:none !important; background:inherit !important;}#flickr_badge_wrapper {opacity: '+this._backgroundAlpha+";background-color: "+this._backgroundColor+";border: solid 1px "+this._borderColor+"}"+"#flickr_badge_source {padding:0 !important; font: 11px Arial, Helvetica, Sans serif !important; }"+"body {overflow: hidden;}"+d+"</style>"+'<table id="flickr_badge_uber_wrapper" cellpadding="0" cellspacing="10" border="0"><tr><td><a href="http://www.flickr.com" id="flickr_www">www.<strong style="color:#3993ff">flick<span style="color:#ff1c92">r</span></strong>.com</a><table cellpadding="0" cellspacing="10" border="0" id="flickr_badge_wrapper">'+'<script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?show_name=1&count='+a.imageCount+"&display="+a.whichImages+"&size="+a.imageSize+"&layout="+a.layoutOrientation+"&source="+c+"&user="+a.userID+b+'"></script>'+"</table>"+"</td>"+"</tr>"+"</table>"+"</td></tr></table>"}})}),define.component("wysiwyg.viewer.components.FooterContainer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteSegmentContainer")}),define.component("wysiwyg.viewer.components.GoogleMap",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({mapContainer:{type:"htmlElement"}}),b.states(["normal","error"]),b.dataTypes(["GeoMap"]),b.propertiesSchemaType("GoogleMapProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED],MIN_SIZE:130}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this.iframeCreated=!1,this.addEvent("resizeEnd",this._renderGoogleMapsIframe)},_editModeChanged:function(a,b){"PREVIEW"==b&&"CURRENT_PAGE"==a&&this.render()},render:function(){this._renderGoogleMapsIframe()},_renderGoogleMapsIframe:function(){this.isReady()&&(this.iframeCreated&&this._skinParts.mapContainer.hasChildNodes()?this._updateIframe():(this._createIframe(),this.iframeCreated=!0))},_createIframe:function(){var a=new IFrame({src:this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/googleMap.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",events:{load:function(){this._iframeCreated=!0,this._updateIframe()}.bind(this)}});this._iframe=a,this._skinParts.mapContainer.empty(),this._skinParts.mapContainer.grab(a)},_updateIframe:function(){var a={address:this._data.get("address"),addressInfo:this._data.get("addressInfo"),mapType:this.getComponentProperty("mapType"),mapDragging:this.getComponentProperty("mapDragging"),showZoom:this.getComponentProperty("showZoom"),showPosition:this.getComponentProperty("showPosition"),showStreetView:this.getComponentProperty("showStreetView"),showMapType:this.getComponentProperty("showMapType"),latVal:this._data.get("latitude"),longVal:this._data.get("longitude")};this._iframe.contentWindow.postMessage(JSON.stringify(a),"*")}})}),define.component("wysiwyg.viewer.components.HeaderContainer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteSegmentContainer")}),define.component("wysiwyg.viewer.components.HorizontalMenu",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.utilize(["core.components.BaseList","core.components.SimpleButton"]),b.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,dataRefField:"pages",container:"itemsContainer",hookMethod:"_changePagesRefData",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"}}),b.binds(["_onButtonDataChange","_onMoreButtonClick","_onThemeChange","_arrangeButtons","_onButtonClick","_onMoreButtonOver","_onMoreButtonOut","_onMoreContainerOver","_onMoreContainerOut","_closeMoreMenu","_onPageChanged"]),b.dataTypes(["Document"]),b.propertiesSchemaType("HorizontalMenuProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],dblClick:{command:"WEditorCommands.Pages"}},_moreButtonClicked:!1,_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionStarted",this._onPageChanged),this._usesExternalData=!0,this._staticWidth=0,this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._hiddenButtonsContainer=new Element("div",{id:"hiddenButtonsContainer",style:"visibility:hidden"}),this._hiddenButtonsContainer.inject(this.getViewNode()),this.getViewNode().setStyle("opacity","0")},_testOverFlow:function(){var a=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=a),a!=this._prevButtonsWidth?this._arrangeButtons():(this._testOverFlowCount--,this._testOverFlowCount>0&&(this._overflowID=this.callLater(this._testOverFlow,[],100)))},_onPageChanged:function(a){var b,c;if(null!=this._skinParts&&this._allButtons)for(b=0;b<this._allButtons.length;b++)this._allButtons[b]&&this._allButtons[b].getViewNode()&&(c=this._allButtons[b],c.getID()==a?c.setState("selected"):c.removeState("selected"),this.injects().Utils.forceBrowserRepaint(c.getViewNode()))},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._allButtons=[]},_onRepeaterItemReady:function(a,b,c,d){d&&b.addEvent("click",function(){this._onButtonClick(c)}.bind(this)),this._allButtons.push(b),this.parent(a,b,c,d)},_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._addPartsListeners(),this._arrangeButtons()},_addPartsListeners:function(){this._skinParts.moreButton.addEvent("over",this._onMoreButtonOver),this._skinParts.moreButton.addEvent("out",this._onMoreButtonOut),this._skinParts.moreButton.addEvent("click",this._onMoreButtonClick),this._skinParts.moreContainer.addEvent("mouseover",this._onMoreContainerOver),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut);var a;for(a=0;a<this._allButtons.length;a++)this._allButtons[a]&&this._allButtons[a].getViewNode()&&(this._allButtons[a].getViewNode().uncollapse(),this._allButtons[a].addEvent("dataChanged",this._onButtonDataChange))},render:function(){this.parent(),"styleChange"==this._changeTriggeredBy?this._arrangeButtonsDelayed():this._arrangeButtons()},setSkin:function(a){this._staticWidth=a.staticWidth||0,this.parent(a)},_onButtonDataChange:function(){this._changeTriggeredBy="dataChange",this.render()},_onDataChange:function(a){this.getComponentProperties().removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent(a)},_applySettings:function(){this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._staticWidth>0?this._preWidthModifier=this._staticWidthModifier:(this.getComponentProperty("sameWidthButtons")&&(this._preWidthModifier=this._sameWidthModifier),this.getComponentProperty("stretchButtonsToMenuWidth")&&(this._postWidthModifier=this._stretchToFillModifier))},_skinSizeChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_skinParamsChange:function(a){this._changeTriggeredBy="styleChange",this.parent(a)},_arrangeButtonsDelayed:function(){-1!=this._arrangeWaitID&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtonsCapture,[],100),this._changeTriggeredBy="",this._skinParts.itemsContainer.setStyle("overflow","hidden")},_arrangeButtonsCapture:function(){this._arrangeButtons(),-1!=this._arrangeWaitID&&this._arrangeButtonsDelayed()
},_arrangeButtons:function(){if(void 0!=this._skinParts&&this._allButtons&&0!=this._allButtons.length&&this._isDisplayed&&this.isReady()){this.getViewNode().setStyle("opacity","1"),this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth=0,this._arrangeWaitID=-1,this._applySettings();var a=this._allButtons[0]&&this._allButtons[0].getViewNode()?this._allButtons[0].getViewNode().getStyle("-webkit-transition-duration"):0;this._initItemsContainer(),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal"),this._initMoreContainer(),this._skinParts.moreButton.setLabel(this.getComponentProperty("moreButtonLabel")),this._skinParts.moreButton.skipMe=!0;var b=this._getDisplayedButtons();if(b.length){b.push(this._skinParts.moreButton);var c=this._getSampleButton();this._sampleButtonBorder(c),this._setMinimumDimensions(c),this._preArrangeButtons(b),this._preWidthModifier(b),this._calculateButtonsAmount(b),this.setMinW(b[0].getViewNode().offsetWidth),this._postWidthModifier(b),this._arrangeMoreContainer(),b=this._getDisplayedButtons(),b.push(this._skinParts.moreButton),this._alignButtonsText(b);var d;for(d=0;d<b.length;d++){var e=b[d];e.getViewNode().setStyle("-webkit-transition-duration",a)}this._skinParts.itemsContainer.setStyle("overflow","visible"),this._skinParts.itemsContainer.setStyle("white-space","nowrap"),this._setListPositions(),this._testOverFlow()}}},_calculateButtonsAmount:function(a){a=this._arrangementAlgorithm(a),this._skinParts.moreButton.skipMe&&(this._skinParts.moreButton.getViewNode().setStyle("visibility","hidden"),this._skinParts.moreButton.getViewNode().inject(this._skinParts.moreContainer),a[a.length-1]===this._skinParts.moreButton&&a.pop())},_getButtonsWidth:function(){var a=0;for(i=0;i<this._skinParts.itemsContainer.children.length;i++)a+=this._skinParts.itemsContainer.children[i].getLogic().getWidthOnLayout();return a},_getDisplayedButtons:function(){var a,b=[];for(a=0;a<this._allButtons.length;a++)this._allButtons[a]&&this._allButtons[a].getDataItem()&&!this._allButtons[a].getDataItem()._data.hidePage?b.push(this._allButtons[a]):this._allButtons[a]&&this._allButtons[a].getViewNode()&&(this._allButtons[a].getViewNode().setStyle("visibility","inherit"),this._allButtons[a].getViewNode().inject(this._hiddenButtonsContainer));return b},_setListPositions:function(){var a,b,c;for(a=0;a<this._skinParts.itemsContainer.children.length;a++)b=this._skinParts.itemsContainer.children[a],c=0==a&&this._setPositionForFirst()?"first":a==this._skinParts.itemsContainer.children.length-1&&this._setPositionForLast()?"last":"center",b.setProperty("listposition",c);for(a=0;a<this._skinParts.moreContainer.children.length;a++)b=this._skinParts.moreContainer.children[a],b.setProperty("listposition","more")},_setPositionForFirst:function(){var a=!1;return this._postWidthModifier==this._stretchToFillModifier?a=!0:"left"==this.getComponentProperty("alignButtons")&&(a=!0),a},_setPositionForLast:function(){var a=!1;return this._postWidthModifier==this._stretchToFillModifier?a=!0:"right"==this.getComponentProperty("alignButtons")&&(a=!0),a},_getSampleButton:function(){return this._allButtons[0]&&this._allButtons[0].getViewNode()&&"visible"==this._allButtons[0].getViewNode().getStyle("visibility")?this._allButtons[0]:this._skinParts.moreButton},_sampleButtonBorder:function(a){this._buttonsBorder=a._skinParts.borderWrapper?this._getBorder(a._skinParts.borderWrapper):this._getBorder(a.getViewNode())},_setMinimumDimensions:function(a){a._skinParts.label.setStyle("line-height","100%");var b=0;a.getSkin()&&!isNaN(a.getSkin().addToMinH)&&(b=a.getSkin().addToMinH);var c=this._getBorder(this._skinParts.itemsContainer).y+this._buttonsBorder.y;this.setMinH(b+c+parseInt(a._skinParts.label.getComputedStyle("line-height"),10))},_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var a=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,b=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",a+"px"),this._skinParts.itemsContainer.setStyle("width",b+"px")},_initMoreContainer:function(){this._skinParts.moreContainer.setStyle("visibility","hidden"),this._skinParts.moreContainer.setStyle("opacity","0"),this._skinParts.moreContainer.setStyle("width","0px"),this._skinParts.moreContainer.setStyle("left","0px")},_preArrangeButtons:function(a){var b;for(b=0;b<a.length;b++){var c=a[b];c.getViewNode().setStyle("visibility","inherit"),c.getViewNode().setStyle("-webkit-transition-duration","0s"),c.getViewNode().inject(this._skinParts.moreContainer),c._skinParts.bg.setStyle("padding","0px 0px")}},_arrangeMoreContainer:function(){var a,b,c=this._skinParts.moreButton.getViewNode().offsetWidth;for(a=0;a<this._skinParts.moreContainer.children.length;a++)b=this._skinParts.moreContainer.children[a],c=Math.max(c,b.offsetWidth);for(this._skinParts.moreContainer.setStyle("width",c+"px"),a=0;a<this._skinParts.moreContainer.children.length;a++)b=this._skinParts.moreContainer.children[a],this._fillWidthByPadding(b,c);var d=this._skinParts.moreButton.getViewNode().offsetLeft;isNaN(d)||this._skinParts.moreContainer.setStyle("left",d+"px")},_alignButtonsText:function(a){var b;for(b=0;b<a.length;b++){var c=a[b].getViewNode(),d=parseInt(c.getLogic()._skinParts.bg.getComputedStyle("padding-left"),10)+parseInt(c.getLogic()._skinParts.bg.getComputedStyle("padding-right"),10);switch(this.getComponentProperty("alignText")){case"left":c.getLogic()._skinParts.bg.setStyle("padding-left","0px"),c.getLogic()._skinParts.bg.setStyle("padding-right",d+"px");break;case"right":c.getLogic()._skinParts.bg.setStyle("padding-left",d+"px"),c.getLogic()._skinParts.bg.setStyle("padding-right","0px")}}},_setPadding:function(a,b){a.getLogic()._skinParts.bg.setStyle("padding","0px "+b+"px")},_fillWidthByPadding:function(a,b){var c=parseInt(a.getLogic()._skinParts.bg.getComputedStyle("padding-left"),10),d=c+Math.floor((b-a.offsetWidth)/2);this._setPadding(a,d)},_arrangementAlgorithm:function(a){for(var b=!1;!b;)if(b=this._arrangementIteration(a),!b)if(1==a.length)b=!0;else{this._skinParts.moreButton.skipMe=!1;var c=a.splice(a.length-2,1)[0];c.getViewNode().setStyle("visibility","inherit"),c.getViewNode().inject(this._skinParts.moreContainer,"top")}return a},_stretchToFillModifier:function(a,b){function c(a,b){if(j>0){var c=Math.floor(h/j),e=parseInt(a._skinParts.bg.getStyle(b),10);d&&(i._buttonsPadding[a]||(i._buttonsPadding[a]={}),i._buttonsPadding[a][b]=e),a._skinParts.bg.setStyle(b,e+c+"px"),j--,h-=c}}b=b||0;var d=!1;0==b&&(d=!0,this._buttonsPadding={});var e,f=this._getButtonsWidth(),g=parseInt(this._skinParts.itemsContainer.getStyle("width"),10),h=g-f-b-1;Browser.ie&&(h-=1),h=Math.max(h,0);var i=this;if(a.length>0){var j=2*a.length;for(e=0;e<a.length/2;e++){var k=a[e],l=a[a.length-e-1];c(k,"padding-left"),c(l,"padding-right"),c(k,"padding-right"),c(l,"padding-left")}}if(this._skinParts.itemsContainer.scrollHeight-a[0].getViewNode().offsetHeight>=a[0].getViewNode().offsetHeight){for(e=0;e<a.length;e++){var m=a[e];m._skinParts.bg.setStyle("padding-left",this._buttonsPadding[m]["padding-left"]),m._skinParts.bg.setStyle("padding-right",this._buttonsPadding[m]["padding-left"])}if(b>20)return;this._stretchToFillModifier(a,b+1)}},_sameWidthModifier:function(a){var b,c,d=0;for(b=0;b<a.length;b++){c=a[b];var e=parseInt(c.getViewNode().offsetWidth-this._buttonsBorder.x,10);isNaN(e)||(d=Math.max(d,e))}if(d>0)for(b=0;b<a.length;b++)c=a[b],this._fillWidthByPadding(c.getViewNode(),d)},_staticWidthModifier:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.offsetWidth<this._staticWidth?this._fillWidthByPadding(c.getViewNode(),this._staticWidth):c.getViewNode().setStyle("width",this._staticWidth+"px")},_nullModifier:function(){},_arrangementIteration:function(a){var b,c;for(c=0;c<a.length;c++){var d=a[c];d.skipMe?d.collapse():(d.uncollapse(),d.getViewNode().setStyle("visibility","visible"),d.getViewNode().inject(this._skinParts.itemsContainer),b=parseInt(this._skinParts.itemsContainer.getStyle("height"),10)-this._buttonsBorder.y,d.getViewNode().setStyle("height",b+"px"),void 0!=d._skinParts.labelPad&&(b-=d._skinParts.labelPad.offsetHeight),d._skinParts.label.setStyle("line-height",b+"px"),d._skinParts.label.setStyle("width","auto"))}return this._skinParts.itemsContainer.scrollHeight-a[0].getViewNode().offsetHeight<a[0].getViewNode().offsetHeight},_getBorder:function(a){var b=0,c=0;return a&&(b=parseInt(a.getStyle("border-left-width"),10)+parseInt(a.getStyle("border-right-width"),10),c=parseInt(a.getStyle("border-top-width"),10)+parseInt(a.getStyle("border-bottom-width"),10)),{x:b,y:c}},_getMargin:function(a){var b=0,c=0;return a&&(b=parseInt(a.getStyle("margin-left"),10)+parseInt(a.getStyle("margin-right"),10),c=parseInt(a.getStyle("margin-top"),10)+parseInt(a.getStyle("margin-bottom"),10)),{x:b,y:c}},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(a){this.injects().Viewer.goToPage(a.get("id"))},_openMoreMenu:function(){this._skinParts.moreButton.setState("selected"),this._skinParts.moreContainer.setStyle("visibility","visible"),this._skinParts.moreContainer.setStyle("opacity","1"),this._isMoreContainerOpen=!0,this._toCloseMoreMenu=!1,this.injects().Utils.forceBrowserRepaint(this._skinParts.moreButton.getViewNode()),this.injects().Utils.forceBrowserRepaint(this._skinParts.moreContainer)},_closeMoreMenuTimer:function(){this.injects().Utils.clearCallLater(this._closeMoreMenuTimerID),this._closeMoreMenuTimerID=this.injects().Utils.callLater(this._closeMoreMenu,[],this,500)},_closeMoreMenu:function(a){(a||this._toCloseMoreMenu)&&(this._skinParts.moreButton.removeState("selected"),this._skinParts.moreContainer.setStyle("visibility","hidden"),this._skinParts.moreContainer.setStyle("opacity","0"),this._toCloseMoreMenu=!1,this._isMoreContainerOpen=!1,this._moreButtonClicked=!1)},_forceCloseMoreMenu:function(){this._closeMoreMenu(!0)},_onMoreButtonOver:function(){this._toCloseMoreMenu=!1,this._moreButtonClicked||this._openMoreMenu()},_onMoreButtonOut:function(){this._toCloseMoreMenu=!0,this._closeMoreMenuTimer()},_onMoreContainerOver:function(){this._toCloseMoreMenu=!1},_onMoreButtonClick:function(){this._moreButtonClicked=!0,this._isMoreContainerOpen===!1?this._openMoreMenu():this._forceCloseMoreMenu()},_onMoreContainerOut:function(){this._toCloseMoreMenu=!0,this._closeMoreMenuTimer()},dispose:function(){this.injects().Viewer.removeEvent("pageTransitionStarted",this._onPageChanged),this.injects().Theme.removeEvent("propertyChange",this._onThemeChange),this.parent()}})}),define.component("wysiwyg.viewer.components.HtmlComponent",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["core.components.base.SizeLimits"]),b.resources([]),b.binds([]),b.traits([]),b.skinParts({iFrameHolder:{type:"htmlElement"}}),b.dataTypes(["HtmlComponent"]),b.states(["hasContent","noContent"]),b.propertiesSchemaType(""),b.statics({MAX_HTML_COMPONENT_HEIGHT_DEFAULT:5e3}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent("resizeEnd",this._onResizeEnd),this._iframe=null,this._renderOnResize=!1},_onViewModeChanged:function(){"PREVIEW"!=this.resources.W.Viewer.getEditorMode()&&(this._iframe.set("src","about:blank"),this._setFrameWithSrc(this._iframe))},_onResizeEnd:function(){this._iframe&&(this._iframe.width=this._view.getWidth(),this._iframe.height=this._view.getHeight()),this._renderOnResize&&this._renderIfReady()},render:function(){this._createIFrame(this._view.getWidth(),this._view.getHeight()),this.setState(this.hasContent()?"hasContent":"noContent"),this.hasContent()&&this._setFrameWithSrc(this._iframe)},getSizeLimits:function(){return void 0===this._sizeLimits&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAX_HTML_COMPONENT_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._sizeLimits},getIFrameSrc:function(){var a=this._data.get("url"),b=/^(ftps|ftp|http|https).*$/;return b.test(a)||(a="http://"+a),a},hasContent:function(){return!!this._data.get("url")},_createIFrame:function(a,b){var c=new IFrame;c.width=a,c.height=b,navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&this._view.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),this._iframe?c.replaces(this._iframe):c.insertInto(this._skinParts.iFrameHolder),this._iframe=c},_setFrameWithSrc:function(a){a.set("src",this.getIFrameSrc())}})}),define.component("wysiwyg.viewer.components.IFrameComponent",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._iframe=null},render:function(){this._renderIframe()},_onResize:function(){this.parent(),this._skinParts&&this._renderIframe()},_renderIframe:function(a){this._iframe?this._updateIframe(a):this._createIframe()},_createIframe:function(){this._iframe=new IFrame({src:"about:blank",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0",scrolling:"no"}),this._setBasicIframeParams(),this._setIframeParams(),this._iframe.insertInto(this._getIframeContainer())},_getIframeContainer:function(){return this._view},_changeSize:function(a,b){var c=this.getWidth(),d=this.getHeight(),e=a.x||a.w||a.width,f=a.y||a.h||a.height;e&&e!=c&&(this.setWidth(e,!1,!f&&b),this._iframe.setStyle("width",e+"px")),f&&f!=d&&(this.setHeight(f,!1,b),this._iframe.setStyle("height",f+"px")),this._wCheckForSizeChangeAndFireAutoSized(1)},_updateIframe:function(a){this._setBasicIframeParams(a),this._setIframeParams()},_setBasicIframeParams:function(a){a=a||!1;var b=this._getUrl(a);(a||this._iframe.src!==b)&&this.setIFrameSrc(b),this._iframe.width=this.getWidth(),this._iframe.height=this.getHeight()},setIFrameSrc:function(a){this._iframe.src=a},_setIframeParams:function(){},_getUrl:function(){throw new Error("IFrameComponent::_getUrl() must be overridden.")},getIFrame:function(){return this._iframe}})}),define.component("wysiwyg.viewer.components.ImageLite",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["core.components.image.ImageUrl"]),b.dataTypes(["Image"]),b.fields({_currentUri:""}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_onAllSkinPartsReady:function(){this._img||(this._img=new Element("img"),this._view.adopt(this._img))},render:function(){var a=this._view.getSize();this.setSize(a.x,a.y)},setOwner:function(){},invalidateSize:function(){},setSize:function(a,b){this._imgWidth=parseInt(this._data.get("width")),this._imgHeight=parseInt(this._data.get("height"));var c={width:parseInt(a),height:parseInt(b),overflow:"hidden"};this._view.setStyles(c);var d=a,e=a*(this._imgHeight/this._imgWidth);b>e&&(e=b,d=b*(this._imgWidth/this._imgHeight));var f=(b-e)/2;f=0>f?f:0;var g=(a-d)/2;g=0>g?g:0;var h=(new this.imports.ImageUrl).getImageUrlFromPyramid({x:parseInt(d),y:parseInt(e)},this._data.get("uri")).url;this._currentUri!==h&&(this._currentUri=h,this._img.setAttribute("src",h));var i={position:"static",width:Math.round(d)+1,height:parseInt(e),"margin-top":parseInt(f),"margin-left":parseInt(g),"box-shadow":"#000 0 0 0","image-rendering":"optimizequality"};this._img.setStyles(i)}})}),define.component("wysiwyg.viewer.components.LazySocialPanel",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["onHover"]),b.skinParts({placeHolder:{type:"htmlElement"},fbLike:{type:"htmlElement"},twitterShare:{type:"htmlElement"},googlePlus:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c);var d="";this.injects().Viewer.getCurrentPageNode()&&(d=this.injects().Viewer.getCurrentPageNode().getLogic().getDataItem().getData().title),location.href,this._buttons={fbLike:{type:"wysiwyg.viewer.components.WFacebookLike",skin:"skins.core.FacebookLikeSkin",data:null,args:{propObj:{layout:"button_count"}}},twitterShare:{type:"wysiwyg.viewer.components.WTwitterTweet",skin:"mobile.core.skins.TwitterTweetSkin",data:this.injects().Data.createDataItem({defaultText:d+" ~ ",accountToFollow:"",type:"TwitterTweet"},"TwitterTweet"),args:null},googlePlus:{type:"wysiwyg.viewer.components.WGooglePlusOne",skin:"mobile.core.skins.GooglePlusOneSkin",data:null,args:{annotation:"small_bubble",size:"medium",width:{w:50,h:15}}}}},render:function(){this._skinParts.placeHolder.addEvent("mouseover",this.onHover)},onHover:function(){this._skinParts.placeHolder.removeEvent("mouseover",this.onHover),this._skinParts.placeHolder.dispose(),this._addService(this._buttons.twitterShare,this._skinParts.twitterShare),this._addService(this._buttons.fbLike,this._skinParts.fbLike)},_addService:function(a,b){this.injects().Components.createComponent({type:a.type,skin:a.skin,data:a.data,args:a.args}).insertInto(b)}})}),define.component("wysiwyg.viewer.components.LinkBar",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.binds(["_setComponentSize"]),b.skinParts({imageItem:{type:"wysiwyg.viewer.components.LinkBarItem",repeater:!0,container:"itemsContainer",dataRefField:"items",argObject:{unit:"px"}},itemsContainer:{type:"htmlElement"}}),b.propertiesSchemaType("LinkBarProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"SOCIAL_BAR_MNG_ICONS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"social_icons"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"social_icons"},commandParameterDataRef:"SELF"}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this.setMaxH(9999),this.setMaxW(9999)},_onDataChange:function(){this.parent()},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){this._iconSize=this.getComponentProperty("iconSize")||30,this._orientation=this.getComponentProperty("orientation"),this._spacing=this.getComponentProperty("spacing"),this._bgScale=this.getComponentProperty("bgScale"),this._setComponentSize()},_processDataRefs:function(a){return a},_onRepeaterReady:function(a){this._itemsAmount=a.itemsAmount,this._items=a.readyItemsLogic},_setComponentSize:function(){for(var a=0,b=0,c="HORIZ"==this._orientation,d=0;d<this._items.length;d++){var e=this._items[d],f=e.getViewNode(),g=this._spacing;d==this._items.length-1&&(g=0),e.setSize(this._iconSize,g,this._bgScale,c);var h=f.offsetWidth,i=f.offsetHeight;c?(f.setStyle("display","inline-block"),b=Math.max(b,i),a+=h):(f.setStyle("display","block"),b+=i,a=Math.max(a,h))}this.setWidth(a+5,!0),this.setHeight(b,!0),this._wCheckForSizeChangeAndFireAutoSized(3)}})}),define.component("wysiwyg.viewer.components.LinkBarItem",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onMouseOver","_onMouseOut","_onLinkMouseDown","_onImageStateChange"]),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.skinParts({image:{type:"core.components.Image",dataRefField:"*",optional:!1},imageBG:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1}}),b.dataTypes(["Image"]),b.states(["loading","normal","rollover"]),b.fields({_parentList:null}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},setParentList:function(a){this._parentList=a},_onImageStateChange:function(){switch(this._skinParts.image.getState()){case"loading":this.setState("loading");break;case"loaded":this.setState("normal")}},_onMouseOver:function(){"normal"==this.getState()&&this.setState("rollover")},_onMouseOut:function(){"rollover"==this.getState()&&this.setState("normal")},_onLinkMouseDown:function(){var a=this._data.get("link"),b=this._data.get("target")||"_blank";a&&window.open(a,b)},setSize:function(a,b,c,d){var e,f;d?(e=b,f=0):(e=0,f=b);var g,h={};this._skinParts.image.setSize(a,a,"px"),g=a,h.x=h.y=g/2,this._skinParts.image.getViewNode().setStyles({left:h.x-a/2,top:h.y-a/2}),this.getViewNode().setStyles({width:String(g+e)+"px",height:String(g+f)+"px"})},_onDataChange:function(){this.parent()},_onAllSkinPartsReady:function(){this.parent()},_onResize:function(){this.parent(),this._skinParts.image&&(this._skinParts.image._invalidate("size"),this._skinParts.image._renderIfReady())},getAcceptableDataTypes:function(){return[]},getImageRef:function(){var a="";return this._skinParts&&(a=String(this._skinParts.image.getDataItem().get("id"))),a}})}),define.component("wysiwyg.viewer.components.LoginButton",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onStyleChange"]),b.skinParts({container:{type:"htmlElement"},actionTitle:{type:"htmlElement"},memberTitle:{type:"htmlElement"}}),b.states(["auth","no_auth"]),b.statics({SIGN_IN:"Login/Sign up",SIGN_OUT:"Log out",HELLO:"Hello"}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChange)},_onStyleChange:function(){this._centerButton(),this._wCheckForSizeChangeAndFireAutoSized(10)},render:function(){this.parent(),this._updateTextsAndEvents(),this._centerButton()},_updateTextsAndEvents:function(){var a=this._skinParts,b=this.injects().SiteMembers,c=a.actionTitle,d=a.memberTitle,e=this;this.injects().SiteMembers.isLoggedIn()?(c.set("text",this.SIGN_OUT),c.addEvent("click",function(){b.logout(),c.removeEvent("click",arguments.callee),setTimeout(function(){location.reload()},500)}),this.injects().SiteMembers.getMemberDetails(function(a){var b=a.attributes&&a.attributes.name||a.email;d.set("text",this.HELLO+" "+b)}.bind(this)),this.setState("auth")):(c.set("text",this.SIGN_IN),c.addEvent("click",function(){b.openSiteMembersPopup({authCallback:function(a){1==a.authResponse&&e._renderIfReady()}}),c.removeEvent("click",arguments.callee)}.bind(this)),d.set("text",""),this.setState("no_auth"))},_centerButton:function(){var a=this._skinParts.container,b=a.getSize(),c=b.x,d=b.y,e=this.getHeight()-d;this.getWidth()-c,a.setStyle("margin-top",e/2),this._skinParts.actionTitle.setStyle("width",this.getWidth()),this._skinParts.memberTitle.setStyle("width",this.getWidth()),this.setMinH(d)},_onResize:function(){this._centerButton(),this.parent()}})}),define.component("wysiwyg.viewer.components.MatrixGallery",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.binds(["_increaseTotalMaxRows","_sequencingHook"]),b.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items",argObject:{unit:"px"}},itemsContainer:{type:"htmlElement"},showMore:{type:"htmlElement"}}),b.states(["fullView","hiddenChildren"]),b.propertiesSchemaType("MatrixGalleryProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery"},commandParameterDataRef:"SELF"}},_itemsRef:[],_galleryItems:[],_totalMaxRows:0,_numCols:0,_numRows:0,_gap:0,_itemWidth:-1,_itemHeight:-1,_transitionProp:"",_numItems:0,_imageMode:"",_transitionsOn:!0,_Tween:null,_widthDiff:0,_heightDiff:0,_minDisplayerWidth:5,_minDisplayerHeight:5,_renderingPhase:"normal"}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._transitionProp=this.injects().Utils.getCSSBrowserFeature("transition"),this._Tween=this.injects().Utils.Tween,this.setMaxW(1e4),this.setMaxH(1e4),this._sequencer=new this.imports.ComponentSequencer,this._sequencer.resolveItem=c&&c.sequencingHook?c.sequencingHook:this._sequencingHook},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},_onDataChange:function(){var a,b;this._numItems=this._data.get("items").length,this._numCols=parseInt(this.getComponentProperty("numCols")),this._numRows=this._getRowNumber(),this._gap=parseInt(this.getComponentProperty("margin")),this._imageMode=String(this.getComponentProperty("imageMode")),this._updateState(),-1==this._itemWidth?this._calculateItemSize():this._numItems>0&&(a=Math.round(this._numCols*this._itemWidth+(this._numCols-1)*this._gap),b=Math.round(this._numRows*this._itemHeight+(this._numRows-1)*this._gap),this._setContainerWidth(a),this._setContainerHeight(b),this._positionAllItems(),this.fireEvent("autoSized")),this._updateSizeLimits(),this.parent()},_getRowNumber:function(){var a=parseInt(this.getComponentProperty("numCols")),b=parseInt(this.getComponentProperty("maxRows"));return this._numItems&&this._numItems<b*a?this._normalizeRows(b):b},_updateSizeLimits:function(){this.setMinW(this._numCols*(this._minDisplayerWidth+this._gap)+this._widthDiff-this._gap),this.setMinH(this._numRows*(this._minDisplayerHeight+this._gap)+this._heightDiff-this._gap)},_editModeChanged:function(a,b){this.parent(a),"PREVIEW"==b&&this._setTotalMaxRows(this._getRowNumber())},_setContainerWidth:function(a){var b=a+this._widthDiff;this._skinParts.itemsContainer.setStyle("width",String(a)+"px"),this._view.setStyle("width",String(b)+"px"),this.setWidth(b,!1,!1)},_setContainerHeight:function(a){var b=a+this._heightDiff;this._skinParts.itemsContainer.setStyle("height",String(a)+"px"),this.setHeight(b,!1,!1),this._view.setStyle("height",String(b)+"px")},_updateContainerSize:function(){var a=this._view.getSize();(0==a.x||0==a.y)&&(a.x=this.getWidth(),a.y=this.getHeight());var b=a.x-this._widthDiff,c=a.y-this._heightDiff;this._skinParts.itemsContainer.setStyles({width:b+"px",height:c+"px"})},_calculateItemSize:function(){if(this._skinParts&&this._data.get("items").length>0){var a=this._view.getSize();(0==a.x||0==a.y)&&(a.x=this.getWidth(),a.y=this.getHeight());var b=a.x-this._widthDiff,c=a.y-this._heightDiff;this._itemWidth=Math.max(Math.floor((b-(this._numCols-1)*this._gap)/this._numCols),0),this._itemHeight=Math.max(Math.floor((c-(this._numRows-1)*this._gap)/this._numRows),0)}},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._sequencer.addEvent("componentSetup",function(a){this._onDisplayerCreation(a.compView.getLogic(),a.method,a.index)}.bind(this)),this._sequencer.addEvent("productionFinished",function(a){this._onSequencerFinished(a)}.bind(this)),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.showMore&&(this._skinParts.showMore.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._increaseTotalMaxRows),this._skinParts.showMore.setStyles({"white-space":"nowrap"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0,this._bottomGap=this._skin.bottomGap||0,this._calculateItemSize(),this._updateSizeLimits(),this._setCorrectedComponentSize(),this._updateContainerSize()},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){this._newItems=[],this._sequencer.createComponents(this._skinParts.itemsContainer,this._data.get("items").slice(0,this._numCols*this._numRows))},_onSequencerFinished:function(a){this._renderingPhase="normal",this._galleryItems=a.elements,this._totalMaxRows=this.getComponentProperty("maxRows"),this._positionAllItems(),this._setupAllItems()},_setupItem:function(a){if(a.getLogic){var b=a.getLogic();b.setOwner(this),b.invalidateSize(),b.setSize(this._itemWidth,this._itemHeight-this._bottomGap,this._imageMode),this._transitionsOn&&parseFloat(a.getStyle("opacity"))<1&&(this._transitionProp?(a.setStyle(this._transitionProp,"opacity 1s"),setTimeout(function(){a.setStyle("opacity","1.0")},150)):this._Tween.to(a,1,{opacity:1}))}},_onDisplayerCreation:function(a,b){"create"==b&&"showMore"==this._renderingPhase&&a.getViewNode().setStyle("opacity","0.0")},_normalizeRows:function(a){var b=Math.floor(this._numItems/this._numCols)+(this._numItems%this._numCols>0?1:0);return Math.min(a,b)},_updateState:function(){this._numItems<=this._numRows*this._numCols?this.setState("fullView"):this.setState("hiddenChildren")},_positionAllItems:function(a){a=a||this._galleryItems;for(var b=0;b<a.length;b++){var c=this._calcItemPosition(b);a[b].setStyles({position:"absolute",left:c.left+"px",top:c.top+"px"})}},_calcItemPosition:function(a){var b=a%this._numCols,c=Math.floor((a-b)/this._numCols);return{left:b*(this._itemWidth+this._gap),top:c*(this._itemHeight+this._gap),width:this._itemWidth+this._gap,height:this._itemHeight+this._gap}},_setupAllItems:function(a){a=a||this._galleryItems;for(var b=0;b<a.length;b++)this._setupItem(a[b])},_setCorrectedComponentSize:function(){var a=this.getWidth()-(this.getWidth()-this._widthDiff-this._gap*(this._numCols-1))%this._numCols,b=this.getHeight()-(this.getHeight()-this._heightDiff-this._gap*(this._numRows-1))%this._numRows;this._view.setStyles({width:a,height:b}),this.setWidth(a,!1,!1),this.setHeight(b,!1,!1)},_onResize:function(){this.parent(),this._skinParts&&(this._calculateItemSize(),this._setCorrectedComponentSize(),this._updateContainerSize(),this._positionAllItems(),this._setupAllItems())},_checkExtremeValues:function(){if(this._itemWidth<this._minDisplayerWidth){var a=this.getWidth()-this._widthDiff;this._itemWidth=this._minDisplayerWidth,this._gap=Math.floor((a-this._numCols*this._itemWidth)/(this._numCols-1)),this.setComponentProperty("margin",this._gap)}else if(this._itemHeight<this._minDisplayerHeight){var b=this.getHeight()-this._heightDiff;this._itemHeight=this._minDisplayerHeight,this._gap=Math.floor((b-this._numRows*this._itemHeight)/(this._numRows-1)),this.setComponentProperty("margin",this._gap)}},_increaseTotalMaxRows:function(){this._setTotalMaxRows(this._normalizeRows(this._numRows+parseInt(this.getComponentProperty("incRows"))))},_setTotalMaxRows:function(a){this._numRows=a;var b=Math.floor(this._numRows*this._itemHeight+(this._numRows-1)*this._gap);this._updateState(),this._setContainerHeight(b),this._calculateItemSize(),this.fireEvent("autoSized"),this._renderingPhase="showMore",this.render()},getSequencer:function(){return this._sequencer}})}),define.component("wysiwyg.viewer.components.MediaZoom",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_handleCurrentItemChange","_transitionToCurrentDisplayer"]),b.traits(["wysiwyg.viewer.components.traits.ListIterator"]),b.skinParts({blockingLayer:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},dialogBox:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},virtualContainer:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},counter:{type:"htmlElement"},buttonPrev:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Prev"},buttonNext:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"}}),b.fields({transitionTime:"normal",_inTransition:!1,_lastCurrentItem:null}),b.methods({initialize:function(a,b,c){this.isVolatile=!0,this.parent(a,b,c);var d=this.injects().Commands;d.registerCommandAndListener("WViewerCommands.MediaZoom.Close",this,this._closeZoom,null,!0),d.registerCommandAndListener("WViewerCommands.MediaZoom.Next",this,this.gotoNext,null,!0),d.registerCommandAndListener("WViewerCommands.MediaZoom.Prev",this,this.gotoPrev,null,!0),d.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._editModeChanged,null,!0),this.addEvent("currentItemChanged",this._handleCurrentItemChange),this.collapse()
},_onAllSkinPartsReady:function(){var a=function(a){a.stopPropagation()};this._skinParts.dialogBox.addEvent("click",a),this._skinParts.buttonNext.addEvent("click",a),this._skinParts.buttonPrev.addEvent("click",a),this._skinParts.xButton.addEvent("click",a)},setGallery:function(a,b,c,d,e){this._validateArgs(a,b)&&(this._opened=!0,this._getDisplayerDivFunction=c,this._getHashPartsFunction=d,this._extraParams=e||{},this.setDataItem(a),this.setListAndCurrentIndex(a,b),this._setNextPrevVisibility())},setImage:function(a,b,c){var d=this.injects().Data.createDataItem({type:"list",items:[a]});this.setGallery(d,0,b,c)},showZoomImage:function(){if(this._currentItem&&this._currentItem!=this._lastCurrentItem){var a=this.injects().Utils.getWindowSize(),b=this.getSkin().getParams().first(function(a){return"$marginIncludingArrow"===a.id});this._imageMaxWidth=a.width-2*b.defaultValue,this._imageMaxHeight=a.height-60,this._lastCurrentItem=this._currentItem,this._renderCurrentDisplayer(this._transitionToCurrentDisplayer),this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this.injects().Viewer.enterFullScreenMode(),this.uncollapse()}},_editModeChanged:function(){this._isDisposed||(this._closeZoom(),this.injects().Viewer.removeZoomElement(),this.dispose())},_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._skinParts.virtualContainer.empty(),this._skinParts.itemsContainer.empty(),this._skinParts.dialogBox.setStyles({width:"100px"}),this._opened=!1,this.unlock(),this._lastCurrentItem=null},_handleCurrentItemChange:function(){this.lock();var a=function(a){var b=this.injects().Utils.hash.getHashParts();b.id===a.id&&b.extData===a.extData?this.showZoomImage():this.injects().Utils.hash.setHash(a.id,a.title,a.extData,!0)}.bind(this);this._getHashPartsFunction?this._getHashPartsFunction(this._currentItem,a):this.showZoomImage()},_renderCurrentDisplayer:function(){for(var a=this._skinParts.virtualContainer,b=0;b<a.childNodes.length;b++)a.childNodes[b].destroy();var c=this;this._getDisplayerDivFunction(this._currentItem,{container:c._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight},function(a){a.getParent('[skinpart="virtualContainer"]')||a.insertInto(c._skinParts.virtualContainer),c._transitionToCurrentDisplayer(a)})},_transitionToCurrentDisplayer:function(a){if(!this._inTransition){this._inTransition=!0,a.setStyle("opacity","0.0");var b=this._skinParts.itemsContainer,c=this,d=function(){for(var d=0;d<b.childNodes.length;d++)b.childNodes[d].destroy();b.empty();var f=a.getStyles("width","height"),g=c._getTopGap(f.height.replace("px",""));b.adopt(a),c._skinParts.virtualContainer.empty();var h=new Fx.Morph(c._skinParts.dialogBox,{duration:c.transitionTime,link:"chain"});h.addEvent("complete",function(){var b=new Fx.Tween(a,{duration:c.transitionTime,link:"chain"});b.addEvent("complete",function(){c.unlock(),c._inTransition=!1,b.removeEvent("complete",arguments.callee)}),b.start("opacity","1.0"),h.removeEvent("complete",arguments.callee)}),h.start({width:f.width,"min-height":f.height,"margin-top":g+"px"}),e&&e.removeEvent("complete",arguments.callee)};if(b.hasChildNodes()){var e=new Fx.Tween(b.firstChild,{duration:c.transitionTime,link:"chain",property:"opacity"});e.addEvent("complete",d),e.start("0.0")}else d()}},_changeImageNoTransition:function(a){for(var b=this._skinParts.itemsContainer,c=this,d=0;d<b.childNodes.length;d++)b.childNodes[d].destroy();b.empty();var e=a.getStyles("width","height"),f=c._getTopGap(e.height.replace("px",""));b.adopt(a),c._skinParts.virtualContainer.empty(),c._skinParts.dialogBox.setStyles({width:e.width,"min-height":e.height,"margin-top":f+"px"}),c.unlock()},_getTopGap:function(a){var b=this.injects().Utils.getWindowSize(),c=(b.height-a)/2;return c>0?c:0},_validateArgs:function(a,b){if(!a)return!1;var c=a.length;return a.length<1?!1:0>b||b>=c?(LOG.reportError(wixErrors.EDITOR_INDEX_OUT_OF_RANGE,"wysiwyg.viewer.components.MediaZoom","setGallery",b),!1):!0},_setNextPrevVisibility:function(){this._skinParts.buttonNext.uncollapse(),this._skinParts.buttonPrev.uncollapse(),(this.getDataItem().get("items").length<=1||this._extraParams.hideNextPrevBtns)&&(this._skinParts.buttonNext.collapse(),this._skinParts.buttonPrev.collapse())},_getItemId:function(a){var b="string"==typeof a?a:a.get("id");return 0==b.indexOf("#")?b.substr(1):b},_opened:!1,isZoomOpened:function(){return this._opened},validateArgs:function(a,b){if(!a)return!1;var c=a.length;return a.length<1?!1:0>b||b>=c?(LOG.reportError(wixErrors.EDITOR_INDEX_OUT_OF_RANGE,"wysiwyg.viewer.components.MediaZoom","setGallery",b),!1):!0}})}),define.component("wysiwyg.viewer.components.MediaZoomDisplayer",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_setCorrectImageSize"]),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.skinParts({title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},link:{type:"htmlElement",optional:!0},imageWrapper:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"},image:{type:"core.components.Image",dataRefField:"*",optional:!1,hookMethod:"_addImageArgs"}}),b.states({link:["showLink","hideLink"]}),b.fields({_minWidth:600,_maxWidth:-1,_maxHeight:-1,_imgActualSize:{x:0,y:0}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._maxWidth=c.maxWidth,this._maxHeight=c.maxHeight},_tweetHookMethod:function(a){return a.dataItem=this.injects().Data.createDataItem({defaultText:"",accountToFollow:"",type:"TwitterTweet"},"TwitterTweet"),a},_addImageArgs:function(a){this._imageDimensionsClass=this.injects().Classes.get("core.components.image.ImageDimensions"),this._imageDimensions=new this._imageDimensionsClass,this._imageDimensions.setCropMode(this._imageDimensionsClass.settingOptions.crop.FULL);var b=this.getSkin().getParams().first(function(a){return"imgPadding"===a.id});this._maxWidth=this._maxWidth-2*b.defaultValue;var c=this._imageDimensions.getDimensionsForContainerSize({x:this.getDataItem().get("width"),y:this.getDataItem().get("height")},{x:this._getImageWidth(),y:this._getImageHeight()});return this._imgActualSize=c.imageVisibleSize,a.argObject={unit:"px",cropMode:"full",width:this._imgActualSize.x,height:this._imgActualSize.y},a},_onAllSkinPartsReady:function(){this.parent(),this._skinParts.comments&&(this._minWidth=600),this._setCorrectImageSize(this._imgActualSize),this._updateParts()},getAcceptableDataTypes:function(){return["Image"]},_updateParts:function(){this._skinParts&&(this._skinParts.title.set("text",this._data.get("title")),this._skinParts.description.set("text",this._data.get("description")),""==this.getDataItem().get("href")?this.setState("hideLink","link"):this.setState("showLink","link"))},_setCorrectImageSize:function(a){var b=a.y,c=this._getDisplayerWidth(a.x);this._skinParts.imageWrapper.setStyles({width:c+"px",height:b+"px","min-width":"600px"}),this._skinParts.title.setStyles({"max-width":c+"px","word-wrap":"break-word"}),this._skinParts.description.setStyles({"max-width":c+"px","word-wrap":"break-word"})},_getDisplayerWidth:function(a){return a<this._minWidth?this._minWidth:a},_getImageWidth:function(){var a=this._data.get("width");return this._maxWidth<0||a<=this._maxWidth?a:this._maxWidth},_getImageHeight:function(){var a=this._data.get("height");return this._maxHeight<0||a<=this._maxHeight?a:this._maxHeight}})}),define.component("wysiwyg.viewer.components.MessageView",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({blockingLayer:{type:"htmlElement"},okButton:{type:"core.editor.components.EditorButton"},title:{type:"htmlElement"},description:{type:"htmlElement"},dialog:{type:"htmlElement"}}),b.binds(["_closeView"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_onAllSkinPartsReady:function(a){a.okButton.setLabel("OK"),a.okButton.addEvent("buttonClick",this._closeView)},_editModeChanged:function(){this._closeView()},showMessage:function(a){this.uncollapse(),this._skinParts.title.set("html",a.msgTitle||""),this._skinParts.description.set("html",a.msgBody||""),this._visible=!0},visible:function(){return this._visible},_closeView:function(){this.collapse(),this._visible=!1,this.fireEvent("complete")}})}),define.component("wysiwyg.viewer.components.Modal",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onCloseClick","_onBlockingLayerClick","_editModeChanged","_onViewportResize"]),b.skinParts({blockingLayer:{type:"htmlElement"},close:{type:"htmlElement"},innerComponent:{hookMethod:"_innerComponentDefinition"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this.disableBlockLayer=c.disableBlockLayer,this._origin=c.innerComponentArgs.argObject.origin,this._viewportSize=window.getSize(),this._innerComponentArgs=c.innerComponentArgs,this._innerComponentsize=null},render:function(){this.setSize();var a=0,b=0;"50%"==this._skinParts.innerComponent.getTop()&&(a=this._skinParts.innerComponent.getHeight()/2),"50%"==this._skinParts.innerComponent.getLeft()&&(b=this._skinParts.innerComponent.getWidth()/2),this._setInnerCompPosition(a,b),this._setClosePosition(a,b)},_onAllSkinPartsReady:function(a){this.parent(),window.addEvent(Constants.CoreEvents.RESIZE,this._onViewportResize),a.close.addEvent(Constants.CoreEvents.CLICK,this._onCloseClick),this.disableBlockLayer?a.blockingLayer.hide():a.blockingLayer.addEvent(Constants.CoreEvents.CLICK,this._onBlockingLayerClick)},_innerComponentDefinition:function(a){return a.type=this._innerComponentArgs.type,a.skin=this._innerComponentArgs.skin,a.dataItem=this._innerComponentArgs.dataItem||this._data,a.argObject=this._innerComponentArgs.argObject,a.argObject.containingComponent=this,a},_onViewportResize:function(){this._viewportSize=window.getSize(),this._renderIfReady()},_onCloseClick:function(){this.dispose()},_onBlockingLayerClick:function(){this.dispose()},_editModeChanged:function(){this.dispose()},_setClosePosition:function(a,b){var c=this._skinParts.close,d=c.getSize().x/2,e=this._skinParts.innerComponent.getWidth(),f=this._skinParts.innerComponent.getHeight(),g=this._skinParts.innerComponent.getX(),h="auto"!==this._skinParts.innerComponent.getLeft(),i="auto"!==this._skinParts.innerComponent.getTop(),j=h?b?"50%":g+e-d:"auto",k=h?"auto":0,l=i?a?"50%":0:"auto",m=i?"auto":f-d;c.setStyles({left:j,right:k,top:l,bottom:m,"margin-left":b?b-d:0,"margin-top":a?-a-d:0})},_centerModal:function(){var a=this._skinParts.close,b=a.getSize(),c=this._skinParts.innerComponent.getWidth()/2,d=this._skinParts.innerComponent.getHeight()/2;this._skinParts.innerComponent.getViewNode().setStyles({"margin-left":-c,"margin-top":-d}),a.setStyles({left:"50%",top:"50%","margin-left":c-b.x/2,"margin-top":-d-b.y/2})},setSize:function(){var a,b,c,d;this._innerComponentsize=this._innerComponentsize||{width:this._skinParts.innerComponent.getWidth(),height:this._skinParts.innerComponent.getHeight()},c=this._innerComponentsize,d=this._viewportSize,a=Math.min(c.width,d.x),b=Math.min(c.height,d.y),(this._skinParts.innerComponent.getWidth()!=a||this._skinParts.innerComponent.getHeight()!=b)&&(this._skinParts.innerComponent.setWidth(a),this._skinParts.innerComponent.setHeight(b,!1,!0)),this._setClosePosition()},dispose:function(){window.removeEvent(Constants.CoreEvents.RESIZE,this._onViewportResize),this._skinParts.innerComponent&&this._skinParts.innerComponent.dispose(),this.collapse(),this.parent()},_setInnerCompPosition:function(a,b){this._skinParts.innerComponent.getViewNode().setStyles({"margin-left":-b,"margin-top":-a})}})}),define.component("wysiwyg.viewer.components.PageGroup",function(a){var b=a;b.inherits("core.components.Container"),b.utilize(["wysiwyg.viewer.utils.TransitionUtils","core.components.Page"]),b.resources(["W.Utils","W.Viewer","W.Layout"]),b.propertiesSchemaType("PageGroupProperties"),b.binds(["onCurrentPageResize","_setHorizontalGrid","_setVerticalGrid","toggleGrid","refreshGrid","_resizePage","_onTransitionFinished"]),b.skinParts({grid:{type:"htmlElement"}}),b.states(["showGridLines"]),b.fields({_transitionQueue:[]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setMaxH(this.imports.Page.MAX_HEIGHT),this._runAnimations=!1,this._transitionDurationMap={},this._transitionDurationMap[Constants.TransitionTypes.NONE]=0,this._transitionDurationMap[Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN]=1.1,this._transitionDurationMap[Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN]=1.1,this._transitionDurationMap[Constants.TransitionTypes.CROSS_FADE]=1.2,this._transitionDurationMap[Constants.TransitionTypes.OUT_IN]=1.5},render:function(){this.parent();var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a)},getInlineContentContainer:function(){return this._skinParts.inlineContent},editModeChange:function(a){"MASTER_PAGE"==a||this._skinParts.overlay.collapse()},_onDataChanged:function(){var a=this.getComponentProperty("transition");"slide"==a&&this.setComponentProperty("transition",Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN,!0)},_onAllSkinPartsReady:function(){this._transitionUtils=new this.imports.TransitionUtils,this._Tween=this.resources.W.Utils.Tween,this._skinParts.overlay.collapse(),this.parent()},gotoPage:function(a){var b=document.getElementById(a);b.getLogic().setWidth(this.getWidth()),this._setVisiblePageCallId=this.resources.W.Utils.callLater(function(){b.getLogic().wixifyContent(function(){this.actualGotoPage(b)}.bind(this))}.bind(this))},actualGotoPage:function(a){this._transitionQueue.push(a),1==this._transitionQueue.length&&this._executeTransition(this._transitionQueue[0])},_onTransitionFinished:function(){if(this._currentPage.getLogic().addEvent("resize",this.onCurrentPageResize),this._transitionQueue.shift(),this._transitionQueue.length>0){var a=this._transitionQueue.pop();this._transitionQueue=[a],this._executeTransition(this._transitionQueue[0])}else{var b=this._currentPage.getLogic().getDataItem().get("id");window.scrollTo(0,0),this._view.fireEvent("pageTransitionEnded",b),this._resizePage()}},_executeTransition:function(a){var b=a.getLogic()._data.get("id");if(this._view.fireEvent("pageTransitionStarted",b),this.resources.W.Viewer.fireEvent("pageTransitionStarted",b),a.setStyle("opacity","0.0"),a.getLogic().uncollapse(),a.getLogic().isContentReady()===!0)this._executeTransitionPageReady(a);else{var c=this;a.getLogic().addEvent("pageContentReady",function(){a.getLogic().removeEvent("pageContentReady",arguments.callee),c._executeTransitionPageReady(a)})}},_executeTransitionPageReady:function(a){var b=this.getComponentProperty("transition"),c=this._transitionDurationMap[b]||0,d=b==Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN?1:0,e=a.getLogic().getHeight();if(a.setStyles({opacity:"1.0"}),this._currentPage&&!this._currentPage.getLogic().getIsDisposed()){this._currentPage.getLogic().removeEvent("resize",this.onCurrentPageResize);var f=this._currentPage.getLogic().getHeight();c>0?(this._Tween.execute(f,e,c,{onUpdate:this._resizePage,ease:"strong_easeInOut"}),this._Tween.execute(window.scrollY,0,c,{onUpdate:function(a){window.scrollTo(0,a)},ease:"strong_easeInOut"})):this._resizePage(e);var g=this._transitionUtils.getTransition(b);g(this._currentPage,a,d,c,function(){this._currentPage.getLogic().collapse(),this._currentPage=a,this._onTransitionFinished()}.bind(this))}else this._currentPage=a,this._resizePage(e),this._onTransitionFinished()},onCurrentPageResize:function(){this._resizePage()},_resizePage:function(a){a||(a=this._currentPage.getLogic().getHeight()),this.setHeight(a),this.resources.W.Layout.enforceAnchors([this]),this.refreshGrid()},useLayoutOnDrag:function(){return!0},isSelectable:function(){return!1},isContainer:function(){return!1},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},isDeleteable:function(){return!1},toggleGrid:function(){this._setVerticalGrid(),this._setHorizontalGrid();var a="showGridLines",b=this.getState()==a;b?this.removeState(a):this.setState(a)},refreshGrid:function(){"showGridLines"==this.getState()&&(this._setVerticalGrid(),this._setHorizontalGrid())},_setHorizontalGrid:function(){var a=window.getSize().x,b=this._view.getSize().x,c=a-b,d=-1*(c/2);this._skinParts.gridHeader.setStyle("width",a),this._skinParts.gridFooter.setStyle("width",a),this._skinParts.gridHeader.setStyle("left",d),this._skinParts.gridFooter.setStyle("left",d)},_setVerticalGrid:function(){var a=this._view.getPosition().y;window.getSize().y;var b=-1*a,c=parseInt(document.id("SITE_STRUCTURE").getStyle("height"));this._skinParts.gridBodyRight.setStyle("height",c),this._skinParts.gridBodyLeft.setStyle("height",c),this._skinParts.gridBodyRight.setStyle("top",b),this._skinParts.gridBodyLeft.setStyle("top",b)},getMinPhysicalHeight:function(){return this._currentPage.getLogic().getHeight()}})}),define.component("wysiwyg.viewer.components.PagesContainer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteSegmentContainer"),b.utilize(["core.components.Page"]),b.resources(["W.Viewer"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setMaxH(this.imports.Page.MAX_HEIGHT),this._resizableSides=[]},isAnchorable:function(){return{to:{allow:!0,allowBottomBottom:!1,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},isContainer:function(){return!1},layoutMinHeight:function(){return this.resources.W.Viewer.getCurrentPageNode().getLogic().getHeight()}})}),define.component("wysiwyg.viewer.components.PaginatedGridGallery",function(a){var b=a;b.inherits("wysiwyg.viewer.components.MatrixGallery"),b.traits(["wysiwyg.viewer.components.traits.GalleryAutoplay"]),b.utilize(["wysiwyg.viewer.utils.MatrixTransitions","wysiwyg.viewer.utils.GalleryUtils","bootstrap.utils.LinkUtils"]),b.resources(["W.Utils","W.Commands","W.Viewer"]),b.propertiesSchemaType("PaginatedGridGalleryProperties"),b.binds(["next","prev","_onTransitionComplete","_onRollOut","_onMouseMove","_onClick","_onPrevious","_onNext"]),b.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement",optional:!0},rolloverHolder:{type:"htmlElement",optional:!0},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1}}),b.states({rendering:["pending","ready"],itemSelection:["rollover","idle"],linkableComponent:["link","noLink"],slideshow:["autoplayOn","autoplayOff"],mobile:["notMobile","mobile"]}),b.fields({_rolloverSequencer:null,_fixedRowNumber:!1,_pageItemsCount:0,_currentItemIndex:0,_displayerDict:{},_transitionPending:!1,_transitionUtils:null,_linkUtils:null,_NO_LINK_PROPAGATION:!0,_hasRollOver:!0}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._transitionUtils=new this.imports.MatrixTransitions,this._linkUtils=new this.imports.LinkUtils,this._view.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onMouseMove),this._view.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onRollOut),"fixedRowNumber"in c&&(this._fixedRowNumber=c.fixedRowNumber===!0),void 0===c.sequencingHook&&(this._sequencer.resolveItem=function(){return{comp:"wysiwyg.viewer.components.ImageLite",skin:"mobile.core.skins.InlineSkin"}}),c.rolloverHook&&(this._rolloverSequencer=new this.imports.ComponentSequencer,this._rolloverSequencer.resolveItem=c.rolloverHook,this._rolloverSequencer.addEvent("componentSetup",this._onRollOverViewCreated)),W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile")},_onRollOverViewCreated:function(a){this._setupItem(a.compView)},getSequencer:function(){return this._sequencer},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0),this._updateGalleryImageOnClickAction()),this.parent(),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.itemsContainer.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder&&(this._skinParts.rolloverHolder.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder.setStyles({overflow:"hidden"}));var c=this.injects().Utils.getCSSBrowserFeature("user-select"),d={cursor:"pointer"};c&&(d[c]="none"),this._skinParts.buttonPrev.setStyles(d),this._skinParts.buttonNext.setStyles(d),this._addEventListeners(),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._transitionUtils.setupTransitionMap(this._calcItemPosition.bind(this),this._skinParts.itemsContainer),this._checkSkinPartsVisibility()},_addEventListeners:function(){this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.CLICK,this._onPrevious),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.CLICK,this._onNext),"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this._onPrevious),Hammer(this._view).on("swipeleft",this._onNext))},_onPrevious:function(a){a.stopPropagation(),this.prev()},_onNext:function(a){a.stopPropagation(),this.next()},_onResize:function(){this.parent(),this._skinParts&&this._resetRollOver()},_onDataChange:function(a,b){this._updateGalleryImageOnClickAction(),this._currentItemIndex=0,this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber()),this._componentReady&&a===this._data&&this._skinParts.itemsContainer.empty(),this._checkSkinPartsVisibility(),this.parent(a,b)},render:function(){var a=this._data.get("items");this._displayerDict={},this._skinParts.counter&&this._skinParts.counter.set("text",this._getCounterText(this._currentItemIndex,a.length)),this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber()),this._displayedItems=this._getPageItems(a,this._currentItemIndex);var b=this._displayedItems;a.length>this._pageItemsCount?(this._nextPageItems=this._getPageItems(a,this._getNextPageItemIndex()),this._prevPageItems=this._getPageItems(a,this._getPrevPageItemIndex()),b=b.concat(this._nextPageItems).concat(this._prevPageItems),this._skinParts.buttonNext.setStyles({display:"block"}),this._skinParts.buttonPrev.setStyles({display:"block"})):(this._skinParts.buttonNext.setStyles({display:"none"}),this._skinParts.buttonPrev.setStyles({display:"none"})),this._sequencer.createComponents(this._skinParts.itemsContainer,b)},_getRowNumber:function(){return this._fixedRowNumber===!0?parseInt(this.getComponentProperty("maxRows")):this.parent()},_getPageItems:function(a,b){for(var c=[],d=Math.min(this._numItems-1,b+this._pageItemsCount-1),e=b;d>=e;e++)c.push(a[e]);return c},_getCounterText:function(a){var b=Math.floor(a/this._pageItemsCount),c=this._getTotalPageCount();return c||(c=1),String(b+1)+"/"+String(c)},_translateRefList:function(a){var b,c,d,e=[],f=this._skinParts.itemsContainer.children,g=typeOf(a[0]);a=a.slice(0);for(var h=0;h<f.length;h++)b=f[h],c=b.getLogic().getDataItem(),d="string"===g?"#"+c.get("id"):c,a.contains(d)&&(e.push(b),a.splice(a.indexOf(d),1));return e},_checkSkinPartsVisibility:function(){this._skinParts&&(this._resetRollOver(),this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.setStyle("cursor",this._isImageClickable()?"pointer":"default"),this._skinParts.link.set("text",this.getComponentProperty("goToLinkText")))},_updateState:function(){},_onDisplayerCreation:function(a,b,c){var d=a.getViewNode();this._setupItem(d);var e;e=a.getRef?a.getRef():"#"+a.getDataItem().get("id"),d.addClass("galleryDisplayer"),this._displayerDict[e]=a,c>=this._displayedItems.length&&d.setStyles({top:1.5*-this._itemHeight,position:"absolute"})},_onSequencerFinished:function(a){a.elements=a.elements.slice(0,this._displayedItems.length),this.parent(a),this._transitionPending=!1,this.fireEvent("transitionFinished")},gotoNext:function(){this.next()},next:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&this._nextPageItems&&(this._currentItemIndex=this._getNextPageItemIndex(),this._goto(this._nextPageItems,0))},prev:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&this._prevPageItems&&(this._currentItemIndex=this._getPrevPageItemIndex(),this._goto(this._prevPageItems,1))},_getNextPageItemIndex:function(){var a=this._currentItemIndex+this._pageItemsCount;return a>=this._numItems&&(a=0),a},_getPrevPageItemIndex:function(){var a=this._currentItemIndex-this._pageItemsCount;return 0>a&&(a=(this._getTotalPageCount()-1)*this._pageItemsCount),a},_goto:function(a,b){this._transitionPending=!0,this._resetRollOver();var c=this._translateRefList(this._displayedItems),d=this._translateRefList(a),e=this._transitionUtils.getTransition(this.getComponentProperty("transition"));this._setupAllItems(d),e(c,d,this._numCols,this._numRows,b,parseFloat(this.getComponentProperty("transDuration")),function(){this._onTransitionComplete(d)}.bind(this))},_onTransitionComplete:function(){this.render()},_onMouseMove:function(a){if(this._transitionPending!==!0){var b=this._findDisplayerFromPosition(a.page);if(b&&this._skinParts.rolloverHolder&&this._hasRollOver){if(this._highlightedDisplayer!==b){this._highlightedDisplayer=b;var c=b.getCoordinates(this._skinParts.rolloverHolder.getParent());this._skinParts.rolloverHolder.setStyles({visibility:"visible",position:"absolute",padding:0,left:c.left,top:c.top,width:c.width,height:c.height}),this.setState("idle"),window.requestAnimFrame(function(){if(this._highlightedDisplayer){this._updateDisplayerInfo(b.getLogic().getDataItem());var a=this._getHighlightedDisplayerData();if(a.getType&&"Image"===a.getType()){var c=this.getSkinPart("link");this._linkUtils.linkifyElement(this,c,a,!0)}this._skinParts.rolloverHolder.setStyle("cursor",this._isImageClickable()?"pointer":"default"),"goToLink"==this._galleryImageOnClickAction?this._skinParts.link.setStyle("display","none"):this._skinParts.link.setStyle("display",this._isImageLinked()?"block":"none"),this.setState("rollover")}}.bind(this))}}else this._resetRollOver()}},_onRollOut:function(a){a.relatedTarget&&!a.relatedTarget.getParents().contains(this._view)&&this._resetRollOver()},_findDisplayerFromPosition:function(a){var b,c=this._skinParts.itemsContainer.getPosition(),d={x:a.x-c.x,y:a.y-c.y},e=Math.floor(d.x/(this._itemWidth+this._gap)),f=Math.floor(d.y/(this._itemHeight+this._gap));if(e>=0&&f>=0){var g=f*this._numCols+e;g<this._galleryItems.length&&(b=this._galleryItems[g])}return b},_findDisplayer:function(a){for(;a;){if(a===this._skinParts.itemsContainer)return null;if(this._galleryItems.contains(a))return a;a=a.getParent()}return null},_updateDisplayerInfo:function(a){this._skinParts.rolloverHolder&&this._rolloverSequencer?this._rolloverSequencer.createComponents(this._skinParts.rolloverHolder,[a]):a&&a.getData&&"title"in a.getData()&&"description"in a.getData()&&(this._skinParts.title.set("text",a.get("title")),this._skinParts.description.set("text",a.get("description")))},_hideRollOverHolder:function(){this.setState("idle"),this._skinParts.rolloverHolder.setStyles({visibility:"hidden"})},_resetRollOver:function(){this._hideRollOverHolder(),this._highlightedDisplayer=null},_onClick:function(a){if(a.rightClick===!1){var b;if("zoomMode"==this._galleryImageOnClickAction){var c=this._highlightedDisplayer||this._findDisplayer(a.target);if(c){b=c.getLogic().getDataItem();var d=b.get("id"),e=this._data.get("items"),f=e.indexOf("#"+d);this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._data,currentIndex:f,getDisplayerDivFunction:this.resources.W.Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.resources.W.Viewer.getDefaultGetHashPartsFunction("Image")})}}else"goToLink"==this._galleryImageOnClickAction&&this._isImageLinked()&&this._skinParts.link.click()}},_getTotalPageCount:function(){var a=Math.floor(this._numItems/this._pageItemsCount);return this._numItems%this._pageItemsCount>0&&a++,a},_isImageLinked:function(){var a=this._getHighlightedDisplayerData();if(a){var b=a.get("href");return!!b}return!1},_getHighlightedDisplayerData:function(){return this._highlightedDisplayer&&this._highlightedDisplayer.getLogic?this._highlightedDisplayer.getLogic().getDataItem():null},_isImageClickable:function(){return"goToLink"===this._galleryImageOnClickAction?this._isImageLinked():"disabled"!==this._galleryImageOnClickAction},_updateGalleryImageOnClickAction:function(){this._galleryImageOnClickAction=this.getComponentProperties().hasField("galleryImageOnClickAction")?this.getComponentProperty("galleryImageOnClickAction"):this.getComponentProperty("expandEnabled")?"zoomMode":"disabled"}})}),define.component("wysiwyg.viewer.components.PasswordLogin",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils","W.Data","W.Config","W.Viewer","W.Commands"]),b.skinParts({blockingLayer:{type:"htmlElement"},passwordInput:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},submitButton:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.PasswordLogin.Close"},cancel:{type:"htmlElement"},favIcon:{type:"htmlElement"},faveIconAhref:{type:"htmlElement"},header:{type:"htmlElement"},title:{type:"htmlElement"},dialog:{type:"htmlElement"}}),b.binds(["centerDialog","_onSubmit","_reportError","_invalidateErrorState","_onKeyPress","_handleCancel","_onPasswordSuccess"]),b.methods({initialize:function(a,b,c){this.isVolatile=!0,this.parent(a,b,c),this.VIEWER_STRINGS={LOGIN_HEADER:"Enter password to view this page",LOGIN_ERR_GENERAL:"Server error - Unable to log in",LOGIN_ERR_WRONG_PASSWORD:"Please enter the correct password",PASSWORD_LABEL:"Password"},this._digestedPassword=c&&c.digestedPassword,this._authCallback=c&&c.authCallback,this._disableCancel=c&&c.disableCancel},centerDialog:function(){var a=this.resources.W.Utils.getWindowSize(),b=this._skinParts.dialog;b.setPosition({x:a.width/2-b.getSize().x/2,y:a.height/2-b.getSize().y/2})},_onAllSkinPartsReady:function(a){if(this._disableCancel?(a.xButton.hide(),a.cancel.setStyle("visibility","hidden")):(a.cancel.addEvent("click",this._handleCancel),a.xButton.addEvent("click",this._handleCancel),a.blockingLayer.addEvent("click",function(b){b.target==a.blockingLayer&&this._handleCancel()}.bind(this))),a.submitButton.addEvent("click",this._onSubmit),a.title.set("text",this.VIEWER_STRINGS.LOGIN_HEADER),this.resources.W.Viewer.isPremiumUser()){a.faveIconAhref.removeAttribute("href");var b=window.publicModel&&window.publicModel.favicon;a.favIcon.src=b?this.resources.W.Config.getMediaStaticUrl(b)+b:this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/viewer/blank-favicon.png"}a.passwordInput.addEvent(Constants.CoreEvents.KEY_UP,this._onKeyPress)},_handleCancel:function(){this.resources.W.Commands.executeCommand("WViewerCommands.PasswordLogin.Close",null,null),this._reportAuthStatusChange(!1,{cancel:!0})},_reportAuthStatusChange:function(a,b){this._authCallback&&this._authCallback({authResponse:a,data:b})},_editModeChanged:function(){this._handleCancel()},_onKeyPress:function(a){13==a.code&&this._onSubmit(),this._invalidateErrorState()},_onSubmit:function(){this._invalidateErrorState();var a=this._skinParts.passwordInput._data.get("text");this._validatePassword(a,function(){this._invalidateErrorState(),this._onPasswordSuccess()
}.bind(this),function(a){this._reportError(a)}.bind(this))},_onPasswordSuccess:function(){this.resources.W.Commands.executeCommand("WViewerCommands.PasswordLogin.Close",null,null),this._reportAuthStatusChange(!0)},_validatePassword:function(a,b,c){if(this._digestedPassword){var d=W.Utils.hashing.SHA256.b64_sha256(a);d==this._digestedPassword?b():c(this.VIEWER_STRINGS.LOGIN_ERR_WRONG_PASSWORD)}},_reportError:function(a){this._skinParts.passwordInput.setError(a)},_invalidateErrorState:function(){this._skinParts.passwordInput.setValidationState(!0)},_bindPasswordField:function(a){return a.argObject={label:this.VIEWER_STRINGS.PASSWORD_LABEL,passwordField:!0},a.dataItem=this.resources.W.Data.createDataItem({text:"",type:"Text"},"Text"),a}})}),define.component("wysiwyg.viewer.components.PayPalButton",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Commands"]),b.dataTypes(["PayPalButton"]),b.propertiesSchemaType("PayPalButtonProperties"),b.skinParts({buttonContainer:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[]},render:function(){this._createPayPalForm()},_createPayPalForm:function(){this._buttonType=this.getComponentProperty("buttonType");var a=this.getComponentProperty("amount"),b=!a||0==Number(a),c=this.getComponentProperty("target"),d="buy"==this._buttonType?"_xclick":"_donations";if(this._form=new Element("form",{action:"https://www.paypal.com/cgi-bin/webscr",method:"POST"}),this._skinParts.buttonContainer.empty(),this._skinParts.buttonContainer.adopt(this._form),this._form.set("target",c),this._addHiddenInput("cmd",d),this._addHiddenInput("business",this._data.get("merchantID")),this._addHiddenInput("item_name","buy"==this._buttonType?this.getComponentProperty("itemName"):this.getComponentProperty("organizationName")),this._addHiddenInput("item_number","buy"==this._buttonType?this.getComponentProperty("itemID"):this.getComponentProperty("organizationID")),this._addHiddenInput("notify_url","https://inventory.wix.com/ecommerce/ipn/paypal"),"_blank"==c){var e=document.location.href;this._addHiddenInput("return",e),this._addHiddenInput("cancel_return",e)}b||this._addHiddenInput("amount",this.getComponentProperty("amount")),this._addHiddenInput("currency_code",this.getComponentProperty("currencyCode")),"buy"==this._buttonType?this._addHiddenInput("bn","Wix_BuyNow_WPS_IL"):this._addHiddenInput("bn","Wix_Donate_WPS_IL"),this._addSubmitImage(),this._addPixelImage(),this._alignSize(),this._form.addEvent("click",function(){if("_self"==c){var a={component:this};this.resources.W.Commands.executeCommand("linkableComponent.navigateSameWindow",a,this)}}.bind(this))},_alignSize:function(){var a,b,c=this.getComponentProperty("showCreditCards"),d=this.getComponentProperty("smallButton");d?(a=21,b="buy"==this._buttonType?86:74):c?(a=47,b=170):(a=26,b="buy"==this._buttonType?107:92),this.setWidth(b),this.setHeight(a),this._view.setStyle("height",a+"px")},_addSubmitImage:function(){var a=new Element("input",{type:"image",name:"submit",border:0,src:function(){var a=this.getComponentProperty("showCreditCards"),b=this.getComponentProperty("smallButton"),c="en_US",d="https://www.paypalobjects.com/"+c+"/i/btn/btn_";return d+="buy"==this._buttonType?"buynow":"donate",d+=a&&!b?"CC":"",d+=b?"_SM":"_LG",d+=".gif"}.bind(this)()});this._form.adopt(a)},_addHiddenInput:function(a,b){var c=new Element("input",{type:"hidden",name:a,value:b});this._form.adopt(c)},_addPixelImage:function(){this._form.adopt(new Element("img",{src:"https://www.paypalobjects.com/en_US/i/scr/pixel.gif",width:"1",height:"1"}))}})}),define.component("wysiwyg.viewer.components.ScreenWidthArea",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({inlineContent:{type:"htmlElement"},background:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),b.methods({getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getLayoutMode:function(){return"BACKGROUND_STRIP"}})}),define.component("wysiwyg.viewer.components.ScreenWidthContainer",function(a){var b=a;b.inherits("core.components.Container"),b.resources(["W.Viewer","W.Commands"]),b.binds(["_onScreenResize","_stretchBackgroundAndCenterContent"]),b.skinParts({inlineContent:{type:"htmlElement"},screenWidthBackground:{type:"htmlElement"},bg:{type:"htmlElement"},centeredContent:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),b.methods({initialize:function(a,b,c){this._pendingSizeUpdates={},this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this._moveDirections=[Constants.BaseComponent.MoveDirections.VERTICAL]},_onScreenResize:function(){this.getIsDisplayed()&&this._stretchBackgroundAndCenterContent()},_onResize:function(){},_stretchBackgroundAndCenterContent:function(){var a=this._view,b=$(document).getSize(),c=a.getSize(),d=this.resources.W.Viewer.getDocWidth(),e=-Math.round((b.x-d)/2);e>0&&(e=0),this._skinParts.screenWidthBackground.setStyles({position:"absolute",width:b.x+"px",height:c.y+"px",left:e})},render:function(){this.resources.W.Viewer.addEvent(this.resources.W.Viewer.SCREEN_RESIZE_EVENT,this._onScreenResize),this._stretchBackgroundAndCenterContent();var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a),this._onAutoSized()},dispose:function(){this.parent(),this.resources.W.Viewer.removeEvent(this.resources.W.Viewer.SCREEN_RESIZE_EVENT,this._onScreenResize)},_onAllSkinPartsReady:function(){this._applyPendingSizeUpdates(!0)},_applyPendingSizeUpdates:function(a){null!=this._pendingSizeUpdates.width?(this.setWidth(this._pendingSizeUpdates.width),this._pendingSizeUpdates.width=null):a&&this.setWidth(this.getWidth(),!0),null!=this._pendingSizeUpdates.height?(this.setHeight(this._pendingSizeUpdates.height),this._pendingSizeUpdates.height=null):a&&this.setHeight(this.getHeight(),!0)},setX:function(){},getX:function(){return 0},setHeight:function(a,b,c){this.parent(a,b,c),this._skinParts?(this._view.setStyle("min-height",a+"px"),this._stretchBackgroundAndCenterContent(),this.flushPhysicalHeightCache(),this._onResize()):this._pendingSizeUpdates.height=a},setWidth:function(a,b,c){if(this.parent(a,b,c),this._skinParts){var d=this.resources.W.Viewer.getDocWidth(),e=a+"px",f=(d-a)/2+"px";this._skinParts.centeredContent.setStyles({width:e,"margin-left":f})}else this._pendingSizeUpdates.width=a},getSelectableX:function(){var a=$(document).getSize().x;return this.getX()-(a-this.getWidth())/2},getSelectableWidth:function(){var a=$(document).getSize().x;return a},isContainable:function(a){return instanceOf(a,this.constructor)},isDuplicatable:function(){return!0},saveCurrentDimensions:function(){this._lastDimensions={w:this.resources.W.Viewer.getDocWidth(),h:this.getHeight()}},_getEditBoxReferenceNode:function(){return this._skinParts.inlineContent}})}),define.component("wysiwyg.viewer.components.SelectableSliderGallery",function(a){var b=a;b.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items"},itemsContainer:{type:"htmlElement"},swipeLeftHitArea:{type:"htmlElement"},swipeRightHitArea:{type:"htmlElement"}}),b.inherits("wysiwyg.viewer.components.SliderGallery"),b.fields({_selectedItem:null}),b.methods({initialize:function(a,b,c){this._expandEnabled=!1,this._initialSelectedIndex=0,c.selectedIndex&&(this._initialSelectedIndex=c.selectedIndex),this.parent(a,b,c)},_setupDisplayer:function(a,b){this.parent(a),b===this._initialSelectedIndex&&this.setSelectedState(a),a.addEvent("itemSelected",function(){this.setSelectedState(a),this.fireEvent("imageSelected",a.getDataItem())}.bind(this))},setSelectedState:function(a){if(this._selectedItem){if(this._selectedItem===a)return;this._selectedItem.setSelected(!1)}this._selectedItem=a,this._selectedItem.setSelected(!0)}})}),define.component("wysiwyg.viewer.components.SiteButton",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils"]),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.propertiesSchemaType("ButtonProperties"),b.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),b.dataTypes(["SiteButton"]),b.binds(["_onClick","_onOver","_onOut","_onMouseDown","_onMouseUp"]),b.states(["up","over","selected","pressed"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}]},_canFocus:!0,_triggers:["click"]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._userSelectedWidth=0,this._resizeTriggeredByData=!1},_onClick:function(a){if(LOG.reportEvent(wixEvents.VIEWER_BUTTON_COMPONENT_CLICK,{c1:this._compId,i1:this.isEnabled()?1:0}),!this.isEnabled())return this._cancelEvent(a);if(a.target=this.getViewNode(),this.fireEvent(Constants.CoreEvents.CLICK,a),this._toggleMode){var b="selected"!=this.getState()?"selected":"over";this.setState(b)}},_onOver:function(a){this.isEnabled()&&"selected"!=this.getState()&&(this.fireEvent("over",a),this.setState("over"))},_onOut:function(a){this.isEnabled()&&"selected"!=this.getState()&&(this.fireEvent("up",a),this.setState("up"))},_onMouseDown:function(a){if(this.isEnabled()&&"selected"!=this.getState())this.setState("pressed"),this.fireEvent(Constants.CoreEvents.MOUSE_DOWN,a);else if(!this.isEnabled())return this._cancelEvent(a)},_cancelEvent:function(a){return a.stopPropagation(),a.preventDefault(),!1},_onMouseUp:function(){this.removeState("pressed")},_onEnabled:function(){var a=this._skinParts.view;a.addEvent(Constants.CoreEvents.CLICK,this._onClick),a.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),a.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),a.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),a.addEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},_onDisabled:function(){var a=this._skinParts.view;a.removeEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),a.removeEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),a.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},render:function(){var a=this._data.get("label");this._skinParts.label.set("text",a),this._userSelectedWidth||a||(this._userSelectedWidth=parseInt(this._view.getStyle("width"),10)),this._updateMinimumWidth(),this._updateWidthFromText(),this._updateMinimumHeight(),this._setLineHeight(),this._setTextAlignment(),this._wCheckForSizeChangeAndFireAutoSized(0)},_skinParamsChange:function(){this.resources.W.Utils.callLater(function(){this._renderIfReady()}.bind(this),[],this,0),this.parent()},setHeight:function(a,b,c){this.parent(a,b,c),this._setLineHeight()},_setLineHeight:function(){if(this.isReady()){var a=parseInt(this._view.getStyle("padding-top")),b=parseInt(this._view.getStyle("padding-bottom")),c=this.getHeight()-a-b;this._skinParts.label.setStyle("line-height",c+"px")}},_setTextAlignment:function(){var a=this.getComponentProperty("align");this._skinParts.link.setStyle("text-align",a),this._setTextMargin()},_setTextMargin:function(){var a=this.getComponentProperty("margin"),b=this.getComponentProperty("align"),c=parseInt(this._skinParts.label.offsetWidth),d=this.getWidth();c+a>d&&(a=d-c),"left"==b?(this._skinParts.label.setStyle("margin-right",""),this._skinParts.label.setStyle("margin-left",a+"px")):"right"==b?(this._skinParts.label.setStyle("margin-left",""),this._skinParts.label.setStyle("margin-right",a+"px")):(this._skinParts.label.setStyle("margin-left",""),this._skinParts.label.setStyle("margin-right",""))},_setMinimumWidthAccordingToText:function(){var a=parseInt(this._skinParts.label.offsetWidth),b=parseInt(this._view.getStyle("padding-left")),c=parseInt(this._view.getStyle("padding-right"));this.setMinW(a+b+c)},_setMinimumHeightAccordingToText:function(){var a=parseInt(this._view.getStyle("padding-top")),b=parseInt(this._view.getStyle("padding-bottom"));this._skinParts.label.setStyle("line-height",""),this.setMinH(this._skinParts.label.offsetHeight+a+b)},_updateMinimumHeight:function(){this._setMinimumHeightAccordingToText(),this.setHeight(this.getHeight(),!1,!1)},_updateMinimumWidth:function(){this._setMinimumWidthAccordingToText(),this.setWidth(this.getWidth(),!1,!1)},_updateWidthFromText:function(){this._userSelectedWidth=0==this._userSelectedWidth?this.getWidth():this._userSelectedWidth;var a=Math.max(this.getSizeLimits().minW,this._userSelectedWidth);this.setWidth(a,!1,!1)},_onResize:function(){return this.parent(),0==this._resizeTriggeredByData?this._userSelectedWidth=parseInt(this._view.getStyle("width")):this._resizeTriggeredByData=!1,this.isReady()?(this._setTextMargin(),void 0):0},_onDataChange:function(a,b,c){this._resizeTriggeredByData=!0,this.parent(a,b,c)}})}),define.component("wysiwyg.viewer.components.SiteSegmentContainer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.ScreenWidthContainer"),b.skinParts({inlineContent:{type:"htmlElement"},screenWidthBackground:{type:"htmlElement"},bg:{type:"htmlElement"},centeredContent:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},useLayoutOnDrag:function(){return!0},useLayoutOnResize:function(){return!0},isDeleteable:function(){return!1},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},canMoveToOtherScope:function(){return!1},isMultiSelectable:function(){return!1},isDraggable:function(){return!1},isDuplicatable:function(){return!1}})}),define.component("wysiwyg.viewer.components.SlideShowGallery",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.utilize(["wysiwyg.viewer.utils.TransitionUtils"]),b.traits(["core.components.traits.TouchRollOverSupport","wysiwyg.viewer.components.traits.GalleryAutoplay"]),b.dataTypes(["ImageList"]),b.resources(["W.Utils","W.Viewer","W.Theme"]),b.states({editMode:["showButtons"],slideshow:["autoplayOn","autoplayOff"],mobile:["notMobile","mobile"],mobileShowTextPanel:["showTextPanel","notShow"]}),b.propertiesSchemaType("SlideShowGalleryProperties"),b.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"virtualContainer",moveOldItemsToContainer:!1,dataRefField:"items",argObject:{unit:"px"}},virtualContainer:{type:"htmlElement",optional:!0},itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement"},autoplay:{type:"htmlElement"}}),b.binds(["gotoNext","gotoPrev","_onNext","_onPrev"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery"},commandParameterDataRef:"SELF"}},_currentItemIndex:0,_currentItemRef:"",_prevItemIndex:-1,_numItems:-1,_itemHolder:null,_currentDisplayer:null,_locked:!1,_lastCommand:"",_transitionUtils:null,_displayedImages:[],_imageMode:"",_widthDiff:0,_heightDiff:0,_galleryItems:[],_expandEnabled:!0}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._Tween=this.resources.W.Utils.Tween,this._hideIndicatorElement=c&&c.hideIndicatorElement||!1,W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile")},_onDataChange:function(){this._numItems=this._data.get("items").length,this._imageMode=String(this.getComponentProperty("imageMode")),this._expandEnabled=this.getComponentProperty("expandEnabled")===!0,this._resizableSides="flexibleHeight"==this._imageMode?[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]:[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.BOTTOM,Constants.BaseComponent.ResizeSides.RIGHT],this._checkSkinPartsVisibility(),this.parent()},_checkSkinPartsVisibility:function(){if(this._skinParts){var a=this.getComponentProperty("showNavigation"),b="mobile"===this.getState("mobile"),c=a||b?"visible":"hidden";this._skinParts.buttonPrev.setStyle("visibility",c),this._skinParts.buttonNext.setStyle("visibility",c),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden")}},_processDataRefs:function(a){var b=[];if(a.length>0){b=[a[this._currentItemIndex]];var c;this._currentItemRef=a[this._currentItemIndex],a.length>1&&(c=this._normalizeIndex(this._currentItemIndex+1),b.push(a[c]),a.length>2&&(c=this._normalizeIndex(this._currentItemIndex-1),b.push(a[c])))}else this._itemHolder.empty();return b},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._view.setStyle("overflow","hidden"),this._itemHolder=new Element("div"),this._itemHolder.setStyles({position:"absolute",width:"100%",height:"100%"}),this._skinParts.itemsContainer.appendChild(this._itemHolder),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onPrev),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onNext),"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this._onPrev),Hammer(this._view).on("swipeleft",this._onNext)),this._transitionUtils=new this.imports.TransitionUtils,this._skinParts.virtualContainer||(this._skinParts.virtualContainer=new Element("div"),this._view.grab(this._skinParts.virtualContainer,"top"),this._skinParts.virtualContainer.setStyles({visibility:"hidden",display:"block",width:"1px",height:"1px",overflow:"hidden"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0;var c={cursor:"pointer"},d=this.injects().Utils.getCSSBrowserFeature("user-select");d&&(c[d]="none"),this._skinParts.buttonPrev.setStyles(c),this._skinParts.buttonNext.setStyles(c),this._checkSkinPartsVisibility(),this._editModeChanged(this._editorMode)},_mobileShowTextPanel:function(){this.setState("notShow","mobileShowTextPanel"),this._mobileShowTextPanelTimeout&&clearTimeout(this._mobileShowTextPanelTimeout),"mobile"===this.getState("mobile")&&(this.setState("showTextPanel","mobileShowTextPanel"),this._mobileShowTextPanelTimeout=setTimeout(function(){this.setState("notShow","mobileShowTextPanel")}.bind(this),2e3))},_onPrev:function(){this._mobileShowTextPanel(),this.gotoPrev()},_onNext:function(){this._mobileShowTextPanel(),this.gotoNext()},_editModeChanged:function(a){this.resources.W.Viewer.isPublicMode()||this._hideIndicatorElement||(this._createSlideShowIndicatorElement(),"PREVIEW"===a?this._hideEditModeSlideShowIndicator():this._showEditModeSlideShowIndicator())},_createSlideShowIndicatorElement:function(){if(!this._editorIndicatorElement){var a=this.resources.W.Theme.getProperty("WEB_THEME_DIRECTORY")+"ico_slide.png";this._editorIndicatorElement=new Element("div",{styles:{position:"absolute",top:"50%",width:"100%",marginTop:"-18px",textAlign:"center"}});var b=new Element("b",{styles:{display:"inline-block",borderRadius:"3px",background:"#222 url("+a+") no-repeat 8px 50%",opacity:"0.6",color:"#ffffff",padding:"0 14px 0 66px",whiteSpace:"nowrap",height:"38px",lineHeight:"39px",fontSize:"12px"}});b.set("text","Slide Show"),b.insertInto(this._editorIndicatorElement)}this._editorIndicatorElement.insertInto(this._view)},_hideEditModeSlideShowIndicator:function(){this.removeState("showButtons","editMode"),this._editorIndicatorElement.collapse()},_showEditModeSlideShowIndicator:function(){this.setState("showButtons","editMode"),this._editorIndicatorElement.uncollapse()},_onRepeaterItemReady:function(a,b){b.getViewNode().setStyles({position:"relative"})},_onRepeaterReady:function(a){this._galleryItems=a.readyItems},_isAllowRender:function(){return!0},render:function(){if(this._isAllowRender()){for(var a,b=0;b<this._galleryItems.length;b++)a=this._galleryItems[b].getLogic(),a.invalidateSize(),this._setupDisplayer(a),this._currentItemRef=="#"+a.getDataItem().get("id")?this._insertNewDisplayer(a):a.getViewNode().setStyles({visibility:"hidden",opacity:"1.0"});this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this._prevItemIndex=this._currentItemIndex}},_setupDisplayer:function(a){a.setOwner(this),a.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode)},_insertNewDisplayer:function(a){var b=this._itemHolder,c=this._currentDisplayer,d=a.getViewNode(),e=parseFloat(this.getComponentProperty("transDuration"));this._currentDisplayer=a,c&&c!==a&&b.adopt(c.getViewNode()),b.adopt(a.getViewNode()),d.setStyles({position:"absolute",top:"0px",left:"0px",visibility:"visible"}),a.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode),"flexibleHeight"==this._imageMode&&this._adjustFlexibleHeight(this._currentDisplayer,e);var f=this._currentDisplayer.getImageRef();f&&-1==this._displayedImages.indexOf(f)&&this._displayedImages.push(f),b.children.length>1?(a.setState("transIn"),c&&c.setState("transOut"),this._locked=!0,this._transitionUtils.getTransition(String(this.getComponentProperty("transition")))(b.children[0],b.children[1],this._getTransitionDirection(),e,function(){b.children.length>1&&(b.children[1].setStyle("position","static"),b.removeChild(b.children[0])),this._locked=!1,c&&c.setState("normal"),a.setState("noTransition"),this.fireEvent("transitionFinished")}.bind(this))):this._restartAutoPlay()},_restartAutoPlay:function(){},_adjustFlexibleHeight:function(a,b){var c=a.getHeight()+this._heightDiff;this._Tween.to(this._view,b,{height:c,onUpdate:function(a){this.setHeight(parseInt(a)),this.fireEvent("autoSized")}.bind(this)})},_getTransitionDirection:function(){var a=this.getComponentProperty("bidirectional")===!0,b=this.getComponentProperty("reverse")===!0,c={next:0,prev:1},d=0;return a&&(d=c[this._lastCommand]||0,b&&(d=1==d?0:1)),d},_onResize:function(){var a;this.parent(),this._currentDisplayer&&(this._currentDisplayer.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode),"flexibleHeight"==this._imageMode?window.requestAnimFrame(function(){a=this._currentDisplayer.getHeight()+this._heightDiff,this._view.setStyle("height",String(a)+"px"),this.setHeight(a),this.fireEvent("autoSized")}.bind(this)):(a=this.getHeight(),this._view.setStyle("height",String(a)+"px"),this.setHeight(a)))},gotoPrev:function(){!this._locked&&this._galleryItems.length>0&&(this._lastCommand="prev",this._currentItemIndex=this._getPrevItemIndex(),this._allRepeatersReady=!1,this._renderIfReady()),this.fireEvent("displayerChanged")},gotoNext:function(){!this._locked&&this._galleryItems.length>0&&(this._lastCommand="next",this._currentItemIndex=this._getNextItemIndex(),this._allRepeatersReady=!1,this._renderIfReady()),this.fireEvent("displayerChanged")},onPageVisibilityChange:function(a){a?this.resources.W.Utils.callLater(this._updateAutoplayState,[],this,1e3):null!=this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},_getNextItemIndex:function(){return this._normalizeIndex(this._currentItemIndex+1)},_getPrevItemIndex:function(){return this._normalizeIndex(this._currentItemIndex-1)},_normalizeIndex:function(a){return(a%this._numItems+this._numItems)%this._numItems}})}),define.component("wysiwyg.viewer.components.SliderGallery",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.resources(["W.Commands","W.Utils"]),b.traits(["core.components.traits.SwipeSupport"]),b.propertiesSchemaType("SliderGalleryProperties"),b.dataTypes(["ImageList"]),b.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items"},itemsContainer:{type:"htmlElement"},swipeLeftHitArea:{type:"htmlElement"},swipeRightHitArea:{type:"htmlElement"}}),b.binds(["gotoNext","gotoPrev","_updateMovementNoLoop","_updateMovementInLoop","_stopMovement"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery"},commandParameterDataRef:"SELF"}},_itemHolder:null,_itemWidth:0,_itemHeight:0,_gap:20,_movementSpeed:0,_shiftOffset:0,_shiftOffsetMax:0,_shiftOffsetMin:0,_maxSpeed:.05,_aspectRatio:0,_movementActive:!1,_debugMode:!1,_imageMode:"",_lastUpdate:0/0,_updateMovementFunc:null,_loop:!1,_itemsHolderSize:0,_contentOverflow:!1,_segment:0,_isZoomed:!1}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent("resizeEnd",this._onResizeEnd),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onChangeMode,null)},_onChangeMode:function(a){"PREVIEW"!==a&&this._stopMovement()},_onResizeEnd:function(){this._recalcItemSize(),this._allRepeatersReady=!1,this._renderIfReady()},_recalcItemSize:function(){this._skinParts&&(this._itemHeight=Math.floor(this._skinParts.itemsContainer.getHeight()),this._itemWidth=Math.floor(this._itemHeight*this._aspectRatio))},_processDataRefs:function(a){return this._loop===!0?a.concat(a):a},_onDataChange:function(){this._enableMovement(!1),this._aspectRatio=this._parseAspectRatioPreset(this.getComponentProperty("aspectRatioPreset")),this._aspectRatio?this.setComponentProperty("aspectRatio",this._aspectRatio,!0):this._aspectRatio=parseFloat(this.getComponentProperty("aspectRatio")),this._loop=this.getComponentProperty("loop")===!0,this._maxSpeed=parseInt(this.getComponentProperty("maxSpeed")),this._imageMode=String(this.getComponentProperty("imageMode")),this._gap=parseInt(this.getComponentProperty("margin")),this.parent()},_parseAspectRatioPreset:function(a){var b=a.split(":"),c=0;return 2==b.length&&(c=parseFloat(b[0])/parseFloat(b[1])),c},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._itemHolder=this._skinParts.itemsContainer,this._itemHolder.setStyles({position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px","white-space":"nowrap","-webkit-transform":"translateZ(0)"}),this._skinParts.itemsContainer.setStyles({overflow:this._debugMode?"visible":"hidden",border:this._debugMode?"1px solid black":"0"}),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.SetMediaZoomImage",this,this._onMediaZoomClicked,null),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed,null),this._skinParts.swipeLeftHitArea.addEvent(Constants.CoreEvents.MOUSE_MOVE,this.gotoPrev),this._skinParts.swipeRightHitArea.addEvent(Constants.CoreEvents.MOUSE_MOVE,this.gotoNext),this._skinParts.swipeLeftHitArea.addEvent(Constants.CoreEvents.MOUSE_OUT,this._stopMovement),this._skinParts.swipeRightHitArea.addEvent(Constants.CoreEvents.MOUSE_OUT,this._stopMovement)},_onMediaZoomClicked:function(){this._isZoomed=!0,this._stopMovement()},_onMediaZoomClosed:function(){this._isZoomed=!1},render:function(){var a;for(this._recalcItemSize(),this._updateMovementFunc=this._loop===!0?this._updateMovementInLoop:this._updateMovementNoLoop,this._loop===!1&&(this._segment=0),this._shiftOffset=0,this._itemsHolderSize=0,a=0;a<this._itemHolder.children.length;a++)this._setupDisplayer(this._itemHolder.children[a].getLogic(),a),this._itemsHolderSize+=this._itemHolder.children[a].getLogic().getWidth()+this._gap;this._checkItemsVisibility(),this._applyShiftOffset()},_checkItemsVisibility:function(){var a=this._itemHolder.children.length/2,b=this._loop===!0?this._itemsHolderSize/2:this._itemsHolderSize;for(this._contentOverflow=b>this._skinParts.itemsContainer.getWidth(),this._loop===!0&&this._contentOverflow===!1&&(this._segment=0),i=0;i<this._itemHolder.children.length;i++)this._loop===!0&&this._contentOverflow===!1&&i>=a?this._itemHolder.children[i].setStyle("opacity","0.0"):this._itemHolder.children[i].setStyle("opacity","1.0")},_setupDisplayer:function(a){a.invalidateSize(),a.setSize(this._itemWidth,this._itemHeight,this._imageMode),a.setOwner(this),a.getViewNode().setStyles({position:"static",display:"inline-block","vertical-align":"top","margin-right":String(this._gap)+"px","margin-left":"0px",opacity:"1.0"})},_moveToRight:function(){this._contentOverflow&&(this._setMovementSpeed(this._maxSpeed),this._enableMovement(!0))},_moveToLeft:function(){this._contentOverflow&&(this._setMovementSpeed(-this._maxSpeed),this._enableMovement(!0))},gotoNext:function(){this._isZoomed||this._contentOverflow&&(this._setMovementSpeed(this._maxSpeed),this._enableMovement(!0))},gotoPrev:function(){this._contentOverflow&&(this._setMovementSpeed(-this._maxSpeed),this._enableMovement(!0))},_enableMovement:function(a){a===!0&&this._movementActive===!1&&window.requestAnimFrame(this._updateMovementFunc),a===!0?this._movementActive||(this._shiftOffsetMin=this._skinParts.itemsContainer.getWidth()+this._gap-this._itemsHolderSize,this._offsetIsOnGapOnly()&&(this._shiftOffsetMin=0),this._movementActive=!0):(this._movementActive=!1,this._movementSpeed=0)},_stopMovement:function(){var a=this.resources.W.Utils.Tween;a.to(this,1,{_movementSpeed:0,onComplete:function(){this._enableMovement(!1)}.bind(this)})},_setMovementSpeed:function(a){var b=this.resources.W.Utils.Tween;b.to(this,1,{_movementSpeed:a})},_calcMovementCoeficient:function(){var a=1,b=(new Date).getTime();return isNaN(this._lastUpdate)||(a=(b-this._lastUpdate)/16),this._lastUpdate=b,a},_updateMovementNoLoop:function(){var a=this._calcMovementCoeficient();this._movementActive&&(this._shiftOffset+=-this._movementSpeed*a,this._shiftOffset>this._shiftOffsetMax&&(this._shiftOffset=this._shiftOffsetMax,this._enableMovement(!1)),this._shiftOffset<this._shiftOffsetMin&&(this._shiftOffset=this._shiftOffsetMin,this._enableMovement(!1)),this._applyShiftOffset()),this._movementActive&&window.requestAnimFrame(this._updateMovementFunc)},_updateMovementInLoop:function(){var a=this._calcMovementCoeficient();this._movementActive&&(this._shiftOffset+=-this._movementSpeed*a,this._movementSpeed<0&&(this._segment=0,this._shiftOffset>this._shiftOffsetMax&&(this._shiftOffset-=this._itemsHolderSize/2)),this._movementSpeed>0&&(this._segment=1,this._shiftOffset<0&&(this._shiftOffset+=this._itemsHolderSize/2)),this._applyShiftOffset()),this._movementActive&&window.requestAnimFrame(this._updateMovementFunc)},_applyShiftOffset:function(){var a=this._shiftOffset-this._segment*this._itemsHolderSize/2;this._itemHolder.children.length>0&&this._itemHolder.children[0].setStyle("margin-left",String(Math.floor(a))+"px")},_offsetIsOnGapOnly:function(){return Math.abs(this._shiftOffsetMin)<this._gap&&this._shiftOffsetMin>0}})}),define.component("wysiwyg.viewer.components.SocialBaseComponent",function(a){var b=a;b.inherits("wysiwyg.viewer.components.IFrameComponent"),b.resources(["W.Config"]),b.binds(["_createClickOverlay","_getUrl"]),b.methods({initialize:function(a,b,c){if(this.parent(a,b),this._resizableSides=[],c&&c.propObj)for(var d in c.propObj){var e=c.propObj[d];this.setComponentProperty(d,e)}this._iframeCallback=0},_onResize:function(){this._initialized&&this._renderIframe()
},render:function(){this._createClickOverlay(),this._renderComponent(),this._initialized=!0},_renderComponent:function(){if(this._renderIframe(!1),this._getSizeAccordingToProperties){var a=this._getSizeAccordingToProperties();this._changeSize(a)}},_getSizeAccordingToProperties:function(){return{w:225,h:55}},_getUrl:function(){var a=this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/",b=this._getUrlParams();return a+this._getPageName()+"?"+Object.toQueryString(b)},_getPageName:function(){},_getUrlParams:function(){return{}}})}),define.component("wysiwyg.viewer.components.SoundCloudWidget",function(a){var b=a;b.inherits("wysiwyg.viewer.components.IFrameComponent"),b.resources(["W.Config","W.Utils","W.Viewer"]),b.binds(["_stopPlayback","_getSoundCloudUrl"]),b.states(["hasContent","noContent"]),b.dataTypes(["SoundCloudWidget"]),b.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._urlExists=!1,this._view.addEvent(Constants.DisplayEvents.COLLAPSED,this._stopPlayback),this.setMinW(250)},_stopPlayback:function(){this._iframe.set("src","about:blank")},_updateIFrameSize:function(){var a;a=this._iframe,a&&a.set({width:this._view.getWidth()-1,height:this._view.getHeight()-1})},_getUrl:function(){var a=this._getSoundCloudUrl();if(void 0!=a&&""!=a){var b=this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/soundcloud.html";a=b+"?src="+encodeURIComponent(a)}return a},_getSoundCloudUrl:function(){var a=this._data.get("url");if(this._urlExists=!1,void 0!=a&&""!=a){3==a.split("?").length&&(a=a.substring(0,a.lastIndexOf("?"))),a=this.resources.W.Utils.setUrlParam(a,"show_artwork",this._isDataTrue("showArtWork"));var b=this._isDataTrue("autoPlay");(this.resources.W.Viewer.getPreviewMode()&&"PREVIEW"!=this._editorMode||!this.getIsDisplayed())&&(b=!1),a=this.resources.W.Utils.setUrlParam(a,"auto_play",b),this._urlExists=!0}return a||""},_isDataTrue:function(a){var b=!1;return(this._data.get(a)===!0||"true"===this._data.get(a))&&(b=!0),b},_setIframeParams:function(){this._iframe["class"]="html5player",this._iframe.setStyles({position:"absolute"}),this._urlExists===!1?this.setState("noContent"):this.setState("hasContent"),this._updateIFrameSize()},_editModeChanged:function(a,b){("PREVIEW"==a||"PREVIEW"==b)&&this._updateIframe(!0)},setHeight:function(a,b,c){a=Math.max(a,50),this._view.setStyle("height",parseInt(a)+"px"),this.parent(a,b,c)},setWidth:function(a,b,c){a=Math.max(a,200),this._view.setStyle("width",parseInt(a)+"px"),this.parent(a,b,c)}})}),define.component("wysiwyg.viewer.components.TableComponent",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.skinParts({tableBody:{type:"htmlElement"},tableHeader:{type:"htmlElement",optional:!0},tableFooter:{type:"htmlElement",optional:!0},table:{type:"htmlElement",optional:!0}}),b.propertiesSchemaType("TableComponentProperties"),b.binds(["_createBodyRow","_createHeaderCell","_createFooterCell","_createBodyCell","_addSpacerRow"]),b.dataTypes(["list","Table"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._rowsSequencer=new this.imports.ComponentSequencer,this._rowsSequencer.resolveItem=this._createBodyRow,this._rowsSequencer.addEvent("productionFinished",this._addSpacerRow),this._bodyCellSequencingHook=c.SequencingHook,this._headerFooterCellSequencingHook=c.HeaderFooterSequencingHook||c.SequencingHook},_onAllSkinPartsReady:function(a){this.parent(a);var b=this.getComponentProperty("minHeight");b&&this.setMinH(b),this.getDataItem()&&this._populateTable()},_onComponentPropertyChange:function(a,b){"minHeight"===a&&this.setMinH(b)},setMinH:function(a){this._skinParts&&this._skinParts.table.setStyle("height",a+"px"),this.parent(a),this.setHeight(a)},_onDataChange:function(a,b,c){this._skinParts&&("minHeight"==b?this.setMinH(c.minHeight||c):(this._populateTable(),this.fireEvent("autoSized",{ignoreLayout:!1}))),this.parent(a,b,c)},_populateTable:function(){var a=this.getDataItem();if(this._rowsSequencer.createComponents(this._skinParts.tableBody,a.get("items")),a.hasField("header")){var b=this._createRow(a.get("header"),this._createHeaderCell);this._skinParts.tableHeader.empty().adopt(b)}else this._skinParts.tableHeader.removeFromDOM();if(a.hasField("footer")){var c=this._createRow(a.get("footer"),this._createFooterCell);this._skinParts.tableFooter.empty().adopt(c)}else this._skinParts.tableFooter.removeFromDOM()},_createBodyRow:function(a){return this._createRow(a,this._createBodyCell)},_createRow:function(a,b){var c=new Element("tr"),d=new this.imports.ComponentSequencer;return d.resolveItem=b,d.createComponents(c,a),c},_createHeaderCell:function(a,b,c){return this._createCell(a,b,c,"th",this._headerFooterCellSequencingHook)},_createFooterCell:function(a,b,c){return this._createCell(a,b,c,"td",this._headerFooterCellSequencingHook)},_createBodyCell:function(a,b,c){return this._createCell(a,b,c,"td",this._bodyCellSequencingHook)},_createCell:function(a,b,c,d,e){var f=new Element(d),g=e(a,b,c);g&&f.grab(g);var h=a.styleData;if(h)for(var i in h)f.setStyle(i,h[i]);return f},_addSpacerRow:function(){var a=new Element("tr",{"class":"spacer"}),b=new Element("td",{colspan:"100%"});a.adopt(b),this._skinParts.tableBody.adopt(a),this.fireEvent("autoSized",{ignoreLayout:!1})}})}),define.component("wysiwyg.viewer.components.TwitterFeed",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Skins","W.Config"]),b.propertiesSchemaType("TwitterFeedProperties"),b.dataTypes(["TwitterFollow"]),b.binds(["_applyThemeColors","_onResizeEnd"]),b.fields({MIN_SIZE:220,EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.AdvancedDesign"}]}}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this.iframeCreated=!1,this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=2e3},render:function(){this._renderFeed()},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},_applyThemeColors:function(a){var b=["bg","txt1","bg2","txt2","linkColor"];for(var c in a.properties)if(b.indexOf(c)>-1)return this._renderFeed(),void 0},_renderFeedAndDontReload:function(){this._renderFeed(!0)},_renderFeed:function(a){this.isReady()&&(this.iframeCreated?this._postMessageToIframe(a):(this._createIframe(),this.iframeCreated=!0))},_createIframe:function(a){var b=new IFrame({src:this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/twfeed.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",scrolling:"no",events:{load:function(){this._iframeCreated=!0,this._postMessageToIframe(a)}.bind(this)}});this._iframe=b,this._view.empty(),this._view.grab(b)},_postMessageToIframe:function(a){var b=this.resources.W.Skins,c=this._skin.className,d={userName:this._data.get("accountToFollow")||"wix",height:this._view.getHeight()-90,width:this._view.getWidth(),numOfTweets:this.getComponentProperty("numOfTweets")||1,shellBGColor:b.getSkinParamValue(c,"bg",this._style).getHex(!1),shellColor:b.getSkinParamValue(c,"txt1",this._style).getHex(!1),tweetBGColor:b.getSkinParamValue(c,"bg2",this._style).getHex(!1),tweetColor:b.getSkinParamValue(c,"txt2",this._style).getHex(!1),tweetLinkColor:b.getSkinParamValue(c,"linkColor",this._style).getHex(!1),start:!a};this._iframe.contentWindow.postMessage(JSON.stringify(d),"*")},setHeight:function(a){a=Math.max(220,a),this._view.setStyle("height",parseInt(a)+"px"),this.parent(a,!0,!0)},setWidth:function(a){a=Math.max(220,a),this._view.setStyle("width",parseInt(a)+"px"),this.parent(a,!0,!0)},_onResize:function(){this.parent(),this._renderFeedAndDontReload()},_onResizeEnd:function(){this._renderFeed()}})}),define.component("wysiwyg.viewer.components.VerticalLine",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["render"]),b.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Theme.setProperty("WEB_THEME_DIRECTORY","viewer"),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},render:function(){this.setWidth(this.getViewNode().getSize().x)},setHeight:function(a,b,c){this._getNumberOfKnobs(),this.height=a,this.parent(a,b,c)},_getNumberOfKnobs:function(){var a=0;return this._skinParts&&(this._skinParts.bottomKnob&&a++,this._skinParts.topKnob&&a++,this._skinParts.middleKnob&&a++),a}})}),define.component("wysiwyg.viewer.components.VerticalMenu",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.utilize(["core.components.BaseList","core.components.SimpleButton"]),b.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,dataRefField:"pages",container:"itemsContainer",hookMethod:"_changePagesRefData",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"}}),b.binds(["_onMoreButtonClick","_onThemeChange","_arrangeButtons","_onButtonClick","_onMoreButtonOver","_onMoreButtonOut","_onMoreContainerOver","_onMoreContainerOut","_closeMoreMenu","_onPageChanged"]),b.dataTypes(["Document"]),b.propertiesSchemaType("HorizontalMenuProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionEnded",this._onPageChanged),this._usesExternalData=!0},_onPageChanged:function(a){var b,c;if(this._allButtons)for(b=0;b<this._allButtons.length;b++)c=this._allButtons[b],c.getID()==a?c.setState("selected"):c.removeState("selected")},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._allButtons=[]},_onRepeaterItemReady:function(a,b,c,d){d&&b.addEvent("click",function(){this._onButtonClick(c)}.bind(this)),this._allButtons.push(b),this.parent(a,b,c,d)},_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._addPartsListeners(),this._arrangeButtons()},_addPartsListeners:function(){this._skinParts.moreButton.addEvent("over",this._onMoreButtonOver),this._skinParts.moreButton.addEvent("out",this._onMoreButtonOut),this._skinParts.moreButton.addEvent("click",this._onMoreButtonClick),this._skinParts.moreContainer.addEvent("mouseover",this._onMoreContainerOver),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut);for(var a=0;a<this._allButtons.length;a++)this._allButtons[a].getViewNode().uncollapse(),this._allButtons[a].addEvent("dataChanged",this._arrangeButtons)},render:function(){this.parent(),"styleChange"==this._changeTriggeredBy?this._arrangeButtonsDelayed():this._arrangeButtons(),this._changeTriggeredBy=""},_onDataChange:function(a){this.getComponentProperties().removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent(a)},_skinParamsChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_arrangeButtonsDelayed:function(){-1!=this._arrangeWaitID&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtons,[],50)},_arrangeButtons:function(){if(void 0!=this._skinParts&&this._allButtons&&0!=this._allButtons.length&&this._isDisplayed&&this.isReady()){this._skinParts.moreButton.getViewNode().collapse(),this._skinParts.moreContainer.collapse(),this._skinParts.itemsContainer.setStyle("width","0px"),this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignText")),this._arrangeWaitID=-1;var a=this._getWidestLabelWidth();this.setMinW(a);for(var b=Math.max(a,this.getWidth()),c=Math.max(this._allButtons[0]._skinParts.label.offsetHeight,Math.floor(this.getHeight()/this._allButtons.length)),d=0;d<this._allButtons.length;d++){var e=this._allButtons[d];e.setWidth(b,!0),e.setHeight(c,!0),e._skinParts.label.setStyle("line-height",c+"px")}this._wCheckForSizeChangeAndFireAutoSized(0)}},_getWidestLabelWidth:function(){for(var a=0,b=0;b<this._allButtons.length;b++){var c=this._allButtons[b],d=parseInt(c._skinParts.label.offsetWidth);parseInt(c._view.getStyle("padding-left")),parseInt(c._view.getStyle("padding-right")),a=Math.max(a,d+c.getExtraPixels(!0).width)}return a},_setMinimumWidthAccordingToText:function(){this.setMinW(labelWidth+viewNodePaddingLeft+viewNodePaddingRight)},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(a){this.injects().Viewer.goToPage(a.get("id"))},_openMoreMenu:function(){this._skinParts.moreContainer.setStyle("display","block"),!this._isMoreContainerOpen,this._isMoreContainerOpen=!0,this._toCloseMoreMenu=!1},_closeMoreMenuTimer:function(){this._toCloseMoreMenu||(this._toCloseMoreMenu=!0,this.injects().Utils.callLater(this._closeMoreMenu,[],this,500))},_closeMoreMenu:function(a){(a||this._toCloseMoreMenu)&&(this._skinParts.moreContainer.setStyle("display","none"),this._toCloseMoreMenu=!1,this._isMoreContainerOpen=!1)},_forceCloseMoreMenu:function(){this._closeMoreMenu(!0)},_onMoreButtonOver:function(){this._openMoreMenu()},_onMoreButtonOut:function(){this._closeMoreMenuTimer()},_onMoreContainerOver:function(){this._openMoreMenu()},_onMoreButtonClick:function(){this._isMoreContainerOpen===!1?this._openMoreMenu():this._forceCloseMoreMenu()},_onMoreContainerOut:function(){this._closeMoreMenuTimer()}})}),define.component("wysiwyg.viewer.components.VerticalRepeater",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.dataTypes(["","ImageList"]),b.binds(["_sequencingHook"]),b.skinParts({inlineContent:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._sequencer=new this.imports.ComponentSequencer,this._sequencer.resolveItem=c&&c.sequencingHook?this._sequencingHookWrapper(c.sequencingHook):this._sequencingHookWrapper(this._sequencingHook)},_sequencingHookWrapper:function(a){return function(b,c,d){return a(b,c,d)}},getSequencer:function(){return this._sequencer},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},setSequencingHook:function(a){this._sequencer.resolveItem=this._sequencingHookWrapper(a)},_onAllSkinPartsReady:function(){this._sequencer.addEvent("productionFinished",function(a){this._markChildren(a.elements)}.bind(this))},render:function(){this._data&&(this._newItems=[],this._sequencer.createComponents(this._skinParts.inlineContent,this._data.get("items")))},_markChildren:function(a){a.each(function(a,b,c){a.set("isfirst",0==b?"true":"false"),a.set("iseven",1==b%2?"true":"false"),a.set("islast",b==c.length-1?"true":"false")})}})}),define.component("wysiwyg.viewer.components.Video",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({videoFrame:{type:"htmlElement"},preview:{type:"htmlElement"}}),b.binds(["_stopVideo","_getYouTubeParams","_getVimeoParams","_onResize","_onResizeEnd","_getYouTubePreview","_getViemoPreviewUrl"]),b.states([]),b.dataTypes(["Video"]),b.propertiesSchemaType("VideoProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],EDITOR_META_DATA:{general:{settings:!0,design:!0}},_defaultPlayerParams:{wmode:"transparent"},_options:{videoType:"",videoId:"",resize:[]}}),b.methods({_getServices:function(){return{YOUTUBE:{url:"http://www.youtube.com/embed/",preview:this._getYouTubePreview,getParams:this._getYouTubeParams,hMinSize:200,wMinSize:200},VIMEO:{url:"http://player.vimeo.com/video/",preview:this._getViemoPreviewUrl,getParams:this._getVimeoParams,hMinSize:100,wMinSize:100}}},initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._iframe=null,this._inPublicMode=this.injects().Viewer.isPublicMode(),this.addEvent("resizeEnd",this._onResizeEnd),this._view.addEvent(Constants.DisplayEvents.COLLAPSED,this._stopVideo)},_stopVideo:function(){this._iframe.set("src","about:blank")},render:function(){this._renderIframe(),this.setMinW(this._getWMinSize()),this.setMinH(this._getHMinSize())},_onResize:function(){this.parent()},_onResizeEnd:function(){this._renderIframe()},_editModeChanged:function(a,b){if(!this.injects().Viewer.isPublicMode()){var c="PREVIEW";this._inPublicMode=a==c,(b==c||a==c)&&this._renderIframe()}},setHeight:function(a,b,c){a=Math.max(a,this._getHMinSize()),this._view.setStyle("height",parseInt(a,10)+"px"),this.parent(a,!0,c)},setWidth:function(a,b,c){a=Math.max(a,this._getWMinSize()),this._view.setStyle("width",parseInt(a,10)+"px"),this.parent(a,b,c)},_getHMinSize:function(){var a=this._getVideoType(),b=this._getServices()[a].hMinSize,c=this.getComponentProperty("showControls");return"YOUTUBE"==a&&"always_show"==c&&(b+=20),b},_getWMinSize:function(){var a=this._getVideoType();return this._getServices()[a].hMinSize},_renderIframe:function(){if(this._options.videoType=this._getVideoType(),this._options.videoId=this._getVideoId(),this._options.videoId&&this._options.videoType){if(!this._inPublicMode&&(Browser.ie||Browser.firefox&&Browser.Platform.mac))return this._createPreview(),void 0;this._skinParts.videoFrame.uncollapse(),this._skinParts.preview.collapse(),this._iframe&&this._skinParts.videoFrame.hasChildNodes()?this._updateIframe(this._getUrl(),this.getWidth(),this.getHeight()):this._createIframe(this._getUrl(),this.getWidth(),this.getHeight()),this._iframe.setStyles({height:"100%",width:"100%"})}},_getContainerIframe:function(){return this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/video.html"},_createIframe:function(a,b,c){var d=this._getContainerIframe()+"?url="+encodeURIComponent(a)+"&width="+b+"&height="+c;this._iframe=new IFrame({src:d,webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0"}),this._iframe.insertInto(this._skinParts.videoFrame)},_updateIframe:function(a){var b=this._getContainerIframe()+"?url="+encodeURIComponent(a);this._iframe.set({src:b})},_getPlayerParamsAsQueryString:function(){var a=this._getServices()[this._options.videoType].getParams(),b=[];return Object.forEach(a,function(a,c){b.push(c+"="+a)}),b.join("&")},_getYouTubeParams:function(){var a={},b=this.getComponentProperty("showControls"),c=this.injects().Config.isFacebookSite(),d=this.getComponentProperty("autoplay")&&!c,e=this.getComponentProperty("lightTheme"),f=this.getComponentProperty("loop"),g=this.getComponentProperty("showinfo");switch(a.wmode="transparent",this._inPublicMode&&(a.autoplay=d&&this.getIsDisplayed()?"1":"0"),a.theme=e?"light":"dark",b){case"always_show":a.controls="1",a.autohide="0";break;case"always_hide":a.controls="0";break;case"temp_show":a.autohide="1"}return f?(a.loop="1",a.playlist=this._options.videoId):a.loop="0",a.showinfo=g?"1":"0",a.rel="0",a},_getVimeoParams:function(){var a={};return this._inPublicMode&&(a.autoplay=this.getIsDisplayed()?this.getComponentProperty("autoplay"):0),a.loop=this.getComponentProperty("loop"),a.byline=this.getComponentProperty("showinfo"),a.portrait=this.getComponentProperty("showinfo"),a.title=this.getComponentProperty("showinfo"),a},_getUrl:function(){return this._getServices()[this._options.videoType].url+this._options.videoId+"?"+this._getPlayerParamsAsQueryString()},_getVideoType:function(){return this._data&&this._data.get("videoType")},_getVideoId:function(){return this._data&&this._data.get("videoId")},_createPreview:function(){var a=this._getServices(),b=this._options.videoType,c=a[b].preview;c()},_renderPreviewImage:function(a){var b=this._view.getWidth(),c=this._view.getHeight();this._image?this._updatePreviewImage(a,c,b):this._createPreviewImage(a,c,b)},_createPreviewImage:function(a,b,c){this._image=new Image,this._image.src=a,this._image.setStyles({height:b,width:c}),this._image.insertInto(this._skinParts.preview),this._options.resize.push(this._image),this._skinParts.videoFrame.collapse(),this._skinParts.preview.uncollapse()},_updatePreviewImage:function(a,b,c){this._image.get("src")!=a&&this._image.set("src",a),this._image.setStyles({height:b,width:c}),this._skinParts.videoFrame.collapse(),this._skinParts.preview.uncollapse()},_getYouTubePreview:function(){var a="http://img.youtube.com/vi/[repLace]/0.jpg",b=a.replace("[repLace]",this._options.videoId);this._renderPreviewImage(b)},_getViemoPreviewUrl:function(){var a="http://vimeo.com/api/v2/video/[repLace].json",b=a.replace("[repLace]",this._options.videoId),c=new Request.JSONP({url:b+"?"+"r="+Math.random(),onComplete:this.onVimeoRetrun.bind(this)});c.send()},onVimeoRetrun:function(a){var b=a&&a[0]&&a[0].thumbnail_large;this._renderPreviewImage(b)}})}),define.component("wysiwyg.viewer.components.WFacebookComment",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils","W.Viewer","W.TPA"]),b.propertiesSchemaType("WFacebookCommentProperties"),b.skinParts({facebook:{type:"htmlElement"}}),b.states({EDITOR:["light","dark"],VIEWER:["scriptLoading","scriptLoaded","loading","idle"]}),b.binds(["_onResizeEnd","_onFacebookComponentRender","_checkIframeSize","_renderComponentOnViewer","_rebuildFacebookComponent"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b){this.parent(a,b),this.addEvent("resizeEnd",this._onResizeEnd),this._resizableSides=[Constants.BaseComponent.ResizeSides.RIGHT,Constants.BaseComponent.ResizeSides.LEFT],this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this._iframeOldHeight=0},render:function(){this._createClickOverlay(),this._renderComponent()},_editModeChanged:function(a,b){("PREVIEW"==a||"PREVIEW"==b)&&this._renderComponent()},_onResizeEnd:function(){this._skinParts&&(this.setComponentProperty("width",this.getWidth()),this._renderComponent())},_renderComponent:function(){this.resources.W.Viewer.isPublicMode()||!Browser.ie?this._renderComponentOnViewer():this._renderComponentOnEditor()},_renderComponentOnEditor:function(){var a=this.getComponentProperty("colorScheme");this.setState(a,"editor")},_renderComponentOnViewer:function(){var a=this.getState("viewer");return a?"loading"==a||"scriptLoading"==a?(this.callRenderLater(),!1):(this.setState("loading","viewer"),this._rebuildFacebookComponent(),void 0):(this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","viewer")}.bind(this)),this.callRenderLater(),!1)},_rebuildFacebookComponent:function(){var a=this._getFacebookHref();this._skinParts.facebook.empty();var b={"class":"fb-comments","data-href":a,"data-num-posts":this.getComponentProperty("numPosts"),"data-width":this.getComponentProperty("width"),"data-colorscheme":this.getComponentProperty("colorScheme"),mobile:!1};this._fbCommentElement=new Element("DIV",b),this._fbCommentElement.insertInto(this._skinParts.facebook),window.FB&&FB.XFBML&&FB.XFBML.parse&&FB.XFBML.parse(this._skinParts.facebook),this.setState("idle","viewer")},appendPageHash:function(a){var b=this.resources.W.Viewer.getCurrentPageId(),c=this.resources.W.Viewer.getPagesData()[b],d=this.resources.W.TPA.getPageState(b),e=this.resources.W.Utils.hash.getHashPartsString(b,c.get("pageUriSEO"),d);return this.resources.W.Utils.strEndsWith(a,"#!"+e)||(a+=this.resources.W.Utils.strEndsWith(a,"/#")?"!"+e:this.resources.W.Utils.strEndsWith(a,"/")?"#!"+e:"/#!"+e),a},_getFacebookHref:function(){var a=location.href;return this.resources.W.Viewer.isHomePage()&&(a=this.appendPageHash(a)),a},_onFacebookComponentRender:function(){if(this.isReady()){var a=this._skinParts.facebook.getSize(),b=a.y;this.setHeight(b),this._wCheckForSizeChangeAndFireAutoSized(1)}},dispose:function(){this._iframeAuditor&&clearInterval(this._iframeAuditor),window.FB&&(FB.Event.unsubscribe("xfbml.render",this._onFacebookComponentRender),FB.Event.subscribe("comment.create",this._onFacebookComponentRender),FB.Event.subscribe("comment.remove",this._onFacebookComponentRender)),this.parent()},setWidth:function(a,b,c){var d=400;a>=d?this.parent(a,b,c):this.parent(d,b,c)},_checkIframeSize:function(){if(this.isReady()){var a=this._skinParts.facebook.getElement("iframe");if(a){var b=a.getSize().y;this._iframeOldHeight!=b&&(this._iframeOldHeight=b,this._onFacebookComponentRender())}}},_loadScript:function(a){var b="236335823061286";this.resources.W.Viewer.loadExternalScript("//connect.facebook.net/en_US/all.js",function(){FB.Event.subscribe("xfbml.render",this._onFacebookComponentRender),FB.Event.subscribe("comment.create",this._onFacebookComponentRender),FB.Event.subscribe("comment.remove",this._onFacebookComponentRender),this._iframeAuditor=setInterval(function(){this._checkIframeSize()}.bind(this),500),FB.init({appId:b,xfbml:1}),a()}.bind(this))}})}),define.component("wysiwyg.viewer.components.WFacebookLike",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SocialBaseComponent"),b.resources(["W.Utils","W.Viewer"]),b.propertiesSchemaType("WFacebookLikeProperties"),b.skinParts({facebook:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this.parent(a,b,c)},render:function(){this._layout=this.getComponentProperty("layout"),this._showFaces=this.getComponentProperty("show_faces"),this._action=this.getComponentProperty("action"),this._colorScheme=this.getComponentProperty("colorScheme"),this._send=this.getComponentProperty("send"),this.parent()},_getPageName:function(){return"fblike.html"},_getUrlParams:function(){return{href:this._getLikeUrl(),layout:this._layout,show_faces:this._showFaces,action:this._action,colorscheme:this._colorScheme,send:this._send,width:this._getSizeAccordingToProperties().x}},_getLikeUrl:function(){if(this.resources.W.Viewer.isPublicMode()){var a=window.publicModel?window.publicModel.externalBaseUrl:void 0;return a=a||location.protocol+"//"+location.host+location.pathname,this.resources.W.Viewer.isHomePage()?a:a+location.hash}return"http://www.wix.com/create/website"},_getSizeAccordingToProperties:function(){var a,b;return"standard"==this._layout?(a=250,"recommend"==this._action&&(a+=40),b=this._showFaces?85:40):"button_count"==this._layout?(a=90,b=20,"recommend"==this._action&&(a+=40)):"box_count"==this._layout&&(a=55,"recommend"==this._action&&(a+=40),b=65),{w:a,h:b}}})}),define.component("wysiwyg.viewer.components.WGooglePlusOne",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils","W.Viewer"]),b.binds(["_renderComponentOnViewer","_renderComponentOnEditor","_rebuildComponent","_getSizeAccordingToState","_setComponentSize"]),b.propertiesSchemaType("WGooglePlusOneProperties"),b.states({LAYOUT:["small_bubble","small_none","small_inline","medium_bubble","medium_none","medium_inline","standard_bubble","standard_none","standard_inline","tall_bubble","tall_none","tall_inline"],VIEWER:["scriptLoading","scriptLoaded","loading","idle"]}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this._resizableSides=[],this._props=c},render:function(){this._createClickOverlay(),this._size=this.getComponentProperty("size"),this._annotation=this.getComponentProperty("annotation"),this._renderComponent()},_renderComponent:function(){this.setState(this._size+"_"+this._annotation,"LAYOUT"),this.resources.W.Viewer.isPublicMode()||!Browser.ie?this._renderComponentOnViewer():this._renderComponentOnEditor()},_renderComponentOnEditor:function(){this._setComponentSize()},_renderComponentOnViewer:function(){this._view.setStyles({background:"none"});var a=this.getState("viewer");return a&&""!=a?"loading"==a||"scriptLoading"==a?(this.callRenderLater(),!1):(this.setState("loading","VIEWER"),this._rebuildComponent(function(){this.setState("idle","VIEWER")}.bind(this)),void 0):(this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","VIEWER")}.bind(this)),this.callRenderLater(),!1)},_rebuildComponent:function(a){this._skinParts.googlePlus.empty();var b={"class":"googlePlusOne",href:location.href};b=this._props?{size:this._props.size||this._size,annotation:this._props.annotation||this._annotation,width:this._props.width||this._view.getWidth()}:{size:this._size,annotation:this._annotation,width:this._view.getWidth()},this._googlePlusOneElement=new Element("g\\:plusone",b),this._skinParts.googlePlus.adopt(this._googlePlusOneElement),window.gapi&&gapi.plusone&&gapi.plusone.go&&gapi.plusone.go(this._skinParts.googlePlus),this.callLater(this._setComponentSize,null,100),a()},_setComponentSize:function(){var a=this._props&&this._props.width?this._props.width:this._getSizeAccordingToState();this.setHeight(a.h),this.setWidth(a.w),this._wCheckForSizeChangeAndFireAutoSized(5)},_loadScript:function(a){this.resources.W.Viewer.loadExternalScript("https://apis.google.com/js/plusone.js",function(){a()}.bind(this))},_getSizeAccordingToState:function(){switch(this.getState("LAYOUT")){case"small_bubble":return{w:70,h:15};case"small_none":return{w:24,h:15};case"small_inline":return{w:250,h:15};case"medium_bubble":return{w:90,h:20};case"medium_none":return{w:32,h:20};case"medium_inline":return{w:250,h:20};case"standard_bubble":return{w:106,h:24};case"standard_none":return{w:38,h:24};case"standard_inline":return{w:250,h:24};case"tall_bubble":return{w:50,h:60};case"tall_none":return{w:50,h:20};case"tall_inline":return{w:250,h:20}}}})}),define.component("wysiwyg.viewer.components.WPhoto",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.utilize(["core.components.image.ImageSettings","core.components.image.ImageDimensionsNew"]),b.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*",hookMethod:"_setImageArgs"}}),b.dataTypes(["Image"]),b.propertiesSchemaType("WPhotoProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"}},{label:"PHOTO_EDIT_IMAGE",command:"WEditorCommands.OpenAviaryDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"}}}}),b.statics({MIN_IMAGE_HEIGHT:1,MIN_IMAGE_WIDTH:1,_autoSizeStates:{none:1,autoSizeNoLayoutUpdate:2,autoSizeUpdateLayout:3}}),b.methods({initialize:function(a,b,c){this._imageDimensions=new this.imports.ImageDimensionsNew,this._SettingsClass=this.imports.ImageSettings,this.parent(a,b,c),c&&c.props&&this.setComponentProperties(c.props),this._contentPadding={x:0,y:0},this._autoSizeState=this._autoSizeStates.none,this._initialDataChange=!0},_setImageArgs:function(a){return a.argObject={requestExactSize:this.injects().Viewer.getPreviewMode()!==!0},a},_onAllSkinPartsReady:function(a){this.parent(a),this._data&&this._setTitle()},_preventRenderOnDataChange:function(a,b){return b&&"displayMode"!=b&&"href"!=b?!0:!1
},_onDataChange:function(a,b,c){if(this._skinParts&&"title"==b&&this._setTitle(),"displayMode"==b){var d=this._translateDisplayModeToImageCropMode(c.displayMode);this._getImageSettings().setCropMode(d)}this._initialDataChange||!this._isFitMode()||"displayMode"!=b&&b||(this._autoSizeState=this._autoSizeStates.autoSizeUpdateLayout),this._initialDataChange=!1,this.parent(a,b,c)},setWidth:function(a,b,c,d){if(a&&!isNaN(a)&&(d||"fitHeightStrict"!=this._getDisplayMode())&&(this._getImageSettings().setContainerWidth(a-this._getContentPaddingSize().x),this.parent(a,b,c),!d)){var e=this._getImageDisplayMode();e==this._SettingsClass.CropModes.FIT_HEIGHT&&this._isDisplayed&&this._getImageSettings().setCropMode(this._SettingsClass.CropModes.FIT_WIDTH),(e===this._SettingsClass.CropModes.FIT_WIDTH||e===this._SettingsClass.CropModes.FIT_HEIGHT)&&(this._autoSizeState=this._autoSizeStates.autoSizeNoLayoutUpdate),this._renderImage()}},setHeight:function(a,b,c,d){if(a&&!isNaN(a)&&(d||"fitWidthStrict"!=this._getDisplayMode())&&(this.parent(a,b,c),this._getImageSettings().setContainerHeight(a-this._getContentPaddingSize().y),!d)){var e=this._getImageDisplayMode();e==this._SettingsClass.CropModes.FIT_WIDTH&&this._isDisplayed&&this._getImageSettings().setCropMode(this._SettingsClass.CropModes.FIT_HEIGHT),(e===this._SettingsClass.CropModes.FIT_WIDTH||e===this._SettingsClass.CropModes.FIT_HEIGHT)&&(this._autoSizeState=this._autoSizeStates.autoSizeNoLayoutUpdate),this._renderImage()}},getMinPhysicalHeight:function(){return this._getContentPaddingSize().y},render:function(){this._styleChanged(),this._renderImage(),this.parent()},_renderImage:function(){if(this._layoutInitialized){var a=this._skinParts.img;if(a&&a.getOriginalClassName){var b=this._getImageSettings();a.setSettings(b),b.getCropMode()==b.CropModes.FIT_WIDTH?this.setHeight(a.getSize().y+this._getContentPaddingSize().y,!1,!1,!0):b.getCropMode()==b.CropModes.FIT_HEIGHT&&this.setWidth(a.getSize().x+this._getContentPaddingSize().x,!1,!1,!0),this._fireAutoSize()}}},_fireAutoSize:function(){this._autoSizeState!=this._autoSizeStates.none&&(this.fireEvent("autoSized",{ignoreLayout:this._autoSizeState==this._autoSizeStates.autoSizeNoLayoutUpdate}),this.injects().Layout.notifyPositionChanged(this,"updateSize"),this._autoSizeState=this._autoSizeStates.none)},_styleChanged:function(){var a=this._getContentPaddingSize(!0);this.setMinH(a.y+this.MIN_IMAGE_HEIGHT),this.setMinW(a.x+this.MIN_IMAGE_WIDTH);var b=this._getPhotoInnerSize();this._getImageSettings().setSize(b.x,b.y)},_getContentPaddingSize:function(a){if(!this._contentPadding||a){this._contentPadding={};var b=this.getSkin();this._contentPadding.x=parseInt(b.getParamValue("contentPaddingLeft"),10)+parseInt(b.getParamValue("contentPaddingRight"),10),this._contentPadding.y=parseInt(b.getParamValue("contentPaddingTop"),10)+parseInt(b.getParamValue("contentPaddingBottom"),10),this._contentPadding.x=isNaN(this._contentPadding.x)?0:this._contentPadding.x,this._contentPadding.y=isNaN(this._contentPadding.y)?0:this._contentPadding.y,this.getSizeLimits().minH=this._contentPadding.y,this.getSizeLimits().minW=this._contentPadding.x}return this._contentPadding},_getImageSettings:function(){if(!this._imageSettings){var a=this._getPhotoInnerSize(),b=this._translateDisplayModeToImageCropMode(this._getDisplayMode());this._imageSettings=new this.imports.ImageSettings(b,a.x,a.y)}return this._imageSettings},_getPhotoInnerSize:function(){var a=this._getContentPaddingSize(),b=this.getWidth()-a.x,c=this.getHeight()-a.y;return{x:b,y:c}},_setTitle:function(){var a=this._data.get("title");a&&this._skinParts.view.set("title",a)},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_getImageDisplayMode:function(){return this._getImageSettings()&&this._getImageSettings().getCropMode()},_translateDisplayModeToImageCropMode:function(a){var b=a;return"fitWidthStrict"==a&&(b=this._SettingsClass.CropModes.FIT_WIDTH),"fitHeightStrict"==a&&(b=this._SettingsClass.CropModes.FIT_HEIGHT),b},allowHeightLock:function(){return!this._isFitMode()},_isFitMode:function(){var a=["fitWidth","fitWidthStrict","fitHeightStrict"];return a.indexOf(this._getDisplayMode())>=0}})}),define.component("wysiwyg.viewer.components.WRichText",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Data","W.Commands","W.Viewer","W.Css"]),b.dataTypes(["RichText","Text","StyledText"]),b.skinParts({richTextContainer:{type:"htmlElement",optional:!0}}),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED],EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"EDIT_RICH_TEXT",command:"EditorUI.StartEditRichText"}]}}),b.methods({initialize:function(a,b,c){this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._setLinksDataToElements),this.parent(a,b,c),this.setMaxH(5e3)},_onAllSkinPartsReady:function(){this._updateText(),this.resources.W.Viewer.getPreviewMode()||this._setLinksDataToElements("VIEW")},_onDataChange:function(){this._skinParts&&this._updateText()},_updateText:function(){this._loadFontsToViewer();var a=this.getDataItem().get("text");this.getRichTextContainer().set("html",a)},_setLinksDataToElements:function(a){if(this._skinParts&&("PREVIEW"===a||"VIEW"===a))for(var b=$(this.getRichTextContainer()).getElements("a"),c=0;c<b.length;c++){var d=b[c],e=d.getAttribute("dataquery");e?this._setLinkAttributes(e,d):!this.resources.W.Viewer.getPreviewMode()||d.getAttribute("target")&&"_blank"==d.getAttribute("target")||d.setAttribute("target","_blank")}},_setLinkAttributes:function(a,b){var c=this._getLinkData(a);if(c){var d=this._getLinkHref(c);b.set("href",d);var e=this._getLinkTarget(c);e&&b.set("target",e),this._sanitizeLink(b)}},_getLinkData:function(a){var b=a,c=this.resources.W.Data;return c.isDataAvailable(b)||(b="#"+a,c.isDataAvailable(b))?c.getDataByQuery(b):(LOG.reportError(wixErrors.LINK_DATA_ITEM_DOESNT_EXIST,"WRichText","_setLinksDataToElements",a),null)},_getLinkHref:function(a){var b=a.get("href"),c=a.get("linkType");if("PAGE"!=c)return b;try{var d=b.split("/")[1],e=this.resources.W.Data.getDataByQuery("#"+d);b="#!"+e.get("pageUriSEO")+"/"+d}catch(f){}return b},_getLinkTarget:function(a){var b,c=a.get("linkType");return b=this.resources.W.Viewer.getPreviewMode()&&"PAGE"!=c?"_blank":a.get("target")},getRichTextContainer:function(){return this._skinParts?this._skinParts.richTextContainer||this.getViewNode():null},_loadFontsToViewer:function(){var a=this._getUsedFontsInComp();Object.forEach(a,function(a,b){this.resources.W.Css.loadFont(this._getFontNameInCamelCase(b))},this)},_getUsedFontsInComp:function(){var a=this.getDataItem().get("text"),b=new Element("div");b.innerHTML=a;var c=b.getElements("span[style]"),d=b.getElements("font[face]"),e={};return c.forEach(function(a){var b=a.style["font-family"]||a.style.fontFamily;b&&(b=this._cleanUpFontName(b),e[b]=!0)},this),d.forEach(function(a){var b=a.getAttribute("face");b=this._cleanUpFontName(b),e[b]=!0},this),e},_cleanUpFontName:function(a){return a.replace(/['"]/gi,"")},_getFontNameInCamelCase:function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},isEditableInPlace:function(){return!0}})}),define.component("wysiwyg.viewer.components.WSiteStructure",function(a){var b=a;b.inherits("core.components.Container"),b.binds(["_onThemePropertyChange","_updateSiteBgPosition","_updateSiteBgSize","_validateBg","_delayedInvalidateBg","_invalidateBg","_setBgAsImageViewMode"]),b.resources(["W.Utils","W.Viewer","W.Theme","W.Components","W.Data","W.Config"]),b.statics({MAX_SITE_HEIGHT:1e5}),b.methods({initialize:function(a,b,c){this._mobileConfig=this.resources.W.Config.mobileConfig,this._bgNode=new Element("div",{id:"bgNode"}),this._bgNode.setStyles({position:"absolute",width:"100%"}),this._bgNode.inject(document.body,"top"),this._bgStyle={},this._lastBgStyle={},this.parent(a,b,c),window.addEvent("scroll",this._delayedInvalidateBg),window.addEvent("resize",this._delayedInvalidateBg),this.resources.W.Theme.addEvent("propertyChange",this._onThemePropertyChange),this._updateBgProperty(),this._validateBg(),this.setMaxH(this.MAX_SITE_HEIGHT),this.resources.W.Viewer.getPreviewMode()&&this._view.setStyle("padding-bottom",100),this._handleMobile()},_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"),this._mobileConfig.isAndroidMobileDevice()&&this._view.setStyle("max-height","10000000000px"),this._view.setStyle("-webkit-text-size-adjust","none"),this._view.setStyle("-moz-text-size-adjust","none"),this._view.setStyle("-ms-text-size-adjust","none"))},render:function(){var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a),this.parent()},_getReformattedBgColor:function(){return this.parent()},_onThemePropertyChange:function(a){a&&"propertyChange"==a.type&&"siteBg"!=a.name||(this._updateBgProperty(),this._invalidateBg())},_updateBgProperty:function(){this._siteBgDef=this.resources.W.Theme.getProperty("siteBg"),this._bgFixed="fixed"==this._siteBgDef.getAttachment(),this._bgStyle["background-image"]=this._siteBgDef.getUrl(),this._bgStyle["background-size"]=this._siteBgDef.getCssSizeValue(),this._bgStyle["background-position"]=this._siteBgDef.getPosition(),this._bgStyle["background-repeat"]=this._siteBgDef.getRepeatUnified(),this._bgStyle["background-color"]=this._siteBgDef.getColor()},_updateSiteBgSize:function(){this._bgStyle.height=this._mobileConfig.isMobileOrTablet()?this._bgFixed?window.innerHeight:Math.max(this._siteHeight,document.getHeight())+"px":this._bgFixed?$(document.body).getSize().y+"px":Math.max(this._siteHeight||50,$(document.body).getSize().y)+"px"},_updateSiteBgPosition:function(){Modernizr.positionfixed&&!this._mobileConfig.isMobileOrTablet()?this._bgStyle.position=this._bgFixed?"fixed":"absolute":this._bgStyle.top=this._bgFixed?document.body.scrollTop+"px":0},_delayedInvalidateBg:function(){this._delayedInvalidateBgTimeout&&clearTimeout(this._delayedInvalidateBgTimeout),this._delayedInvalidateBgTimeout=this.resources.W.Utils.callLater(this._invalidateBg,null,this,150)},_invalidateBg:function(){this._bgRenderCall||(this._bgRenderCall=this.resources.W.Utils.callOnNextRender(this._validateBg,10))},_validateBg:function(){delete this._bgRenderCall,this._updateSiteBgSize(),this._updateSiteBgPosition(),this._isBgStyleChanged()&&(this._lastBgStyle=Object.clone(this._bgStyle),this._bgNode.setStyles(this._bgStyle),Modernizr.backgroundsize||("none"===this._bgStyle["background-image"]||"contain"!==this._bgStyle["background-size"]&&"cover"!==this._bgStyle["background-size"]?this._bgAsImage&&this._bgAsImage.collapse():(this._bgNode.setStyle("background-image","none"),this._setBgAsImage(this._bgNode))))},_setBgAsImage:function(){this._bgAsImage?(this._setBgAsImageDataItemValues(this._siteBgDef.getImageId(),this._siteBgDef.getImageSize()),this._setBgAsImageViewMode(this._bgAsImage.getLogic())):(this._bgAsImageDataItem=this.resources.W.Data.createDataItem({type:"Image",uri:this._siteBgDef.getImageId(),width:this._siteBgDef.getImageSize()[0],height:this._siteBgDef.getImageSize()[1],borderSize:0,title:"",description:"",alt:""}),this._bgAsImage=this.resources.W.Components.createComponent("core.components.Image","mobile.core.skins.ImageSkin",this._bgAsImageDataItem,{width:"100",height:"100",unit:"%"},null,this._setBgAsImageViewMode),this._bgAsImage.insertInto(this._bgNode))},_setBgAsImageDataItemValues:function(a,b){this._bgAsImageDataItem&&this._bgAsImageDataItem.setFields({uri:a,width:b[0],height:b[1]})},_setBgAsImageViewMode:function(a){var b="contain"===this._bgStyle["background-size"]?"full":"fill",c=this._bgStyle["background-position"].split(" ");a.setCropMode(b),a.setAlign(c[0],c[1]),a.uncollapse()},_isBgStyleChanged:function(){for(var a in this._bgStyle)if(this._bgStyle[a]!=this._lastBgStyle[a])return!0;return!1},setHeight:function(a){this._siteHeight!=a&&(this._siteHeight=a,this._delayedInvalidateBg(),this.parent(a),this.resources.W.Viewer.siteHeightChanged(!0))},_getBestFit:function(a,b){return this.parent(a,b)},_getWantedBgSize:function(){return this.parent()},getChildComponents:function(){return this.getViewNode().getChildren("[comp]")},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS,distance:0},from:{allow:!1,lock:Constants.BaseComponent.AnchorLock.NEVER}}},layoutMinHeight:function(){return 0}})}),define.component("wysiwyg.viewer.components.WTwitterFollow",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SocialBaseComponent"),b.skinParts({twitter:{type:"htmlElement"}}),b.dataTypes(["TwitterFollow"]),b.propertiesSchemaType("WTwitterFollowProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({render:function(){this._showCount=this.getComponentProperty("showCount"),this._showScreenName=this.getComponentProperty("showScreenName");var a=this._data.get("accountToFollow").replace("@","");a||(a="wix"),this._screenName=a,this.parent()},_getPageName:function(){return"twfollow.html"},_getUrlParams:function(){return{screen_name:this._screenName,href:"https://twitter.com/"+this._screenName,show_count:this._showCount,show_screen_name:this._showScreenName,lang:this.getComponentProperty("dataLang"),align:"left"}},_getSizeAccordingToProperties:function(){var a=80,b=20;return this._showCount&&(a+=85),this._showScreenName&&(a+=6*this._screenName.length),{w:a,h:b}}})}),define.component("wysiwyg.viewer.components.WTwitterTweet",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SocialBaseComponent"),b.resources(["W.Utils"]),b.skinParts({twitter:{type:"htmlElement"}}),b.dataTypes(["TwitterTweet"]),b.propertiesSchemaType("WTwitterTweetProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this.parent(a,b,c)},_getPageName:function(){return"twtweet.html"},_getUrlParams:function(){return{href:"https://twitter.com/share",count:this.getComponentProperty("dataCount"),lang:this.getComponentProperty("dataLang"),url:location.href,text:this._data.get("defaultText"),related:this._data.get("accountToFollow"),counturl:location.href}},_getSizeAccordingToProperties:function(){var a,b,c=this.getComponentProperty("dataCount");switch(b=20,c){case"none":a=60;break;case"horizontal":a=100;break;case"vertical":a=60,b=62}return{w:a,h:b}}})}),define.component("wysiwyg.viewer.components.WixAds",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({footerLabel:{type:"htmlElement",optional:!1},topRectLabel:{type:"htmlElement",optional:!1},topRectContent:{type:"htmlElement",optional:!1}}),b.binds(["_getAdHeight"]),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED]}),b.resources(["W.Config"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c);var d=this.injects().Commands;d.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),d.registerCommandListenerByName("WViewerCommands.OpenZoom",this,function(){this._showHideAds(!1)}),d.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,function(){this._showHideAds(!this._isPremium())}),this.resources.W.Config.isPublicMode()||this.injects().Viewer.addHeightChangeCallback(this._getAdHeight)},_onAllSkinPartsReady:function(){this.setCollapsed(this.injects().Viewer.getPreviewMode()||this._isPremium()),this._view.addClass("Z-WIX-ADS"),this._skinParts.view.addEvent("click",function(){var a=!this.injects().Viewer.getPreviewMode(),b=a?adData.adUrl.replace("[site_id]",window.siteId):adData.adUrl,c=!a||this._isFacebook();c?window.open(b,"_blank"):window.location.assign(b)}.bind(this)),this.injects().Viewer.getPreviewMode()&&this._addBiEvent()},_addBiEvent:function(){var a=wixEvents.WIXADS_CLICKED_IN_PREVIEW;this._skinParts.topRectLabel.addEvent("click",function(){LOG.reportEvent(a,{c1:"top-right"})}),this._skinParts.footerLabel.addEvent("click",function(){LOG.reportEvent(a,{c1:"footer"})})},render:function(){this.parent();var a=this.injects().Viewer.getAdData();this._skinParts.topRectLabel.set("html",a.topLabel),this._skinParts.topRectContent.set("html",a.topContent),this.resources.W.Config.mobileConfig.isMobile()?this._skinParts.footerLabel.collapse():this._skinParts.footerLabel.set("html",a.footerLabel)},_onModeChange:function(a){this._showHideAds(this._shouldShowAds(a))},_showHideAds:function(a){this.setCollapsed(!a),this.injects().Viewer.siteHeightChanged(!1)},_shouldShowAds:function(a){return this._isInPreviewMode(a)&&!this._isPremium()},_isInPreviewMode:function(a){return a.toLowerCase()===Constants.ViewManager.VIEW_MODE_PREVIEW.toLowerCase()},_isPremium:function(){var a=window.rendererModel||window.editorModel&&window.editorModel.metaSiteData||window.top&&window.top.editorModel&&window.top.editorModel.metaSiteData;if(!a||!a.premiumFeatures)return!1;var b=a.premiumFeatures;return this._isFacebook()?b.contains("NoAdsInSocialSites"):b.contains("AdsFree")||b.contains("ShowWixWhileLoading")},_isFacebook:function(){var a=window.siteHeader.applicationType||window.rendererModel.applicationType;return"HtmlFacebook"===a},_getAdHeight:function(){return this._view.isCollapsed()?0:this._skinParts.footerLabel.getHeight()},_getAdTopHeight:function(){return this._view.isCollapsed()?0:this._skinParts.topRect.getHeight()},getAdHeight:function(){return{footer:this._getAdHeight(),top:this._getAdTopHeight()}}})}),define.component("wysiwyg.viewer.components.inputs.CheckBoxInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.skinParts({checkBox:{type:Constants.ComponentPartTypes.HTML_ELEMENT},label:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),b.binds([]),b.states({validation:["valid","invalid"]}),b.dataTypes(["Boolean"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(a){this.setState(a?"valid":"invalid","validation")}.bind(this)),this._label=c.label||""},_onAllSkinPartsReady:function(a){var b=a.checkBox;b.addEvent(Constants.CoreEvents.CHANGE,function(){this.getDataItem().set("value",b.get("checked")),b.get("checked")&&this.fireEvent("itemSelected",this)}.bind(this));var c=a.label.parentNode.id+"-check";a.label.setAttribute("for",c),a.checkBox.setAttribute("id",c),a.label.set("text",this._label)},render:function(){1==this.getDataItem().get("value")?this._skinParts.checkBox.setAttribute("checked","checked"):this._skinParts.checkBox.removeAttribute("checked")},setError:function(a){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",a)},setDisabled:function(){var a=this._skinParts.checkBox;a.set("disabled","disabled")},setSelected:function(a){var b=this._skinParts.checkBox;b.set("checked",a)}})}),define.component("wysiwyg.viewer.components.inputs.ColorOption",function(a){var b=a;b.skinParts({tooltip:{type:"wysiwyg.common.components.InfoTip"}}),b.inherits("wysiwyg.viewer.components.inputs.TextOption"),b.methods({_onAllSkinPartsReady:function(){this.getViewNode().setStyle("background-color",this.getDataItem().get("text")),this._initializeTooTip(this.getViewNode())}})}),define.component("wysiwyg.viewer.components.inputs.ComboBoxInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.statics({PROMPT_OPTION_VALUE:-1}),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),b.binds(["_selectedIndexChanged","_getPromptOptionDataItem"]),b.states({validity:["valid","invalid"]}),b.dataTypes(["SelectableList"]),b.propertiesSchemaType("ComboBoxInputProperties"),b.fields({_optionsData:[]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(a){this.setState(a?"valid":"invalid","validity")}.bind(this))},_preventRenderOnDataChange:function(a,b){return"selected"==b},_prepareForRender:function(){return this._createDropDownList(),!0},_onAllSkinPartsReady:function(){this._createDropDownList(),this._skinParts.collection.addEvent(Constants.CoreEvents.CHANGE,this._selectedIndexChanged)},_createDropDownList:function(){var a=function(a){this._optionsData=Object.values(a),this._bindDdlToData(this._skinParts.collection)}.bind(this),b=this.getDataItem().get("items").filter(function(a){return a.get("enabled")});b.length>0&&"string"==typeof b[0]?this.injects().Data.getDataByQueryList(b,a):a(b)},_bindDdlToData:function(a){a.empty();for(var b=0;b<this._optionsData.length;b++){var c=this._optionsData[b];a.options[b]=new Option(c.get("text"),c.get("value"))}var d=this.getDataItem().get("selected");d?this._setSelectedFromData(a,d):this.getComponentProperty("hasPrompt")&&this._addPrompt(a)},_setSelectedFromData:function(a,b){var c=this;"string"==typeof b?this.injects().Data.getDataByQuery(b,function(b){c._setSelected(a,b)}):this._setSelected(a,b)},_setSelected:function(a,b){var c=this._optionsData.indexOf(b);c>-1&&c<a.length&&(a.getSelected()[0].erase("selected"),a[c].set("selected","selected"))},_selectedIndexChanged:function(){this._hasPrompt&&this._removePrompt();var a=this._getSelectedIndex();this.setValidationState(!0),this.getDataItem().set("selected",this._optionsData[a]),this.fireEvent("selectionChanged",this._optionsData[a])},_getSelectedIndex:function(){return this._skinParts.collection.selectedIndex},setError:function(a){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",a)},_addPrompt:function(a){var b=this.getComponentProperty("promptText");a.options.add(new Option(b,this.PROMPT_OPTION_VALUE,!0,!0),0),this._optionsData.splice(0,0,this._getPromptOptionDataItem(b)),this._hasPrompt=!0},_removePrompt:function(){var a=this._skinParts.collection;a.getFirst().value==this.PROMPT_OPTION_VALUE&&(a.options.remove(0),this._optionsData.splice(0,1),this._hasPrompt=!1)},_getPromptOptionDataItem:function(a){var b={type:"SelectOption",value:this.getComponentProperty("promptValue"),text:a,enabled:!0,description:""},c=W.Data.createDataItem(b);return c.setMeta("isPersistent",!1),c}})}),define.component("wysiwyg.viewer.components.inputs.DateInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({year:{type:Constants.ComponentPartTypes.HTML_ELEMENT},month:{type:Constants.ComponentPartTypes.HTML_ELEMENT},day:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),b.binds(["_userChange"]),b.states({validation:["valid","invalid"]}),b.dataTypes(["Text"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(a){this.setState(a?"valid":"invalid","validation")}.bind(this))},_onAllSkinPartsReady:function(){this._skinParts.year.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.month.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.day.addEvent(Constants.CoreEvents.CHANGE,this._userChange);var a=(new Date).getUTCFullYear();for(i=1979;a+6>i;i++)this._skinParts.year.options.add(new Option(i,i));for(i=1;13>i;i++)this._skinParts.month.options.add(new Option(i,i))},render:function(){var a,b=this._data.get("text"),c=new Date(b),d=c.getUTCFullYear(),e=c.getUTCMonth(),f=c.getUTCDate();for(this._skinParts.year[d-1979].selected=!0,this._skinParts.month[e].selected=!0;this._skinParts.day.options.length;)this._skinParts.day.options.remove(this._skinParts.day.options[0]);for(a=1;a<this._getDaysForMonth(d,e)+1;a++)this._skinParts.day.options.add(new Option(a,a));this._skinParts.day[f-1].selected=!0},_userChange:function(){var a=new Date(0);a.setUTCFullYear(this._skinParts.year.getSelected()[0].value),a.setUTCMonth(this._skinParts.month.getSelected()[0].value-1),a.setUTCDate(this._skinParts.day.getSelected()[0].value),this.getDataItem().set("text",a.toISOString()),this.fireEvent("selectionChanged",a.toISOString())},_getDaysForMonth:function(a,b){return b--,new Date(a,b,0).getDate()}})}),define.component("wysiwyg.viewer.components.inputs.RadioGroupInput",function(a){var b=a;b.inherits("wysiwyg.viewer.components.inputs.ComboBoxInput"),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._radioGroupName=c.radioGroupName||"radioGroup",this._selectedValue=c.selectedValue},_prepareForRender:function(){return this._createRadioGroup(),!0},_onAllSkinPartsReady:function(){this._createRadioGroup(),this._skinParts.collection.addEvent(Constants.CoreEvents.CHANGE,this._selectedIndexChanged)},_createRadioGroup:function(){var a=function(a){this._optionsData=Object.values(a),this._bindRadioGroupToData(this._skinParts.collection)}.bind(this),b=this.getDataItem().get("items").filter(function(a){return a.get("enabled")});b.length>0&&"string"==typeof b[0]?this.injects().Data.getDataByQueryList(b,a):a(b)},_bindRadioGroupToData:function(a){a.empty();for(var b=0;b<this._optionsData.length;b++){var c=this._optionsData[b],d=c.get("value"),e=new Element("Input",{type:"radio",name:this._radioGroupName,value:d});d==this._selectedValue&&e.setAttribute("checked","checked"),a.grab(e,"bottom"),a.innerHTML+=c.get("text")+"<BR/>"}this._setSelected(a)},_getSelectedIndex:function(){for(var a=document.getElementsByName(this._radioGroupName),b=0;b<a.length;b++)if(a[b].checked)return b},_setSelected:function(a){var b=this.getDataItem().get("selected");b&&this.injects().Data.getDataByQuery(b,function(b){var c=this._optionsData.indexOf(b);c>-1&&c<a.length&&a[c].set("checked","checked")}.bind(this))}})}),define.component("wysiwyg.viewer.components.inputs.TextAreaInput",function(a){var b=a;b.inherits("wysiwyg.viewer.components.inputs.TextInput"),b.skinParts({textarea:{type:"htmlElement"},errorMessage:{type:"htmlElement",optional:!0}}),b.binds(["_checkMaxLength"]),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this._maxLength=c.maxLength||""},_onAllSkinPartsReady:function(){var a=this._skinParts.textarea;a.set("value",this.getDataItem().get("text")),this.addEvent("inputChanged",function(a){this.getDataItem().set("text",a.value)}.bind(this)),this._maxLength&&(a.setProperty("maxlength",this._maxLength),Browser.ie&&a.addEvent(Constants.CoreEvents.KEY_UP,this._checkMaxLength)),this._listenToInput()},_checkMaxLength:function(){var a=this._skinParts.textarea.get("value"),b=a.length;if(a.length>this._maxLength){var c=this._maxLength-b;a=a.slice(0,c),this._skinParts.textarea.set("value",a)}},_changeEventHandler:function(a){return 13==a.code?!1:(this.parent(a),void 0)},_listenToInput:function(){this._skinParts.textarea.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.textarea.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_stopListeningToInput:function(){this._skinParts.textarea.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.textarea.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_getValue:function(){var a=this._skinParts.textarea;return a.get("value")}})}),define.component("wysiwyg.viewer.components.inputs.TextOption",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({size:{type:"htmlElement"},tooltip:{type:"wysiwyg.common.components.InfoTip"}}),b.traits(["wysiwyg.common.components.traits.SelectableOption"]),b.states({selectState:["selected","unselected"],enabledState:["enabled","disabled"]}),b.dataTypes(["SelectOption"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setSelected(!1)},_onAllSkinPartsReady:function(){var a=this._skinParts.size;a.set("text",this.getDataItem().get("text")),this._initializeTooTip(this.getViewNode())},_initializeTooTip:function(a){var b=this._skinParts.tooltip,c=this.getDataItem().get("description");c&&c.trim().length>0&&(a.addEvent("mouseenter",function(){b._showToolTipCmd({id:1,content:c},{source:a})}),a.addEvent("mouseleave",function(){b._closeToolTipCmd()}))},_onDataChange:function(){this.setEnabled(this.getDataItem().get("enabled"))},setSelected:function(a){this.setState(a?"selected":"unselected","selectState")},setEnabled:function(a){this.setState(a?"enabled":"disabled","enabledState")}})}),define.Class("wysiwyg.viewer.components.menus.DropDownController",function(a){a.fields({_menu:null,_dropButtons:[],_dropContainer:null,_dropWrapper:null,_dropOwnerButton:null,_dropDownNeedsClosing:!1,_closeTimerID:null}),a.inherits(["bootstrap.utils.Events"]),a.binds(["_onItemsContainerOver","_onItemsContainerOut","closeDropDown","_onMoreContainerOver","_onMoreContainerOut"]),a.methods({initialize:function(a){this._menu=a,this._init()},_init:function(){var a=this._menu.getItemsContainer();a.addEvent("mouseover",this._onItemsContainerOver),a.addEvent("mouseout",this._onItemsContainerOut),this._dropContainer=this._menu.getMoreContainer(),this._dropWrapper=this._menu.getDropWrapper(),null==this._dropWrapper&&(this._dropWrapper=this._dropContainer),this.closeDropDown(!0),this._dropContainer.addEvent("mouseover",this._onMoreContainerOver),this._dropContainer.addEvent("mouseout",this._onMoreContainerOut)},openDropDown:function(a,b){if(a==this._dropOwnerButton)return this._dropDownNeedsClosing=!1,void 0;for(;this._dropContainer.children.length;)this._dropContainer.children[0].dispose();var c,d=[];for(c=0;c<b.length;c++)0==b[c].isHidden()&&d.push(b[c]);if(d.length>0){for(this._dropWrapper.setStyle("width","auto"),c=0;c<d.length;c++)d[c].getViewNode().inject(this._dropContainer,"bottom");this._setDropListPositions(d),this._menu.arrangeDropButtons(d),this._dropDownNeedsClosing=!1,this._releasePreviousOwner(),this._dropOwnerButton=a,this._dropButtons=d,this._dropOwnerButton.setDropdownOpen(!0),this._dropWrapper.setStyle("display","block"),this._dropWrapper.setStyle("opacity","1"),this._arrangeDropDown(),this._dropWrapper.setStyle("z-index","99999")}},_setDropListPositions:function(a){var b,c,d,e=1==a.length;for(b=0;b<a.length;b++)c=a[b],d=0==b?e?"dropLonely":"top":e||b!=a.length-1?"dropCenter":"bottom",c.getViewNode().setProperty("listposition",d),c.getViewNode().setProperty("container","drop")},closeDropDown:function(a){(a||this._dropDownNeedsClosing)&&(this._releasePreviousOwner(),this._dropWrapper.setStyle("display","none"),this._dropWrapper.setStyle("opacity","0"),this._dropDownNeedsClosing=!1)},_releasePreviousOwner:function(){this._dropOwnerButton&&(this._dropOwnerButton.setDropdownOpen(!1),this.injects().Utils.forceBrowserRepaint(this._dropOwnerButton.getViewNode()),this._dropOwnerButton=null)},_closeDropDownTimer:function(){this.injects().Utils.clearCallLater(this._closeTimerID),this._closeTimerID=this.injects().Utils.callLater(this.closeDropDown,[],this,500)
},_arrangeDropDown:function(){var a=this._dropOwnerButton.getViewNode().getProperty("listPosition");this._dropWrapper.setProperty("dropHPosition",a),this._setDropDownWidth(),this._setDropDownPosition()},_setDropDownWidth:function(){var a,b,c=this._dropOwnerButton.getMinimalDropdownWidth();for(a=0;a<this._dropButtons.length;a++)b=this._dropButtons[a],c=Math.max(c,b.getMinimalWidth());var d=this._menu.getMenuExtraPixels(!0);this._dropWrapper.setStyle("width",d.left+d.right+c+"px")},_setDropDownPosition:function(){this._dropWrapper.setStyle("text-align",this._menu.getComponentProperty("alignText"));for(var a=0;a<this._dropButtons.length;a++){var b=this._dropButtons[a];b.setPadding(0),b.alignText()}this._setHorizontalPosition(),this._setVerticalPosition()},_setHorizontalPosition:function(){var a=this._dropOwnerButton.getOffsetLeft(),b=this._menu.getComponentProperty("alignButtons");this._dropWrapper.setProperty("dropAlign",b);var c="0px",d="auto",e=this._menu.getMenuExtraPixels(!0),f=this._dropOwnerButton.getViewNode().getProperty("listPosition");"left"==b?c="left"==f?0:a+e.left+"px":"right"==b?(d="right"==f?0:this._menu.getWidth()-a-this._dropOwnerButton.getOffsetWidth()-e.right+"px",c="auto"):"left"==f?c=a+(this._dropOwnerButton.getOffsetWidth()+e.left-this._dropWrapper.offsetWidth)/2+"px":"right"==f?(c="auto",d=(this._dropOwnerButton.getOffsetWidth()+e.right-parseInt(this._dropWrapper.getStyle("width"),10))/2+"px"):c=e.left+a+(this._dropOwnerButton.getOffsetWidth()-this._dropWrapper.offsetWidth)/2+"px",this._dropWrapper.setStyle("left",c),this._dropWrapper.setStyle("right",d)},_setVerticalPosition:function(){var a="dropDown";this._needsToOpenUp()?(a="dropUp",this._dropWrapper.setStyle("bottom",this._menu.getHeight()+"px")):this._dropWrapper.setStyle("bottom","auto"),this._dropWrapper.setProperty("dropMode",a)},_needsToOpenUp:function(){if(navigator.userAgent.match(/MSIE 8.0/))return!1;var a=!0,b=window.innerHeight,c=this._menu.getViewNode(),d=0;do d+=c.offsetTop,c=c.offsetParent;while(null!=c);var e=d-document.body.getScroll().y;return b/2>=e&&(a=!1),a},_onItemsContainerOver:function(a){var b=this._findLogicParent(a.target);this._isValidButtonForDropDown(b)&&b.children.length>0&&this.openDropDown(b,b.children)},_onItemsContainerOut:function(a){var b=this._findLogicParent(a.target);b&&b==this._dropOwnerButton&&(this._dropDownNeedsClosing=!0,this._closeDropDownTimer())},_onMoreContainerOver:function(){this._dropDownNeedsClosing=!1},_onMoreContainerOut:function(){this._dropDownNeedsClosing=!0,this._closeDropDownTimer()},_findLogicParent:function(a){for(var b=!1;0==b;){var c;b=!0;try{navigator.userAgent.match(/MSIE 8.0/)?c=a.getLogic():a.hasOwnProperty("getLogic")&&a.getLogic()?c=a.getLogic():b=!1}catch(d){b=!1}0==b?(a=a.getParent(),a||(b=!0)):a=c}return a},_isValidButtonForDropDown:function(a){return a&&"core.components.MenuButton"==a.className?!0:!1}})}),define.component("wysiwyg.viewer.components.menus.DropDownMenu",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.utilize(["core.components.BaseList","core.components.SimpleButton","wysiwyg.viewer.components.menus.DropDownController"]),b.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,inlineDataField:"items",repeaterDataQueryField:"refId",container:"itemsContainer",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"},dropWrapper:{type:"htmlElement"}}),b.binds(["_onButtonDataChange","_onThemeChange","_arrangeButtons","_onButtonClick","_onPageChanged"]),b.dataTypes(["Menu"]),b.propertiesSchemaType("HorizontalMenuProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}],dblClick:{command:"WEditorCommands.Pages"}},_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionStarted",this._onPageChanged),this._usesExternalData=!0,this._staticWidth=0,this._aspectRatio=-1,this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._hiddenButtonsContainer=new Element("div",{id:"hiddenButtonsContainer",style:"visibility:hidden"}),this._hiddenButtonsContainer.inject(this.getViewNode()),this._flatButtons=[],this._arrangeDone=!1,this._treeConstructionDone=!1,this.getViewNode().setStyle("opacity","0")},setWidth:function(a,b,c,d){if(void 0==d&&(d=!0),d&&-1!=this._aspectRatio){var e=a/this._aspectRatio;e<this.getSizeLimits().minH&&(e=this.getSizeLimits().minH,a=e*this._aspectRatio),this.setHeight(e,!0,!1,!1)}this.parent(a,b,c)},setHeight:function(a,b,c,d){if(void 0==d&&(d=!0),d&&-1!=this._aspectRatio){var e=a*this._aspectRatio;e<this.getSizeLimits().minW&&(e=this.getSizeLimits().minW,a=e/this._aspectRatio),this.setWidth(e,!0,!1,!1)}this.parent(a,b,c)},_onAllSkinPartsReady:function(){this.parent(),this._dropDown=new this.imports.DropDownController(this),this._registerButton(this._skinParts.moreButton)},_registerButton:function(a){a.setMenu(this),a.addEvent("dataChanged",this._onButtonDataChange),a.dropdownMode=!0},getItemsContainer:function(){var a=null;return this._skinParts&&(a=this._skinParts.itemsContainer),a},getMoreContainer:function(){var a=null;return this._skinParts&&(a=this._skinParts.moreContainer),a},getDropWrapper:function(){var a=null;return this._skinParts&&(a=this._skinParts.dropWrapper),a},getMenuExtraPixels:function(){return this.getDivExtraPixels(this._skinParts.itemsContainer,!0)},arrangeDone:function(){return this._arrangeDone},_testOverFlow:function(){var a=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=a),a!=this._prevButtonsWidth?this._arrangeButtons():(this._testOverFlowCount--,this._testOverFlowCount>0&&(this._overflowID=this.callLater(this._testOverFlow,[],100)))},_onPageChanged:function(a){null!=this._skinParts&&this._selectActiveButton(a)},_selectActiveButton:function(a){if(this._flatButtons)for(i=0;i<this._flatButtons.length;i++)button=this._flatButtons[i],button.getID()==a?button.setSelected(!0):button.setSelected(!1),this.injects().Utils.forceBrowserRepaint(button.getViewNode())},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._rootButtons=[],this._flatButtons=[],this._flatButtons.push(this._skinParts.moreButton)},_onRepeaterItemReady:function(a,b,c,d){d&&b.addEvent("click",function(){this._onButtonClick(c)}.bind(this)),this._rootButtons.push(b),this._flatButtons.push(b),b.getViewNode().setStyle("visibility","hidden"),this._registerButton(b),this.parent(a,b,c,d)},_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._treeConstructionDone=!1,this._arrangeButtonAccordingToData(),this._constructButtonsTree()},_constructButtonsTree:function(){var a,b,c,d,e,f=this._data.get("items"),g=this,h=[];for(a=0;a<f.length;a++){for(c=null,b=0;b<this._rootButtons.length;b++)if(this._rootButtons[b].compareRefID(f[a].get("refId"))){c=this._rootButtons[b];break}if(c)for(c.children=[],d=this._data.getSubItems(f[a]),b=0;b<d.length;b++)e=Object.clone(this._repeaterDefinitions[0]),e.dataQuery=d[b].get("refId"),h.push({owner:c,def:e})}var i=h.length;if(0==i)this._constructionDone();else for(a=0;a<h.length;a++){var j=h[a].def;h[a].owner.createSubButton(this._createComponentbyDefinition.bind(this),j,function(a){g._registerButton(a),g._flatButtons.push(a),a.addEvent("click",function(){g._onButtonClick(a._data)}.bind(g)),i--,0==i&&g._constructionDone()})}},_arrangeButtonAccordingToData:function(){for(var a=this._data.get("items"),b=[],c=0;c<a.length;c++){var d=a[c].get("refId").substr(1);b.push(this._rootButtons.filter(function(a){return a.getDataItem().get("id")==d})[0])}this._rootButtons=b},_constructionDone:function(){this._treeConstructionDone=!0,this._arrangeButtons()},render:function(){this.parent(),"styleChange"==this._changeTriggeredBy?this._arrangeButtonsDelayed():this._arrangeButtons()},setSkin:function(a){this._staticWidth=a.staticWidth||0,this._aspectRatio=parseFloat(a.aspectRatio,10)||-1,this.parent(a)},_onButtonDataChange:function(){this._changeTriggeredBy="dataChange",this.render()},_onDataChange:function(){var a=this.getComponentProperties();a&&a.removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent()},_applySettings:function(){this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._staticWidth>0?this._preWidthModifier=this._staticWidthModifier:(this.getComponentProperty("sameWidthButtons")&&(this._preWidthModifier=this._sameWidthModifier),this.getComponentProperty("stretchButtonsToMenuWidth")&&(this._postWidthModifier=this._stretchToFillModifier))},_skinSizeChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_skinParamsChange:function(a){this._changeTriggeredBy="styleChange",this.parent(a)},_arrangeButtonsDelayed:function(){this._arrangeDone=!1,-1!=this._arrangeWaitID&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtonsCapture,[],100),this._changeTriggeredBy="",this._skinParts.itemsContainer.setStyle("overflow","hidden")},_arrangeButtonsCapture:function(){this._arrangeButtons(),-1!=this._arrangeWaitID&&this._arrangeButtonsDelayed()},_arrangeButtons:function(){if(this._arrangeDone=!1,this._treeConstructionDone&&void 0!=this._skinParts&&this._rootButtons&&0!=this._rootButtons.length&&this._isDisplayed&&this.isReady()&&""!=this._skinParts.moreButton.className){var a=this._hideButtonsOfHiddenPages();if(a){this.getViewNode().setStyle("opacity","1"),this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth=0,this._arrangeWaitID=-1,this._applySettings(),this._initItemsContainer(),this._initMoreButton();var b=this._getDisplayedButtons();if(b.length){b.push(this._skinParts.moreButton),this._preArrangeButtons(this._flatButtons);var c=this._getSampleButton();this._sampleButtonBorder(c),this._setMinimumDimensions(c);for(var d=0;d<b.length;d++)b[d].getViewNode().inject(this._skinParts.itemsContainer),b[d].getViewNode().setProperty("container","menu");this._preWidthModifier(b),this._calculateButtonsAmount(b),this.setMinW(b[0].getViewNode().offsetWidth),this._postWidthModifier(b),b=this._getDisplayedButtons(),b.push(this._skinParts.moreButton),this._alignButtonsText(b),this._restoreTransition(this._flatButtons),this._skinParts.itemsContainer.setStyle("overflow","visible"),this._skinParts.itemsContainer.setStyle("display","inherit"),this._skinParts.itemsContainer.setStyle("white-space","nowrap"),this._testOverFlow(),this._arrangeDone=!0,this._selectActiveButton(this.injects().Viewer.getCurrentPageId()),this.fireEvent("ready")}}}},arrangeDropButtons:function(a){var b;for(b=0;b<a.length;b++){var c=a[b];c.getViewNode().setStyle("visibility","inherit");var d=this._skin.more_vPadding||15;this._setButtonHeight(c,this._getButtonMinimalHeight(c)+d)}},_calculateButtonsAmount:function(a){a=this._arrangementAlgorithm(a),this._skinParts.moreButton.skipMe&&(this._skinParts.moreButton.getViewNode().setStyle("visibility","hidden"),this._skinParts.moreButton.getViewNode().inject(this._hiddenButtonsContainer),a[a.length-1]===this._skinParts.moreButton&&a.pop())},_getButtonsWidth:function(){var a=0;for(i=0;i<this._skinParts.itemsContainer.children.length;i++)a+=this._skinParts.itemsContainer.children[i].getLogic().getWidthOnLayout();return a},_hideButtonsOfHiddenPages:function(){for(var a=!0,b=0;b<this._flatButtons.length;b++)if(this._flatButtons[b]!=this._skinParts.moreButton){if(!this._flatButtons[b].getDataItem()){a=!1;break}this._flatButtons[b].isHidden()&&(this._flatButtons[b].getViewNode().setStyle("visibility","inherit"),this._flatButtons[b].getViewNode().inject(this._hiddenButtonsContainer))}return a},_getDisplayedButtons:function(){for(var a=[],b=0;b<this._rootButtons.length;b++)this._rootButtons[b].getDataItem()._data.hidePage||a.push(this._rootButtons[b]);return a},_setMenuListPositions:function(a){var b,c,d;if(1==a.length)c=a[0],c.getViewNode().setProperty("listposition","lonely"),c.getViewNode().setProperty("container","menu");else for(b=0;b<a.length;b++)c=a[b],d=0==b&&this._setPositionForFirst()?"left":b==a.length-1&&this._setPositionForLast()?"right":"center",c.getViewNode().setProperty("listposition",d),c.getViewNode().setProperty("container","menu")},_setPositionForFirst:function(){var a=!1;return this._postWidthModifier==this._stretchToFillModifier?a=!0:"left"==this.getComponentProperty("alignButtons")&&(a=!0),a},_setPositionForLast:function(){var a=!1;return this._postWidthModifier==this._stretchToFillModifier?a=!0:"right"==this.getComponentProperty("alignButtons")&&(a=!0),a},_getSampleButton:function(){return"visible"==this._rootButtons[0].getViewNode().getStyle("visibility")?this._rootButtons[0]:this._skinParts.moreButton},_sampleButtonBorder:function(a){this._buttonsBorder=a._skinParts.borderWrapper?this._getBorder(a._skinParts.borderWrapper):this._getBorder(a.getViewNode())},_setMinimumDimensions:function(a){this.setMinH(this._getButtonMinimalHeight(a))},_getButtonMinimalHeight:function(a){a._skinParts.label.setStyle("line-height","100%");var b=0;a.getSkin()&&!isNaN(a.getSkin().addToMinH)&&(b=a.getSkin().addToMinH);var c=this._getBorder(this._skinParts.itemsContainer).y+this._buttonsBorder.y;return b+c+parseInt(a._skinParts.label.getComputedStyle("line-height"))},_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var a=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,b=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",a+"px"),this._skinParts.itemsContainer.setStyle("width",b+"px"),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal")},_initMoreButton:function(){this._skinParts.moreButton.setLabel(this.getComponentProperty("moreButtonLabel")),this._skinParts.moreButton.skipMe=!0,this._skinParts.moreButton.children=[],this._skinParts.moreButton.getViewNode().inject(this._skinParts.itemsContainer)},_preArrangeButtons:function(a){for(var b=0;b<a.length;b++){var c=a[b];a[b].getViewNode().setStyle("position","relative"),c.getViewNode().setStyle("visibility","inherit"),c.disableTransition(),c._skinParts.bg.setStyle("padding","0px 0px")}},_restoreTransition:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.enableTransition()}},_alignButtonsText:function(a){for(var b=0;b<a.length;b++){var c=a[b].getViewNode(),d=parseInt(c.getLogic()._skinParts.bg.getComputedStyle("padding-left"))+parseInt(c.getLogic()._skinParts.bg.getComputedStyle("padding-right"));a[b].setPadding(d)}},_arrangementAlgorithm:function(a){for(var b=!1;!b;)if(b=this._arrangementIteration(a),!b)if(1==a.length)b=!0;else{this._skinParts.moreButton.skipMe=!1;var c=a.splice(a.length-2,1)[0];c.getViewNode().setStyle("visibility","inherit"),c.getViewNode().dispose(),this._skinParts.moreButton.children.unshift(c)}return a},_stretchToFillModifier:function(a,b){function c(a,b){if(j>0){var c=Math.ceil(h/j);h-=c;var e=parseInt(a._skinParts.bg.getStyle(b));d&&(i._buttonsPadding[a]||(i._buttonsPadding[a]={}),i._buttonsPadding[a][b]=e),a._skinParts.bg.setStyle(b,e+c+"px"),j--}}b=b||0;var d=!1;0==b&&(d=!0,this._buttonsPadding={});var e,f=this._getButtonsWidth(),g=parseInt(this._skinParts.itemsContainer.getStyle("width")),h=g-f-b;Browser.ie&&(h-=1),h=Math.max(h,0);var i=this;if(a.length>0){var j=2*a.length;for(e=0;e<a.length/2;e++){var k=a[e],l=a[a.length-e-1];c(k,"padding-left"),c(l,"padding-right"),c(k,"padding-right"),c(l,"padding-left")}}if(this._skinParts.itemsContainer.scrollHeight-a[0].getViewNode().offsetHeight>=a[0].getViewNode().offsetHeight){for(e=0;e<a.length;e++){var m=a[e];m._skinParts.bg.setStyle("padding-left",this._buttonsPadding[m]["padding-left"]),m._skinParts.bg.setStyle("padding-right",this._buttonsPadding[m]["padding-left"])}20>b&&this._stretchToFillModifier(a,b+1)}for(e=0;e<a.length;e++){var m=a[e];m.alignText()}},_sameWidthModifier:function(a){var b,c,d=0;for(b=0;b<a.length;b++){c=a[b];var e=parseInt(c.getViewNode().offsetWidth-this._buttonsBorder.x);isNaN(e)||(d=Math.max(d,e))}if(d>0)for(b=0;b<a.length;b++)c=a[b],c.fillWidthByPadding(d)},_staticWidthModifier:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.offsetWidth<this._staticWidth?c.fillWidthByPadding(this._staticWidth):c.getViewNode().setStyle("width",this._staticWidth+"px")},_nullModifier:function(){},_arrangementIteration:function(a){var b,c,d,e=[];for(d=0;d<a.length;d++)c=a[d],c.skipMe?c.collapse():e.push(c);for(this._setMenuListPositions(e),d=0;d<e.length;d++)c=e[d],c.uncollapse(),c.getViewNode().setStyle("visibility","visible"),c.getViewNode().inject(this._skinParts.itemsContainer),b=parseInt(this._skinParts.itemsContainer.getStyle("height"))-this._buttonsBorder.y,this._setButtonHeight(c,b),c._skinParts.label.setStyle("width","auto");return this._skinParts.itemsContainer.scrollHeight-a[0].getViewNode().offsetHeight<a[0].getViewNode().offsetHeight},_setButtonHeight:function(a,b){void 0!=a._skinParts.labelPad&&(b-=a._skinParts.labelPad.offsetHeight),a._skinParts.label.setStyle("line-height",b+"px")},_getBorder:function(a){var b=0,c=0;return a&&(b=parseInt(a.getStyle("border-left-width"))+parseInt(a.getStyle("border-right-width")),c=parseInt(a.getStyle("border-top-width"))+parseInt(a.getStyle("border-bottom-width"))),{x:b,y:c}},_getMargin:function(a){var b=0,c=0;return a&&(b=parseInt(a.getStyle("margin-left"))+parseInt(a.getStyle("margin-right")),c=parseInt(a.getStyle("margin-top"))+parseInt(a.getStyle("margin-bottom"))),{x:b,y:c}},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(a){this.injects().Viewer.goToPage(a.get("id")),this.callLater(function(){navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&this._dropDown.closeDropDown(!0)}.bind(this),[],100)},dispose:function(){this.injects().Viewer.removeEvent("pageTransitionStarted",this._onPageChanged),this.injects().Theme.removeEvent("propertyChange",this._onThemeChange),this.parent()}})}),define.component("wysiwyg.viewer.components.sm.SMApplyForMembership",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMRegister"),b.resources(["W.SiteMembers"]),b.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},re_password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindRePasswordField"}}),b.methods({onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rePasswordField._data.get("text");this._validateFields(a,b,c)&&this.resources.W.SiteMembers.applyForMembership(a,b,this._onFormSuccess,this._onFormError)},_onFormSuccess:function(){var a=this._emailField._data.get("text");this._container.showConfirmation("Success! Your member login request has been sent and is awaiting approval. The site administrator will notify you via email ("+a+") once your request has been approved")}})}),define.component("wysiwyg.viewer.components.sm.SMContainer",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Config","W.Utils","W.Viewer","W.Commands","W.SiteMembers"]),b.binds(["_handleSubmit","onFormError","onFormSuccess","_getCurrentForm","_handleCancel","_handleConfirmationOk"]),b.states(["normal","confirm"]),b.skinParts({blockingLayer:{type:"htmlElement"},submitButton:{type:"htmlElement"},okButton:{type:"htmlElement"},content:{type:"htmlElement"},contentInner:{hookMethod:"_createInnerDialog"},confirmationText:{type:"htmlElement"},errMsg:{type:"htmlElement"},title:{type:"htmlElement"},infoTitle:{type:"htmlElement"},note:{type:"htmlElement"},cancel:{type:"htmlElement"},xButton:{type:"htmlElement"}}),b.statics({INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"}}),b.methods({initialize:function(a,b,c){this.isVolatile=!0,this.parent(a,b,c),this._intent=c&&c.intent,this._authCallback=c&&c.authCallback,this._hashRedirectTo=c&&c.hashRedirectTo,this._openedByPageSecurity=c&&c.openedByPageSecurity,this._disableCancel=c&&c.disableCancel},_onAllSkinPartsReady:function(a){this.setState("normal"),a.submitButton.addEvent("click",this._handleSubmit),this._disableCancel?(a.xButton.hide(),a.cancel.setStyle("visibility","hidden")):(a.cancel.addEvent("click",this._handleCancel),a.xButton.addEvent("click",this._handleCancel),a.blockingLayer.addEvent("click",function(b){b.target==a.blockingLayer&&this._handleCancel()}.bind(this))),a.okButton.addEvent("click",this._handleConfirmationOk),this._initializeForm(a.contentInner),this.callLater(this.centerDialog)},_getFormType:function(a){var b=this.resources.W.SiteMembers;switch(a||(a=b.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER),a){case"REGISTER":var c=b.getCollectionType();switch(c){case"Open":return"register";case"ApplyForMembership":return"applyForMembership"}break;case"LOGIN":return"login"}},_createInnerDialog:function(a){var b=this._getFormType(this._intent);return a.type="wysiwyg.viewer.components.sm.SM"+b.capitalize(),a.skin="wysiwyg.viewer.skins.sm.SM"+b.capitalize()+"Skin",a.argObject={container:this},a},_initializeForm:function(a){this._currentForm=a;var b=this._skinParts.title;b.set("html",this._currentForm.getDisplayName());var c=this._skinParts.submitButton;c.set("value",this._currentForm.getButtonLabel());var d=this._skinParts.note,e=this._currentForm.getSubHeaderElement();if(e){var f=e.el,g=e.intent;f.getElements("a").addEvent("click",function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:g,disableCancel:this._disableCancel,openedByPageSecurity:this._openedByPageSecurity,hashRedirectTo:this._hashRedirectTo})}.bind(this)),d.adopt(f.childNodes)}this._addCurrentFormEvents(),this._openedByPageSecurity&&(this.resources.W.Viewer.isPublicMode()||this.resources.W.Config.isInDebugMode()?(this._skinParts.infoTitle.set("text","To view this page, you need to be logged in."),this._skinParts.note.setStyle("float","right"),this._skinParts.infoTitle.setStyle("display","block")):this.showConfirmation("This page is protected with a member login. Your users will be able to see this page once they are logged in. To manage your site's members, go to your site in My Account and click Site Members",function(){this.reportAuthStatusChange(!0),this._closeSMContainer()}.bind(this)))},setActiveForm:function(){},centerDialog:function(){var a=this._skinParts.dialog;a.setStyles({"margin-left":-(a.getSize().x/2),"margin-top":-(a.getSize().y/2)})},_removeCurrentFormEvents:function(){var a=this._getCurrentForm();a.removeEvent("error",this._onFormError),a.removeEvent("success",this._onFormSuccess)},_addCurrentFormEvents:function(){var a=this._getCurrentForm();a.addEvent("error",this._onFormError),a.addEvent("success",this._onFormSuccess)},onFormError:function(a){this._skinParts.errMsg.set("html",a)},onFormSuccess:function(){this._closeSMContainer()},closeAndRedirect:function(){if(this._closeSMContainer(),this._hashRedirectTo){var a=this.resources.W.Utils.hash.getHashParts(this._hashRedirectTo);this.resources.W.Utils.hash.setHash(a.id,a.title,a.extData,!0),window.location.hash=this._hashRedirectTo}location.reload()},reportAuthStatusChange:function(a,b){this._authCallback&&this.resources.W.SiteMembers.reportAuthStatusChange(this._authCallback,a,b)},showConfirmation:function(a,b){this.setState("confirm"),this._skinParts.confirmationText.set("text",a),this._confirmCallback=b},_handleConfirmationOk:function(){this._confirmCallback&&this._confirmCallback(),this._closeSMContainer()},_handleCancel:function(){this._getCurrentForm().onCancel(),this.reportAuthStatusChange(!1,{cancel:!0}),this._closeSMContainer()},_onKeyPress:function(a){13==a.code&&this._handleSubmit()},_handleSubmit:function(){return this.resources.W.Viewer.isPublicMode()||this.resources.W.Config.isInDebugMode()?(this._skinParts.errMsg.set("html",""),this._getCurrentForm().onSubmit(),void 0):(this.resources.W.Commands.executeCommand("adminLogin.submitAttempt",{component:this._skinParts.submitButton},this),void 0)},_editModeChanged:function(){this._closeSMContainer()},_closeSMContainer:function(){this.resources.W.Commands.executeCommand("WViewerCommands.SiteMembers.Close",null,null)},_getCurrentForm:function(){return this._currentForm}})}),define.component("wysiwyg.viewer.components.sm.SMForm",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Data"]),b.binds(["_onFormError","_onFormSuccess"]),b.statics({PASS_MIN_LEN:4,PASS_MAX_LEN:15,ERR_MAP:{GENERAL_ERR:"Server error. try again later.",VAL_ERR_PASSWORD_BLANK:"Password cannot be blank",VAL_ERR_PASSWORD_RETYPE:"Passwords are not the same",VAL_ERR_PASSWORD_LENGTH:"Password length must be between {0} and {1}",VAL_ERR_EMAIL_BLANK:"Email cannot be blank",VAL_ERR_EMAIL_INVALID:"Email is invalid","-19999":"Unknown user","-19995":"Email is already taken","-19972":"Invalid token","-19988":"Validation Error","-19984":"Invalid Session","-19976":"Wrong email or password","-19958":"Your member request is waiting approval from the site owner"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},LABELS:{EMAIL:"Email",PASSWORD:"Password",RE_PASSWORD:"Retype password",REMEMBER_ME:"Remember Me"}}),b.methods({initialize:function(a,b,c){this.isVolatile=!0,c=c||{},this.parent(a,b,c),this._container=c.container},onSubmit:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"performSubmit")},getDisplayName:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"getDisplayName")},getSubHeaderElement:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"getSubHeaderElement")},reportAuthStatusChange:function(a,b){this._container.reportAuthStatusChange(a,b)},closeAndRedirect:function(){this._container.closeAndRedirect()},onCancel:function(){},_onFormError:function(a,b){var c=this._getErrorMessage(a);b?b.setError(c):this._container.onFormError(c)},_onFormSuccess:function(a){this._container.onFormSuccess(a)},_getErrorMessage:function(a){var b=this.ERR_MAP.GENERAL_ERR;if(a){var c=a.errorCode;if(c&&this.ERR_MAP[c]){b=this.ERR_MAP[c];var d=a.errorParams;if(d)for(var e=d.length||0,f=0;e>f;f++)b=b.replace("{"+f+"}",d[f])}else b=this.ERR_MAP.GENERAL_ERR+" ("+c+")";LOG.reportError("Site Members error - "+a.errorDescription+"("+a.errorCode+")")}return b},_bindRePasswordField:function(a){return a.argObject={label:this.LABELS.RE_PASSWORD,passwordField:!0},this._bindTextDataItem(a)},_bindPasswordField:function(a){return a.argObject={label:this.LABELS.PASSWORD,passwordField:!0},this._bindTextDataItem(a)},_bindEmailField:function(a){return a.argObject={label:this.LABELS.EMAIL},this._bindTextDataItem(a)},_bindTextDataItem:function(a){return a.dataItem=this.resources.W.Data.createDataItem({text:"",type:"Text"},"Text"),a}})}),define.Class("wysiwyg.viewer.components.sm.SMFormValidationHelper",function(a){var b=a;b.resources(["W.Utils"]),b.statics({PASS_MIN_LEN:4,PASS_MAX_LEN:15}),b.methods({isEmailBlank:function(a){return a?!1:!0},isEmailValid:function(a){return this.resources.W.Utils.isValidEmail(a)},isBlankPassword:function(a){return a?!1:!0},isPasswordLengthValid:function(a){return a.length<this.PASS_MIN_LEN||a.length>this.PASS_MAX_LEN?!1:!0},doPasswordsMatch:function(a,b){return a!==b?!1:!0},isPasswordCharsValid:function(a){var b=-1===a.indexOf("#");return b?!0:!1}})}),define.component("wysiwyg.viewer.components.sm.SMLogin",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMForm"),b.resources(["W.Data","W.SiteMembers","W.Utils"]),b.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},rememberMe:{type:"wysiwyg.viewer.components.inputs.CheckBoxInput",hookMethod:"_bindCheckBoxDataItem"}}),b.methods({_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rememberMeField=this._skinParts.rememberMe},onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rememberMeField._data.get("value");this._validateFields(a,b)&&this.resources.W.SiteMembers.login(a,b,c,this._onFormSuccess,this._onFormError)},_validateFields:function(a,b){return this._passwordField.setValidationState(!0),this._emailField.setValidationState(!0),a?this.resources.W.Utils.isValidEmail(a)?b?b.length<this.PASS_MIN_LEN||b.length>this.PASS_MAX_LEN?(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._passwordField),!1):!0:(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._passwordField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._emailField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._emailField),!1)},_onFormSuccess:function(){this.closeAndRedirect()},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return"Login"},getButtonLabel:function(){return"GO"},getSubHeaderElement:function(){var a=new Element("DIV");return a.set("html","Or <a>Sign up</a>"),{el:a,intent:this.INTENTS.REGISTER}},_bindCheckBoxDataItem:function(a){return a.dataItem=this.resources.W.Data.createDataItem({value:"false",type:"Boolean"},"Boolean"),a.dataItem.setMeta("isPersistent",!1),a.argObject={label:this.LABELS.REMEMBER_ME},a}})}),define.component("wysiwyg.viewer.components.sm.SMProfile",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMForm"),b.resources(["W.SiteMembers"]),b.skinParts({name:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindTextDataItem"}}),b.methods({_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._nameField=this._skinParts.name},onSubmit:function(){var a=this._nameField._data.get("text");this._validateFields(a)&&this.resources.W.SiteMembers.updateMemberDetails({name:a},this._onFormSuccess,this._onFormError)},_validateFields:function(){return!0},onCancel:function(){this.fireEvent("cancel")},getDisplayName:function(){return"Update your details"},getButtonLabel:function(){return"Update"},getSubHeaderElement:function(){var a=new Element("DIV");return{el:a}}})}),define.component("wysiwyg.viewer.components.sm.SMRegister",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMForm"),b.resources(["W.SiteMembers","W.Utils"]),b.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},re_password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindRePasswordField"}}),b.methods({_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rePasswordField=this._skinParts.re_password},onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rePasswordField._data.get("text");this._validateFields(a,b,c)&&this.resources.W.SiteMembers.register(a,b,this._onFormSuccess,this._onFormError)
},_validateFields:function(a,b,c){return this._passwordField.setValidationState(!0),this._rePasswordField.setValidationState(!0),this._emailField.setValidationState(!0),a?this.resources.W.Utils.isValidEmail(a)?b?b.length<this.PASS_MIN_LEN||b.length>this.PASS_MAX_LEN?(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._passwordField),!1):b!=c?(this._rePasswordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_RETYPE"},this._rePasswordField),!1):!0:(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._passwordField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._emailField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._emailField),!1)},_onFormSuccess:function(){this.closeAndRedirect()},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return"Sign up"},getButtonLabel:function(){return"GO"},getSubHeaderElement:function(){var a=new Element("DIV");return a.set("html","I already have a user, <a>Login</a>"),{el:a,intent:this.INTENTS.LOGIN}}})}),define.Class("wysiwyg.viewer.components.traits.GalleryAutoplay",function(a){var b=a;b.binds(["_onComponentReady","_onMouseDown","_autoplayCallback","_onPropertyChanged","_onTransitionFinished","_onModeChange","_onMediaZoomClosed","_onMediaZoomOpened","_getDirection"]),b.fields({_autoplayOn:!1,_timeoutID:null,_suppressAutoplay:!1}),b.resources(["W.Viewer","W.Commands"]),b.methods({initialize:function(){this.addEvent(Constants.ComponentEvents.RENDER,this._onComponentRender),this.addEvent(Constants.ComponentEvents.READY,this._onComponentReady),this.resources.W.Viewer.getPreviewMode()===!0&&(this._suppressAutoplay=!0,this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange)),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.OpenZoom",this,this._onMediaZoomOpened)},_onComponentReady:function(){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._updateAutoplayState()},_onComponentRender:function(){this._properties.addEvent(Constants.DataEvents.DATA_CHANGED,this._onPropertyChanged),this.addEvent("transitionFinished",this._onTransitionFinished),this._skinParts.autoplay&&(this._skinParts.autoplay.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),this._skinParts.autoplay.setStyle("cursor","pointer"),this._checkAutoPlaySkinPartsVisibility())},_onModeChange:function(a){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._suppressAutoplay=!("PREVIEW"==a),this._updateAutoplayState()},_onMediaZoomOpened:function(){this._lastAutoplayState=this._autoplayOn,this._suppressAutoplay=!0,this._updateAutoplayState()},_onMediaZoomClosed:function(){this._suppressAutoplay=!1,this._autoplayOn=this._lastAutoplayState===!0,this._updateAutoplayState()},_validateHostComponent:function(){var a=this.getComponentProperties().getSchema();this._skinPartsSchema.hasOwnProperty("autoplay")||this._validationErr("Must require 'autoplay' skinPart."),a.hasOwnProperty("autoplay")||this._validationErr("Must contain 'autoplay' among the component properties."),a.hasOwnProperty("autoplayInterval")||this._validationErr("Must contain 'autoplayInterval' among the component properties."),"function"!=typeOf(this.gotoNext)&&this._validationErr("Host component must implement gotoNext() method.")},_validationErr:function(a){throw new Error("GalleryAutoplay trait's host component validation failed. "+a)},_onMouseDown:function(){this._toggleAutoplay()},_toggleAutoplay:function(){this._autoplayOn=!this._autoplayOn,this._updateAutoplayState()},_updateAutoplayState:function(){this._suppressAutoplay&&(this._autoplayOn=!1),this.setState(this._autoplayOn?"autoplayOn":"autoplayOff","slideshow"),this._startAutoplayTimer()},_getAutoplayInterval:function(){var a=parseFloat(this.getComponentProperty("autoplayInterval"));parseFloat(this.getComponentProperty("transDuration"));var b=Math.floor(1e3*a);return b},_startAutoplayTimer:function(){null!=this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._autoplayOn&&(this._timeoutID=setTimeout(this._autoplayCallback,this._getAutoplayInterval()))},_autoplayCallback:function(){"LTR"==this._getDirection()?this.gotoPrev():this.gotoNext()},_onPropertyChanged:function(){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._updateAutoplayState(),this._checkAutoPlaySkinPartsVisibility()},_checkAutoPlaySkinPartsVisibility:function(){this._skinParts&&this._skinParts.autoplay&&this._skinParts.autoplay.setStyle("visibility",this.getComponentProperty("showAutoplay")?"visible":"hidden")},_onTransitionFinished:function(){this._startAutoplayTimer()},_getDirection:function(){return this.getComponentProperties().getData().autoPlayDirection}})}),define.oldTrait({name:"wysiwyg.viewer.components.traits.ListIterator",trait:{_currentItemIndex:0,_oldItem:null,_currentItem:null,_numItems:-1,_locked:!1,_lastCommand:"",lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return this._locked},setListAndCurrentIndex:function(a,b){this._numItems=a.get("items").length,this._currentItemIndex=b,this._onCurrentItemChanged()},resetIterator:function(){this._currentItemIndex=0,this._numItems=-1,this._locked=!1,this._lastCommand="",this._currentItem=null},_onCurrentItemChanged:function(){this._oldItem=this._currentItem,this._currentItem=this.getDataItem().getData().items[this._currentItemIndex],this.fireEvent("currentItemChanged")},gotoPrev:function(){this._locked||(this._lastCommand="prev",this._currentItemIndex=this._getPrevItemIndex(),this._onCurrentItemChanged())},gotoNext:function(){this._locked||(this._lastCommand="next",this._currentItemIndex=this._getNextItemIndex(),this._onCurrentItemChanged())},_getNextItemIndex:function(){var a=this._currentItemIndex;return a++,a>=this._numItems&&(a=0),a},_getPrevItemIndex:function(){var a=this._currentItemIndex;return a--,-1==a&&(a=this._numItems-1),a}}}),define.oldTrait({name:"wysiwyg.viewer.components.traits.VideoUtils",trait:{_videoUrl:{YOUTUBE:"http://youtu.be/",VIMEO:"http://vimeo.com/"},_getServices:function(){var a={YOUTUBE:{url:"http://www.youtube.com/embed/",getPreviewUrl:this._getYouTubePreviewUrl},VIMEO:{url:"http://player.vimeo.com/video/",getPreviewUrl:this._getVimeoPreviewUrl}};return a},_getYouTubePreviewUrl:function(a,b){var c="http://img.youtube.com/vi/[repLace]/0.jpg",d=c.replace("[repLace]",a);return b(d),d},_getVimeoPreviewUrl:function(a,b){var c="http://vimeo.com/api/v2/video/[repLace].json",d=c.replace("[repLace]",a),e=new Request.JSONP({url:d+"?"+"r="+Math.random(),onComplete:function(a){b(a[0].thumbnail_large)}});e.send()},_getYoutubeId:function(a){var b="",c=/(?:youtube\.com\/watch[^\s]*[\?&]v=)([\w-]+)/g,d=/(?:youtu\.be\/)([\w-]+)/g,e=c.exec(a)||d.exec(a);return e&&e.length&&e[1]&&(b=e[1]),b},_getVimeoId:function(a){var b="",c=/vimeo\.com\/(\d+)$/gi,d=c.exec(a);return d&&d.length&&d[1]&&(b=d[1]),b},_getVideoDataFromVideoUrl:function(a){var b=null,c=this._getYoutubeId(a);return c?b="YOUTUBE":(c=this._getVimeoId(a),c&&(b="VIMEO")),c&&b?{videoId:c,videoType:b}:{}},_getVideoUrlFromVideoData:function(a){var b=a.videoId,c=a.videoType;return b&&c?this._videoUrl[c]+b:""}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.HomePageLogin",skinParts:{actionTitle:{type:"htmlElement"},memberTitle:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onStyleChange","_doLogout","_doLogin"],_states:["auth","no_auth"],Translations:{en:{SIGN_IN:"Login/Sign up",SIGN_OUT:"Log out",HELLO:"Hello"},de:{SIGN_IN:"Anmelden/Registrieren",SIGN_OUT:"Abmelden",HELLO:"Hallo"},es:{SIGN_IN:"Login/ Regstrate",SIGN_OUT:"Cerrar Sesin",HELLO:"Hola"},fr:{SIGN_IN:"Connexion/ Inscription",SIGN_OUT:"Dconnexion",HELLO:"Bonjour"},it:{SIGN_IN:"Accedi/Registrati",SIGN_OUT:"Esci",HELLO:"Ciao"},pl:{SIGN_IN:"Zaloguj si/Zarejestruj si",SIGN_OUT:"Wyloguj si",HELLO:"Witaj"},pt:{SIGN_IN:"Login/Registre-se",SIGN_OUT:"Sair",HELLO:"Ol"},ko:{SIGN_IN:"/",SIGN_OUT:"",HELLO:"?"},ja:{SIGN_IN:"/",SIGN_OUT:"",HELLO:""},ru:{SIGN_IN:"/",SIGN_OUT:"",HELLO:""}},initialize:function(a,b,c){this.parent(a,b,c),window.userApi&&(this._userApi=window.userApi)},_translate:function(a){var b="en";return this._userApi&&(b=this._userApi.getLanguage()),this.Translations[b][a]},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChange)},_onStyleChange:function(){this._wCheckForSizeChangeAndFireAutoSized(10)},_onAllSkinPartsReady:function(){this._updateTextsAndEvents()},_doLogout:function(){var a=this._skinParts.actionTitle;a.removeEvent("click",arguments.callee),this.injects().Viewer.isPublicMode()?(this._userApi.logout(),window.location.href="http://www.wix.com"):this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this.getViewNode()},this)},_doLogin:function(){var a=this._skinParts.actionTitle;a.removeEvent("click",arguments.callee),this.injects().Viewer.isPublicMode()?this._openLoginDialog():this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this.getViewNode()},this)},_updateView:function(a,b,c){var d=this._skinParts.actionTitle,e=this._skinParts.memberTitle;d.set("text",a),e.set("text",b),d.addEvent("click",c)},_updateTextsAndEvents:function(){var a=this._userApi;a&&a.isSessionValid()?(this._updateView(this._translate("SIGN_OUT"),this._translate("HELLO")+" "+a.getUserName(),this._doLogout),this.setState("auth")):(this._updateView(this._translate("SIGN_IN"),"",this._doLogin),this.setState("no_auth"))},_openLoginDialog:function(){var a=this._data.get("postLoginUrl"),b=this._data.get("postSignUpUrl"),c=this._data.get("startWith");a||(a=location.href),b||(b=location.href),window.animateForm.callForm([b,a,c,"HTML"])},getAcceptableDataTypes:function(){return["HomePageLogin"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.LanguagesDropDown",skinParts:{select:{type:"htmlElement"},options:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_initMenu","_populateDropDown","_updateSelection","_changeLanguage","_onFocus","_onBlur","_onOptionClick","_onKeyPress","_changeLanguageSuccess","_changeLanguageFailed"],Static:{CLASS_NAME_SELECTED:"selected",CLASS_NAME_OPTION_CONTAINER:"optionContainer"},_states:{mouse:["selected"]},initialize:function(a,b,c){this.parent(a,b,c),this._selectedOption=null,this._menuData=window.wixhomepage&&window.wixhomepage.languagesDropDownData?window.wixhomepage.languagesDropDownData:[{languageCode:"en",languageSubdomain:"www",iconURL:"",languageLabel:"English"},{languageCode:"de",languageSubdomain:"de",iconURL:"",languageLabel:"Deutsch"},{languageCode:"es",languageSubdomain:"es",iconURL:"",languageLabel:"Espaol"},{languageCode:"fr",languageSubdomain:"fr",iconURL:"",languageLabel:"Franais"},{languageCode:"it",languageSubdomain:"it",iconURL:"",languageLabel:"Italiano"},{languageCode:"pl",languageSubdomain:"pl",iconURL:"",languageLabel:"Polski"},{languageCode:"pt",languageSubdomain:"pt",iconURL:"",languageLabel:"Portugus"},{languageCode:"ru",languageSubdomain:"ru",iconURL:"",languageLabel:"P"}]},_onAllSkinPartsReady:function(){this._initMenu()},_initMenu:function(){this._populateDropDown(),this._skinParts.select.addEvent(Constants.CoreEvents.CHANGE,this._changeLanguage),this._skinParts.select.addEvent(Constants.CoreEvents.CLICK,this._onFocus),this._skinParts.options.addEvent(Constants.CoreEvents.CLICK,this._onOptionClick)},_onFocus:function(a){return a.stopPropagation(),"selected"==this.getState("mouse")?(this._onBlur(a),void 0):(this.setState("selected","mouse"),document.body.addEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.addEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress),void 0)},_onBlur:function(a){a.stopPropagation(),this.removeState("selected","mouse"),document.body.removeEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.removeEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},_onOptionClick:function(a){a=a||{};for(var b=a.target;b!==this._skinParts.options&&0==b.hasClass(this.CLASS_NAME_OPTION_CONTAINER);)b=b.parentNode;var c=b.getAttribute("data-subdomain"),d=b.getAttribute("data-languagecode"),e=this._getLanguage();this._setSelected(b),"site"==window.viewMode&&c&&d&&d!=e&&this._skinParts.select.fireEvent(Constants.CoreEvents.CHANGE,{value:c}),this._onBlur(a)},_onKeyPress:function(a){switch(a.stopPropagation(),a.key){case"up":var b=this._selectedOption.getPrevious();b||(b=this._skinParts.options.getLast()),this._setSelected(b),a.preventDefault();break;case"down":this._setSelected(this._selectedOption.getNext()),a.preventDefault();break;case"enter":case"space":a.target=this._selectedOption,this._onOptionClick(a);break;case"esc":case"tab":this._onBlur(a)}},_setSelected:function(a){var b=this._skinParts.select,c=this._skinParts.options,d=this._skinParts.options.getElement("."+this.CLASS_NAME_SELECTED);d&&d.removeClass(this.CLASS_NAME_SELECTED),a=a||this._skinParts.options.getFirst(),a.addClass(this.CLASS_NAME_SELECTED),b.setAttribute("data-subdomain",a.getAttribute("data-subdomain")),b.setAttribute("data-languagecode",a.getAttribute("data-languagecode")),b.set("html",a.get("html"));var e=a.getPosition(c).y,f=c.getScroll().y;(e>c.getSize().y+f||0>e)&&c.scrollTo(0,e),this._selectedOption=a},_populateDropDown:function(){var a,b;for(this._skinParts.select.empty(),this._skinParts.options.empty(),a=0,b=this._menuData.length;b>a;a++)this._insertOption(this._menuData[a]);this._updateSelection()},_insertOption:function(a){var b=new Element("li",{html:a.languageLabel}),c=new Element("image");b.addClass(this.CLASS_NAME_OPTION_CONTAINER),a.iconURL&&(c.setAttribute("src",a.iconURL),c.inject(b)),b.insertInto(this._skinParts.options),b.setAttribute("data-subdomain",a.languageSubdomain),b.setAttribute("data-languagecode",a.languageCode),b.addEvent(Constants.CoreEvents.CLICK,this._onOptionClick)},_getOptionBySubDomain:function(a){return this._skinParts.options.getElement('[data-subdomain="'+a+'"]')},_changeLanguageSuccess:function(){var a=this._skinParts.select.getAttribute("data-subdomain"),b=location.hostname.substring(location.hostname.indexOf(".")),c=location.protocol+"//"+a+b+location.pathname+location.search+location.hash;location.href.toLowerCase()==c.toLowerCase()?location.reload():location.href=c},_changeLanguageFailed:function(){},_changeLanguage:function(){var a=this._skinParts.select.getAttribute("data-languagecode");window.userApi?window.userApi.setLanguage(a,this._changeLanguageFailed,this._changeLanguageSuccess):LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"LanguagesDropDown","_changeLanguage")()},_getLanguage:function(){return window.userApi?window.userApi.getLanguage():(LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"LanguagesDropDown","_getLanguage")(),"en")},_updateSelection:function(){var a;a=window.userApi?window.userApi.getLanguage():"www";var b=this._getOptionBySubDomain(a);this._setSelected(b)},_removeAllDomEvents:function(){document.body.removeEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.removeEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},dispose:function(){this._removeAllDomEvents(),this.parent()}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.WixHomepageMenu",skinParts:{buttonsContainer:{type:"htmlElement"},buttonTemplate:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_populateMenu","_getData"],_states:["topMenu","bottomMenu"],render:function(){this._getData(),this._populateMenu(),this._setMenuType()},_setMenuType:function(){var a=this._data.get("menuDataSource");this.setState(a)},_getData:function(){var a=this._data.get("menuDataSource"),b=this._getLanguage();this._menuData=window.wixhomepage&&window.wixhomepage[a]&&window.wixhomepage[a][b]?window.wixhomepage[a][b]:[{label:"Create",link:"/create/website"},{label:"Explore",link:"/sample/website"},{label:"Features",link:"/about/features"},{label:"My Account",link:"/create/my-account"},{label:"Premium",link:"/upgrade/website"},{label:"Support",link:"/support/"}]},_getLanguage:function(){return window.userApi?window.userApi.getLanguage():(LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"WixHomepageMenu","_getLanguage"),"en")},_insertButton:function(a){var b=this._skinParts.buttonTemplate.cloneNode(!0);b.setAttribute("isTemplate","false");var c=b.getElements(".buttonLink")[0];c.setAttribute("href",a.link),c.innerHTML=a.label,b.insertInto(this._skinParts.buttonsContainer)},_populateMenu:function(){var a;for(this._skinParts.buttonsContainer.empty(),a=0,l=this._menuData.length;l>a;a++)this._insertButton(this._menuData[a])},getAcceptableDataTypes:function(){return["WixHomepageMenu"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.WixOfTheDay",imports:["core.components.image.ImageSettings"],skinParts:{img:{type:"core.components.image.ImageNew",dataRefField:"*"},introContainer:{type:"htmlElement"},descriptionContainer:{type:"htmlElement"},introPreTitle:{type:"htmlElement"},introTitle:{type:"htmlElement"},introText:{type:"htmlElement"},shortDescriptionText:{type:"htmlElement"},descriptionText:{type:"htmlElement"},readOn:{type:"htmlElement"},closeDescription:{type:"htmlElement"}},traits:["wysiwyg.common.components.traits.LinkableComponent"],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onCloseDescriptionClicked","_onReadOnClicked","_renderTexts","_updateContainers"],Static:{},_states:["opened","closed"],Translations:{en:{INTRO_PRE_TITLE:"GET INSPIRED WITH",INTRO_TITLE:"OF THE DAY",INTRO_TEXT:"Everyday we feature an amazing new website built with Wix.<br>Want your website featured?<br>Submit your URL to wixofday@wix.com",READ_ON_BUTTON_LABEL:"Read on",CLOSE_DESCRIPTION_BUTTON_LABEL:"Close"},es:{INTRO_PRE_TITLE:"Insprate con el",INTRO_TITLE:"del da!",INTRO_TEXT:"Todos los das te presentamos un increble sitio creado con Wix.<br>Quieres que tu sitio aparezca aqu?<br>Envanos tu URL a wixofday@wix.com",READ_ON_BUTTON_LABEL:"Leer Ms",CLOSE_DESCRIPTION_BUTTON_LABEL:"Cerrar"},fr:{INTRO_PRE_TITLE:"Inspirez-vous du",INTRO_TITLE:"du Jour!",INTRO_TEXT:"Nous exposons chaque jour le meilleur site cr avec Wix.<br>Vous voulez que votre site soit expos?<br>Envoyez votre URL  wixofday@wix.com",READ_ON_BUTTON_LABEL:"En lire plus",CLOSE_DESCRIPTION_BUTTON_LABEL:"Fermer"},it:{INTRO_PRE_TITLE:"Lasciati ispirare dal",INTRO_TITLE:"del giorno!",INTRO_TEXT:"Ogni giorno presentiamo un sito spettacolare creato con Wix.<br>Vuoi che anche il tuo sito venga preso in considerazione?<br>Inviaci il tuo URL a wixofday@wix.com",READ_ON_BUTTON_LABEL:"Continua a leggere",CLOSE_DESCRIPTION_BUTTON_LABEL:"Chiudi"},pl:{INTRO_PRE_TITLE:"Zainspiruj sie",INTRO_TITLE:"EM DNIA!",INTRO_TEXT:"Kazdego dnia prezentujemy nowa, niesamowita witryne zbudowana z Wix.<br>Chcesz, aby twoja witryna zostala wyrzniona?<br>Przeslij jej adres URL na wixofday@wix.com",READ_ON_BUTTON_LABEL:"Czytaj wiecej",CLOSE_DESCRIPTION_BUTTON_LABEL:"Zamknij"},pt:{INTRO_PRE_TITLE:"INSPIRE-SE COM O",INTRO_TITLE:"DO DIA!",INTRO_TEXT:"Todos os dias ns exibimos um site incrvel construdo com o Wix.<br>Quer ver o seu site aqui?<br>Envie o seu endereo URL para wixofday@wix.com",READ_ON_BUTTON_LABEL:"Leia mais",CLOSE_DESCRIPTION_BUTTON_LABEL:"Fechar"},ko:{INTRO_PRE_TITLE:" ",INTRO_TITLE:" WIX",INTRO_TEXT:"  Wix    .<br>   ?<br>wixofday@wix.com  URL .",READ_ON_BUTTON_LABEL:"",CLOSE_DESCRIPTION_BUTTON_LABEL:""},ja:{INTRO_PRE_TITLE:"\r\n\r\n",INTRO_TITLE:"WIX ",INTRO_TEXT:"Wix\nURLwixofday@wix.com",READ_ON_BUTTON_LABEL:"",CLOSE_DESCRIPTION_BUTTON_LABEL:""},ru:{INTRO_PRE_TITLE:" ",INTRO_TITLE:"",INTRO_TEXT:"     ,  ,    Wix!<br>,       ?<br>   URL  wixofday@wix.com",READ_ON_BUTTON_LABEL:" ",CLOSE_DESCRIPTION_BUTTON_LABEL:""}},initialize:function(a,b,c){this.parent(a,b,c),this._SettingsClass=this.imports.ImageSettings,window.userApi&&(this._userApi=window.userApi),this.setState("closed")},_translate:function(a){var b="en";return this._userApi&&(b=this._userApi.getLanguage()),this.Translations[b][a]},render:function(){this._renderImage(),this._renderTexts(),this.parent()},_updateContainers:function(){"closed"==this.getState()?(this._skinParts.introContainer.setStyle("display","block"),this._skinParts.descriptionContainer.setStyle("display","none")):(this._skinParts.introContainer.setStyle("display","none"),this._skinParts.descriptionContainer.setStyle("display","block"))},_renderTexts:function(){this._updateContainers(),this._skinParts.introPreTitle.innerHTML=this._translate("INTRO_PRE_TITLE"),this._skinParts.introTitle.innerHTML=this._translate("INTRO_TITLE"),this._skinParts.introText.innerHTML=this._translate("INTRO_TEXT"),this._skinParts.descriptionText.innerHTML=this._data.get("description"),this._skinParts.shortDescriptionText.innerHTML=this._data.get("description"),this._skinParts.readOn.innerHTML=this._translate("READ_ON_BUTTON_LABEL"),this._skinParts.closeDescription.innerHTML=this._translate("CLOSE_DESCRIPTION_BUTTON_LABEL")},_renderImage:function(){if(this._layoutInitialized){var a=this._skinParts.img;if(a&&a.getOriginalClassName){var b=this._getImageSettings();a.setSettings(b),a.setHeight(274,!1,!1),a.setWidth(344,!1,!1)}}},_getImageSettings:function(){return this._imageSettings||(this._imageSettings=new this.imports.ImageSettings(this._SettingsClass.CropModes.FIT_WIDTH,344,274)),this._imageSettings},_onReadOnClicked:function(a){a.stopPropagation(),this.setState("opened"),W.Utils.Tween.to(this._skinParts.introContainer,.3,{opacity:0,onComplete:this._updateContainers}),W.Utils.Tween.to(this._skinParts.descriptionContainer,.3,{delay:.3,opacity:1})},_onCloseDescriptionClicked:function(a){a.stopPropagation(),this.setState("closed"),W.Utils.Tween.to(this._skinParts.descriptionContainer,.3,{opacity:0,onComplete:this._updateContainers}),W.Utils.Tween.to(this._skinParts.introContainer,.3,{delay:.3,opacity:1})},_onAllSkinPartsReady:function(){this._skinParts.readOn.addEvent(Constants.CoreEvents.CLICK,this._onReadOnClicked),this._skinParts.closeDescription.addEvent(Constants.CoreEvents.CLICK,this._onCloseDescriptionClicked)},_removeAllDomEvents:function(){this._skinParts.readOn.removeEvent(Constants.CoreEvents.CLICK,this._onReadOnClicked),this._skinParts.closeDescription.removeEvent(Constants.CoreEvents.CLICK,this._onCloseDescriptionClicked)},getAcceptableDataTypes:function(){return["Image"]},dispose:function(){this._removeAllDomEvents(),this.parent()}}});
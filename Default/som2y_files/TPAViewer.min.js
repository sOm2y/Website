define.dataSchema("TPA",{applicationId:{type:"string","default":"",description:"application ID"},appDefinitionId:{type:"string","default":"",description:"application Definition Id"}}),define.dataSchema("CustomProperties",function(){return{properties:"object"}}),define.dataSchema("TPAGluedProperties",{placement:{type:"string","default:":"BOTTOM_RIGHT",description:"widget placement"},verticalMargin:{type:"string","default:":"",description:"widget vertical margin"},horizontalMargin:{type:"string","default:":"",description:"widget horizontal margin"}}),define.dataSchema("TPAWidget",{"extends":"TPA",widgetId:{type:"string","default":"",description:"some amazing description"}}),define.Class("wysiwyg.viewer.managers.tpa.PixelTracker",function(a){"use strict";a.binds(["sendPixelRequest"]),a.utilize(["bootstrap.utils.Que"]),a.methods({initialize:function(a,b){this.getUrls=a,this.image=document.createElement("img"),this._useCacheKiller=b?!1:!0,this.que=new this.imports.Que({outputRate:100,outputChankSize:1,processContext:this,onprocess:function(a){this.sendPixelRequest(a)}})},_buildUrl:function(a,b){return a+=~a.indexOf("?")?"&":"?",a+=b||"",a+=this._calcCacheKiller(a),a.replace(/&&/g,"&").replace("?&","?").replace(/\?$/,"")},_calcCacheKiller:function(){return this._useCacheKiller?"&ck="+(+new Date).toString(36):""},_getUrls:function(a){return this.getUrls?this.getUrls(a):[]},sendAll:function(a){this.que.add.apply(this.que,this._getUrls(a))},sendPixelRequest:function(a,b){return a?this.image.src=this._buildUrl(a,b):!1}})}),define.Class("wysiwyg.viewer.managers.tpa.TPAComponentRegistrar",function(a){var b=a;b.resources(["W.Data"]),b.statics({SECTION:"section",WIDGETS:"widgets",SECTION_PAGE_ID:"pageId",APPLICATION_ID_KEY:"tpaApplicationId"}),b.methods({initialize:function(){this._componentsByType={},this._componentsByCompId={}},register:function(a,b){b=a.getApplicationId()||b;var c=this._getDataObjectByApplicationId(b);if(a&&"wysiwyg.viewer.components.tpapps.TPASection"==a.getOriginalClassName())c[this.SECTION]=a;else{var d=this._getWidgets(b);d.push(a)}this._componentsByCompId[a.getComponentId()]=a},unregister:function(a,b){b=a.getApplicationId()||b;var c=this._getDataObjectByApplicationId(b);if(a&&"wysiwyg.viewer.components.tpapps.TPASection"==a.getOriginalClassName())delete c[this.SECTION];else{var d=this._getWidgets(b),e=d.indexOfByPredicate(function(b){return b===a}.bind(this));d.splice(e,1)}delete this._componentsByCompId[a.getComponentId()]},getPageId:function(a){var b=this.resources.W.Data.getDataMap(),c=Object.filter(b,function(b){return"Page"==b.get("type")&&b.get(this.APPLICATION_ID_KEY)==a}.bind(this)),d=Object.values(c);return d.length>0?d[0].get("id")||null:null},_getDataObjectByApplicationId:function(a){return this._componentsByType[a]||(this._componentsByType[a]={}),this._componentsByType[a]},_getByApplicationId:function(a){var b=[].concat(this._getWidgets(a)),c=this.getSection(a);return c&&b.push(c),b},each:function(a,b){var c=this._getByApplicationId(a);Array.each(c,function(a){b(a)})},_getWidgets:function(a){var b=this._getDataObjectByApplicationId(a);return b[this.WIDGETS]||(b[this.WIDGETS]=[]),b[this.WIDGETS]},getSection:function(a){var b=this._getDataObjectByApplicationId(a);return b[this.SECTION]},getComponents:function(){return this._componentsByCompId}})}),define.component("wysiwyg.viewer.components.tpapps.TPABase",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["scriptLoader","W.Config","W.Viewer","W.TPA"]),b.traits(["wysiwyg.viewer.components.traits.TPAHandlers"]),b.skinParts({iframe:{type:"htmlElement"}}),b.binds(["_handlePageNavigationChange","_onIframeLoad"]),b.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],MIN_SIZE:{w:10,h:10},EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}],dblClick:{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}},_Events:{EDIT_MODE_CHANGE:"WPreviewCommands.WEditModeChanged",PAGE_NAVIGATION_CHANGE:"pageTransitionEnded",SITE_PUBLISHED:"WEditorCommands.Publish",COMPONENT_DELETED:"COMPONENT_DELETED",APP_MESSAGE:"SETTINGS_UPDATED",WINDOW_PLACEMENT_CHANGED:"WINDOW_PLACEMENT_CHANGED"},isTpa:!0}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._initialized=!1,this._appIsAlive=!1,this.setMinW(this.MIN_SIZE.w),this.setMinH(this.MIN_SIZE.h),this.addEvent("resizeEnd",this._onResizeEnd),this._startTime=new Date},isVisible:function(){return!0},isPremiumApp:function(){return!!this._appData&&!!this._appData.vendorProductId},isDemoMode:function(){return!!this._appData&&!!this._appData.demoMode},_onAllSkinPartsReady:function(){this._skinParts.iframe.addEvent("load",this._onIframeLoad),this.addEventListeners()},_onIframeLoad:function(){this._loadTime=(new Date).getMilliseconds()-this._startTime.getMilliseconds(),this.injects().TPA.reportLoadStart(this)},setIFrameSrc:function(a){a?(this._startTime=new Date,this._iframe.src=a):this.onError()},setUrl:function(a){this._iframe&&(this._iframe.src=a)},onError:function(){this.showErrorPage(),LOG.reportError(wixErrors.APPS_OPEN_TIMEOUT,this.$className,"showAppNotAvailable",this._appData.appDefinitionName)},showErrorPage:function(){this._skinParts.iframe.removeEvent("load",this._onIframeLoad),this.setUrl(this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/appNotResponding.html")},render:function(){this._renderIframe()},onDataInitialized:function(){},onPageVisibilityChange:function(a,b){a&&this.fireEvent(this._Events.PAGE_NAVIGATION_CHANGE,b._compId)},addEventListeners:function(){this.injects().Commands.registerCommandListenerByName(this._Events.EDIT_MODE_CHANGE,this,function(){this.handleAddEventListener.apply(this,[this._Events.EDIT_MODE_CHANGE])}),this.injects().Viewer.addEvent(this._Events.PAGE_NAVIGATION_CHANGE,this._handlePageNavigationChange),"site"!==this.resources.W.Viewer.getViewMode()&&window.parent.W.Commands.registerCommandListenerByName(this._Events.SITE_PUBLISHED,this,function(){this.handleAddEventListener.apply(this,[this._Events.SITE_PUBLISHED])})},passAppMessage:function(a){this.handleAddEventListener(this._Events.APP_MESSAGE,a)},passWindowPlacement:function(a){this.handleAddEventListener(this._Events.WINDOW_PLACEMENT_CHANGED,a)},handleAddEventListener:function(a,b){var c,d={intent:"addEventListener",eventType:"",params:{}};switch(a){case"WPreviewCommands.WEditModeChanged":c="EDIT_MODE_CHANGE",d.params={editMode:this._getCurrentEditMode()};break;case"pageTransitionEnded":c="PAGE_NAVIGATION_CHANGE",d.params=this._getPageParameters(b);break;case"WEditorCommands.Publish":c="SITE_PUBLISHED";break;case this._Events.COMPONENT_DELETED:c=a;break;case this._Events.APP_MESSAGE:c=a,d.params=b;break;case this._Events.WINDOW_PLACEMENT_CHANGED:c=a,d.params=b}if(d.eventType=c,this._skinParts.iframe){msgStr="";try{msgStr=JSON.stringify(d)}catch(e){return}this._skinParts.iframe.contentWindow.postMessage(msgStr,"*")}},setQueryParams:function(a){this._queryParams=a},isAppAlive:function(){return this._appIsAlive},getAppDefinitionId:function(){return this._appDefinitionId},getApplicationId:function(){return this._data&&this._data.get("applicationId")},getAppData:function(){return this._appData},getSectionURL:function(){return this.injects().TPA.getSectionURL(this._applicationId)},forceRender:function(){this.getIsDisplayed()&&this._renderIframe(!0)},disposeRegisteredTPA:function(){this.handleAddEventListener.apply(this,[this._Events.COMPONENT_DELETED]),this.injects().Viewer.removeEvent(this._Events.PAGE_NAVIGATION_CHANGE,this._handlePageNavigationChange),this.injects().TPA.getComponentRegistrar().unregister(this),this._view.setStyle("display","none"),this._isSelectable=!1},dispose:function(a){a?this.parent():(this.disposeRegisteredTPA(),setTimeout(function(){this.dispose(!0)}.bind(this),500))},refreshAppData:function(){this._extractAppData()},getPanelInfo:function(a){this._appData.panelInfo?a(this._appData.panelInfo):this.resources.W.TPA.getAppMarketData(this._appData.appDefinitionId,function(b){this._setPanelInfo(b),a(this._appData.panelInfo)}.bind(this))},_setPanelInfo:function(a){a&&(this._appData.panelInfo={},this._appData.panelInfo.title=a.title,this._appData.panelInfo.price=a.price,this._appData.panelInfo.features=a.features,this._appData.panelInfo.upgradeBenefits=a.upgradeBenefits,this._appData.panelInfo.supportInfo=a.supportInfo)},_handlePageNavigationChange:function(a){var b=$$("#"+a)[0].getLogic(),c=b.getPageComponents().map(function(a){return a._compId}).indexOf(this._compId)>-1;(this.getIsDisplayed()||c)&&this.handleAddEventListener(this._Events.PAGE_NAVIGATION_CHANGE,b)},_getPageParameters:function(a){var b={pageName:a._data._data.title,pageId:a._compId,pageUrl:""},c=this._getSiteBaseUrl();return b.pageUrl=""!=c?c+"#!"+b.pageName+"/"+b.pageId:"",b},_getCurrentEditMode:function(){return"PREVIEW"==window.top.W.Editor.getEditMode()?"preview":"editor"},_addCustomQueryString:function(a){if(this._queryParams){var b="";return Object.each(this._queryParams,function(a,c){b+="&"+c+"="+encodeURIComponent(a)}),delete this._queryParams,a+b}return a},_onDataChange:function(){this._initializeWithData()},_extractAppData:function(){if(this._applicationId=this._data.get("applicationId"),this._appData=this.injects().Viewer.getAppDataHandler().getAppData(this._applicationId),this._appData||"site"===W.Viewer.getViewMode())this._appDefinitionId=this._appData.appDefinitionId;else if(this._appDefinitionId=this._data.get("appDefinitionId"),this._appDefinitionId){var a=this.isWidget?W.AppStoreManager.TPA_WIDGET:W.AppStoreManager.TPA_SECTION,b=this._data.get("widgetId");window.parent.W.AppStoreManager.provisionApp(a,this._appDefinitionId,b,function(a){this.injects().Preview.getPreviewManagers().Viewer.getAppDataHandler().registerAppData(a),this.forceRender()}.bind(this))}},_initializeWithData:function(){this._initialized||(this._extractAppData(),this.injects().Viewer.isPublicMode()&&LOG.reportEvent(wixEvents.APPS_FLOW_APP_LOADED_ON_VIEWER,{g1:this._appDefinitionId+" "+window.location.href,i1:this._applicationId}),this.injects().TPA.getComponentRegistrar().register(this),this._initialized=!0,this.onDataInitialized(this._appData))},_editModeChanged:function(a){this._editMode=a},_onResize:function(){this.isRendered()&&this._initialized&&this.parent()},_onResizeEnd:function(){this._appIsAlive&&this._skinParts&&this._renderIfReady(),this._wCheckForSizeChangeAndFireAutoSized(3)},_changeSize:function(a,b){var c=this.getWidth(),d=this.getHeight(),e=a.x||a.w||a.width,f=a.y||a.h||a.height;e&&e!=c&&this.setWidth(e,!1,!f&&b),f&&f!=d&&this.setHeight(f,!1,b),this._wCheckForSizeChangeAndFireAutoSized(1)},_renderIframe:function(a){this._iframe?this._updateIframe(a):this._createIframe()},_createIframe:function(){this._iframe=this._skinParts.iframe,this._updateIframe(!0)},_updateIframe:function(a){this._setBasicIframeParams(a)},_setBasicIframeParams:function(a){a=a||!1;var b=this._getUrl(a);this.isVisible()&&(a||this._iframe.src!==b)&&this.setIFrameSrc(b)},getIFrame:function(){return this._iframe}})}),define.component("wysiwyg.viewer.components.tpapps.TPAFixedWidget",function(a){var b=a;b.inherits("wysiwyg.viewer.components.tpapps.TPAWidget"),b.resources(["W.Utils"]),b.statics({DEFAULT_COORDINATES:{top:"auto",left:"auto",bottom:"auto",right:"auto"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._$top="auto",this._$left="auto",this._$bottom="auto",this._$right="auto"},initComponentLayout:function(){this._view.setStyle("visibility","visible"),this.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout);var a=["x","y","width","height"],b=0;for(b;b<a.length;b++){var c=a[b],d=this._view.get(c);if(null!=d&&""!=d){var e="set"+c.capitalize();this[e](d,!0)}}this._view.setStyle("position","fixed"),this.saveCurrentDimensions(),this.saveCurrentCoordinates()},getLayoutMode:function(){return"FIXED"},_setCssPosition:function(a,b){var c="auto"==a||!a&&isNaN(a),d=["top","left","bottom","right"],e="px";if(!d.contains(b))return this.resources.W.Utils.debugTrace("fixedPositionComponent","_setCssPostion",b+" passed as "+a),void 0;if(a&&a.split&&(e=a.split(parseInt(a,10)).join(""),"%"!==e&&(e="px")),a=c?"auto":parseInt(a,10),this["_$"+b]!=a){if(!c&&isNaN(a))return this.resources.W.Utils.debugTrace("fixedPositionComponent","set"+b,"NaN passed as value"),void 0;this["_$"+b]=a+e,this._view.setStyle(b,a+e),"left"==b&&(this._$x=c||"%"==e?this._view.getPosition().x:a),"top"==b&&(this._$y=c||"%"==e?this._view.getPosition().y:a),this.onMovement()}},setX:function(a){this.setLeft(a),this.setRight("auto")},setY:function(a){this.setTop(a),this.setBottom("auto")},getRight:function(){return this._$right},setRight:function(a){this._setCssPosition(a,"right")},getBottom:function(){return this._$bottom},setBottom:function(a){this._setCssPosition(a,"bottom")},getLeft:function(){return this._$left},setLeft:function(a){if(this._setCssPosition(a,"left"),"50%"===a){var b=this.getWidth()/2;this._view.setStyle("margin-left",-b)}},setTop:function(a){if(this._setCssPosition(a,"top"),"50%"===a){var b=this.getHeight()/2;this._view.setStyle("margin-top",-b)}},getTop:function(){return this._$top},setWidth:function(a,b,c){var d,e,f=a;this._isPercent(a)&&(d=parseFloat(a)/100,e=window.getSize().x,f=Math.round(e*d)),this.parent(f,b,c)},setHeight:function(a,b,c){var d,e,f=a;this._isPercent(a)&&(d=parseFloat(a)/100,e=window.getSize().y,f=Math.round(e*d)),this.parent(f,b,c)},setPosition:function(a,b,c,d){this.setTop(a),this.setLeft(b),this.setBottom(c),this.setRight(d)},setCoordinates:function(a){return a=Object.merge(this.DEFAULT_COORDINATES,a||{}),this._changeSize({width:a.x,height:a.y},!0),this.setPosition(a.top,a.left,a.bottom,a.right),a},_onAutoSized:function(){this.fireEvent("autoSizeChange")},_isPercent:function(a){return"string"==typeof a&&"%"==a.split(parseFloat(a)).join("")}})}),define.component("wysiwyg.viewer.components.tpapps.TPAModal",function(a){a.binds(["_onDispose"]),a.inherits("wysiwyg.viewer.components.tpapps.TPAWidget"),a.statics({DEFAULT_URL:"http://sslstatic.wix.com/services/js-sdk/1.16.0/html/modal.html"}),a.skinParts({blockingLayer:{type:"htmlElement"},dialog:{type:"htmlElement"},x:{type:"htmlElement"}}),a.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this._rawUrl=c.url||this.DEFAULT_URL,this._url=null,this._width=c.width,this._height=c.height,this.isVolatile=!0,this._onClose=c.onClose},getAcceptableDataTypes:function(){return["TPAWidget","TPA"]},_onAllSkinPartsReady:function(){this._skinParts.x.addEvent("click",this._onDispose),this._skinParts.blockingLayer.addEvent("click",this._onDispose)},render:function(){if(this._width>0){var a=this._width/2;this._skinParts.dialog.setStyles({width:this._width,"margin-left":-a})}if(this._height>0){var b=this._height/2;this._skinParts.dialog.setStyles({height:this._height,"margin-top":-b})}this.parent()},_getUrl:function(){var a=this._url;return a||(a=W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData)),a},_onDispose:function(){this._onClose&&this._onClose(),this._view.dispose()},_onEditModeChanged:function(){this._onDispose()},handleCloseWindow:function(a){this._onClose&&this._onClose(a.msgData),this.dispose()},setHeight:function(a,b,c){if(0!=c&&(c=!0),a=parseInt(a,10),isNaN(a))return W.Utils.debugTrace("WbaseComp","setHeight","NaN passed as value"),void 0;a=this._limitHeight(a);var d=this._skinParts.dialog;(this._$height!=a||b)&&(this._$height=a,d.setStyle("height",this._$height+"px"),this.flushPhysicalHeightCache(),c&&this._onResize())}})}),define.component("wysiwyg.viewer.components.tpapps.TPAPlaceholder",function(a){var b=a;b.inherits("wysiwyg.viewer.components.WPhoto"),b.skinParts({img:{type:"core.components.image.ImageNew",dataRefField:"*"}}),b.fields({propertiesSchemaName:"WPhotoProperties",EDITOR_META_DATA:{general:{title:"App Placeholder",settings:!0,design:!1},custom:[{label:"SIDE_BTN_MARKET",command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}}})}),define.component("wysiwyg.viewer.components.tpapps.TPAPopup",function(a){a.inherits("wysiwyg.viewer.components.tpapps.TPAFixedWidget"),a.resources([]),a.binds(["_onResize","_onDispose"]),a.statics({FIXED_OFFSET:2,MIN_EDGE_SIZE:50}),a.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this._rawUrl=c.url,this._url=null,this._popupSize=c.popupSize?c.popupSize:{x:c.width,y:c.height},this._origin=c.origin||"",this._placement=c.placement||"CENTER",this._openPosition=c.openPosition||{top:0,left:0},this._openSize=c.openSize,this.isVolatile=!0,this._origPopupSize=this._popupSize,this._onClose=c.onClose},getAcceptableDataTypes:function(){return["TPAWidget","TPA"]},_onAllSkinPartsReady:function(){this._skinParts.x&&this._skinParts.x.addEvent("click",this._onDispose)},render:function(){this.parent();var a=this.calcCoordinates();this.setCoordinates(a)},calcCoordinates:function(){var a={};switch(this._origin){case"RELATIVE":a=Object.merge(this._getRelativeCoords(),this._popupSize),a=this._applyRelativeOffsets(a),a=this._validateRelativeCoordinates(a);break;case"FIXED":default:a=Object.merge(this._getFixedCoords(),this._popupSize),a=this._applyFixedOffsets(a),a=this._validateFixedCoordinates(a)}return a.x||(a.x=200),a.y||(a.y=200),a=this._validateMinSize(a),a=this._validateNegtaivePosition(a)},_validateMinSize:function(a){return(a.x<=this.MIN_EDGE_SIZE||a.y<=this.MIN_EDGE_SIZE)&&(a=this._fallbackToCenterMin(a)),a},_validateNegtaivePosition:function(a){return("number"==typeof a.top&&a.top<0||"number"==typeof a.left&&a.left<0||"number"==typeof a.bottom&&a.bottom<0||"number"==typeof a.right&&a.right<0)&&(a=this._fallbackToCenterMin(a)),a},_validateFixedCoordinates:function(a){var b=window.getWidth(),c=window.getHeight();return a.x>=b&&(a.y=b-2*this.FIXED_OFFSET),a.y>=c&&(a.y=c-2*this.FIXED_OFFSET),a},_validateRelativeCoordinates:function(a){return a=this._validateMaxSizeLimit(a),this._isTop()||this._isBottom()?a=this._getVerticalCroppedCoords(a):this._isCenter()&&(a=this._getHorizontalCroppedCoords(a)),this._getFixedWidthHeightCoords(a)},_getFixedWidthHeightCoords:function(a){for(var b in a)a[b]<0&&"x"!=b&&"y"!=b&&(("top"===b||"botom"===b)&&(a.y=a.y+a[b]),("right"===b||"left"===b)&&(a.x=a.x+a[b]),a[b]=0);return a},_fallbackToCenterMin:function(a){return a.top="50%",a.left="50%",a.x=this._origPopupSize.x,a.y=this._origPopupSize.y,this._validateMaxSizeLimit(a)},_getVerticalCroppedCoords:function(a){var b=window.getWidth(),c=window.getHeight();if(this._isTop()){var d=this._openPosition.y>this._popupSize.y;d||(a.y=this._openPosition.y-2*this.FIXED_OFFSET,a.top=this.FIXED_OFFSET)}else if(this._isBottom()){var d=c-(this._openPosition.y+this._openSize.y)>this._popupSize.y;d||(a.y=c-(this._openPosition.y+this._openSize.y)-2*this.FIXED_OFFSET)}if(this._isRight()){var e=b-(this._openPosition.x+this._openSize.x)>this._popupSize.x;e||(a.x=b-(this._openPosition.x+this._openSize.x)-10)}else if(this._isLeft()){var e=b-(this._openPosition.x-this._popupSize.x)>this._popupSize.x;e||(a.x=b-this._openPosition.x,a.left=this._openPosition.x-a.x)}else if(this._isCenter()){var e=b-this._openPosition.x>this._popupSize.x;e||(a.x=b-this._openPosition.x),a.left=a.left=this._openPosition.x-a.x/2+this._openSize.x/2}return a},_applyRelativeOffsets:function(a){return this._isTop()&&(a.top-=this.FIXED_OFFSET),this._isBottom()&&(a.top+=this.FIXED_OFFSET),this._isLeft()&&(a.left-=this.FIXED_OFFSET),this._isRight()&&(a.left+=this.FIXED_OFFSET),a},_applyFixedOffsets:function(a){return this._isTop()&&(a.top+=this.FIXED_OFFSET),this._isBottom()&&(a.top+=this.FIXED_OFFSET),this._isLeft()&&(a.left+=this.FIXED_OFFSET),this._isRight()&&(a.left+=this.FIXED_OFFSET),a},_getHorizontalCroppedCoords:function(a){var b=window.getWidth();if(this._isRight()){var c=b-(this._openPosition.x+this._openSize.x)>this._popupSize.x;c||(a.x=b-(this._openPosition.x+this._openSize.x)-10)}else if(this._isLeft()){var c=b-(this._openPosition.x-this._popupSize.x)>this._popupSize.x;c||(a.x=b-this._openPosition.x,a.left=this._openPosition.x-a.x)}return a},_validateMaxSizeLimit:function(a){var b=window.getWidth()/2,c=window.getHeight()/2;return a.x=a.x%b==a.x?a.x:b,a.y=a.y%c==a.y?a.y:c,a},_onDispose:function(){this._onClose&&this._onClose(),this._view.dispose()},_onEditModeChanged:function(){this._onDispose()},_getFixedCoords:function(){var a={};switch(this._placement){case"TOP_LEFT":a={left:0,top:0};break;case"TOP_RIGHT":a={right:0,top:0};break;case"BOTTOM_RIGHT":a={right:0,bottom:0};break;case"BOTTOM_LEFT":a={left:0,bottom:0};break;case"TOP_CENTER":a={top:0,left:"50%"};break;case"CENTER_RIGHT":a={top:"50%",right:0};break;case"BOTTOM_CENTER":a={bottom:0,left:"50%"};break;case"CENTER_LEFT":a={left:0,top:"50%"};break;default:a={top:"50%",left:"50%"}}return a},_getRelativeCoords:function(){var a={},b=this._openPosition,c=this._openSize,d=this._popupSize,e=b.x,f=b.y,g=c.x,h=c.y,i=d.x,j=d.y;switch(this._placement){case"TOP_LEFT":a={top:f-j,left:e-i};break;case"TOP_RIGHT":a={top:f-j,left:e+g};break;case"BOTTOM_RIGHT":a={top:f+h,left:e+g};break;case"BOTTOM_LEFT":a={top:f+h,left:e-i};break;case"TOP_CENTER":a={top:f-j,left:this._getRelativeCenterLeft(e,g,i)};break;case"CENTER_RIGHT":a={top:this._getRelativeCenterTop(f,h,j),left:e+g};break;case"BOTTOM_CENTER":a={top:f+h,left:this._getRelativeCenterLeft(e,g,i)};break;case"CENTER_LEFT":a={top:this._getRelativeCenterTop(f,h,j),left:e-i};break;default:a={top:this._getRelativeCenterTop(f,h,j),left:this._getRelativeCenterLeft(e,g,i)}}return a},_getRelativeCenterTop:function(a,b,c){return a+b/2-c/2},_getRelativeCenterLeft:function(a,b,c){return a+b/2-c/2},_getUrl:function(){var a=this._url;return a||(a=W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData)),a},_onResize:function(){this.parent()},handleCloseWindow:function(a){this._onClose&&this._onClose(a.msgData),this.dispose()},_isTop:function(){return this._placement.indexOf("TOP")>=0},_isBottom:function(){return this._placement.indexOf("BOTTOM")>=0},_isLeft:function(){return this._placement.indexOf("LEFT")>=0},_isRight:function(){return this._placement.indexOf("RIGHT")>=0},_isCenter:function(){return this._placement.indexOf("CENTER")>=0}})}),define.component("wysiwyg.viewer.components.tpapps.TPASection",function(a){var b=a;b.inherits("wysiwyg.viewer.components.tpapps.TPABase"),b.dataTypes(["TPA"]),b.methods({isPage:!0,initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this._nodeReady=!1},render:function(){this.parent()},isVisible:function(){return this._nodeReady},onPageVisibilityChange:function(a){a===!0&&this._nodeReady===!1&&(this._nodeReady=!0,this._renderIframe())},onDataInitialized:function(a){var b=a.sectionRefreshOnWidthChange;b||this.removeEvent("resizeEnd",this._onResizeEnd)},_getUrl:function(a){if(a||!this._url){if(!this._initialized)return"";var b=this._appData.sectionUrl,c=this.injects().TPA.getURLBuilder().buildStateFullUrl(b,["instance","section-url","target","width","viewMode","locale","cacheKiller"],this,this._appData);this._url=this._addCustomQueryString(c)}return this._url},handleAppStateChanged:function(a){this.injects().Utils.hash.setHashExtData(a)},isDeleteable:function(){return!1},isDeleteableRecurse:function(){return!1},isDuplicatable:function(){return!1},canMoveToOtherScope:function(){return!1},isContainable:function(){return!1}})}),define.component("wysiwyg.viewer.components.tpapps.TPAWidget",function(a){var b=a;b.inherits("wysiwyg.viewer.components.tpapps.TPABase"),b.dataTypes(["TPAWidget"]),b.methods({isWidget:!0,initialize:function(a,b,c){this.parent(a,b,c),this._isSelectable=!0},getWidgetId:function(){return this._data.get("widgetId")},onDataInitialized:function(){var a=this.getWidgetId(),b=this.injects().Viewer.getAppDataHandler(),c=b.getWidgetProperty(this._applicationId,a,"refreshOnWidthChange");c||this.removeEvent("resizeEnd",this._onResizeEnd)},_getUrl:function(a){if(a||!this._url){var b=this.getWidgetId(),c=this.injects().Viewer.getAppDataHandler().getWidgetData(this._applicationId,b),d=c.widgetUrl,e=this.injects().TPA.getURLBuilder().buildStateLessUrl(d,["instance","section-url","target","width","viewMode","locale","cacheKiller"],this,this._appData);this._url=this._addCustomQueryString(e)}return this._url},handleAppStateChanged:function(){},handleClosePopup:function(){},setIFrameSrc:function(a){this._iframe.src=a,this._url=this._iframe.src},isSelectable:function(){return this._isSelectable},isDeleteableRecurse:function(){return!0}})}),define.component("wysiwyg.viewer.components.tpapps.TPAComponent",function(a){var b=a;b.inherits("wysiwyg.viewer.components.tpapps.TPABase"),b.resources(["W.Events","topology"]),b.binds(["_postMessageToIframe"]),b.fields({EDITOR_META_DATA:{general:{title:"App Container",settings:!0,design:!1}},isTpa:!1}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c)},_onDataChange:function(a,b){if(this._skinParts){if(void 0!==this._propertiesSchemaName&&a._dataType===this._propertiesSchemaName)return this._sendPropertiesChangeMessage(a,b);this._postMessageToIframe()}},_postMessageToIframe:function(){var a=this;this._getMessageData(function(b){a._onBeforePostMessage(b),a.handleAddEventListener(a._Events.APP_MESSAGE,b)})},_sendPropertiesChangeMessage:function(){this._postMessageToIframe()},_onIframeLoad:function(){this._postMessageToIframe()},handleAppStateChanged:function(a){try{a=JSON.parse(a)}catch(b){a={}}a.cmd&&this[a.cmd+"Command"]&&this[a.cmd+"Command"].apply(this,a.args)},_onBeforePostMessage:function(){},_getMessageData:function(){},_getUrl:function(){return this.resources.topology.wysiwyg+"/html/external/tpacomp.html"},dispose:function(){this.disposeRegisteredTPA(),this.parent(!0)}})}),define.Class("wysiwyg.viewer.components.traits.TPAHandlers",function(a){var b=a;b.inherits("wysiwyg.viewer.components.traits.TPAHandlersBase"),b.statics({DEFAULTS:{POPUP_COORDINATES:{NORMAL:{top:"auto",left:"auto",bottom:"auto",right:"auto",width:500,height:500},MODAL:{top:"50%",left:"50%",bottom:"auto",right:"auto",width:500,height:500}}}}),b.resources(["W.Components","W.Data"]),b.binds(["handleSiteInfo"]),b.methods({initialize:function(){this._datam=this.resources.W.Data},handleHeightChanged:function(a){var b="number"==typeof a?a:a.msgData.height;this.handleChangeAppSize({height:b})},handleChangeAppSize:function(a){(this.injects().Viewer.isPublicMode()||"PREVIEW"===this.injects().Viewer.getEditorMode())&&(a.width=null,a.w=null,a.x=null),this._changeSize(a)},handleAppSettingsClose:function(a){this.handleCloseWindow(a)},handleOpenPopup:function(a){var b,c,d,e,f,g=this.injects().Viewer.getSiteNode();c="wysiwyg.viewer.components.tpapps.TPAPopup",d="wysiwyg.viewer.skins.TPAPopupSkin",f=this._data,e=this._getPopupArgs(a.msgData||a,a.callback),b=this.resources.W.Components.createComponent(c,d,f,e,null,null),b.insertInto(g)},handleOpenModal:function(a){var b=this.injects().Viewer.getSiteNode();this._clearModals(b);var c,d,e,f,g,h=a.msgData||a;d="wysiwyg.viewer.components.tpapps.TPAModal",e="wysiwyg.viewer.skins.TPAModalSkin",g=this._data,f={url:h.url,width:h.width,height:h.height,onClose:a.callback},c=this.resources.W.Components.createComponent(d,e,g,f,null,null),c.insertInto(b)},handleGetSitePages:function(a){var b=this.resources.W.Data.getDataByQuery("#MAIN_MENU"),c=b.getItems()||[],d=this._getSitePages(c);a.callback(d)},handleNavigateToPage:function(a){a.msgData.pageId&&"editor"!==this.resources.W.Viewer.getViewMode()&&this.resources.W.Viewer.goToPage(a.msgData.pageId)},handleSmRequestLogin:function(a){var b=this.injects().SiteMembers;b.isServiceProvisioned()&&(b.isApiReady()?this.injects().Commands.executeCommand("WViewerCommands.SiteMembers.Open",{form:"login",authCallback:a.callback}):this.callLater(this.handleSmRequestLogin,a))},handleSmCurrentMember:function(a){var b=this.injects().SiteMembers;b.getMemberDetails(function(b){a.callback(b)},function(){a.callback(null)})},handleScrollBy:function(a){var b=this._getTopWindow();b.scrollBy(a.msgData.x,a.msgData.y)},handleScrollTo:function(a){var b=this._getTopWindow();b.scrollTo(a.msgData.x,a.msgData.y)},_clearModals:function(a){var b=a.getChildren("[comp=wysiwyg.viewer.components.tpapps.TPAModal]");b.dispose()},_handleOpenPopup:function(a,b,c){var d=this.injects().Viewer.getSiteNode();this._clearModals(d);var e,f,g,h,i;f="wysiwyg.viewer.components.tpapps.TPAPopup",g="wysiwyg.viewer.skins.TPAPopupSkin",i=this._data,h={url:a,width:c.width,height:c.height},e=this.resources.W.Components.createComponent(f,g,i,h,null,null),e.insertInto(d)},_getPopupArgs:function(a,b){return this.isPage?"FIXED":a.position.origin,{dataItem:this._data,url:a.url,origin:a.position.origin,placement:a.position.placement,openPosition:this._view.getPosition(),openSize:this._view.getSize(),popupSize:{x:a.width||200,y:a.height||200},onClose:b}},_getModalCoords:function(a,b){return Object.merge(this.DEFAULTS.POPUP_COORDINATES.MODAL,{width:a,height:b}||{})},_getMetadataParameter:function(a,b){var c=$$("meta["+(b||"name")+"='"+a+"']"),d="";if(c&&c.length>0){var e=c.get("content");e.length>0&&(d=e[0])}return d},_getTopWindow:function(){var a=window;return"preview"===W.Viewer.getViewMode()&&(a=window.parent),a}})}),define.experiment.newComponent("wysiwyg.viewer.components.tpapps.TPA3DGallery.TPA3DGallery.New",function(a){a.inherits("wysiwyg.viewer.components.tpapps.TPAGallery"),a.methods({_getUrl:function(){return this.resources.topology.wysiwyg+"/html/external/Slicebox/TPA3DGallery.html?compId="+this.getComponentId()}})}),define.experiment.newComponent("wysiwyg.viewer.components.tpapps.TPAMusicGallery.TPA3DGallery.New",function(a){a.inherits("wysiwyg.viewer.components.tpapps.TPAGallery"),a.methods({_getUrl:function(){return this.resources.topology.wysiwyg+"/html/external/jqueryuicoverflow/index.html?compId="+this.getComponentId()}})}),define.experiment.newComponent("wysiwyg.editor.components.panels.TPAFrameGalleryProperties.TPA3DGallery.New",function(a){var b=a;b.inherits("wysiwyg.editor.components.panels.base.AutoPanel"),b.traits(["core.editor.components.traits.DataPanel","core.editor.components.traits.GalleryDataPanel"]),b.dataTypes(["ImageList"]),b.propertiesSchemaType("SlideShowGalleryProperties"),b.skinParts({content:{type:"htmlElement"}}),b.methods({_createFields:function(){var a=this._previewComponent.getComponentProperties()._schema;a.transDuration;var b=a.autoplayInterval||{minimum:0,maximum:30};this.addInputGroupField(function(){this.addListEditorButton(W.Resources.get("EDITOR_LANGUAGE","GALLERY_ORGANIZE_PHOTOS"),this._data,"TPA3DGallery")}),this.addInputGroupField(function(){this.addCheckBoxField(W.Resources.get("EDITOR_LANGUAGE","SLIDESHOW_GALLERY_AUTOPLAY")).bindToProperty("autoplay"),this.addSliderField(W.Resources.get("EDITOR_LANGUAGE","SLIDESHOW_GALLERY_INTERVAL"),b.minimum,b.maximum,.05,!1,!0).bindToProperty("autoplayInterval")}),this.createGeneralGalleryPropertiesGroup(!1)}})}),define.experiment.dataItem("COMPONENT_TYPES.TPA3DGallery.New",function(a){var b=a;return b.merge({items:{addTPA3DGallery:{component:function(){return{comp:"wysiwyg.viewer.components.tpapps.TPA3DGallery",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",data:{type:"ImageList"},dataRefs:{items:{isList:!0,items:[{data:{type:"Image",title:"Water Droplets",uri:"cd6a81b7d29d88425609ecc053a00d16.jpg",description:"Describe your image here",width:1e3,height:750}},{data:{type:"Image",title:"Budding Tree",uri:"44dab8ba8e2b5ec71d897466745a1623.jpg",description:"Describe your image here",width:1e3,height:750}},{data:{type:"Image",title:"Fallen Apples",uri:"8dfce587e3f99f17bba2d3346fea7a8d.jpg",description:"Describe your image here",width:758,height:569}},{data:{type:"Image",title:"Cherry Blossom",uri:"3dcc6f56be1f8507181d0197e52d09e8.jpg",description:"Describe your image here",width:1e3,height:750}},{data:{type:"Image",title:"Ray of Light",uri:"8fed9ef13904fb85b6b12092c269a465.jpg",description:"Describe your image here",width:750,height:563}},{data:{type:"Image",title:"Bloom",uri:"24bba47f40f8473a534ae0301bf748c9.jpg",description:"Describe your image here",width:1e3,height:750}},{data:{type:"Image",title:"Dew",uri:"8dde68848c4daae3a6905dc6a17d270e.jpg",description:"Describe your image here",width:800,height:600}},{data:{type:"Image",title:"Tranquil forest",uri:"568544c06dafc9d2ab6f4f4496e7d7b9.jpg",description:"Describe your image here",width:800,height:600}},{data:{type:"Image",title:"Lilly Pond",uri:"a3ae91861f93fde1b8917291180c5fe0.jpg",description:"Describe your image here",width:700,height:525}}]}},layout:{width:960,height:600},props:{type:"SlideShowGalleryProperties",galleryImageOnClickAction:"disabled"}}
}},addTPA3DCarousel:{component:function(){return{comp:"wysiwyg.viewer.components.tpapps.TPA3DCarousel",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",data:{type:"ImageList"},dataRefs:{items:{isList:!0,items:[{data:{type:"Image",title:"Water Droplets",uri:"cd6a81b7d29d88425609ecc053a00d16.jpg",description:"Describe your image here",width:1e3,height:750}},{data:{type:"Image",title:"Budding Tree",uri:"44dab8ba8e2b5ec71d897466745a1623.jpg",description:"Describe your image here",width:1e3,height:750}},{data:{type:"Image",title:"Fallen Apples",uri:"8dfce587e3f99f17bba2d3346fea7a8d.jpg",description:"Describe your image here",width:758,height:569}},{data:{type:"Image",title:"Cherry Blossom",uri:"3dcc6f56be1f8507181d0197e52d09e8.jpg",description:"Describe your image here",width:1e3,height:750}},{data:{type:"Image",title:"Ray of Light",uri:"8fed9ef13904fb85b6b12092c269a465.jpg",description:"Describe your image here",width:750,height:563}},{data:{type:"Image",title:"Bloom",uri:"24bba47f40f8473a534ae0301bf748c9.jpg",description:"Describe your image here",width:1e3,height:750}},{data:{type:"Image",title:"Dew",uri:"8dde68848c4daae3a6905dc6a17d270e.jpg",description:"Describe your image here",width:800,height:600}},{data:{type:"Image",title:"Tranquil forest",uri:"568544c06dafc9d2ab6f4f4496e7d7b9.jpg",description:"Describe your image here",width:800,height:600}},{data:{type:"Image",title:"Lilly Pond",uri:"a3ae91861f93fde1b8917291180c5fe0.jpg",description:"Describe your image here",width:700,height:525}}]}},layout:{width:960,height:600},props:{type:"SlideShowGalleryProperties",galleryImageOnClickAction:"disabled"}}}},addTPAMusicGallery:{component:function(){return{comp:"wysiwyg.viewer.components.tpapps.TPAMusicGallery",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",data:{type:"ImageList"},dataRefs:{items:{isList:!0,items:[{data:{type:"Image",title:"Purple flower",uri:"86c6c5_f9afbb75fddb18f73f20174706b02a0f.jpg",description:"Some description here",width:699,height:800}},{data:{type:"Image",title:"Yellow flowers",uri:"86c6c5_097d39a780549ec28c1a05570925cc73.jpg",description:"Some description here",width:4e3,height:3e3}},{data:{type:"Image",title:"White flower",uri:"86c6c5_8c954aebebdbf6c06e8efe39b75d15fc.jpg",description:"Some description here",width:2240,height:1488}},{data:{type:"Image",title:"White flower",uri:"86c6c5_09a0364d830144211760e98b6cc933e7.jpg",description:"Some description here",width:2240,height:1488}},{data:{type:"Image",title:"White flower",uri:"86c6c5_8aab4eef0d2679fbba0123242312884d.jpg",description:"Some description here",width:2240,height:1488}},{data:{type:"Image",title:"White flower",uri:"86c6c5_3d321883c35224fed81fb204c9bcbeed.jpg",description:"Some description here",width:2240,height:1488}}]}},layout:{width:960,height:600},props:{type:"SlideShowGalleryProperties",galleryImageOnClickAction:"disabled"}}}}}})}),define.experiment.dataItem("ADD_COMPONENT_TABS.TPA3DGallery.New",function(a){var b=a;return b.merge({items:{TPA3DGallery:{type:"Button",category:"gallery",iconSrc:"buttons/3d_gallery.png",label:"ADD_TPA3DSLIDESHOW_GALLERY",command:"WEditorCommands.AddComponent",commandParameter:{compType:"addTPA3DGallery",styleId:""},order:91},TPA3DCarousel:{type:"Button",category:"gallery",iconSrc:"buttons/carousel_gallery.png",label:"ADD_TPACAROUSEL_GALLERY",command:"WEditorCommands.AddComponent",commandParameter:{compType:"addTPA3DCarousel",styleId:""},order:91}}})}),define.experiment.dataItem("STYLES.TPA3DGallery.New",function(a){var b=a;return b.merge({styleItems:{"wysiwyg.viewer.components.tpapps.TPA3DGallery":["tfg1"],"wysiwyg.viewer.components.tpapps.TPA3DCarousel":["tfc1"],"wysiwyg.viewer.components.tpapps.TPAMusicGallery":["tfmg1"]}})}),define.experiment.dataItem("SKINS.TPA3DGallery.New",function(a){var b=a;return b.merge({components:{"wysiwyg.viewer.components.tpapps.TPA3DGallery":["wysiwyg.viewer.skins.TPAWidgetSkin"],"wysiwyg.viewer.components.tpapps.TPA3DCarousel":["wysiwyg.viewer.skins.TPAWidgetSkin"],"wysiwyg.viewer.components.tpapps.TPAMusicGallery":["wysiwyg.viewer.skins.TPAWidgetSkin"]}})}),define.experiment.dataItem("PROPERTY_PANELS.TPA3DGallery.New",function(a){return a.merge({items:[{dataType:"ImageList",compType:"wysiwyg.viewer.components.tpapps.TPA3DGallery",panelCompType:"wysiwyg.editor.components.panels.TPAFrameGalleryProperties",panelSkinType:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"},{dataType:"ImageList",compType:"wysiwyg.viewer.components.tpapps.TPA3DCarousel",panelCompType:"wysiwyg.editor.components.panels.TPAFrameGalleryProperties",panelSkinType:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"},{dataType:"ImageList",compType:"wysiwyg.viewer.components.tpapps.TPAMusicGallery",panelCompType:"wysiwyg.editor.components.panels.TPAFrameGalleryProperties",panelSkinType:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"}]})}),define.experiment.dataItem("HELP_IDS.TPA3DGallery.New",function(a){var b=a;return b.merge({items:{COMPONENT_PANEL_TPA3DGallery:"/node/17968",COMPONENT_PANEL_TPA3DCarousel:"/node/17969"}})}),define.experiment.component("wysiwyg.viewer.components.tpapps.TPABase.TPAExtensions.New",function(a,b){var c=a,d=b;c.statics({EXTENSIONS_FOOTER_HEIGHT:50}),c.methods({_onAllSkinPartsReady:d.after(function(){this._hasExtensions()&&this.EDITOR_META_DATA.custom.push({label:"TPA_APP_EXTENSIONS",command:"WEditorCommands.OpenTPAAppExtensionsDialog",commandParameter:this._appData})}),_hasExtensions:function(){return this._appData.widgets&&(this.isWidget&&Object.keys(this._appData.widgets).length>1||!this.isWidget&&Object.keys(this._appData.widgets).length>0)}})}),define.experiment.component("wysiwyg.viewer.components.tpapps.TPAFixedWidget.TPAGlued.New",function(a,b){var c=a;c.methods({isFixedPositioned:function(){return!0},_setCssPosition:function(a,b){var c="auto"==a||!a&&isNaN(a),d=["top","left","bottom","right"],e="number"==typeof a?"px":"";if(!d.contains(b))return W.Utils.debugTrace("fixedPositionComponent","_setCssPostion",b+" passed as "+a),void 0;if(!c&&a&&a.split&&(e=a.split(parseInt(a,10)).join(""),"%"!==e&&(e="px")),a=c?"auto":parseInt(a,10),this["_$"+b]!=a){if(!c&&isNaN(a))return W.Utils.debugTrace("fixedPositionComponent","set"+b,"NaN passed as value"),void 0;this["_$"+b]=a+e,this._view.setStyle(b,a+e),"left"==b&&(this._$x=c||"%"==e?this._view.getPosition().x:a),"top"==b&&(this._$y=c||"%"==e?this._view.getPosition().y:a),this.onMovement()}},_isLeftPositioned:function(){return"auto"!==this.getLeft()},_isHorizCentred:function(){return"50%"===this.getLeft()},_isVertCentred:function(){return"50%"===this.getTop()},_isRightPositioned:function(){return"auto"!==this.getRight()},_isTopPositioned:function(){return"auto"!==this.getTop()},_isSideCentered:function(){return this._isVertCentred()&&(this._isLeftPositioned()||this._isRightPositioned())},_isBottomPositioned:function(){return"auto"!==this.getBottom()}})}),define.experiment.newComponent("wysiwyg.viewer.components.tpapps.TPAGluedWidget.TPAGlued.New",function(a){var b=a;b.inherits("wysiwyg.viewer.components.tpapps.TPAFixedWidget"),b.statics({DEF_PLACEMENT:"BOTTOM_RIGHT",DEF_WIDTH:200,DEF_HEIGHT:200,TOP_STICKY_AREA:120,SIDE_STICKY_AREA:300,CENTER_MARGIN_VALUE:0}),b.propertiesSchemaType("TPAGluedProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1,disableMoveForward:!0,disableMoveBackward:!0},custom:[{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}],dblClick:{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[];var d=this;resource.getResourceValue("W.Viewer",function(a){a.isSiteReady()?d._makeRoomForAd():a.addEvent("SiteReady",function(){d._makeRoomForAd()})})},render:function(){this.setCoordinates(this._coordinates),this.parent()},initComponentLayout:function(){this.parent(),this._view.addClass("Z-FIXED-COMPS");var a=this;resource.getResourceValue("W.Viewer",function(b){b.isPublicMode()&&a._addTransitionClass()})},_addTransitionClass:function(){this._view.addClass("TransitionSize"),this._skinParts.iframe.addClass("TransitionSize")},_removeTransitionClass:function(){this._view.removeClass("TransitionSize"),this._skinParts.iframe.removeClass("TransitionSize")},setCoordinates:function(a){this.parent(this._coordinates||a),this._setMarginOffset()},setPlacment:function(a,b,c){var d=this.getComponentProperties(),e=a||this._placement||this.DEF_PLACEMENT;this._placement!==e?(this._placement=a||this._placement||this.DEF_PLACEMENT,this._horizontalMargin=this.CENTER_MARGIN_VALUE,this._verticalMargin=this.CENTER_MARGIN_VALUE):(this._horizontalMargin=+c||0,this._verticalMargin=+b||0),d.set("placement",this._placement),d.set("horizontalMargin",this._horizontalMargin),d.set("verticalMargin",this._verticalMargin),this._coordinates=this._getGluedWidgetCoordinates(),this.setCoordinates(this._coordinates)},_setMarginOffset:function(a){var b=a?a.width:this.getWidth(),c=a?a.height:this.getHeight();this._isHorizCentred()?this._handleHorizontalCentredPlacement(b):this._isVertCentred()?this._handleVerticalCenteredPlacement(c):this._view.setStyle("margin","0px")},_pxToPrecentWidth:function(a){return 100*(a/window.getSize().x)},_pxToPrecentHeight:function(a){return 100*(a/window.getSize().y)},_setTopBottomMargin:function(a,b,c){var d=this._view.style;d.top=a,d.bottom=b,d.margin=c},_setLeftRightMargin:function(a,b,c){var d=this._view.style;d.left=a,d.right=b,d.margin=c},_verticalRelativePlacement:function(a,b){var c=a/2,d=this._pxToPrecentHeight(b-2*this.TOP_STICKY_AREA)/2,e=0-c-this._verticalMargin*c,f=d*this._verticalMargin+50+"%";this._setTopBottomMargin(f,"auto",e+"px 0 0 0")},_bottomStickyVerticalPlacement:function(){var a=this._verticalMargin-1,b=(1-a)*this.TOP_STICKY_AREA;this._setTopBottomMargin("auto",b+"px","0")},_topStickyVerticalPlacement:function(){var a=-1*this._verticalMargin-1,b=(1-a)*this.TOP_STICKY_AREA;this._setTopBottomMargin(b+"px","auto","0")},_horizontalRelativePlacement:function(a,b){var c=a/2,d=this._pxToPrecentWidth(b-2*this.SIDE_STICKY_AREA)/2,e=0-c-this._horizontalMargin*c,f=d*this._horizontalMargin+50+"%";this._setLeftRightMargin(f,"auto","0 0 0 "+e+"px")},_rightStickyHorizontalPlacement:function(){var a=this._horizontalMargin-1,b=(1-a)*this.SIDE_STICKY_AREA;this._setLeftRightMargin("auto",b+"px","0")},_leftStickyHorizontalPlacement:function(){var a=-1*this._horizontalMargin-1,b=(1-a)*this.SIDE_STICKY_AREA;this._setLeftRightMargin(b+"px","auto","0")},_handleVerticalCenteredPlacement:function(a){var b=window.getSize().y;return this._verticalMargin>=-1&&this._verticalMargin<=1?this._verticalRelativePlacement(a,b):this._verticalMargin>1&&this._verticalMargin<=2?this._bottomStickyVerticalPlacement():this._verticalMargin<-1&&this._verticalMargin>=-2?this._topStickyVerticalPlacement():void 0},_handleHorizontalCentredPlacement:function(a){var b=window.getSize().x;return this._horizontalMargin>=-1&&this._horizontalMargin<=1?this._horizontalRelativePlacement(a,b):this._horizontalMargin>1&&this._horizontalMargin<=2?this._rightStickyHorizontalPlacement():this._horizontalMargin<-1&&this._horizontalMargin>=-2?this._leftStickyHorizontalPlacement():void 0},getFullPlacementData:function(){return{placement:this._placement,verticalMargin:this._verticalMargin,horizontalMargin:this._horizontalMargin}},handleResizeWindow:function(a){var b={width:a.msgData.width,height:a.msgData.height};this._changeSize(b,!0),this._setMarginOffset(b),this._setTransitionEndCallback(a.callback,400)},_setTransitionEndCallback:function(a,b){setTimeout(function(){try{a()}catch(b){}},b)},onDataInitialized:function(){var a=this.getComponentProperties(),b=this._appData.widgets[this.getWidgetId()];this._placement=this.DEF_PLACEMENT;try{this._placement=a.get("placement")||b.gluedOptions.placement||this.DEF_PLACEMENT}catch(c){this._placement=this.DEF_PLACEMENT}this._setInitPlacementData(a,b),this._coordinates=this._getGluedWidgetCoordinates()},_setInitPlacementData:function(a,b){var c=a.get("horizontalMargin"),d=a.get("verticalMargin");""===c?(a.set("horizontalMargin",b.gluedOptions.horizontalMargin),this._horizontalMargin=b.gluedOptions.horizontalMargin):this._horizontalMargin=+c,""===d?(a.set("verticalMargin",b.gluedOptions.verticalMargin),this._verticalMargin=b.gluedOptions.verticalMargin):this._verticalMargin=+d},_getGluedWidgetCoordinates:function(){var a,b,c=this.getWidgetId(),d=this._appData.widgets[c];"site"===viewMode?(a=this._view.getAttribute("width")||this.DEF_WIDTH,b=this._view.getAttribute("height")||this.DEF_HEIGHT):(a=d.defaultWidth||this.DEF_WIDTH,b=d.defaultHeight||this.DEF_HEIGHT);var e="auto",f="auto",g="auto",h="auto";switch(this._placement){case"TOP_LEFT":f=0,e=0;break;case"TOP_RIGHT":h=0,e=0;break;case"BOTTOM_RIGHT":h=0,g=0;break;case"BOTTOM_LEFT":f=0,g=0;break;case"TOP_CENTER":e=0,f="50%";break;case"CENTER_RIGHT":e="50%",h=0;break;case"BOTTOM_CENTER":g=0,f="50%";break;case"CENTER_LEFT":f=0,e="50%";break;default:e=0,f="50%"}return{x:a,y:b,top:e,left:f,bottom:g,right:h}},_needToMakeRoomForAd:function(){return!(this._isSideCentered()||this._isHorizCentred()&&this._isTopPositioned())},_makeRoomForAd:function(){if(this._needToMakeRoomForAd()){var a=document.getElementById("wixFooter"),b=a?a.$logic.getAdHeight():{footer:46,top:26};this._isTopPositioned()?this.setY(b.top):this._setCssPosition(b.footer,"bottom")}},_resetAdRePosition:function(){this._needToMakeRoomForAd()&&(this._isTopPositioned()?this.setY(0):this._setCssPosition(0,"bottom"))},_editModeChanged:function(a){console.log("_editModeChanged",a),"PREVIEW"===a?this._makeRoomForAd():this._resetAdRePosition(),"PREVIEW"===a?this._addTransitionClass():this._removeTransitionClass()},canMoveBack:function(){return!1},canMoveForward:function(){return!1},isMultiSelectable:function(){return!1},canMoveToOtherScope:function(){return!0},isDraggable:function(){return!1},isDuplicatable:function(){return!1},getShowOnAllPagesChangeability:function(){return!1},getX:function(){var a=0;return this._isLeftPositioned()?this._isHorizCentred()&&(a=this._view.getPosition().x):this._isRightPositioned()&&(a=this._view.getPosition().x),a},getY:function(){var a=0;return this._isTopPositioned()?this._isVertCentred()&&(a=this._view.getPosition().y):this._isBottomPositioned()&&(a=this._view.getPosition().y),a},getSelectableX:function(){return this.getX()},getSelectableY:function(){return this.getY()},_getPageMargin:function(){var a=this.injects().Viewer.getSiteNode(),b=a.getSize();return(window.innerWidth-b.x)/2},_getPageSize:function(){var a=this.injects().Viewer.getSiteNode();return a.getSize()},isHorizontallyMovable:function(){return!1},isVerticallyMovable:function(){return!1}})}),define.experiment.newComponent("wysiwyg.viewer.components.tpapps.TPALinkedinFollow.LinkedinFollow.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.components.tpapps.TPAComponent"),c.propertiesSchemaType("TPALinkedinFollowProperties"),c.statics({_linkedinFollowMargins:16,_linkedinFollowWidth:85,_linkedinFollowHeight:20,_counterBesideWidth:53,_counterAboveHeight:42}),c.fields({EDITOR_META_DATA:{general:{title:"LinkedIn Follow",settings:!0,design:!1}},isTpa:!1}),c.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._resizableSides=[],this._iframeCacheKiller=0},_onDataChange:function(){this.render()},_getUrl:function(){return this._iframeCacheKiller=this._iframeCacheKiller?0:1,this.resources.topology.wysiwyg+"/html/external/linkedinfollow.html?"+this._iframeCacheKiller},_postMessageToIframe:function(){var a=this.getComponentProperties(),b={companyName:a.get("companyName"),dataId:a.get("dataId"),dataCounter:a.get("dataCounter"),language:a.get("language")};this._resizeEditBox(a),this.handleAddEventListener(this._Events.APP_MESSAGE,b)},_resizeEditBox:function(a){var b=this._calculateDimensions(a.get("dataCounter"));this.setWidth(b.width),this.setHeight(b.height)},_calculateDimensions:function(a){var b={};switch(a){case"right":b.width=this._linkedinFollowWidth+this._counterBesideWidth,b.height=this._linkedinFollowHeight;break;case"top":b.width=this._linkedinFollowWidth,b.height=this._linkedinFollowHeight+this._counterAboveHeight;break;default:b.width=this._linkedinFollowWidth,b.height=this._linkedinFollowHeight}return b.width=b.width+this._linkedinFollowMargins,b.height=b.height+this._linkedinFollowMargins,{width:b.width,height:b.height}}})}),define.experiment.component("wysiwyg.viewer.components.tpapps.TPAPlaceholder.Staff.Wix",function(a){a.fields({propertiesSchemaName:"WPhotoProperties",EDITOR_META_DATA:{general:{title:"App Placeholder",settings:!0,design:!1},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}}})}),define.experiment.newComponent("wysiwyg.viewer.components.tpapps.TPA3DCarousel.TPA3DGallery.New",function(a){a.inherits("wysiwyg.viewer.components.tpapps.TPAGallery"),a.methods({_getUrl:function(){return this.resources.topology.wysiwyg+"/html/external/Carousel/TPA3DCarousel.html?compId="+this.getComponentId()}})}),define.component("wysiwyg.viewer.components.tpapps.TPAGallery",function(a){a.inherits("wysiwyg.viewer.components.tpapps.TPAComponent"),a.resources(["W.Data","W.Commands"]),a.dataTypes(["ImageList"]),a.binds(["_imageItemChange"]),a.propertiesSchemaType("SlideShowGalleryProperties"),a.fields({EDITOR_META_DATA:{general:{title:"3D Carousel",settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"TPA3DCarousel"},commandParameterDataRef:"SELF"}]},isTpa:!1}),a.methods({initialize:function(a,b,c){this.parent(a,b,c),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed)},_onBeforePostMessage:function(){var a=this._getAllImagesDataItems();a.forEach(function(a){a.removeEvent(Constants.DataEvents.DATA_CHANGED,this._imageItemChange),a.addEvent(Constants.DataEvents.DATA_CHANGED,this._imageItemChange)},this)},_imageItemChange:function(){var a=this;clearTimeout(this._imageDataChangeTimeout),this._imageDataChangeTimeout=setTimeout(function(){a._postMessageToIframe()},1500)},_getAllImagesDataItems:function(){var a=this.getDataItem().getData();return a.items.map(function(a){return this.resources.W.Data.getDataByQuery(a)},this)},_onMediaZoomClosed:function(){this.handleAddEventListener(this._Events.APP_MESSAGE,{cmd:"zoomClosed"})},_getUrl:function(){throw new Error("Not Implemented: Please override _getUrl in order to use this Class")},_getMessageData:function(a){for(var b=this.getDataItem()._data,c=this.getComponentProperties(),d={items:[],props:c.getData()},e=0;e<b.items.length;e++)d.items[e]=this.resources.W.Data.getDataByQuery(b.items[e])._data;a(d)},_zoom:function(a){a=a||0;var b=this.getDataItem();this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:b,currentIndex:a,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.injects().Viewer.getDefaultGetHashPartsFunction("Image")})},zoomCommand:function(a){this._zoom(a)},dispose:function(){var a=this._getAllImagesDataItems();a.forEach(function(a){a.removeEvent(Constants.DataEvents.DATA_CHANGED,this._imageItemChange)},this),this.resources.W.Commands.unregisterListener(this),this.parent()}})}),define.experiment.Class("wysiwyg.viewer.managers.TPAManager.TPAScript.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Classes"])),c.fields({worksStack:[]}),c.methods({runScript:function(a,b){this.resources.W.Classes.getClass("wysiwyg.common.managers.scripting.ScriptingWorkerWrapper",function(c){var d=new c(b);this.worksStack[d.getCompId()]=d,d.run(a)}.bind(this))},handlePostMessage:function(a,b){if("string"==typeof a.data){var c="";try{c=JSON.parse(a.data)}catch(d){return}var e=c.type;c&&c.intent&&(c.intent===this.TPA_MESSAGE&&e?this._handleTPAMessage(c,e,b):c.intent===this.APP_MARKET_MESSAGE?this._handleAppMarketMessage(c):c.intent===this.TPA_MESSAGE2&&e&&this._handleTPAMessage2(c,this.getCallerContext(this)))}},getCallerContext:function(a){var b={getCaller:function(a){var b=$(a);return b&&b.getLogic()},sendToCaller:function(b,c){var d=JSON.stringify({intent:a.TPA_RESPONSE,compId:b.compId,callId:b.callId,type:b.type,res:c,status:!0});this.getIFrame().contentWindow.postMessage(d,"*")}};return b},_handleTPAMessage2:function(a,b){var c=b.getCaller(a.compId);if(c)if(Object.contains(this.MessageTypes,a.type)){var d=this._getHandlerFunctionName(a.type),e=c[d];"function"==typeof e?e.call(c,{msgData:a.data,callback:b.sendToCaller.bind(c,a)}):LOG.reportError("Handler function not found - "+a.type,"wysiwyg.viewer.managers.TPA","handlePostMessage2")}else LOG.reportError("Unknown post message type - "+a.type,"wysiwyg.viewer.managers.TPA","handlePostMessage")}})});
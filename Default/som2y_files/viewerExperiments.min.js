define.experiment.component("wysiwyg.viewer.components.AdminLoginButton.NBC_SiteButton.New",function(a){var b=a;b.dataTypes(["SiteButton"]),b.states({button:["up","pressed"],alignment:["center","left","right"]})}),define.experiment.newComponent("wysiwyg.viewer.components.BgImageStrip.BgImageStrip.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Config","W.Viewer","topology"]),b.dataTypes(["Image"]),b.skinParts({bg:{type:"htmlElement"}}),b.propertiesSchemaType("BgImageStripProperties"),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._baseUrl=W.Config.getMediaStaticUrl(),this._docWidth=W.Viewer.getDocWidth(),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this.EDITOR_META_DATA={general:{settings:!0,design:!0}},window.on("resize",this,this._fixWidth)},_onRender:function(a){a.data.invalidations.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&this._setBg()},_onDataChange:function(){this.isRendered()?this._setBg():this._fixWidth()},_fixWidth:function(){var a=this.getWidth();this.setWidth(a),this.$view.setStyles({width:a+"px",left:this.getDiff()+"px"})},_setBg:function(){if(this.getDataItem().get("uri")){var a=this._skinParts.bg;a.style.backgroundImage="url("+this._baseUrl+this.getDataItem().get("uri")+")",a.style.backgroundPosition=this.getComponentProperty("bgPosition"),a.style.backgroundRepeat=this.getComponentProperty("bgRepeat"),a.style.backgroundSize=this.getComponentProperty("bgSize")}},getDiff:function(){var a=(this._docWidth-this.getWidth())/2;return a>=0?0:a},getWidth:function(){return document.body.clientWidth},getSelectableX:function(){return this.getDiff()},getX:function(){return this.getDiff()},setX:function(){}})}),define.experiment.component("wysiwyg.viewer.components.ClipArt.MediaGalleryFrame.New",function(a){var b=a;b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"CLIP_ART_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"clipart"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"clipart"}}}})}),define.experiment.component("wysiwyg.viewer.components.ClipArt.NBC_WPhoto.New",function(a){var b=a;b.dataTypes(["Image"])}),define.experiment.newComponent("wysiwyg.viewer.components.DocumentMedia.DocumentMedia.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.common.components.traits.LinkableComponent","wysiwyg.viewer.components.traits.MediaGalleryInteraction"]),b.propertiesSchemaType("DocumentMediaProperties"),b.dataTypes(["Image"]),b.resources(["W.Utils","W.Viewer"]),b.skinParts({documentMediaLink:{type:"htmlElement"},link:{type:"htmlElement"}}),b.binds(["_onDocSelect","_setLabelAccordingToData","_setImageAccordingToData","_toggleTitleDisplay"]),b.states(["loading","normal","rollover"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.EDITOR_META_DATA={general:{settings:!0,design:!1},custom:[{label:"LINK_TO_DOCUMENT",command:"WEditorCommands.ShowDocumentMediaDialog",commandParameter:{callback:this._onDocSelect,galleryConfigID:"documents"}},{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"}}]}},_onRender:function(){this._setLabelAccordingToData(),this._setImageAccordingToData(),this._toggleTitleDisplay()},_onDocSelect:function(a){this._setDownloadLink(this,a)},_setLabelAccordingToData:function(){var a=this.getComponentProperty("title");this._skinParts.label.set("html",a)},_setImageAccordingToData:function(){this.injects().Theme.getProperty("THEME_DIRECTORY"),this._data&&this._data.get("uri")&&this._skinParts.image.set("src","http://static.wix.com/media/"+this._data.get("uri"))},_toggleTitleDisplay:function(){var a=this._skinParts.label;this.getComponentProperty("showDocumentTitle")?a.setStyle("display","block"):a.setStyle("display","none")}})}),define.experiment.newComponent("wysiwyg.viewer.components.FacebookShare.FacebookShare.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.dataTypes(["FacebookShareButton"]),b.resources(["W.Utils","W.Viewer"]),b.skinParts({facebookShareButton:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this.EDITOR_META_DATA={general:{settings:!0,design:!1}}},_onRender:function(a){var b,c,d,e,f=a.data.invalidations;f.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE])&&(b=this.getDataItem(),d=b.get("label"),c="Site Url"===b.get("urlChoice")?this.getSiteUrl():this.getCurrentPageUrl(),e=this._skinParts.facebookShareButton,this._createClickOverlayForPreviewMode(),this._setShareButtonLabelText(),e.setAttribute("data-href","http://www.facebook.com/sharer.php?u="+c),e.addEvent("click",function(){this.resources.W.Utils.openPopupWindow(e.getAttribute("data-href"),"wix-share-to-facebook","width=635,height=346,scrollbars=no,status=no,toolbar=no,menubar=no,location=no")}.bind(this)))},getSiteUrl:function(){return window.publicModel?window.publicModel.externalBaseUrl:""},getCurrentPageUrl:function(){return window.location.href},_setShareButtonLabelText:function(){var a=this.getDataItem().get("label");this._skinParts.label.set("html",a),""===a?(this._skinParts.label.setStyle("display","none"),this._skinParts.icon.setStyle("border-width","0")):(this._skinParts.label.setStyle("display",""),this._skinParts.icon.setStyle("border-width","1px"))}})}),define.experiment.component("wysiwyg.viewer.components.FiveGridLine.NBC_HorizontalLine.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.skinParts({line:{type:"htmlElement"}}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE];return a.isInvalidated(b)},_onRender:function(){var a=this._skinParts.line.$measure.height;this.setHeight(a)}})}),define.experiment.component("wysiwyg.viewer.components.FiveGridLine.NewBaseCompFiveGridLine.New",function(a){var b=a;b.inherits("core.components.base.BaseComp")}),define.experiment.component("wysiwyg.viewer.components.FooterContainer.ErrorLogOnFooterFucks.New",function(a,b){var c=a;c.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Commands.registerCommandListenerByName("EditorCommands.SiteLoaded",this,this._onSiteLoaded.bind(this))},_onSiteLoaded:function(){this._view.addEventListener&&this._view.addEventListener("DOMNodeRemoved",this._onDOMNodeRemoved.bind(this))},_onDOMNodeRemoved:function(){var a=(new Error).stack;LOG.reportError(wixErrors.FOOTER_DELETED,this.$className,"DOMNodeRemoved",a)},setY:function(a){if(this.parent(a),!this._footerAlreadyReportedError)try{var b=$("SITE_HEADER").$logic;if(b){var c=b.getY(),d=this.getY();if(c>d){var e=(new Error).stack;LOG.reportError(wixErrors.FOOTER_HIGHER_THAN_HEADER,this.$className,"setY",e),this._footerAlreadyReportedError=!0}}}catch(f){LOG.reportError(wixErrors.GENERAL_FOOTER_ERROR,this.$className,"setY",f.stack)}}})}),define.experiment.newComponent("wysiwyg.viewer.components.GoogleMapEmbedded.GoogleMapEmbedded.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.dataTypes(["GooglemapEmbeddedDataSchema"]),b.resources(["W.Utils","W.Viewer"]),b.skinParts({mapContainer:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.EDITOR_META_DATA={general:{settings:!0,design:!1},custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.AdvancedDesign"}]}},_onRender:function(){this._skinParts.mapContainer.appendChild(this.createIframe())},createIframe:function(){var a=new IFrame({src:this.getSource(),width:"100%",height:"100%",frameBorder:"0"});return this._skinParts.mapContainer.empty(),a},getSource:function(){var a="https://maps.google.com/maps?source=s_q&f=q&ie=UTF8&output=embed";return a=a+"&hl="+this.setHostLanguage()+"&q="+this.setAddress()+"("+this.setDescription()+")"+"&t="+this.setMapType()+"&z="+this.setZoomLevel()+"&iwloc="+this.toggleIWLOC()},setHostLanguage:function(){return this.getDataItem().get("hostLanguage")},setAddress:function(){return this.getDataItem().get("address")},setDescription:function(){return this.getDataItem().get("addressInfo")},setMapType:function(){return this.getDataItem().get("mapType")},setZoomLevel:function(){return this.getDataItem().get("zoomLevel")},toggleIWLOC:function(){return this.getDataItem().get("showInformationWindow")?"A":"B"}})}),define.experiment.component("wysiwyg.viewer.components.HorizontalMenu.PartialComponentPreview.New",function(a,b){var c=a;c.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],test:"dooooooode",EDITOR_META_DATA:{general:{settings:!0,design:!0,previewable:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],dblClick:{command:"WEditorCommands.Pages"},partialView:!0},_moreButtonClicked:!1,_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}})}),define.experiment.component("wysiwyg.viewer.components.HtmlComponent.RefreshFrameOnTransition.New",function(a,b){var c=a,d=b;c.resources(["W.Viewer","W.Commands"]),c.binds(["_onPageTransitionStarted","_onPageTransitionEnded"]),c.methods({initialize:d.after(function(){this.resources.W.Viewer.getPreviewMode()&&this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onViewModeChanged)}),render:d.before(function(){this.resources.W.Viewer.removeEvent("pageTransitionStarted",this._onPageTransitionStarted),this.resources.W.Viewer.removeEvent("pageTransitionEnded",this._onPageTransitionEnded),this.getDataItem().getData().freezeFrame&&(this.resources.W.Viewer.addEvent("pageTransitionStarted",this._onPageTransitionStarted),this.resources.W.Viewer.addEvent("pageTransitionEnded",this._onPageTransitionEnded))}),_onPageTransitionStarted:function(){this._iframe.set("src","about:blank")},_onPageTransitionEnded:function(){this._setFrameWithSrc(this._iframe)}})}),define.experiment.component("wysiwyg.viewer.components.HtmlComponent.htmlParastorage.New",function(a,b){var c=a;c.methods({getIFrameSrc:function(){var a=this._data.get("url"),b=/^(ftps|ftp|http|https).*$/;return b.test(a)||(a="http://"+a),a=a.split("static.wix.com").join("static.parastorage.com")}})}),define.experiment.component("wysiwyg.viewer.components.LoginButton.SMOwnerLogoutFix.New",function(a,b){var c=a;c.resources(["W.SiteMembers"]),c.methods({_updateTextsAndEvents:function(){var a=this._skinParts,b=this.injects().SiteMembers,c=a.actionTitle,d=a.memberTitle,e=this;this.injects().SiteMembers.isLoggedIn()?(c.set("text",this.SIGN_OUT),c.addEvent("click",this._addLogoutMemberHandler(c)),this.injects().SiteMembers.getMemberDetails(function(a){var b=a.attributes&&a.attributes.name||a.email;d.set("text",this.HELLO+" "+b)}.bind(this)),this.setState("auth")):(c.set("text",this.SIGN_IN),c.addEvent("click",function(){b.openSiteMembersPopup({authCallback:function(a){1==a.authResponse&&e._renderIfReady()}}),c.removeEvent("click",arguments.callee)}.bind(this)),d.set("text",""),this.setState("no_auth"))},_addLogoutMemberHandler:function(a){var b=this,c=function(){var c=b.resources.W.SiteMembers.logout();c&&(a.removeEvent("click",arguments.callee),setTimeout(function(){location.reload()},500))};return c}})}),define.experiment.component("wysiwyg.viewer.components.MediaZoomDisplayer.LazyShare.New",function(a,b){var c=a,d=b;c.skinParts(d.merge({lazyShare:{type:"wysiwyg.viewer.components.LazySocialPanel",optional:!1}}))}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoom.MobileSiteWidth.New",function(a,b){var c=a,d=b;c.states(d.merge({displayDevice:["desktop","mobile"]})),c.methods({initialize:d.after(function(){var a=this.resources.W.Viewer;a.getDocWidth()===a.MOBILE_SITE_WIDTH?this.setState("mobile","displayDevice"):this.setState("desktop","displayDevice")})})}),define.experiment.newComponent("wysiwyg.viewer.components.MobileMediaZoom.MobileZoom.New",function(a){var b=a;b.resources(["W.Viewer"]),b.states({showButtons:["doShowButtons","dontShowButtons"],orientation:["portrait","landscape"]}),b.binds(["_onOrientationChange","_preventEvent","_changeButtonsVisibility","_closeZoom","gotoNext","gotoPrev","_preventTouchStart"]),b.inherits("wysiwyg.viewer.components.MediaZoom"),b.skinParts({blockingLayer:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},dialogBox:{type:"htmlElement"},xButton:{type:"htmlElement"},virtualContainer:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},counter:{type:"htmlElement"},buttonPrev:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Prev"},buttonNext:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"}}),b.fields({transitionTime:"short",_inTransition:!1,_lastCurrentItem:null}),b.methods({initialize:function(a,b,c){this._landscapePortraitRatio=screen.height/screen.width,this._fontSizeCorrectionWhenOpenZoomInPortrait=1.1,this.isVolatile=!0,this.parent(a,b,c);var d=this.injects().Commands;d.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._editModeChanged,null,!0),this.addEvent("currentItemChanged",this._handleCurrentItemChange),this.collapse(),this._mobileConfig=this.injects().Config.mobileConfig,this._setInitZoom()},_setInitZoom:function(){return this._initZoom=this._mobileConfig.getMobileScreenWidth()/document.body.offsetWidth,this._initZoom},fixZoom:function(){(!this._initZoom||this._initZoom<0||this._initZoom>5)&&this._setInitZoom();var a=this._initZoom/this._mobileConfig.getZoom();this._skinParts.xButton.style.zoom=a,this._skinParts.buttonPrev.style.zoom=a,this._skinParts.buttonNext.style.zoom=a},_setOrientation:function(){setTimeout(this.fixZoom.bind(this),300)},_onAllSkinPartsReady:function(){this.parent(),this._mobileConfig.isMobileOrTablet()&&(Hammer(this._view).on("swipeleft",this.gotoNext.bind(this)),Hammer(this._view).on("swiperight",this.gotoPrev.bind(this))),setTimeout(this.fixZoom.bind(this),300),this._skinParts.xButton.addEventListener("touchstart",function(a){return this._closeZoom(a),this._preventEvent(a)}.bind(this)),this._skinParts.buttonPrev.addEventListener("touchstart",function(a){return this.gotoPrev(a),this._preventEvent(a)}.bind(this)),this._skinParts.buttonNext.addEventListener("touchstart",function(a){return this.gotoNext(a),this._preventEvent(a)}.bind(this)),Hammer(this._skinParts.dialogBox).on("tap",this._changeButtonsVisibility)},_onOrientationChange:function(){this._currentDisplayer.hideContent(),this.showZoomImage(!0),this._setOrientation()},_changeButtonsVisibility:function(){return this._changeButtonsVisibilityTimer?!0:(this._changeButtonsVisibilityTimer=setTimeout(function(){this._changeButtonsVisibilityTimer=null}.bind(this),500),"dontShowButtons"==this.getState("showButtons")?(this.setState("doShowButtons","showButtons"),this._currentDisplayer.showText()):(this.setState("dontShowButtons","showButtons"),this._currentDisplayer.hideText()),void 0)},_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._skinParts.virtualContainer.empty(),this._skinParts.itemsContainer.empty(),this._opened=!1,this.unlock(),this._lastCurrentItem=null,this._enableScroll(),window.removeEvent("orientationchange",this._onOrientationChange),this._enableZoomAndMagnifier(),this._refreshQuickActions()},showZoomImage:function(a){if(this._mobileConfig.isMobileOrTablet()&&window.addEvent("orientationchange",this._onOrientationChange),this._disableScroll(),a||this._currentItem&&this._currentItem!=this._lastCurrentItem){var b=this.injects().Utils.getWindowSize(),c=this.getSkin().getParams().first(function(a){return"$marginIncludingArrow"===a.id});this._imageMaxWidth=b.width-2*c.defaultValue,this._imageMaxHeight=b.height-60,this._lastCurrentItem=this._currentItem,this._renderCurrentDisplayer(this._transitionToCurrentDisplayer),this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this.injects().Viewer.enterFullScreenMode(),this.uncollapse()}},_renderCurrentDisplayer:function(){for(var a=this._skinParts.virtualContainer,b=0;b<a.childNodes.length;b++)a.childNodes[b].destroy();var c=this;setTimeout(function(){this._getDisplayerDivFunction(this._currentItem,{container:c._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight},function(a){a.getParent('[skinpart="virtualContainer"]')||a.insertInto(c._skinParts.virtualContainer),c._changeImageNoTransition(a),c._currentDisplayer=a.getLogic()})}.bind(this),500)},_changeImageNoTransition:function(a){for(var b=this._skinParts.itemsContainer,c=this,d=0;d<b.childNodes.length;d++)b.childNodes[d].destroy();b.empty();var e=a.getStyles("width","height"),f=c._getTopGap(e.height.replace("px",""));b.adopt(a),c._skinParts.virtualContainer.empty(),c._skinParts.dialogBox.setStyles({"min-height":e.height,"margin-top":f+"px"}),c.unlock()},setGallery:function(a,b,c,d,e){this.parent(a,b,c,d,e),this._disableZoomAndMagnifier(),this._setZoomModeFontSize()},_setZoomModeFontSize:function(){var a=WQuickActions.initZoom,b=WQuickActions.getZoom(),c=a/b,d=8*c;0===window.orientation&&(d*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",d+"px")},_disableZoomAndMagnifier:function(){this.resources.W.Viewer.setViewportAttribute("minimum-scale",this._initZoom),this.resources.W.Viewer.setViewportAttribute("maximum-scale",this._initZoom)},_enableZoomAndMagnifier:function(){this.resources.W.Viewer.setViewportAttribute("minimum-scale",.25),this.resources.W.Viewer.setViewportAttribute("maximum-scale",1.2)},_refreshQuickActions:function(){window.WQuickActions&&window.WQuickActions.startZooming()},_disableScroll:function(){document.addEvent("touchmove",this._preventEvent)},_preventTouchStart:function(a){console.log(a.type),this._preventEvent(a)},_preventEvent:function(a){return a.preventDefault(),a.stopPropagation(),!1},_enableScroll:function(){document.removeEvent("touchmove",this._preventEvent),document.removeEvent("touchstart",this._preventTouchStart)}})}),define.experiment.newComponent("wysiwyg.viewer.components.MobileMediaZoomDisplayer.MobileZoom.New",function(a){var b=a;b.inherits("wysiwyg.viewer.components.MediaZoomDisplayer"),b.resources(["W.Commands"]),b.skinParts({notAllDescriptionPresentedIndicator:{type:"htmlElement",optional:!1},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},link:{type:"htmlElement",optional:!0},imageWrapper:{type:"htmlElement"},image:{type:"core.components.Image",dataRefField:"*",optional:!1,hookMethod:"_addImageArgs"}}),b.states({link:["showLink","hideLink"],descriptionPresentationMode:["showLimitedDescription","showAllDescription"],showPanelText:["doShowPanelText","dontShowPanelText"],orientation:["portrait","landscape"]}),b.methods({initialize:function(a,b,c){this._fontSizeCorrectionWhenOpenZoomInPortrait=1.1,this.parent(a,b,c);var d=this._getDeviceSize();this._maxWidth=d.width,this._maxHeight=d.height,this.setState("doShowPanelText","showPanelText")},_onAllSkinPartsReady:function(){this.parent(),this.setState("showLimitedDescription","descriptionPresentationMode"),this._skinParts.title.addEvent("touchstart",this._onDescriptionClick.bind(this)),this._skinParts.description.addEvent("touchstart",this._onDescriptionClick.bind(this)),this._skinParts.link.addEvent("touchstart",function(a){a.target.fireEvent("click"),a.stopPropagation()}),this._changeFontSizes(),this._setZoomModeFontSize()},_setZoomModeFontSize:function(){var a=WQuickActions.initZoom,b=WQuickActions.getZoom(),c=a/b,d=8*c;0===window.orientation&&(d*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",d+"px")},render:function(){this.parent(),this._limitedDescriptionHeight=2*1.14*parseInt(this._skinParts.description.getStyle("font-size"))+"px",this._fullDescriptionHeight=this._skinParts.description.getStyle("height"),this._skinParts.description.setStyle("height",this._limitedDescriptionHeight),this._canDescriptionExpand()||this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","hidden"),this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",!0)},_onDescriptionClick:function(a){if(this._canDescriptionExpand()){var b="showLimitedDescription"==this.getState("descriptionPresentationMode")?"showAllDescription":"showLimitedDescription";this.setState(b,"descriptionPresentationMode");var c="showLimitedDescription"==b?!0:!1;this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",c),this._animateDescriptionHeightTransition(b),this._animateImageWrapperOpacityTransition(b),a.stopPropagation()}},_onImageWrapperClick:function(){var a="doShowPanelText"==this.getState("showPanelText")?"dontShowPanelText":"doShowPanelText";this.setState(a,"showPanelText");var b="doShowPanelText"==this.getState("showPanelText")?!0:!1;this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",b)},_canDescriptionExpand:function(){return parseInt(this._fullDescriptionHeight)>parseInt(this._limitedDescriptionHeight)},_animateDescriptionHeightTransition:function(a){var b=new Fx.Tween(this._skinParts.description,{duration:"short",link:"chain",property:"height"}),c="showLimitedDescription"===a?this._limitedDescriptionHeight:this._fullDescriptionHeight;b.addEvent("complete",function(){"showLimitedDescription"===this.getState("descriptionPresentationMode")?this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","visible"):this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","hidden")}.bind(this)),b.start(c)},_animateImageWrapperOpacityTransition:function(a){var b=new Fx.Tween(this._skinParts.imageWrapper,{duration:"short",link:"chain",property:"opacity"}),c="showLimitedDescription"===a?"1":"0.65";b.start(c)},_getDeviceSize:function(){return{width:window.innerWidth,height:window.innerHeight}},_setCorrectImageSize:function(a){var b=a.y;this._getDisplayerWidth(a.x),this._skinParts.imageWrapper.setStyles({width:"100%",height:b+"px"}),this._skinParts.title.setStyles({"word-wrap":"break-word"}),this._skinParts.description.setStyles({"word-wrap":"break-word"})},hideContent:function(){this._skinParts.image.collapse(),this._skinParts.panel.collapse()},showText:function(){this._skinParts.title.uncollapse(),this._skinParts.description.uncollapse(),this._skinParts.notAllDescriptionPresentedIndicator.uncollapse(),this._skinParts.link.uncollapse()},hideText:function(){this._skinParts.title.collapse(),this._skinParts.description.collapse(),this._skinParts.notAllDescriptionPresentedIndicator.collapse(),this._skinParts.link.collapse()},_changeFontSizes:function(){90==window.orientation||-90==window.orientation?this.setState("landscape","orientation"):this.setState("portrait","orientation")}})}),define.experiment.component("wysiwyg.viewer.components.PageGroup.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Commands","W.Viewer"])),c.methods({initialize:d.after(function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.UpdateDocWidth",this,this._onUpdateDocWidth)}),_onUpdateDocWidth:function(){this.refreshGrid(),this.render()},_setHorizontalGrid:function(){var a=window.getSize().x,b=this.resources.W.Viewer._siteStructureData.get("renderModifiers").siteWidth,c=a-b,d=-1*(c/2);this._skinParts.gridHeader.setStyle("width",a),this._skinParts.gridFooter.setStyle("width",a),this._skinParts.gridHeader.setStyle("left",d),this._skinParts.gridFooter.setStyle("left",d)}})}),define.experiment.newComponent("wysiwyg.viewer.components.PinterestPin.PinterestPinComponent.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.utilize(["core.components.image.ImageUrlNew"]),b.resources(["W.Config","topology"]),b.dataTypes(["Image"]),b.propertiesSchemaType("PinterestPinProperties"),b.skinParts({pinButton:{type:"htmlElement"}}),b.statics({_pinButtonMargins:16,_pinButtonWidth:40,_pinButtonHeight:20,_pinCountBesideWidth:35,_pinCountAboveHeight:29}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this._imgUtils=new this.imports.ImageUrlNew},_onRender:function(){this._calculateDimensions(),this._createIframe(),this._createClickOverlayForPreviewMode()},_getImageUrl:function(){var a=this.getDataItem(),b=a?a.get("uri"):"";return b?this._imgUtils.getImageAbsoluteUrlFromRelativeUrl(b):""},_getImageDesciption:function(){var a=this.getDataItem();return a?a.get("description"):""},_getCounterPosition:function(){var a=this.getComponentProperties();return a?a.get("counterPosition"):"none"},_getIframeUrl:function(){var a=this.resources.W.Config.getUserPublicUrl(),b=this.resources.topology.wysiwyg+"/html/external/pinterestpin.html";return b+"?media="+this._getImageUrl()+"&url="+a+"&description="+this._getImageDesciption()+"&data-pin-config="+this._getCounterPosition()},_calculateDimensions:function(){var a=this._getCounterPosition(),b={};switch(a){case"beside":b.width=this._pinButtonWidth+this._pinCountBesideWidth,b.height=this._pinButtonHeight;break;case"above":b.width=this._pinButtonWidth,b.height=this._pinButtonHeight+this._pinCountAboveHeight;break;default:b.width=this._pinButtonWidth,b.height=this._pinButtonHeight}return b.width+=this._pinButtonMargins,b.height+=this._pinButtonMargins,{width:b.width+"px",height:b.height+"px"}},_createIframe:function(){var a=this._calculateDimensions();this._iframe=new IFrame({src:this._getIframeUrl(),webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0",width:a.width,height:a.height}),this._skinParts.pinButton.empty(),this._iframe.insertInto(this._skinParts.pinButton)}})}),define.experiment.component("wysiwyg.viewer.components.ScreenWidthContainer.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.UpdateDocWidth",this,this.render)})})}),define.experiment.component("wysiwyg.viewer.components.SiteButton.LinkRefData.New",function(a,b){var c=a,d=b;c.resources(["W.Data"]),c.utilize(["core.utils.LinkRenderer"]),c.traits(d.customizeField(function(a){return a.erase("wysiwyg.common.components.traits.LinkableComponent"),a})),c.methods({render:d.after(function(){this._renderLink()}),_onDataChange:d.after(function(){this._isRendered&&this._renderLink()}),_renderLink:function(){var a=this.getDataItem(),b=new this.imports.LinkRenderer,c=a._data.link;if(!c)return b.removeRenderedLinkFrom(this._skinParts.link),void 0;var d=this.resources.W.Data.getDataByQuery("#"+c);d&&b.renderLink(this._skinParts.link,d)}})}),define.experiment.component("wysiwyg.viewer.components.SiteButton.NBC_SiteButton.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Utils"]),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.propertiesSchemaType("ButtonProperties"),b.dataTypes(["SiteButton"]),b.states({button:["up","pressed"],alignment:["center","left","right"]}),b.binds(["hasInvalidations","_setLabelAccordingToData","_setVerticalAlignment","_setHorizontalAlignment","_addEventOn","_onClick","_onMouseDown","_onMouseUp"]),b.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.EDITOR_META_DATA={general:{settings:!0,design:!1},custom:[{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}]}},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.WIDTH_REQUEST,this.INVALIDATIONS.HEIGHT_REQUEST,this.INVALIDATIONS.PART_SIZE,this.INVALIDATIONS.SIZE];return a.isInvalidated(b)},_onRender:function(a){if(0===this._data.get("renderVersion")&&this.isDisplayed()&&(this._setLabelAccordingToData(),this._updateRenderLayoutData()),this.hasInvalidations(a,["SKIN_CHANGE"])){var b=this.getViewNode();this._addEventOn(b,Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),this._addEventOn(b,Constants.CoreEvents.MOUSE_UP,this._onMouseUp),this._addEventOn(b,Constants.CoreEvents.CLICK,this._onClick)}this.hasInvalidations(a,["SKIN_CHANGE","DATA_CHANGE","WIDTH_REQUEST"])&&(this.getDataItem()&&this._setLabelAccordingToData(),this._setHorizontalAlignment()),this.hasInvalidations(a,["SKIN_CHANGE","SIZE","PART_SIZE"])&&this._setVerticalAlignment()},_updateRenderLayoutData:function(){var a,b,c,d=this.getComponentProperty("margin"),e=this.getComponentProperty("align");return this._data.set("renderVersion",1),b=parseInt(this._skinParts.label.offsetWidth,10),c=parseInt(this._skinParts.view.getAttribute("width"),10),this._skinParts.view.setStyle("min-width",c),"center"===e?(this.setComponentProperty("margin",0),this._setPadding(0,0),void 0):(a="right"===e?"left":"right",d>c-b?(this.setComponentProperty("align",a),this.setComponentProperty("margin",0),this._skinParts.link.setStyle("text-align",a)):this._skinParts.view.setStyle("min-width",c-d),void 0)},hasInvalidations:function(a,b){for(var c=a.data.invalidations,d=0;d<b.length;++d){var e=b[d],f=this.INVALIDATIONS[e];if(c.getInvalidationByType(f))return!0}return!1},_setLabelAccordingToData:function(){var a=this.getDataItem().get("label");this._skinParts.label.set("text",a)},_setVerticalAlignment:function(){this._setLineHeight()},_setLineHeight:function(){var a=this._skinParts.link,b=parseInt(a.getStyle("font-size"),10),c=this.getHeight(),d=parseInt(a.getStyle("max-height"),10),e=parseInt(a.getStyle("min-height"),10);b>c&&this.setHeight(b),isNaN(d)&&e>d&&this.setHeight(d),a.setStyle("line-height",this.getHeight())},_setHorizontalAlignment:function(){var a=this.getComponentProperty("align"),b=this.getComponentProperty("margin");switch(this._skinParts.link.setStyle("text-align",a),this._skinParts.view.setStyle("width",this._skinParts.label.getWidth()),a){case"center":this._setPadding(b,b);break;case"left":this._setPadding(0,b);break;case"right":this._setPadding(b,0)}},_setPadding:function(a,b){var c=this._skinParts.link,d=this._skinParts.view;c.setStyle("padding","0 "+a+"px"+" 0 "+b+"px"),d.setStyle("padding","0 "+a+"px"+" 0 "+b+"px"),c.setStyle("margin","0 -"+a+"px"+" 0 -"+b+"px")},getWidth:function(){return this.getPhysicalWidth()},_onClick:function(a){this.fireEvent(Constants.CoreEvents.CLICK,a)},_onMouseDown:function(a){this.setState("pressed"),this.fireEvent(Constants.CoreEvents.MOUSE_DOWN,a)},_onMouseUp:function(){this.setState("up")},_eventList:[],_addEventOn:function(a,b,c){a.addEvent(b,c),this._eventList.push({name:b,target:a,handler:c})}})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.AutoPlayFix.New",function(a,b){var c=a;c.methods({onPageVisibilityChange:function(a){a?this._restartAutoPlay():this._stopAutoPlay()},_stopAutoPlay:function(){null!=this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},_restartAutoPlay:function(){this._autoplayOn&&this._galleryItems.length>1&&this._autoplayCallback()}})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.GalleryFlick.New",function(a,b){var c=a;c.methods({_isAllowRender:function(){return!this._locked}})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.NBC_SlideShowGallery.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.utilize(["wysiwyg.common.utils.AutoPlay","wysiwyg.viewer.utils.TransitionHandler"]),c.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement"},autoplay:{type:"htmlElement"},imageItem:{type:"wysiwyg.viewer.components.Displayer",autoCreate:!1,argObject:{unit:"px"}}}),c.dataTypes(["ImageList"]),c.binds(["_onPrev","_onNext","_zoomOnSelectedDisplayer","gotoNext","_handleAutoPlayEvent","_toggleAutoPlay","_onAnimationDone"]),c.propertiesSchemaType("SlideShowGalleryProperties"),c.states({autoPlay:["autoplayOn","autoplayOff"]}),c.statics({INDEX_INVALIDATIONS:"indexChange",HEIGHT_REQUEST:"heightRequest",WIDTH_REQUEST:"widthRequest",DISPLAYER_POS:{PREVIOUS:0,CURRENT:1,NEXT:2},IMAGE_CLICK_ACTIONS:{ZOOM:"zoomMode",LINK:"goToLink",DISABLED:"disabled"},IMAGE_MODE:{CLIPPED:"clipImage",FLEXIBLE:"flexibleHeight"},ANIMATION_DIRECTION:{FORWARDS:0,BACKWARDS:1},IMAGE_ONCLICK_ACTION_PROPERTY:"galleryImageOnClickAction",IMAGE_MODE_PROPERTY:"imageMode",TRANSITION_PROPERTY:"transition",TRANSITION_DURATION_PROPERTY:"transDuration"}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._displayers=[],this._index=0,this._requestedIndex=this._index,this._numberOfDisplayerMoves=0,this._autoPlay=new this.imports.AutoPlay,this._suppressAutoplay=W.Viewer.getPreviewMode()===!0,this._animator=new this.imports.TransitionHandler,this._currentTransition=null,this._isBeingAnimated=!1,this._displayerAnimationDiv=document.createElement("div"),this._displayerAnimationDiv.setStyles({position:"absolute"})
},isRenderNeeded:function(a){if(this._isBeingAnimated!==!0){var b=[this.INVALIDATIONS.PART_SIZE,this.INDEX_INVALIDATIONS];return a.isInvalidated(b)||this.parent(a)}},_onRender:function(a){var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&(this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.view.setStyle("overflow","visible"),this._handleRenderingIfSkinChanged()),b.isInvalidated([this.HEIGHT_REQUEST,this.WIDTH_REQUEST])&&this._handleRenderIfResized(b),b.isInvalidated([this.INVALIDATIONS.DATA_CHANGE,this.INDEX_INVALIDATIONS])&&this._handleRenderIfDataOrIndexChanged(b),b.isInvalidated([this.INVALIDATIONS.SIZE])&&this._orderDisplayers(),this._isImageModeFlexible()&&this._resizeGalleryToFitCurrentDisplayer(),this.getComponentProperty("showAutoplay")===!0?this._skinParts.autoplay.show():this._skinParts.autoplay.hide()},_orderDisplayers:function(){var a=this._skinParts.itemsContainer.$measure.width;this._displayers[0].$view.style.left=-a+"px",this._displayers[1].$view.style.left="0px",this._displayers[2].$view.style.left=a+"px"},_onModeChange:function(a){this._suppressAutoplay="PREVIEW"!==a,this._setAutoPlay()},_setAutoPlay:function(){this._autoPlay.setDelay(this.getComponentProperty("autoplayInterval")),this.getComponentProperty("autoplay")!==!0||this._suppressAutoplay?this._autoPlay.pause():this._autoPlay.play()},_isImageModeFlexible:function(){return this.getComponentProperty(this.IMAGE_MODE_PROPERTY)===this.IMAGE_MODE.FLEXIBLE},_resizeGalleryToFitCurrentDisplayer:function(){var a=this._displayers[1],b=a.getWidth(),c=a.getHeight();this.setWidth(b),this.setHeight(c)},_handleRenderIfDataOrIndexChanged:function(a){if(a.isInvalidated([this.INDEX_INVALIDATIONS])){var b=a.getLastInvalidationByType(this.INDEX_INVALIDATIONS);this._requestedIndex=b.index}a.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._setOnDisplayerClickAction(),this._setNavigationPartsVisibility(),this._currentTransition!==this.getComponentProperty(this.TRANSITION_PROPERTY)&&(this._resetDisplayersStyle(),this._currentTransition=this.getComponentProperty(this.TRANSITION_PROPERTY)),this._updateDisplayersData(),this._updateItemsCounter()),this._renderDisplayers()},_resetDisplayersStyle:function(){for(var a=0;a<this._displayers.length;a++){var b=this._displayers[a];b.$view.setStyles({position:"absolute",opacity:"1.0"})}},_setOnDisplayerClickAction:function(){var a=this.getComponentProperty(this.IMAGE_ONCLICK_ACTION_PROPERTY),b=this._skinParts.itemsContainer;b.removeEvents(Constants.CoreEvents.CLICK),a===this.IMAGE_CLICK_ACTIONS.ZOOM?b.on(Constants.CoreEvents.CLICK,this,this._zoomOnSelectedDisplayer):a===this.IMAGE_CLICK_ACTIONS.LINK?b.on(Constants.CoreEvents.CLICK,this,this._goToLinkOnSelectedDisplayer):a===this.IMAGE_CLICK_ACTIONS.DISABLED},_handleRenderingIfSkinChanged:function(){this._exterminateDisplayers(),this._initDisplayers(),this._orderDisplayers(),this._forceDisplayersRender(),this._updateItemsCounter(),this._bindEventHandlers(),this._setNavigationPartsVisibility(),this._resizeDisplayers()},_bindEventHandlers:function(){this._skinParts.buttonPrev.on(Constants.CoreEvents.CLICK,this,this._onPrev),this._skinParts.buttonNext.on(Constants.CoreEvents.CLICK,this,this._onNext),this._skinParts.autoplay.on(Constants.CoreEvents.CLICK,this,this._toggleAutoPlay),this._autoPlay.on(this._autoPlay.AUTOPLAY_EVENT,this,this._handleAutoPlayEvent),W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange)},_forceDisplayersRender:function(){this._skinParts.itemsContainer.show(),this._displayers.each(function(a){a.render()})},_handleRenderIfResized:function(a){var b=this.getComponentProperty(this.IMAGE_MODE_PROPERTY);if(b===this.IMAGE_MODE.CLIPPED)this._resizeDisplayers();else if(b===this.IMAGE_MODE.FLEXIBLE){var c=a.getLastInvalidationByType(this.WIDTH_REQUEST);null!==c&&this._resizeDisplayersWithAspectRatio(c.width)}},_resizeDisplayersWithAspectRatio:function(a){for(var b=0;b<this._displayers.length;++b)this._displayers[b].setSize(a,-1,this.IMAGE_MODE.FLEXIBLE)},_resizeDisplayers:function(){for(var a=this._skinParts.itemsContainer.$measure,b=a.width,c=a.height,d=0;d<this._displayers.length;++d)null!==b&&this._displayers[d].setWidth(b),null!==c&&this._displayers[d].setHeight(c)},_getDirection:function(a,b){var c=this._getTotalAvailableItems()-1,d=0;return d=0===a&&b===c?-1:a===c&&0===b?1:this._signum(b-a)},getIndex:function(){var a=this.getLastInvalidationByType(this.INDEX_INVALIDATIONS);return a?a.index:this._index},setIndex:function(a){a=this._normalizeIndex(a);var b=this.getIndex();b!==a&&(this._requestedIndex=a,this._numberOfDisplayerMoves+=this._getDirection(b,a),this.invalidate(this.INDEX_INVALIDATIONS,{index:a,oldIndex:b}))},_initDisplayers:function(){for(var a=0;3>a;++a){var b=this.getSkinPartDefinition("imageItem");b.dataQuery=this._getDisplayerDataRef(a);var c=this._createInnerComponent(b);c.setOwner(this),this._displayerAnimationDiv.appendChild(c.$view),this._displayers.push(c)}this._resetDisplayersStyle(),this._skinParts.itemsContainer.appendChild(this._displayerAnimationDiv)},_renderDisplayers:function(){if(0!==a&&0!==this._numberOfDisplayerMoves){var a=this._signum(this._numberOfDisplayerMoves);this._renderDisplayersWithAnimation(a)}},_renderDisplayersWithAnimation:function(a){if(this._isBeingAnimated=!0,Math.abs(this._requestedIndex-this._index)>1){var b=this._getDataItems(),c=b[this._normalizeIndex(this._requestedIndex)];this._displayers[1+a].setDataByQuery(c)}var d=this._displayers[1].$view,e=this._displayers[1+a].$view,f=this.getComponentProperty(this.TRANSITION_DURATION_PROPERTY),g=1===a?this.ANIMATION_DIRECTION.FORWARDS:this.ANIMATION_DIRECTION.BACKWARDS,h=this._animator.getTransition(this.getComponentProperty(this.TRANSITION_PROPERTY));h(d,e,g,f,this._onAnimationDone)},_onAnimationDone:function(){var a=this._signum(this._numberOfDisplayerMoves);this._numberOfDisplayerMoves-=a,this._shiftDisplayers(a),this._index=this._normalizeIndex(this._index+a),this._updateItemsCounter(),this._updateDisplayersData(),this._orderDisplayers(),0!==this._numberOfDisplayerMoves?(this._numberOfDisplayerMoves=a,this._renderDisplayersWithAnimation(a)):this._isBeingAnimated=!1},_shiftDisplayers:function(a){0!==a&&(1===a?this._displayers.push(this._displayers.shift()):-1===a&&this._displayers.unshift(this._displayers.pop()))},_updateDisplayersData:function(){for(var a=0;3>a;++a){var b=this._getDisplayerDataRef(a),c=this._displayers[a];c.setDataByQuery(b)}},_updateItemsCounter:function(){var a=this._index+1,b=this._getTotalAvailableItems(),c=this._getCounterText(a,b);this._skinParts.counter.set("text",c)},_getCounterText:function(a,b){return a+"/"+b},_getDisplayerDataRef:function(a){var b,c=this._getDataItems();switch(a){case this.DISPLAYER_POS.PREVIOUS:b=this._normalizeIndex(this._index-1);break;case this.DISPLAYER_POS.CURRENT:b=this._normalizeIndex(this._index);break;case this.DISPLAYER_POS.NEXT:b=this._normalizeIndex(this._index+1)}return c[b]},_setNavigationPartsVisibility:function(){var a=this.getComponentProperty("showNavigation");a===!0?(this._skinParts.buttonPrev.show(),this._skinParts.buttonNext.show()):(this._skinParts.buttonPrev.hide(),this._skinParts.buttonNext.hide()),this._updateAutoPlayState()},_toggleAutoPlay:function(){var a=this.getComponentProperty("autoplay");a?this._autoPlay.pause():this._autoPlay.play(),this.setComponentProperty("autoplay",!a),this._updateAutoPlayState()},_handleAutoPlayEvent:function(){this._updateAutoPlayState(),this._autoPlay.isPlaying()?(this._autoPlay.setDelay(this.getComponentProperty("autoplayInterval")),this._autoPlay.play()):this._autoPlay.pause(),this.getComponentProperty("reverse")===!0?this._onPrev():this._onNext()},_updateAutoPlayState:function(){this._autoPlay.isPlaying()?this.setState("autoplayOn","autoPlay"):this.setState("autoplayOff","autoPlay")},_onPrev:function(){var a=this._normalizeIndex(this.getIndex()-1);this.setIndex(a)},_onNext:function(){var a=this._normalizeIndex(this.getIndex()+1);this.setIndex(a)},_zoomOnSelectedDisplayer:function(){this._displayers[this._displayers.length-1].zoom()},_goToLinkOnSelectedDisplayer:function(){this._displayers[this._displayers.length-1].goToLink()},_normalizeIndex:function(a){var b=this._getTotalAvailableItems();return this._modulu(a,b)},_modulu:function(a,b){return(a%b+b)%b},_getTotalAvailableItems:function(){var a=this._getDataItems(),b=a.length;return b},_getDataItems:function(){return this._data.get("items")},_signum:function(a){return a>0?1:0>a?-1:0},_exterminateDisplayers:function(){this._displayerAnimationDiv.childNodes=[];for(var a=0;a<this._displayers.length;a+=1)this._displayers[a].dispose();this._displayers=[]},_onAllSkinPartsReady:b.remove()})}),define.experiment.component("wysiwyg.viewer.components.SliderGallery.MobileSliderGallery.New",function(a,b){var c=a,d=b;c.states({mobile:["notMobile","mobile"]}),c.traits([]),c.methods({initialize:d.after(function(){W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile")}),_onAllSkinPartsReady:d.after(function(){"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this.gotoPrev),Hammer(this._view).on("swipeleft",this.gotoNext))}),gotoPrev:d.after(function(){clearTimeout(this._prevStopTimeout),this._prevStopTimeout=setTimeout(function(){this._stopMovement()}.bind(this),2e3)}),gotoNext:d.after(function(){clearTimeout(this._nextStopTimeout),this._nextStopTimeout=setTimeout(function(){this._stopMovement()}.bind(this),2e3)})})}),define.experiment.component("wysiwyg.viewer.components.TwitterFeed.SyncWixify.New",function(a,b){var c=a;c.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._iframeLoaded=!1,this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=2e3},_renderFeed:function(a){this.isReady()&&(this._iframe?this._iframeLoaded&&this._postMessageToIframe(a):this._createIframe())},_createIframe:function(a){var b=new IFrame({src:this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/twfeed.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",scrolling:"no",events:{load:function(){this._iframeLoaded=!0,this._postMessageToIframe(a)}.bind(this)}});this._iframe=b,this._view.empty(),this._view.grab(b)}})}),define.experiment.component("wysiwyg.viewer.components.TwitterFeed.TwitterAPIpatch.New",function(a,b){var c=a;c.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),c.methods({_renderFeed:function(){if(this.isReady()){this._iframeLoaded=!0;var a=this._data.get("accountToFollow")||"wix";this._skinParts.label.set("html",a),this._skinParts.link.set("href","https://twitter.com/intent/user?screen_name="+a)}}})}),define.experiment.newComponent("wysiwyg.viewer.components.VKShare.VKShare.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.resources(["W.Config","W.Utils","W.Viewer","W.Commands","topology"]),b.propertiesSchemaType("VKShareProperties"),b.dataTypes(["VKShareButton"]),b.skinParts({iframe:{type:"htmlElement"}}),b.binds(["_onPostMessageChangeWidth"]),b.statics({LayoutSize:{Button:{w:100,h:21},ButtonWithoutCounter:{w:64,h:21},Link:{w:50,h:16},LinkWithoutIcon:{w:30,h:16},Icon:{w:36,h:36}}}),b.methods({initialize:function(a,b,c){this._resizableSides=[],window.addEventListener("message",this._onPostMessageChangeWidth,!1),this.parent(a,b,c)},_onRender:function(){var a=this.getDataItem(),b=this.LayoutSize[a.get("style")]||this.LayoutSize.Button;this._createClickOverlayForPreviewMode(),this._changeSize(b.w,b.h),this._skinParts.iframe.setAttribute("src",this._getIframeUrl()),this.parent()},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE];return a.isInvalidated(b)},_onPostMessageChangeWidth:function(a){var b,c;this.getID()===a.data.id&&(b=a.data.width,c=this.getHeight(),this._changeSize(b,c))},_getIframeUrl:function(){var a=this.resources.topology.wysiwyg+"/html/external/VKShare.html";return a+"?"+Object.toQueryString(this._getUrlParams())},_getUrlParams:function(){var a=this.getDataItem();return{id:this.getID(),url:this._getPageUrl()||"",style:a.get("style"),text:a.get("text"),rightAngles:this.getComponentProperty("rightAngles")}},_getPageUrl:function(){var a,b,c="",d=this.resources.W.Viewer;return d.isPublicMode()&&(c=window.publicModel.externalBaseUrl,a=d.getCurrentPageId(),a&&!d.isHomePage()&&(b=d.getPageData(a).get("pageUriSEO"),c+="#!"+b+"/"+a)),c},_changeSize:function(a,b){a===this.getWidth()&&this.isRendered()||(this.setWidth(a),this._skinParts.iframe.setStyle("width",a+"px")),b===this.getHeight()&&this.isRendered()||(this.setHeight(b),this._skinParts.iframe.setStyle("height",b+"px"))}})}),define.experiment.component("wysiwyg.viewer.components.VerticalLine.NBC_VerticalLine.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.skinParts({line:{type:"htmlElement"}}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE];return a.isInvalidated(b)},_onRender:function(){var a=this._skinParts.line.$measure.width;this.setWidth(a)}})}),define.experiment.component("wysiwyg.viewer.components.WFacebookComment.FCommentOnAllPages.New",function(a,b){var c=a;c.methods({_renderComponentOnViewer:function(){var a=this.getState("viewer");return a?"loading"==a||"scriptLoading"==a?(this.callRenderLater(),!1):(this.getComponentProperty("canBeShownOnAllPagesBug")?null!=this.resources.W.Viewer.getCurrentPageId()&&(this.setState("loading","viewer"),this._rebuildFacebookComponent()):(this.setState("loading","viewer"),this._rebuildFacebookComponent()),void 0):(this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","viewer")}.bind(this)),this.callRenderLater(),!1)}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.LinkRefData.New",function(a,b){var c=a,d=b;c.resources(["W.Data"]),c.utilize(d.merge(["core.utils.LinkRenderer"])),c.traits(d.customizeField(function(a){return a.erase("wysiwyg.common.components.traits.LinkableComponent"),a})),c.methods({render:function(){this._styleChanged(),this._renderImage(),this._renderLink(),this.parent()},_onDataChange:d.after(function(){this._isRendered&&this._renderLink()}),_renderLink:function(){var a=this.getDataItem(),b=a._data.link,c=new this.imports.LinkRenderer;if(!b)return c.removeRenderedLinkFrom(this._skinParts.link),void 0;var d=this.resources.W.Data.getDataByQuery("#"+b);d&&c.renderLink(this._skinParts.link,d)}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.MediaGalleryFrame.New",function(a){var b=a;b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{imageType:"single",galleryConfigID:"photos"}},{label:"PHOTO_EDIT_IMAGE",command:"WEditorCommands.OpenAviaryDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{imageType:"single",galleryConfigID:"photos"}}}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.NBC_WPhoto.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.fields({initialize:function(a,b,c){this.parent(a,b,c),this._SettingsClass=this.imports.ImageSettings,this._imageSettings=new this.imports.ImageSettings,this._imageDimensions=new this.imports.ImageDimensionsNew,c&&c.props&&this.setComponentProperties(c.props),this._contentPadding={x:0,y:0}},isRenderNeeded:function(a){return a.isInvalidated([this.INVALIDATIONS.PART_SIZE])||this.parent(a)},_onRender:function(a){var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE])&&(this._updateFramePadding(),this._updateImageSize(this.getWidth(),this.getHeight())),this._updateImageSettings(),b.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._setTitle(),this._checkResizeInFitMode())},setWidth:function(a,b){this.parent(a),this._updateImageSize(a,null),b||(this._changeCropModeInFit(!0),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},setHeight:function(a,b){this.parent(a),this._updateImageSize(null,a),b||(this._changeCropModeInFit(!1),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},_changeCropModeInFit:function(a){this.isDisplayed()&&"fitWidth"===this._getDisplayMode()&&(a?this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_WIDTH):this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_HEIGHT))},_updateImageSize:function(a,b){if(a){var c=a-this._framePadding.x;this._imageSettings.setWidth(c)}if(b){var d=b-this._framePadding.y;this._imageSettings.setHeight(d)}},_setTitle:function(){var a=this._data.get("title");a&&this._skinParts.view.set("title",a)},_checkResizeInFitMode:function(){var a=this._framePadding;if(this._imageSettings.getCropMode()==this._imageSettings.CropModes.FIT_WIDTH){var b=this._skinParts.img.getSize().y;this.setHeight(b+a.y,!0)}else if(this._imageSettings.getCropMode()==this._imageSettings.CropModes.FIT_HEIGHT){var c=this._skinParts.img.getSize().x;this.setWidth(c+a.x,!0)}},_updateImageSettings:function(){var a=this._getImageCropMode();this._imageSettings.setCropMode(a),this._skinParts.img.setSettings&&this._skinParts.img.setSettings(this._imageSettings)},_updateFramePadding:function(){var a=this.getSkin();this._framePadding={x:parseInt(a.getParamValue("contentPaddingLeft"),10)+parseInt(a.getParamValue("contentPaddingRight"),10),y:parseInt(a.getParamValue("contentPaddingTop"),10)+parseInt(a.getParamValue("contentPaddingBottom"),10)}},_getImageCropMode:function(){var a=this.getComponentProperty("displayMode");return"fitWidthStrict"==a&&(a=this._imageSettings.CropModes.FIT_WIDTH),"fitHeightStrict"==a&&(a=this._imageSettings.CropModes.FIT_HEIGHT),a},_setImageArgs:function(a){return a.argObject={requestExactSize:this.resources.W.Viewer.getPreviewMode()!==!0},a},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_isFitMode:function(){var a=["fitWidth","fitWidthStrict","fitHeightStrict"];return a.indexOf(this._getDisplayMode())>=0},render:b.remove()})}),define.experiment.component("wysiwyg.viewer.components.WRichText.NBC_WRichText.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.methods({isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE];return a.isInvalidated(b)},_onRender:function(){this._updateText(),this._setLinksDataToElements("VIEW")},_sanitizeLink:function(a){var b=a.get("href");b&&0!==b.indexOf("http://")&&0!==b.indexOf("https://")&&0!==b.indexOf("telnet://")&&0!==b.indexOf("ftp://")&&0!==b.indexOf("mailto:")&&(b.indexOf("@")>0?a.set("href","mailto:"+b):(0===b.indexOf("www")||0!==b.indexOf("www")&&0!==b.indexOf("#"))&&a.set("href","http://"+b))},_onAllSkinPartsReady:b.remove(),_onDataChange:b.remove()})}),define.experiment.component("wysiwyg.viewer.components.WRichText.Responsive1.New",function(a){var b=a;b.methods({_updateText:function(){this._loadFontsToViewer();var a=this.getDataItem().get("text");a=this._normalizeForMobile(a),this.getRichTextContainer().set("html",a)},_normalizeForMobile:function(a){var b=this._view.getAttribute("textScale");textContentArr=a.split("<");for(var c=0;c<textContentArr.length;c++){var d=-1,e=textContentArr[c];if(-1!=e.indexOf("class")&&b){var f=e.indexOf("class")+7,g=e.indexOf('"',f),h=e.substring(f,g);"font"==W.Theme.getPropertyType(h)&&(d=this._convertSizeToMobile(W.Theme.getOriginalFontSize(h)))}if(-1!=e.indexOf("font-size")){var i=e.indexOf("font-size:"),j=e.indexOf("px",i),k=e.substring(i+10,j);d=this._convertSizeToMobile(parseInt(k)),e=e.replace("font-size:"+k+"px","font-size:"+d+"px")}else-1!=d&&(e=-1!=e.indexOf("style=")?e.replace('style="','style="font-size:'+d+"px;"):e.replace(" ",' style="font-size:'+d+'px;" '));textContentArr[c]=e}return a!=textContentArr.join("<")&&(a=textContentArr.join("<")),a},_convertSizeToMobile:function(a){var b=this._view.getAttribute("textScale");return b?a*parseFloat(b):W.Theme.convertFontSizeToMobile(a)}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Commands"])),c.methods({initialize:d.after(function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.UpdateDocWidth",this,this.render)})})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.MobileBackground.New",function(a,b){var c=a;c.methods({_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"),this._mobileConfig.isAndroidMobileDevice()&&this._view.setStyle("max-height","10000000000px"),this._bgFixed?this._fixBackgroundForFixedBg():this._fixBackgroundForMobile(),this._view.setStyle("-webkit-text-size-adjust","none"),this._view.setStyle("-moz-text-size-adjust","none"),this._view.setStyle("-ms-text-size-adjust","none"))},_fixBackgroundForFixedBg:function(){for(var a=document.body,b=document.createDocumentFragment();a.firstChild;)a.firstChild===this._bgNode?a.removeChild(this._bgNode):b.appendChild(a.firstChild);this._bgNode.appendChild(b),a.appendChild(this._bgNode),this._fixBgHeight(),window.addEvent("orientationchange",this._fixBgHeight),window.addEvent("resize",this._fixBgHeight)},_fixBgHeight:function(){this._bgNode.style.height=window.innerHeight+"px",this._bgNode.style.overflowY="scroll"},_fixBackgroundForMobile:function(){var a=document.body;a.style["background-image"]=this._bgStyle["background-image"],a.style["background-size"]=this._bgStyle["background-size"],a.style["background-position"]=this._bgStyle["background-position"],a.style["background-repeat"]=this._bgStyle["background-repeat"],a.style["background-color"]=this._bgStyle["background-color"],this._bgFixed&&(a.style["background-attachment"]="fixed"),a.removeChild(this._bgNode)}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.MobileFontsPOC.New",function(a,b){var c=a;c.methods({_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"))}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.LimitRecursiveDDM.New",function(a,b){var c=a,d=b;c.binds(["_onButtonDataChange","_onThemeChange","_arrangeButtons","_onButtonClick","_onPageChanged","_resetTestOverFlowCount"]),c.methods({_resetTestOverFlowCount:function(){this._testOverFlowCount=5},initialize:d.after(function(){this._resetTestOverFlowCount()}),_testOverFlow:function(){var a=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=a),a!=this._prevButtonsWidth?this._arrangeButtons():this._testOverFlowCount>0&&(this._testOverFlowCount--,this._overflowID=this.callLater(this._testOverFlow,[],100))},_onThemeChange:d.before(function(){this._resetTestOverFlowCount()}),_onResize:d.before(function(){this._resetTestOverFlowCount()}),_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,function(){this._resetTestOverFlowCount(),this._arrangeButtons()}.bind(this)),this._treeConstructionDone=!1,this._arrangeButtonAccordingToData(),this._constructButtonsTree()}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.PartialComponentPreview.New",function(a,b){var c=a;c.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0,previewable:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}],dblClick:{command:"WEditorCommands.Pages"}},_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.RenamePages.New",function(a,b){var c=a;c.fields({EDITOR_META_DATA:b.merge({custom:[{label:"FPP_RENAME_PAGES_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}]})})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.safari5menufix.New",function(a){var b=a;b.methods({_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var a=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y;this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x,this._skinParts.itemsContainer.setStyle("height",a+"px"),this._skinParts.itemsContainer.setStyle("width","100%"),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal")}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMApplyForMembership.SMForgot_Password.New",function(a,b){var c=a;c.methods({_onFormSuccess:function(){var a=this._emailField._data.get("text"),b="Success! Your member login request has been sent and is awaiting approval. The site administrator will notify you via email ("+a+") once your request has been approved";this._container.showConfirmation({message:b})}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMContainer.SMForgot_Password.New",function(a,b){var c=a,d=b;c.statics({INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",EMAIL_RESET_PASSWORD:"EMAILRESETPASSWORD",RESET_PASSWORD:"RESETPASSWORD"}}),c.methods({initialize:d.after(function(a,b,c){this._shouldCloseContainer=!0,this._formData=c&&c.formData}),_initializeForm:function(a){this._currentForm=a;var b=this._skinParts.title;b.set("html",this._currentForm.getDisplayName());var c=this._skinParts.submitButton;c.set("value",this._currentForm.getButtonLabel());var d=this._skinParts.note,e=this._currentForm.getSubHeaderElement();if(e){var f=e.el,g=e.intent;f.getElements("a").addEvent("click",function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:g,disableCancel:this._disableCancel,openedByPageSecurity:this._openedByPageSecurity,hashRedirectTo:this._hashRedirectTo,formData:this._formData})}.bind(this)),d.adopt(f.childNodes)}this._addCurrentFormEvents(),this._openedByPageSecurity&&(this.resources.W.Viewer.isPublicMode()||this.resources.W.Config.isInDebugMode()?(this._skinParts.infoTitle.set("text","To view this page, you need to be logged in."),this._skinParts.note.setStyle("float","right"),this._skinParts.infoTitle.setStyle("display","block")):this.showConfirmation("This page is protected with a member login. Your users will be able to see this page once they are logged in. To manage your site's members, go to your site in My Account and click Site Members",function(){this.reportAuthStatusChange(!0),this._closeSMContainer()}.bind(this)))},_createInnerDialog:function(a){return this._assureIntentExists(),this._enrichDefinitionByType(a),a},_assureIntentExists:function(){var a=this.resources.W.SiteMembers;this._intent||(this._intent=a.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER)},_enrichDefinitionByType:function(a){var b=null;switch(this._intent){case this.INTENTS.REGISTER:var c=this.resources.W.SiteMembers.getCollectionType();switch(c){case"Open":b="register";break;case"ApplyForMembership":b="applyForMembership";break;default:b="register"}break;case this.INTENTS.LOGIN:b="login";break;case this.INTENTS.EMAIL_RESET_PASSWORD:b="ResetPasswordEmail";break;case this.INTENTS.RESET_PASSWORD:b="ResetPassword"}return null!==b&&this._enrichDefinitionType(a,b),a},_enrichDefinitionType:function(a,b){a.type="wysiwyg.viewer.components.sm.SM"+b.capitalize(),a.skin="wysiwyg.viewer.skins.sm.SM"+b.capitalize()+"Skin",a.argObject={container:this,formData:this._formData}},_setConfirmationOkCaption:function(a){this._skinParts.okButton.value=a},showConfirmation:function(a,b,c){this.setState("confirm"),this._updateConfirmationDialogTexts(a),this._confirmCallback=b,this._shouldCloseContainer=c,void 0===c&&(this._shouldCloseContainer=!0)},_updateConfirmationDialogTexts:function(a){this._skinParts.confirmationText.set("text",a.message),this._skinParts.confirmationTitleText.set("text",a.title)},_handleConfirmationOk:function(){this._confirmCallback&&this._confirmCallback(),this._shouldCloseContainer&&this._closeSMContainer(),this._shouldCloseContainer=!0},closeAndRedirectTo:function(a){if(this._closeSMContainer(),this._hashRedirectTo){var b=this.resources.W.Utils.hash.getHashParts(this._hashRedirectTo);this.resources.W.Utils.hash.setHash(b.id,b.title,b.extData,!0),window.location.hash=this._hashRedirectTo}a?this._directToUrl(a):this._reload()},_directToUrl:function(a){location.href=a},_reload:function(){location.reload()}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMForm.SMForgot_Password.New",function(a,b){var c=a;c.statics({PASS_MIN_LEN:4,PASS_MAX_LEN:15,ERR_MAP:{GENERAL_ERR:"Server error. try again later.",VAL_ERR_PASSWORD_BLANK:"Password cannot be blank",VAL_ERR_PASSWORD_RETYPE:"Passwords are not the same",VAL_ERR_PASSWORD_LENGTH:"Password length must be between {0} and {1}",VAL_ERR_EMAIL_BLANK:"Email cannot be blank",VAL_ERR_EMAIL_INVALID:"Email is invalid","-19999":"Unknown user","-19995":"Email is already taken","-19972":"Invalid token","-19988":"Validation Error","-19984":"Invalid Session","-19976":"Wrong email or password","-19958":"Your member request is waiting approval from the site owner"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE",EMAIL_RESET_PASSWORD:"EMAILRESETPASSWORD",RESET_PASSWORD:"RESETPASSWORD"},LABELS:{EMAIL:"Email",PASSWORD:"Password",RE_PASSWORD:"Retype password",REMEMBER_ME:"Remember Me"}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMForm.SMPasswordPoundCharFix.New",function(a,b){var c=a,d=b;c.statics({ERR_MAP:d.merge({VAL_ERR_NON_ASCII_CHARS:"Password must contain only ASCII characters"})})}),define.experiment.Class("wysiwyg.viewer.components.sm.SMFormValidationHelper.SMPasswordPoundCharFix.New",function(a,b){var c=a,d=b;c.methods({_isAsciiOnlyInput:function(a){for(var b=a.length,c=this.PASS_MAX_LEN,d=0;b>d&&c>d;d++)if(a.charCodeAt(d)>127)return!1;return!0},isPasswordCharsValid:d.remove()})}),define.experiment.component("wysiwyg.viewer.components.sm.SMLogin.SMForgot_Password.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.components.sm.SMForm"),c.resources(["W.Data","W.SiteMembers","W.Utils"]),c.utilize(["wysiwyg.viewer.components.sm.SMFormValidationHelper"]),c.statics({CAPTIONS:{FORGOT_PASSWORD:"Forgot your password?",LOGIN:"Login",GO:"GO",SIGN_UP:"Or {0}Sign up{1}"}}),c.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},rememberMe:{type:"wysiwyg.viewer.components.inputs.CheckBoxInput",hookMethod:"_bindCheckBoxDataItem"},forgotPass:{type:"htmlElement"}}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._formData=c&&c.formData,this._initEnteredEmail()},_initEnteredEmail:function(){this._enteredEmail=this._formData&&this._formData.enteredEmail||""},_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rememberMeField=this._skinParts.rememberMe,this._forgotPasswordField=this._skinParts.forgotPass,this._forgotPasswordField.innerHTML=this.CAPTIONS.FORGOT_PASSWORD,this._forgotPasswordField.addEvent("click",function(){this._closeAndRedirectToEmailReset()
}.bind(this)),this._updateEmailWithUserInput()},_updateEmailWithUserInput:function(){var a=this._emailField.getDataItem();a._data.text=this._enteredEmail,this._emailField.setDataItem(a),this._emailField._skinParts.input.value=this._enteredEmail},_closeAndRedirectToEmailReset:function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:this.INTENTS.EMAIL_RESET_PASSWORD,formData:{enteredEmail:this._emailField._data.get("text")}})},onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rememberMeField._data.get("value");this._validateFields(a,b)&&this.resources.W.SiteMembers.login(a,b,c,this._onFormSuccess,this._onFormError)},_onFormSuccess:function(){var a=this._removeResetForgotPasswordParameterIfExists();this._container.closeAndRedirectTo(a)},_removeResetForgotPasswordParameterIfExists:function(){var a=window.location.href;return a.indexOf(this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER)>=0?this._removeParameterFromUrl(a,this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER):a},_removeParameterFromUrl:function(a,b){if(a&&b){var c=a.indexOf(b);if(c>=0){var d=a.substr(c).indexOf("&");return 0>d&&(d=a.length),a.slice(0,c)+a.slice(c+d+"&".length)}}return a},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.LOGIN},getButtonLabel:function(){return this.CAPTIONS.GO},getSubHeaderElement:function(){var a=new Element("DIV"),b=this.CAPTIONS.SIGN_UP;return b=this._formatString(b,["<a>","</a>"]),a.set("html",b),{el:a,intent:this.INTENTS.REGISTER}},_formatString:function(a,b){var c=0;return b.map(function(b){var d="{"+c+"}";a=a.replace(d,b),c++}),a},_bindCheckBoxDataItem:function(a){return a.dataItem=this.resources.W.Data.createDataItem({value:"false",type:"Boolean"},"Boolean"),a.dataItem.setMeta("isPersistent",!1),a.argObject={label:this.LABELS.REMEMBER_ME},a}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMLogin.SMPasswordPoundCharFix.New",function(a){var b=a;b.methods({onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rememberMeField._data.get("value");this._validateFields(a,b)&&(b=this.resources.W.Utils.encodeValue(b),this.resources.W.SiteMembers.login(a,b,c,this._onFormSuccess,this._onFormError))},_validatePassword:function(a,b){return a.isBlankPassword(b)?(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_BLANK"),!1):a.isPasswordLengthValid(b)?!0:(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_LENGTH",[this.PASS_MIN_LEN,this.PASS_MAX_LEN]),!1)}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMLogin.SiteMembersCommon.New",function(a){var b=a;b.utilize(["wysiwyg.viewer.components.sm.SMFormValidationHelper"]),b.methods({_validateFields:function(a,b){this._passwordField.setValidationState(!0),this._emailField.setValidationState(!0);var c=new this.imports.SMFormValidationHelper,d=this._validateEmail(c,a),e=this._validatePassword(c,b);return d&&e},_validateEmail:function(a,b){return a.isEmailBlank(b)?(this._displayErrorOn(this._emailField,"VAL_ERR_EMAIL_BLANK"),!1):a.isEmailValid(b)?!0:(this._displayErrorOn(this._emailField,"VAL_ERR_EMAIL_INVALID"),!1)},_validatePassword:function(a,b){return a.isBlankPassword(b)?(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_BLANK"),!1):a.isPasswordLengthValid(b)?!0:(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_LENGTH",[this.PASS_MIN_LEN,this.PASS_MAX_LEN]),!1)},_displayErrorOn:function(a,b,c){a.setValidationState(!1),this._onFormError({errorCode:b,errorParams:c},a)}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMRegister.SMPasswordPoundCharFix.New",function(a,b){var c=a;c.utilize(["wysiwyg.viewer.components.sm.SMFormValidationHelper"]),c.methods({onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rePasswordField._data.get("text");this._validateFields(a,b,c)&&(b=this.resources.W.Utils.encodeValue(b),this.resources.W.SiteMembers.register(a,b,this._onFormSuccess,this._onFormError))},_validateFields:function(a,b,c){this._passwordField.setValidationState(!0),this._rePasswordField.setValidationState(!0),this._emailField.setValidationState(!0);var d=new this.imports.SMFormValidationHelper,e=this._validateEmail(d,a),f=this._validatePassword(d,b,c);return e&&f},_validateEmail:function(a,b){return a.isEmailBlank(b)?(this._displayErrorOn(this._emailField,"VAL_ERR_EMAIL_BLANK"),!1):a.isEmailValid(b)?!0:(this._displayErrorOn(this._emailField,"VAL_ERR_EMAIL_INVALID"),!1)},_validatePassword:function(a,b,c){return a.isBlankPassword(b)?(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_BLANK"),!1):a._isAsciiOnlyInput(b)?a.isPasswordLengthValid(b)?a.doPasswordsMatch(b,c)?!0:(this._displayErrorOn(this._rePasswordField,"VAL_ERR_PASSWORD_RETYPE"),!1):(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_LENGTH",[this.PASS_MIN_LEN,this.PASS_MAX_LEN]),!1):(this._displayErrorOn(this._passwordField,"VAL_ERR_NON_ASCII_CHARS"),!1)},_displayErrorOn:function(a,b,c){a.setValidationState(!1),this._onFormError({errorCode:b,errorParams:c},a)}})}),define.experiment.newComponent("wysiwyg.viewer.components.sm.SMResetPassword.SMForgot_Password.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.components.sm.SMForm"),c.binds(["_onSuccessfulReset","_onFailedReset"]),c.resources(["W.SiteMembers"]),c.skinParts({formMessage:{type:"htmlElement"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindNewPasswordField"},passwordRetype:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordRetypeField"}}),c.statics({CAPTIONS:{RESET_PASSWORD_MESSAGE:"To set your new password, please enter it in both fields below. ",ENTER_NEW_PASSWORD:"Enter a new password:",RETYPE_PASSWORD:"Type again:",FORM_TITLE:"Reset Password",SUBMIT_BUTTON_LABEL:"GO",CONFIRMATION_BUTTON_CAPTION:"Continue"},MESSAGES:{RESET_SUCCESS:"Youve successfully reset your password.",RESET_FAILED:"Password could not have been changed. Try again later."}}),c.methods({_onAllSkinPartsReady:function(){this._formMessage=this._skinParts.formMessage,this._password=this._skinParts.password,this._passwordRetype=this._skinParts.passwordRetype,this._formMessage.innerText=this.CAPTIONS.RESET_PASSWORD_MESSAGE},onSubmit:function(){this._isPasswordValid()&&this._doPasswordsMatch()&&this._resetPassword()},_resetPassword:function(){var a=this._getTextInputFromField(this._password),b=this.resources.W.SiteMembers;b.resetPassword(a,this._onSuccessfulReset,this._onFailedReset)},_getCurrentSearchURL:function(){return window.location.search},_onSuccessfulReset:function(){this._container._setConfirmationOkCaption(this.CAPTIONS.CONFIRMATION_BUTTON_CAPTION),this._container.showConfirmation({message:this.MESSAGES.RESET_SUCCESS},this._closeAndRedirectToLogin(),!1)},_closeAndRedirectToLogin:function(){var a=this;return function(){a.resources.W.SiteMembers.openSiteMembersPopup({intent:a.INTENTS.LOGIN})}},_onFailedReset:function(){this._container.showConfirmation(this.MESSAGES.RESET_FAILED,this._closeSMContainer)},_isPasswordValid:function(){this._password.setValidationState(!0),this._passwordRetype.setValidationState(!0);var a=this._password._data.get("text");return a?a.length<this.PASS_MIN_LEN||a.length>this.PASS_MAX_LEN?(this._password.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._password),!1):!0:(this._password.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._password),!1)},_doPasswordsMatch:function(){var a=this._getTextInputFromField(this._password),b=this._getTextInputFromField(this._passwordRetype);return this._passwordRetype.setValidationState(!0),a!==b?(this._passwordRetype.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_RETYPE"},this._passwordRetype),!1):!0},_getTextInputFromField:function(a){var b=a._data.get("text");return b},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.FORM_TITLE},getButtonLabel:function(){return this.CAPTIONS.SUBMIT_BUTTON_LABEL},getSubHeaderElement:function(){return null},_bindNewPasswordField:function(a){return this._bindPasswordField(a,this.CAPTIONS.ENTER_NEW_PASSWORD)},_bindPasswordRetypeField:function(a){return this._bindPasswordField(a,this.CAPTIONS.RETYPE_PASSWORD)},_bindPasswordField:function(a,b){return a.argObject={label:b,passwordField:!0},this._bindTextDataItem(a)}})}),define.experiment.newComponent("wysiwyg.viewer.components.sm.SMResetPasswordEmail.SMForgot_Password.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.components.sm.SMForm"),c.resources(["W.Data","W.SiteMembers","W.Utils"]),c.statics({CAPTIONS:{FORM_TITLE:"Reset Password",SUBMIT_BUTTON_LABEL:"GO",BACK_TO_LOGIN:"Back to Login",EMAIL_TITLE:"Please enter your email address",CONFIRMATION_TITLE:"Please check your email",CONFIRMATION_MSG:"Weve sent you an email with a link that will allow you to reset your password"}}),c.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"}}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._enteredEmail=c&&c.formData&&c.formData.enteredEmail||""},_onAllSkinPartsReady:function(){this._email=this._skinParts.email,this._updateEmailWithUserInput()},_updateEmailWithUserInput:function(){var a=this._email.getDataItem();a._data.text=this._enteredEmail,this._email.setDataItem(a),this._email._skinParts.input.value=this._enteredEmail},_getEmailInput:function(){return this._email._data.get("text")},onSubmit:function(){var a=this._getEmailInput();if(this._isEmailFieldValid(a)){var b=this.resources.W.SiteMembers;b.sendUserPasswordResetEmail(a,this._onFormSuccess,this._onFormError)}},_isEmailFieldValid:function(a){return this._email.setValidationState(!0),a?this.resources.W.Utils.isValidEmail(a)?!0:(this._email.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._email),!1):(this._email.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._email),!1)},_bindEmailField:function(a){return a.argObject={label:this.CAPTIONS.EMAIL_TITLE},this._bindTextDataItem(a)},_onFormSuccess:function(){this._closeAndRedirectToConfirmationDialog()},_closeAndRedirectToConfirmationDialog:function(){this._container.showConfirmation({title:this.CAPTIONS.CONFIRMATION_TITLE,message:this.CAPTIONS.CONFIRMATION_MSG},this._closeSMContainer)},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.FORM_TITLE},getButtonLabel:function(){return this.CAPTIONS.SUBMIT_BUTTON_LABEL},getSubHeaderElement:function(){var a=new Element("DIV"),b=this.CAPTIONS.BACK_TO_LOGIN;return a.set("html","<a>"+b+"</a>"),{el:a,intent:this.INTENTS.LOGIN,formData:{enteredEmail:function(){this._email._data.get("text")}.bind(this)}}}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPathParser.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.pathElement=a},getParsedPath:function(){var a=this.pathElement.getAttribute("d"),b=a.match(/[a-z][^a-z]*/gi),c=b.map(function(a){for(a=a.replace(/-/g," -").replace(/,/g," ");-1!==a.indexOf("  ");)a=a.replace(/  /g," ");return[a.substring(0,1),this.trim(a.substring(1))]}.bind(this));return c.map(function(a){var b,c=[];return-1==="QSCL".indexOf(a[0].toUpperCase())||1!==a[1].split(",").length?a:(b=a[1].split(" "),0!==b.length%2?a:(b.forEach(function(a,b,d){0===b%2&&c.push(a+" "+d[b+1])}),[a[0],c.join(",")]))})},stringifyParsedPath:function(a){var b="";return a.forEach(function(a){a.forEach(function(a){b+=a})}),b}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPathScaler.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgPathParser"]),b.methods({initialize:function(a){this.pathElement=a,this.parser=new this.imports.SvgPathParser(this.pathElement),this._createScalers()},_createScalers:function(){this._commandScalers={M:this._scalePairString,L:this._scaleMultiplePairStrings,H:this._scaleSingleValueHorizontal,V:this._scaleSingleValueVertical,Z:this._emptyString,C:this._scaleMultiplePairStrings,S:this._scaleMultiplePairStrings,Q:this._scaleMultiplePairStrings,T:this._scalePairString,A:this._scaleArcString}},_emptyString:function(){return""},_scaleSingleValue:function(a,b){return this.round(parseFloat(a)*b)},_scaleAngleValue:function(a){return this._scaleSingleValue(a,this.scaleY/(360*this.scaleX))},_scaleSingleValueHorizontal:function(a){return this._scaleSingleValue(a,this.scaleX)},_scaleSingleValueVertical:function(a){return this._scaleSingleValue(a,this.scaleY)},_scalePairString:function(a){var b=a.split(/[\s,]+/);return this._scaleSingleValueHorizontal(b[0])+" "+this._scaleSingleValueVertical(b[1])},_scaleMultiplePairStrings:function(a){var b=a.split(",").map(function(a){return this._scalePairString(this.trim(a))}.bind(this));return b.join(",")},_scaleArcString:function(a){var b=a.split(/[\s,]+/);if(7!==b.length)throw new Error("incorrect arc string, should have exactly 7 parameters. (value was "+a);return b[0]=this._scaleSingleValueHorizontal(b[0]),b[1]=this._scaleSingleValueVertical(b[1]),b[2]=this._scaleAngleValue(b[2]),b[5]=this._scaleSingleValueHorizontal(b[5]),b[6]=this._scaleSingleValueVertical(b[6]),b.join(" ")},scale:function(a,b){var c=this.parser.getParsedPath();this.scaleX=a,this.scaleY=b,c.forEach(function(a){a[1]=this._commandScalers[a[0].toUpperCase()].call(this,a[1])}.bind(this)),this.pathElement.setAttribute("d",this.parser.stringifyParsedPath(c))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPolygonParser.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.polygonElement=a},getParsedPoints:function(){var a,b=this.trim(this.polygonElement.getAttribute("points")).split(/[\s,]+/),c=[];for(a=0;a<b.length;a+=2)c.push([b[a],b[a+1]]);return c},stringifyPoints:function(a){var b="";return a.forEach(function(a){b+=a.join(",")+" "}),b}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPolygonScaler.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgPolygonParser"]),b.methods({initialize:function(a){this.polygonElement=a,this.parser=new this.imports.SvgPolygonParser(this.polygonElement)},scale:function(a,b){var c=this.parser.getParsedPoints();c.forEach(function(c){c[0]=this.round(c[0]*a),c[1]=this.round(c[1]*b)}.bind(this)),this.polygonElement.setAttribute("points",this.parser.stringifyPoints(c))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgRectScaler.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.rectElement=a,this._resetRectOrigin()},_resetRectOrigin:function(){this.rectElement.setAttribute("x","0"),this.rectElement.setAttribute("y","0")},scale:function(a,b){var c=this.rectElement.getAttribute("width"),d=this.rectElement.getAttribute("height"),e=this.rectElement.getAttribute("rx"),f=this.rectElement.getAttribute("ry");c&&this.rectElement.setAttribute("width",a*parseInt(c,10)),d&&this.rectElement.setAttribute("height",b*parseInt(d,10)),e&&this.rectElement.setAttribute("rx",a*parseInt(e,10)),f&&this.rectElement.setAttribute("ry",a*parseInt(f,10))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgScaler.SvgShapeComponent.New",function(a){var b=a;b.utilize(["wysiwyg.viewer.components.svgshape.SvgPathScaler","wysiwyg.viewer.components.svgshape.SvgPolygonScaler","wysiwyg.viewer.components.svgshape.SvgRectScaler"]),b.resources(["W.Config"]),b.methods({initialize:function(a){this.svgElement=a,this.groupElement=this.svgElement.getElementsByTagName("g")[0],this._initializeScalers()},_initializeScalers:function(){this.scalers=[],this.groupElement.getChildren().forEach(function(a){this.scalers.push(this._createScaler(a))}.bind(this))},_createScaler:function(a){var b=a.nodeName.toLowerCase();switch(b){case"path":return new this.imports.SvgPathScaler(a);case"polygon":return new this.imports.SvgPolygonScaler(a);case"rect":return new this.imports.SvgRectScaler(a);default:throw new Error("Can't create a scaler for \""+b+'" element, because it is not implemented.')}},setSvgSize:function(a,b){this.svgElement.style.width=a+"px",this.svgElement.style.height=b+"px"},getActualDimensions:function(){var a=this.groupElement.getBBox();return{width:Math.round(a.width),height:Math.round(a.height),x:Math.round(a.x),y:Math.round(a.y)}},setGroupElementPosition:function(){var a=this.getActualDimensions();this.groupElement.setAttribute("transform","translate("+-1*a.x+","+-1*a.y+")")},scale:function(a,b){this.scalers.forEach(function(c){c.scale(a,b)})}})}),define.experiment.newComponent("wysiwyg.viewer.components.svgshape.SvgShape.SvgShapeComponent.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgScaler"]),b.dataTypes(["SvgShapeDataSchema"]),b.resources(["W.Utils","W.Viewer"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_onRender:function(a){var b,c,d,e=a.data.invalidations,f=!1;e.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&(f=!0,this._destroyScaler()),this._initializeScaler(),b=this.svgScaler.getActualDimensions(),c={width:parseInt(this.$view.style.minWidth,10),height:parseInt(this.$view.style.minHeight,10)},d=this.calculateScale(b,c),(1!==d.scaleX||1!==d.scaleY||f)&&(this.svgScaler.setSvgSize(c.width,c.height),this.svgScaler.scale(d.scaleX,d.scaleY),this.svgScaler.setGroupElementPosition())},calculateScale:function(a,b){return{scaleX:this.round(b.width/a.width),scaleY:this.round(b.height/a.height)}},_initializeScaler:function(){this.svgElement||(this.svgElement=this.$view.getElementsByTagName("svg")[0]),this.svgScaler||(this.svgScaler=new this.imports.SvgScaler(this.svgElement))},_destroyScaler:function(){this.svgElement=null,this.svgScaler=null}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils.SvgShapeComponent.New",function(a){var b=a;b.methods({trim:function(a){return a.replace(/^\s+|\s+$/g,"")},round:function(a){return Math.round(1e6*a)/1e6}})}),define.experiment.newClass("wysiwyg.viewer.components.traits.CustomPreviewBehavior.CustomPreviewBehavior.New",function(a){var b=a;b.resources(["W.Config","W.Viewer","W.Commands"]),b.methods({_isPreviewMode:function(){return!this.resources.W.Viewer.isPublicMode()},_overlayElementExists:function(){return!!this._overlayElement},_createOverlayElement:function(){this._overlayElement=new Element("A")},_createOverlayElementStyles:function(){var a=this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/transparent.gif";this._overlayElement.setStyles({position:"absolute",top:"0",left:"0",height:"100%",width:"100%",background:"transparent url("+a+") repeat top left;"})},_bindOverlayElementEvents:function(){this._overlayElement.addEvent("click",function(a){a.stopPropagation(),this.resources.W.Commands.executeCommand("socialWidget.interact",{component:this},this)}.bind(this))},_createClickOverlayForPreviewMode:function(){this._isPreviewMode()&&!this._overlayElementExists()&&(this._createOverlayElement(),this._createOverlayElementStyles(),this._bindOverlayElementEvents(),this.getViewNode().adopt(this._overlayElement))}})}),define.experiment.newClass("wysiwyg.viewer.components.traits.MediaGalleryInteraction.DocumentMedia.New",function(a){var b=a;b.resources(["W.Config","W.Viewer","W.Commands"]),b.methods({_setDownloadLink:function(a,b){a.setComponentProperty("fileName",b.title),a.setComponentProperty("title",b.title),a._data.set("linkType","DOCUMENT"),a._data.set("href",serviceTopology.staticDocsUrl+"/"+b.uri),a._data.set("target","_blank")}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.BetterPrefetch.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Viewer","W.Utils"])),c.methods({initialize:d.after(function(){this._TIME_BETWEEN_PAGES_RETRIEVAL=1e4,this._lazilyLoadedPage=0}),_loadAllPagesLazily:function(){var a=this._getNextUnloadedPage();a&&this._lazilyLoadedPage<5&&(this._lazilyLoadedPage++,this.loadPageById(a.pageId),W.Utils.callLater(this._loadAllPagesLazily,[],this,this._TIME_BETWEEN_PAGES_RETRIEVAL))},_loadSiteNewVersion:function(){this._loadAllPages(this._getPagesToLoad()),this.getMasterPageData(this._createMasterPage),this.resources.W.Viewer.addEvent("SiteReady",this.resources.W.Utils.callLater.bind(this.resources.W.Utils,this._loadAllPagesLazily,[],this,15e3))}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.EditorRenderSiteFromJson.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Data","W.Viewer","dataFixer"])),c.methods({initialize:d.after(function(){this.dataFixer=this.resources.dataFixer}),loadSite:function(){this._isRenderFromJson()?this._renderSiteFromJson():this._isOldPageVersion()?this._renderSiteFromStructure():this._loadSiteNewVersion()},_isRenderFromJson:function(){return void 0!==window.siteAsJson},_renderSiteFromStructure:function(){this.resources.W.Data.getDataByQuery("#SITE_STRUCTURE",function(a){this.resources.W.Viewer.setSite($("SITE_STRUCTURE"),a)}.bind(this))},_renderSiteFromJson:function(){var a=window.siteAsJson;this._setInitData(a.masterPage.data);var b=this._createSiteStructureNode();a.masterPage.structure.children.each(function(a){b.grab(this._createPageElements(a))}.bind(this)),this._attachMasterPage(b),a.pages.forEach(function(a){this._setInitDataForPage(a.data);var b=this._createPageElements(a.structure);$("SITE_PAGES").grab(b)}.bind(this)),this._renderSiteFromStructure()}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.EditorScripting.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.ScriptingManager"])),c.methods({_createElement:d.after(function(a){a.behaviors&&this.resources.W.ScriptingManager.registerScript(a.componentName||a.id,a.behaviors)}),_buildComponentProperties:d.around(function(a,b){var c=a();return b.componentName&&(c.compName=b.componentName),c})})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.LazyPageBI.New",function(a,b){"use strict";var c=a,d=b;c.methods({initialize:d.after(function(){this._isPageRetrievalIsLazy={}}),_getErrorCallbackForUrl:function(a,b,c){if(1==a.length)return function(){c&&this._loadingPages.splice(this._loadingPages.indexOf(c.pageId),1),this._reportTotalFailure(c.pageId)}.bind(this);var d=a.clone();return d.splice(0,1),function(){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",d[0]),this._requestPageJson(d,b,c)}.bind(this)},_reportTotalFailure:function(a){var b=wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED;this._isPageRetrievalIsLazy[a]&&(b=wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED_FOR_LAZY_PAGE_LOAD,delete this._isPageRetrievalIsLazy[a]),LOG.reportError(b,"PageManager","loadPageById")},_loadAllPagesLazily:function(){var a=this._getNextUnloadedPage();a&&(this._isPageRetrievalIsLazy[a.pageId]=!0,this.loadPageById(a.pageId),W.Utils.callLater(this._loadAllPagesLazily,[],this,this._TIME_BETWEEN_PAGES_RETRIEVAL))}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.MobileViewerQuickActions.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.utilize(d.merge(["wysiwyg.viewer.managers.utils.MobileQuickActionsHandler"])),c.methods({_createMasterPage:d.after(function(){if(this.resources.W.Config.mobileConfig.isMobile()){var a=new this.imports.MobileQuickActionsHandler;a.handleMobileQuickActions()}})})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.PageLoadReport.New",function(a,b){var c=a,d=b;c.methods({_loadSiteNewVersion:d.around(function(a){try{a()}catch(b){LOG.reportError(wixErrors.PAGE_FETCHING_ERROR,"PageManager","_loadSiteNewVersion")}}),_requestPageJson:function(a,b,c){var d=a[0];c?c.lastTriedUrl=d:this._sorryNadavToldMeToSaveThePageUrlHere=d;var e=b;b.wrapper||(new Date,e=function(){var a=c?c.lastTriedUrl:this._sorryNadavToldMeToSaveThePageUrlHere;this._logPageError("page loaded",a,c,e.initTime,200),b.apply(this,arguments)}.bind(this),e.wrapper=!0,e.initTime=new Date),this._logPageError("try page load",d,c,e.initTime),this._restClient.get(d,void 0,{onSuccess:e,onError:this._getErrorCallbackForUrl(a,e,c)})},_getErrorCallbackForUrl:function(a,b,c){var d=a[0];if(1==a.length)return function(a,e){c&&this._loadingPages.splice(this._loadingPages.indexOf(c.pageId),1),LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","_requestPageJson"),this._logPageError("total fail",d,c,b.initTime,e,a)}.bind(this);var e=a.clone();return e.splice(0,1),function(a,f){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",e[0]),this._logPageError("attempt fail",d,c,b.initTime,f,a),this._requestPageJson(e,b,c)}.bind(this)},_logPageError:function(a,b,c,d,e,f){var g=new Date,h=b.substr(7).substr(0,b.substr(7).indexOf("/")),g=d?g-d:"",i=c?c.pageId:"masterPage";deployStatus("pageLoad",{type:a,host:h,time:g,pageId:i,httpsStatus:e,errorDesc:f,sessionTime:LOG.getSessionTime()})}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.Responsive1.New",function(a,b){var c=a,d=b;c.utilize(d.merge(["wysiwyg.viewer.responsive.ResponsiveAlgorithmAPI"])),c.methods({initialize:d.after(function(){this._responsiveAlgorithmAPI=new this.imports.ResponsiveAlgorithmAPI}),_createMasterPage:function(a){var b=this._getJsonForString(a),c=b.data||b.payload.data;this._setInitData(c);var d=this._createSiteStructureNode(),e=b.structure||b.payload.structure;if(this._responsiveAlgorithmAPI.modifyStylesToFitMobileLayout(),this._runResponsiveAlgorithm(e,"masterPage"),e.children.each(function(a){d.grab(this._createPageElements(a))}.bind(this)),this._attachMasterPage(d),this.fireEvent("MASTER_PAGE_WAS_LOADED"),this._addPagesStubs(),this.resources.W.Config.mobileConfig.isMobile()){var f=new this.imports.MobileQuickActionsHandler;f.handleMobileQuickActions()}},createPage:function(a){var b=this._getJsonForString(a),c=b.data||b.payload.data;this._setInitDataForPage(c);var d=b.structure||b.payload.structure;this._runResponsiveAlgorithm(d,"page");var e=this._createPageElements(d);this._attachPageWhenReady(e,d.id)},_runResponsiveAlgorithm:function(a,b){this.responsiveAlgorithmStringifiedJSONs=this.responsiveAlgorithmStringifiedJSONs||{};var c="page"==b?a.id:"masterPage";this.responsiveAlgorithmStringifiedJSONs[c]={jsonBefore:JSON.stringify(a)},"page"==b&&(this.responsiveAlgorithmStringifiedJSONs[c].title=W.Data.getDataByQuery(a.dataQuery).get("title")),this._responsiveAlgorithmAPI.convertStructureToMobileLayout(a,b),this.responsiveAlgorithmStringifiedJSONs[c].jsonAfter=JSON.stringify(a)},_buildComponentProperties:function(a){if(!a)return{};var b={id:a.id,comp:a.componentType,skin:"wysiwyg.viewer.components.PagesContainer"==a.componentType?"wysiwyg.viewer.skins.screenwidthcontainer.BlankScreen":a.skin,styleId:a.styleId};return a.dataQuery&&(b.dataQuery=0!=a.dataQuery.indexOf("#")?"#"+a.dataQuery:a.dataQuery),a.propertyQuery&&(b.propertyQuery=0!=a.propertyQuery.indexOf("#")?"#"+a.propertyQuery:a.propertyQuery),a.layout&&(b.width=a.layout.width,b.height=a.layout.height,b.x=a.layout.x,b.y=a.layout.y),a.needsToEnforceAnchors&&(b.needsToEnforceAnchors=a.needsToEnforceAnchors),a.textScale&&(b.textScale=a.textScale),a.layoutType&&(b.layoutType=a.layoutType),b}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.WixAppsPage.New",function(a,b){var c=a,d=b;c.utilize(d.merge(["wysiwyg.common.utils.PageConfigurationFactory"])),c.methods({initialize:d.after(function(){this._pageConfigurationFactory=new this.imports.PageConfigurationFactory,this._pageConfigurationFactory.registerPageType("Page",function(a){return a.type}),this._pageConfigurationFactory.registerConfig("Page",{})}),getPageConfigurationFactory:function(){return this._pageConfigurationFactory},getPageConfig:function(a){return this._pageConfigurationFactory.getConfig(a)},_addPagesStubs:function(){Object.each(this._getPagesList().pages,function(a){this._createStubPageAsync(a,function(a){$("SITE_PAGES").grab(a)})}.bind(this))},_createStubPageAsync:function(a,b){W.Data.getDataByQuery("#"+a.pageId,function(c){var d=c.getData().type,e=this._createStubPage(a,d);b(e)}.bind(this))},_createStubPage:function(a,b){var c=new Element("div");return c.set({id:a.pageId,comp:this._getPageFullQualifier(b),skin:"mobile.core.skins.InlineSkin",dataQuery:"#"+a.pageId}),c},_getPageFullQualifier:function(a){return pageQ={Page:"mobile.core.components.Page",AppPage:"wixapps.integration.components.AppPage"},pageQ[a]}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.NewFetchPolicy.New",function(a,b){"use strict";var c=a,d=b;c.methods({initialize:d.after(function(){this._loadedPages=[],this._loadingPages=[],this._loadingPagesTrialCounter={},this._getPagesList()&&this._getPagesList().pages.each(function(a){this._loadingPagesTrialCounter[a.pageId]=!1}.bind(this)),this._callBacksForPageCreation={}}),_cratePageRequesters:function(){var a=this._getPagesList().pages;a.forEach(function(a){var b=a.urls.map(function(a){return resource.url(a,this._getRequestMethod(a),this._shouldLoadOnce(a))},this);define.resource(this._getResourceIdFromPageID(a.pageId)).withUrls(b).withTrials(3).withTimeBetween(3e3)},this);var b=this._getPagesList().masterPage.map(function(a){return resource.url(a,this._getRequestMethod(a),this._shouldLoadOnce(a))},this);define.resource(this._getResourceIdFromPageID("master")).withUrls(b).withTrials(3).withTimeBetween(3e3)},_getResourceIdFromPageID:function(a){return"pages."+a},_isStaticPage:function(a){return!~a.indexOf("archive.")},_getRequestMethod:function(a){return this._isStaticPage(a)?"cors":"jsonp"},_shouldLoadOnce:function(a){return!!this._isStaticPage(a)},_loadSiteNewVersion:d.before(function(){this._cratePageRequesters()}),_reportTotalFailure:function(){LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","loadPageById")},loadPageById:function(a,b,c){this._callBacksForPageCreation[a]={method:b,scope:c};var d=function(a){a.startContentCreation||(a.startContentCreation=!0,this.createPage(a))}.bind(this);this._loadingPagesTrialCounter[a]=!0,resource.getResourceValue(this._getResourceIdFromPageID(a),d,this._reportTotalFailure.bind(this,a))},_getNextUnloadedPage:function(){return this._getPagesList().pages.first(function(a){return!this.isPageLoaded(a.pageId)&&!this._loadingPagesTrialCounter[a.pageId]}.bind(this))},getMasterPageData:function(a){resource.getResourceValue(this._getResourceIdFromPageID("master"),a,this._reportTotalFailure)},_attachPageWhenReady:function(a,b){$(b)?(this._attachPage(a,b),this._loadedPages.push(b),W.Utils.callLater(this._callBacksForPageCreation[b].method,[],this._callBacksForPageCreation[b].scope,10),this.fireEvent("PAGE_LOADED",b)):W.Utils.callLater(this._attachPageWhenReady,[a,b],this,10)}})}),define.experiment.Class("wysiwyg.viewer.managers.SiteMembersManager.SMForgot_Password.New",function(a,b){var c=a,d=b;c.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"},RESET_PASSWORD_KEY_PARAMETER:"forgotPasswordToken"}),c.methods({initialize:d.after(function(){var a=this;
this.resources.W.Viewer.addEvent("SiteReady",function(){a._showPasswordResetIfNeeded()})}),_showPasswordResetIfNeeded:function(){var a=this._getCurrentSearchURL();if(this._isResetPasswordRequested(a)&&this._isViewerMode()){var b=this;this.resource.getResourceValue("W.SiteMembers",function(c){var d=b._getResetPasswordIdFromURL(a);c.openSiteMembersPopup({intent:"RESETPASSWORD",disableCancel:!0,resetPassKey:d})})}},_getCurrentSearchURL:function(){return window.location.search},sendUserPasswordResetEmail:function(a,b,c){var d=this._getReturnUrl();this._api.sendForgotPasswordMail(a,d,b,c)},_getReturnUrl:function(){var a=this._getLocationUrl();return a=encodeURIComponent(a)},_getLocationUrl:function(){return window.location.href},resetPassword:function(a,b,c){var d=this._getCurrentSearchURL(),e=this._getResetPasswordIdFromURL(d);this._api.resetMemberPassword(e,a,b,c)},_isResetPasswordRequested:function(a){return a.indexOf(this.RESET_PASSWORD_KEY_PARAMETER)>=0},_getResetPasswordIdFromURL:function(a){return W.Utils.getQueryParam(this.RESET_PASSWORD_KEY_PARAMETER,a)},_isViewerMode:function(){return"site"===window.viewMode}})}),define.experiment.Class("wysiwyg.viewer.managers.SiteMembersManager.SMOwnerLogoutFix.New",function(a,b){var c=a;c.resources(["W.Viewer","W.Utils"]),c.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"},OWNER_LOGOUT_ACTION:{TITLE:"Logout failure",MESSAGE:"You are the owner of this website, and are logged in on Wix.com. Please log out of Wix.com to test the Site Members feature."},WIX_USER_COOKIE_NAME:"wixClient"}),c.methods({logout:function(){return this._isOwnerLoggedIn()?(this._informSiteOwnerToLogout(),!1):(this._logoutSiteMember(),!0)},_logoutSiteMember:function(){return this._apiReady?(delete this._token,this._api.logout()):void 0},_informSiteOwnerToLogout:function(){var a=this.OWNER_LOGOUT_ACTION.TITLE,b=this.OWNER_LOGOUT_ACTION.MESSAGE;W.MessagesController.showMessage(a,b,function(){})},_isOwnerLoggedIn:function(){return this.resources.W.Utils.cookies.hasCookie(this.WIX_USER_COOKIE_NAME)&&this._isSiteBelongToUser()},_isSiteBelongToUser:function(){var a=null,b=function(b){a=b};return this.getMemberDetails(b,function(){}),a&&a.owner===!0}})}),define.experiment.Class("wysiwyg.viewer.managers.SiteMembersManager.SMMemberAccessLimit.New",function(a,b){var c=a;c.resources(["W.Viewer","W.Utils"]),c.statics({USER_STATUS:{ACTIVE:"ACTIVE"},COOKIE_CHECK_INTERVAL_IN_MS:100}),c.methods({getMemberDetails:function(a,b){var c=this._isMemberActiveAndCall(a);b||(b=c),this._memberDetails?c(this._memberDetails):this._apiReady?this._token?this._api.getMemberDetails(this._token,c,b):b&&b({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):b&&b({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},_isMemberActiveAndCall:function(a){var b=this;return function(c){c&&b._isInvalidUserAccess(c)?b._handleInvalidUserAccess(c):c&&c.status?c.status!==b.USER_STATUS.ACTIVE?b._logoutAndRefresh():a&&a(c):b.logout()}},_isInvalidUserAccess:function(a){var b=["-19980","-19984","-19999"],c=String(a.errorCode);return b.indexOf(c)>=0},_handleInvalidUserAccess:function(a){var b=String(a.errorCode);"-19980"===b?this._refreshPage():"-19984"===b?this._logoutAndRefresh():"-19999"===b&&this._logoutAndRefresh()},_logoutAndRefresh:function(){this.logout(),this._checkIfLogoutAndRefresh()},_checkIfLogoutAndRefresh:function(){this._hasSiteMemberSessionCookie()?this.resources.W.Utils.callLater(this._checkIfLogoutAndRefresh,null,this,this.COOKIE_CHECK_INTERVAL_IN_MS):this._refreshPage()},_hasSiteMemberSessionCookie:function(){return this._api.isSessionValid()},_refreshPage:function(){location.reload()}})}),define.experiment.component("wysiwyg.viewer.components.tpapps.TPAModal.EditorScripting.New",function(a){var b=a;b.methods({getAcceptableDataTypes:function(){return this._appData?["TPAWidget","TPA"]:[""]},_getUrl:function(){var a=this._url;return a||(a=this._appData?W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData):this._rawUrl),a}})}),define.experiment.component("wysiwyg.viewer.components.tpapps.TPAPopup.EditorScripting.New",function(a){var b=a;b.methods({getAcceptableDataTypes:function(){return this._appData?["TPAWidget","TPA"]:[""]},_getUrl:function(){var a=this._url;return a||(a=this._appData?W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData):this._rawUrl),a}})}),define.experiment.newComponent("wysiwyg.viewer.mobile.components.TinyMenu.TinyMenu.New",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({menuButton:{type:"htmlElement"},menuContainer:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_onAllSkinPartsReady:function(){},render:function(){this.parent()}})}),define.experiment.newClass("wysiwyg.viewer.managers.utils.MobileQuickActionsHandler.MobileViewerQuickActions.New",function(a){var b=a;b.resources(["W.Data","W.Resources","W.Viewer","W.Commands"]),b.binds(["_navigateToPage","_createNavItemsFromDataItems","_createSingleNavItem"]),b.methods({handleMobileQuickActions:function(){this._removePreloader(),this._addNavigation()},_removePreloader:function(){var a=document.getElementById("viewer_preloader");a&&document.body.removeChild(a)},_addNavigation:function(){var a=document.getElementById("quick-actions");if(a){var b=document.getElementById("quick-actions-site-nav");this._navigation=document.getElementById("quick-actions-pages"),null!=b&&(this.resources.W.Commands.registerCommandAndListener("WViewerCommands.SelectedPageChanged",this,this._onSelectedPageChanged),this.resources.W.Data.getDataByQuery("#MAIN_MENU",function(a){var b="Pages";this._navigation.onchange=this._navigateToPage;var c=new Element("optgroup");c.set("label",b),this._navigation.appendChild(c);var d=a.getItems();this._createNavItemsFromDataItems(c,d,0)}.bind(this)),b.className=b.className.replace("disabled",""))}},_createNavItemsFromDataItems:function(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];this._createSingleNavItem(a,e,c);var f=e.get("items");f&&f.length>0&&this._createNavItemsFromDataItems(a,f,c+1)}},_createSingleNavItem:function(a,b,c){for(var d=">",e="",f=0;c>f;f++)e+=d;var g=b.get("refId"),h=new Element("option");h.setAttribute("value",g),a.appendChild(h),this.resources.W.Data.getDataByQuery(g,function(b){var c=b.get("hidePage");if(c)a.removeChild(h);else{var d=b.get("title");h.innerHTML=e+d}}.bind(this))},_onSelectedPageChanged:function(a){this._selectedPageId=this.resources.W.Viewer.getCurrentPageId(),this._navigation.value="#"+a},_navigateToPage:function(){var a=this._navigation.options[this._navigation.selectedIndex].value;0===a.indexOf("#")&&(a=a.substr(1)),this.resources.W.Viewer.goToPage(a)}})}),define.experiment.Class("wysiwyg.viewer.managers.utils.MobileQuickActionsHandler.QuickActionsHideSubPagesOfHiddenParent.New",function(a){var b=a;b.binds(["_navigateToPage","_createNavItemsFromDataItems","_createSingleNavItem"]),b.methods({_createNavItemsFromDataItems:function(a,b,c,d){for(var e=0;e<b.length;e++){var f=b[e];this._createSingleNavItem(a,f,c,d)}},_createSingleNavItem:function(a,b,c,d){for(var e=">",f="",g=0;c>g;g++)f+=e;var h=b.get("refId"),i=new Element("option");i.setAttribute("value",h),0===c?a.appendChild(i):d.parentNode.insertBefore(i,d.nextSibling),this.resources.W.Data.getDataByQuery(h,function(d){var e=d.get("hidePage");if(e)a.removeChild(i);else{var g=d.get("title");i.innerHTML=f+g;var h=b.get("items");h&&h.length>0&&this._createNavItemsFromDataItems(a,h,c+1,i)}}.bind(this))}})}),define.experiment.Class("wysiwyg.viewer.managers.utils.MobileQuickActionsHandler.QuickActionsMenus.New",function(a){var b=a;b.resources(["W.Data","W.Resources","W.Viewer","W.Commands"]),b.binds(["_navigateToPage","_createNavItemsFromDataItems","_createSingleNavItem"]),b.methods({_removePreloader:function(){var a=document.getElementById("viewer_preloader");a&&document.body.removeChild(a)},_addNavigation:function(){var a=document.getElementById("quick-actions");if(a){var b=document.getElementById("quick-actions-pages-button");if(b){var c=document.getElementById("qa-drop-up-pages").querySelector(".quick-actions-drop-up-title"),d=document.getElementById("qa-drop-up-pages-list");this.resources.W.Data.getDataByQuery("#MAIN_MENU",function(a){var b="Pages";c.innerHTML=b;var e=a.getItems();this._createNavItemsFromDataItems(d,e,0),this._addGapElement(d)}.bind(this)),b.className=b.className.replace("disabled","")}}},_addGapElement:function(a){if(a){var b=document.createElement("li");b.className="quick-actions-drop-up-ugly-clearfix",a.appendChild(b)}},_createSingleNavItem:function(a,b,c){for(var d=this._navigateToPage,e=this._hideMenu,f=">",g="",h=0;c>h;h++)g+=f;var i=document.createElement("li"),j=b.get("refId");i.innerHTML="<a href='#'></a>",a.appendChild(i),this.resources.W.Data.getDataByQuery(j,function(f){var h=f.get("hidePage");if(h)a.removeChild(i);else{var k=f.get("title");i.firstChild.innerHTML=g+k;var l=b.get("items");l&&l.length>0&&this._createNavItemsFromDataItems(a,l,c+1,i),j&&0===j.indexOf("#")&&(j=j.substr(1)),i.addEventListener("click",function(a){e(),d(j),a.stopPropagation(),a.preventDefault()})}}.bind(this))},_hideMenu:function(){var a="quick-actions-drop-up-wrapper-open",b=document.getElementById("qa-drop-up-pages");b.removeClass(a)},_navigateToPage:function(a){this.resources.W.Viewer.goToPage(a)}})});
define.experiment.component("wysiwyg.common.components.InfoTip.EditorRulers.New",function(a,b){var c=a;c.fields({_defaultShowTimer:500}),c.methods({_showToolTipCmd:function(a,b){this._shouldShowTooltipAfterTimout=!0,this._tipToShow=a.id?a.id:a.html,a.showTimer&&(this._showTimer=a.showTimer),clearTimeout(this._hideToolTipTimeOut),window.setTimeout(function(){var c=a.id?a.id:a.html;this._shouldShowTooltipAfterTimout&&this._tipToShow===c&&this._callTip(a,b)}.bind(this),this._showTimer)},_resetToolTip:function(){this._skinParts.content.empty(),this._showTimer=this._defaultShowTimer}})}),define.experiment.component("wysiwyg.common.components.inputs.OptionsListInput.RichText2.New",function(a){var b=a;b.methods({_changeSelectedItem:function(a){this._selectedItem&&this._selectedItem.setSelected(!1),a&&(this._selectedItem=a,this._selectedItem.setSelected(!0),this._selectedItem.getViewNode().focus())}})}),define.experiment.component("wysiwyg.common.components.inputs.OptionsListInput.RichTextToolbar.New",function(a){var b=a;b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._sequencer=new this.imports.ComponentSequencer,c&&(this._sequencer.resolveItem=function(){var a={comp:c.compType,skin:c.compSkin};return c.compStyleId&&(a.styleId=c.compStyleId),a})}})}),define.experiment.component("wysiwyg.viewer.components.inputs.TextInput.RichTextToolbar.New",function(a,b){var c=a,d=b;c.skinParts({input:{type:"htmlElement"},errorMessage:{type:"htmlElement",optional:!0}}),c.methods({initialize:d.before(function(a,b,c){c&&c.shouldRenderOnDisplay&&this.startRenderingComponentOnDisplay()}),startRenderingComponentOnDisplay:function(){this._renderTriggers.indexOf(Constants.DisplayEvents.DISPLAY_CHANGED)<0&&this._renderTriggers.push(Constants.DisplayEvents.DISPLAY_CHANGED)},_onAllSkinPartsReady:function(){var a=this._skinParts.input;this.addEvent("inputChanged",function(a){this.getDataItem().set("text",a.value)}.bind(this)),this._listenToInput(),this._placeholder&&this._setPlaceholder(this._placeholder),this._isPasswordField&&a.set("type","password"),this.setLabel(this._label)},setError:function(a){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",a)},setPlaceholder:function(a){this._skinParts.input.set("placeholder",a),window.Modernizr&&!window.Modernizr.input.placeholder&&this._placeholderPolyFill()},render:function(){var a=this._skinParts.input,b=a.get("value"),c=this.getDataItem().get("text");b!=c&&a.set("value",c)},selectText:function(){this._skinParts.input.select()}})}),define.experiment.Class("wysiwyg.common.components.traits.LinkableComponent.PostSignupUrlParam.New",function(a,b){var c=a;c.methods({_handleSpecialCases:function(a,b){switch(b.removeEvents("click"),a){case this.linkType.LOGIN:b.addEvent("click",function(){if(window.animateForm){var a=this.getDataItem(),b=a.get("text");if(b){b=JSON.parse(b);var c=b.postLoginUrl,d=b.postSignupUrl,e=b.type,f="HTML";if(-1!==d.indexOf("ifcontext")){var g=this.resources.W.Utils.getQueryStringParamsAsObject(),h="";_.forOwn(g,function(a,b){"ifcontext"===b.toLowerCase()&&(h=a.replace("#",""),d=/^[a-zA-Z0-9]+$/.test(h)?d.replace("{ifcontext}",h):d.replace("{ifcontext}","illegalContextValue"))})}var i=window.userApi?window.userApi.isSessionValid():!1;i?c&&(window.location.href=c):window.animateForm.callForm([d,c,e,f])}}}.bind(this));break;case this.linkType.ADMIN_LOGIN:b.setStyle("cursor","pointer"),b.addEvent("click",function(){this.injects().Commands.executeCommand("WViewerCommands.AdminLogin.Open")}.bind(this))}}})}),define.experiment.Class("wysiwyg.common.utils.TextMigrationHandler.RichTextMigrationStudio.New",function(a){var b=a;b.methods({migrateComponent:function(a){this._changeData(a),this._changeSkin(a);var b=a.getDataItem();if(b&&b.get("text")){var c=this.migrateText(b.get("text"),null,null);return this._hasStyleOverrides&&a.getViewNode().addClass("hasOverrides"),c}return null},migrateText:function(a,b,c){if(this._hasStyleOverrides=!1,b=b||"p",c=c||"font_8","string"!==typeOf(a))return null;if(""===a)return'<{0} class="{1}"></{0}>'.substitute([b,c]);var d=new Element("div");return d.set("html",a),this._hasStyleOverrides=this._stylesMigration.migrateElement(d,b,c),this._simpleMigration.migrateElement(d),d.get("html")}})}),define.experiment.Class("wysiwyg.common.utils.TextStylesMigration.RichTextMigrationStudio.New",function(a){var b=a;b.methods({migrateElement:function(a,b,c){this._hasStyleOverrides=!1;var d=[],e=this._domHelper.collectionToArray(a.childNodes);return e.forEach(function(a){if(this._domHelper.isBlockElement(a)){d.length>0&&(this._applyStyleOnElements(d,b,c),d=[]);var e=!this._changeableTagList.contains(a.tagName.toLowerCase())||this._domHelper.hasBlockElementChildren(a);e?this.migrateElement(a,b,c):this._applyStyleOnBlock(a,b,c)}else d.push(a)},this),d.length>0&&this._applyStyleOnElements(d,b,c),this._hasStyleOverrides},_moveInlineStyleFromOriginalElementToBlockParentElement:function(a,b){var c=this._viewer.theme.getProperty(b),d="core.utils.css.Font"===c.getOriginalClassName();return d&&(a=this._setBlockElementTagAccordingToStyle(a,b)),a},_removeStyleClassesReplaceWithInline:function(a,b){b.map(function(b){var c=this._stylesHelper.getElementStyleClass(b);if(c==a)0===b.childNodes.length?b.destroy():this._removeStyleFromSpan(b,a);else{this._domHelper.removeClass(b,c),0===b.getProperty("class").length&&b.removeAttribute("class");var d=this._setStyleOverrides(a,c,b);d&&(this._hasStyleOverrides=!0)}},this)},_removeStyleFromSpan:function(a,b){a.removeClass(b),this._domHelper.isElementHasAttributes(a)||this._domHelper.replaceElementWithItsChildren(a)},_setStyleOverrides:function(a,b,c){var d=!1,e=this._stylesHelper.getStyleDelta(a,b),f=c;Object.forEach(e,function(a,b){f.setStyle(b,a),d=!0});var g=this._stylesHelper.getColorDelta(a,b);return g?(g.isRef?(f.addClass(g.value),d=!0):(f.setStyle("color",g.value),d=!0),d):d}})}),define.experiment.newDataSchema("DocumentMediaDataSchema.DocumentMedia.New",function(){return{"extends":"Link",label:{type:"string","default":"Document Label",description:"Document Label"}}}),define.experiment.newDataSchema("FacebookShareButton.FacebookShare.New",function(){return{urlChoice:{type:"string","enum":["Current page Url","Site Url"],"default":"Current page Url",description:"Share: current/site Url"},label:{type:"string","default":"Share",description:""}}}),define.experiment.newDataSchema("GooglemapEmbeddedDataSchema.GoogleMapEmbedded.New",function(){return{address:{type:"string","default":"10 West 18th St. New york, NY 10011",description:"Address"},addressInfo:{type:"string","default":"Wix Lounge NYC",description:"Address Description"},mapType:{type:"string",mapTypes:[{name:"NORMAL",code:"m"},{name:"TERRAIN",code:"p"},{name:"SATELLITE",code:"k"},{name:"HYBRID",code:"h"}],"default":"NORMAL",description:"map Type"},hostLanguage:{type:"string",languages:[{name:"Basque",code:"eu"},{name:"Catalan",code:"ca"},{name:"Croatian",code:"hr"},{name:"Czech",code:"cs"},{name:"Danish",code:"da"},{name:"Dutch",code:"nl"},{name:"English",code:"en"},{name:"Finnish",code:"fi"},{name:"French",code:"fr"},{name:"German",code:"de"},{name:"Galacian",code:"gl"},{name:"Greek",code:"el"},{name:"Hindi",code:"hi"},{name:"Indonesian",code:"id"},{name:"Italian",code:"it"},{name:"Japanese",code:"ja"},{name:"Norwegian",code:"no"},{name:"Nyorsk",code:"nn"},{name:"Portuguese",code:"pt"},{name:"Rhaeto-Romance",code:"rm"},{name:"Russian",code:"ru"},{name:"Serbian",code:"sr"},{name:"Slovak",code:"sk"},{name:"Slovenian",code:"sl"},{name:"Spanish",code:"es"},{name:"Swedish",code:"sv"},{name:"Thai",code:"th"},{name:"Turkish",code:"tr"},{name:"Ukrainian",code:"uk"},{name:"Vietnamese",code:"vi"}],"default":"English",description:"Host Language"},zoomLevel:{type:"string","default":"14",description:"Zoom Level"},showInformationWindow:{type:"boolean","default":"true",description:"Toggle Information Window Display"}}}),define.experiment.newDataSchema("HtmlComponent.RefreshFrameOnTransition.New",function(){return{sourceType:"string",url:"string",freezeFrame:"boolean"}}),define.experiment.dataSchema("SiteButton.LinkRefData.New",function(){return{link:{type:"ref","default":null},label:{type:"string","default":"MY BUTTON"}}}),define.experiment.newDataSchema("SiteButton.NBC_SiteButton.New",function(){return{"extends":"Link",label:{type:"string","default":"MY BUTTON"},renderVersion:{type:"number","default":0}}}),define.experiment.newDataSchema("SvgShapeDataSchema.SvgShapeComponent.New",function(){return{}}),define.experiment.newDataSchema("VKShareButton.VKShare.New",function(){return{style:{type:"string","enum":["Button","ButtonWithoutCounter","Link","LinkWithoutIcon","Icon"],"default":"Button",description:"the layout of the button"},text:{type:"string","default":"Share",description:"the text of the Button"}}}),define.experiment.newClass("wysiwyg.common.managers.ScriptingManager.EditorScripting.New",function(a,b){var c=a;c.inherits("bootstrap.managers.BaseManager"),c.resources(["W.Commands","BrowserUtils"]),c.utilize(["wysiwyg.common.managers.scripting.ScriptingWorkerWrapper"]),c.methods({initialize:function(){this._scripts=[],this._hasScripts=!1;var a=this.resources.BrowserUtils.getQueryParams();this._enable=a.scripting&&!a.scripting[0]?!1:!0,this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.BeforeWEditModeChanged",this,this._onEditModeChanged),this.resources.W.Commands.registerCommandAndListener("WViewerCommands.Page.ContentRendered",this,this._onPageRender),this.resources.W.Commands.registerCommandAndListener("WViewerCommands.ComponentNameChanged",this,this._onComponentNameChanged)},_createWorker:function(){this._worker&&this.terminateWorker(),this._worker=new this.imports.ScriptingWorkerWrapper,this._worker.run()},getScript:function(a){return this._scripts[a]},getAllScripts:function(){return this._scripts},_onEditModeChanged:function(a){"PREVIEW"===a?this._hasScripts&&(this._createWorker(),this.runAllScripts()):this._worker&&this._worker&&(this._worker.revertActions(),this.terminateWorker(),this._worker=null)},_onPageRender:function(a){var b=a.getDescendantComponents();b.forEach(function(a){this.runScript(a.getLogic().getComponentNameOrID())}.bind(this))},_onComponentNameChanged:function(a){var b=this._scripts[a.oldName];b&&(this._scripts[a.newName]=b,this._scripts[a.oldName]=null,delete this._scripts[a.oldName])},registerScript:function(a,b){this._scripts[a]=b,this._hasScripts=!0},registerScriptAndRun:function(a,b){this.registerScript(a,b),this.runScript(a)},runScript:function(a){this._enable&&this._scripts[a]&&(this._worker||this._createWorker(),this._worker.executeScript(a,this._scripts[a]))},runAllScripts:function(){this._enable&&Object.keys(this._scripts).forEach(this.runScript.bind(this))},terminateWorker:function(){this._worker&&(this._worker.terminate(),this._worker=null)},getEnable:function(){return this._enable},setEnable:function(a){this._enable=a}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.methods({_registerCommands:d.after(function(){var a=this.resources.W.Commands;a.registerCommandAndListener("WViewerCommands.UpdateDocWidth",this,this._updateDocWidth)}),_updateDocWidth:function(a){if(a)return this._setDocWidth(a),void 0;var b=this.injects().Utils.getQueryParam("siteWidthInPixels");if(b)return this._setDocWidth(b),void 0;var c=this._siteStructureData.get("renderModifiers");if(c&&c.siteWidth)return this._docWidth=c.siteWidth,void 0;switch(window.rendererModel&&window.rendererModel.applicationType){case"HtmlFacbook":this._docWidth=520;break;case"HtmlWeb":this._docWidth=980;break;default:this._docWidth=980}},_setDocWidth:function(a){this._docWidth=_.parseInt(a),this._siteStructureData.set("siteWidthInPixels",this._docWidth);var b=this._siteStructureData.get("renderModifiers");b?_.extend(this._siteStructureData.get("renderModifiers"),{siteWidth:this._docWidth}):this._siteStructureData.setFields({siteWidth:this._docWidth}),this._siteStructureData.markDataAsDirty()}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.FixMissingSkins.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Data"])),c.methods({setSite:d.before(function(a){this.resources.W.Data.getDataByQuery("#SKINS",function(b){var c=b.getData().components;this._fixMissingSkinsInCompNodes(a,c)}.bind(this))}),_fixMissingSkinsInCompNodes:function(a,b){var c=a.getElements("[comp]");c.forEach(function(a){var c=a.getAttribute("comp"),d=a.getAttribute("skin"),e=!d||"mobile.core.skins.InlineSkin"==d;if(e){var f=b[c];f&&(a.setAttribute("skin",f[0]),d||LOG.reportError(wixErrors.NO_SKIN,"WViewManager","_fixMissingSkinsInCompNodes",{c1:c,c2:d}))}})}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.FixViewport.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.methods({setSite:d.after(function(){this.resources.W.Config.mobileConfig.isMobile()&&this._setMobileSite()}),_setMobileSite:function(){this.setViewportAttribute("minimum-scale","0.25"),this.setViewportAttribute("maximum-scale","1.2"),window.WQuickActions&&window.WQuickActions.delayedFixZoom()},setViewportAttribute:function(a,b){for(var c=document.getElementById("wixMobileViewport"),d=c.getAttribute("content"),e=d.split(/ *,/),f="",g=!1,h=0;h<e.length;h++){var i=e[h];if(i.indexOf(a)>-1){if(g=!0,!b)continue;i=i.replace(/\ *=.*/,"="+b)}f+=i+","}f=f.substring(0,f.length-1),g?c.setAttribute("content",f):c.setAttribute("content",f+","+a+"="+b)}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileSiteWidth.New",function(a,b){var c=a,d=b;c.statics({MOBILE_SITE_WIDTH:320}),c.binds(d.merge(["_handleMobileRotation"])),c.resources(d.merge(["W.Config"])),c.methods({_setMobileSite:function(){this.getDocWidth()===this.MOBILE_SITE_WIDTH?(this._handleMobileRotation(),window.addEventListener("orientationchange",this._handleMobileRotation,!1)):(this.setViewportAttribute("minimum-scale","0.25"),this.setViewportAttribute("maximum-scale","1.2"))},_handleMobileRotation:function(){var a=document.getElementById("wixMobileViewport"),b=this.MOBILE_SITE_WIDTH,c=Math.max(screen.width,screen.height);Math.min(screen.width,screen.height);var d=1,e=this.resources.W.Config.mobileConfig.isPortrait();if(!e){d=c/b;var f=b+1;this._setViewPortTag(a,f,d)}setTimeout(function(){this._setViewPortTag(a,b,d)}.bind(this),50)},_setViewPortTag:function(a,b,c){a.setAttribute("content","width="+b+","+"initial-scale="+c+","+"user-scalable="+"no"+", maximum-scale="+c),window.WQuickActions&&window.WQuickActions.delayedFixZoom()}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileViewerQuickActions.New",function(a,b){var c=a,d=b;c.methods({_pageTransition:d.after(function(a){W.Commands.executeCommand("WViewerCommands.SelectedPageChanged",a)})})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileZoom.New",function(a,b){var c=a;c.methods({_getZoomCompSettings:function(){var a,b;return W.Config.mobileConfig.isMobile()?(a="wysiwyg.viewer.skins.MobileMediaZoomSkin",b="wysiwyg.viewer.components.MobileMediaZoom"):(a="wysiwyg.viewer.skins.MediaZoomSkin",b="wysiwyg.viewer.components.MediaZoom"),{comp:b,skin:a}},_getZoomDisplayerCompSettings:function(){var a,b;return W.Config.mobileConfig.isMobile()?(a="wysiwyg.viewer.skins.displayers.MobileMediaZoomDisplayerSkin",b="wysiwyg.viewer.components.MobileMediaZoomDisplayer"):(a="wysiwyg.viewer.skins.displayers.MediaZoomDisplayerSkin",b="wysiwyg.viewer.components.MediaZoomDisplayer"),{comp:b,skin:a}},setViewportAttribute:function(a,b){for(var c=document.getElementById("wixMobileViewport"),d=c.getAttribute("content"),e=d.split(/ *,/),f="",g=!1,h=0;h<e.length;h++){var i=e[h];if(i.indexOf(a)>-1){if(g=!0,!b)continue;i=i.replace(/\ *=.*/,"="+b)}f+=i+","}f=f.substring(0,f.length-1),g?c.setAttribute("content",f):c.setAttribute("content",f+","+a+"="+b)}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.RichTextMigrationStudio.New",function(a,b){var c=a,d=b;c.utilize(d.merge(["wysiwyg.common.utils.TextMigrationHandler"])),c.methods({_wasMasterMigrated:!1,migrateAllRenderedTextComps:function(){this._textMigrationHandler=this._textMigrationHandler||new this.imports.TextMigrationHandler;var a=[];if(this._wasMasterMigrated){var b=this.getCurrentPageNode(),c=b&&b.$logic;c&&(a=c.getPageComponents())}else{var d=$$("#SITE_STRUCTURE");a=d.getElements("[comp]")[0].map(function(a){return a.$logic}),this._wasMasterMigrated=!0}return this._migrateTextComponents(a)},_migrateTextComponents:function(a){var b=a.filter(function(a){return"wysiwyg.viewer.components.WRichText"===a.getOriginalClassName()&&"StyledText"!==a.getDataItem().getType()});return this._textMigrationHandler=this._textMigrationHandler||new this.imports.TextMigrationHandler,b.forEach(function(a){var b=this._textMigrationHandler.migrateComponent(a);a.getDataItem().set("text",b)},this),b.length}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.WixAppsPage.New",function(a,b){var c=a;c.methods({isPageComponent:function(a){return a.match(/Page$/)},_getPageElements:function(a){return a.getElements("[comp$=Page]")},getAppPages:function(){var a={};return Object.each(W.Viewer.getPages(),function(b){var c=b.getLogic(),d=c.getDataItem(),e=d.getData();if("AppPage"===e.type||"AppBuilderPage"===e.type){var f=d.get("appPageId");a[f]=c}}),a},goToPage:function(a,b){var c=this._pagesData[a];this._checkRequireLogin(c,function(){var c=W.Viewer.getPages()[a],d=c.getLogic(),e=d._data.get("pageUriSEO");W.Utils.hash.setHash(a,e,b)}.bind(this))},_onTransitionFinished:function(){},_changePageFromHash:function(a){if(!this._scrollLock){null!==this._stopAnimation&&this._stopAnimation.stop(),this._scrollToTopOnPageChange();var b=this._getPageDataFromHash(a);if(null!==b){var c=b.get("id");c!=this._currentPageId&&this._checkRequireLogin(b,function(){c&&(("preview"===window.viewMode||"editor"===window.viewMode)&&LOG.reportEvent(wixEvents.USER_REQUESTED_PAGE_MOVE,{c1:b._data&&b._data.pageUriSEO||"no-page-url"}),this._pageTransition(c))}.bind(this))}}},getLinkablePagesData:function(){return Object.filter(this._pagesData,function(a){return"AppPage"!=a.getType()})},_isPageDataType:function(a){return"Page"===a||"AppPage"==a},_onPageExtraDataChange:function(a,b,c){var d=this._getPageDataFromHash(b);switch(d.get("type")){case"Page":if(this.resources.W.TPA.setPageState(b,a),c)return;var e=d.get("tpaApplicationId"),f=this.resources.W.TPA.getComponentRegistrar().getSection(e);f&&f._updateIframe(!0);break;case"AppPage":if(c)return;var g=W.Viewer.getPages()[b],h=g.getLogic();h.updateParams()}},_setUrlHashToPage:function(a){var b=this._pagesData[a];if(b){var c=W.TPA.getPageState(a);W.Utils.hash.setHash(a,b.get("pageUriSEO"),c)}}})}),define.experiment.newClass("wysiwyg.common.managers.scripting.ScriptingComponentHandler.EditorScripting.New",function(a,b){var c=a;c.resources(["W.Viewer","W.Theme","scriptLoader"]),c.fields({_componentsEvents:[],_unDoActions:[]}),c.statics({PREVIEW_ID:"live-preview-iframe",Events:{CLICK:"click",DBLCLICK:"dblclick",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave"}}),c.methods({initialize:function(){this.resources.scriptLoader.loadResource({url:"http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/CSSPlugin.min.js"}),this.resources.scriptLoader.loadResource({url:"http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenLite.min.js"})},handleScript:function(a,b,c,d,e){var f=this._getComponent(a),g=this._getHandlerFunctionName(b),h=this[g];f&&"function"==typeof h&&h.call(this,f,c,d,e)},_getComponent:function(a){var b,c,d=$$('div[compName="'+a+'"]'),e=d.length>0?d[0]:document.getElementById(a);return e&&e.getLogic&&(b=e.getLogic(),b.isReady&&b.isReady()&&(c=!0)),c?b:null},_getComponentName:function(a){return a.getComponentName()||a.getID()},clean:function(){var a=this._componentsEvents,b=this;Object.keys(a).forEach(function(c){var d=b._getComponent(c);d&&Object.keys(a[c]).forEach(function(a){b._removeEvent(d,a)}),a[c]=null,delete a[c]}),this._unDoActions=[]},_removeEvent:function(a,b){var c=this._getComponentName(a);this._componentsEvents[c]&&this._componentsEvents[c][b]&&(a.getViewNode().removeEvent(b,this._componentsEvents[c][b]),this._componentsEvents[c][b]=null,delete this._componentsEvents[c][b])},revertActions:function(){this._unDoActions.forEach(function(a){a.action(),a.comp.originY=null,a.comp.originX=null,a.comp.originWidth=null,a.comp.originHeight=null,a.action=null,a.comp=null}),this._unDoActions=[]},getData:function(a){var b=this._getComponent(a);return b?b.getPosition():null},_addUndoAction:function(a){this.resources.W.Viewer.isPublicMode()||this._unDoActions.push(a)},_getHandlerFunctionName:function(a){return"_handle"+a.capitalize()},_handleGetY:function(a,b,c){c(a.getY())},_handleSetY:function(a,b,c){a.originY||(a.originY=a.getY(),this._addUndoAction({comp:a,action:function(a,b){a.setY(b)}.bind(this,a,a.originY)})),a.setY(b.y),c()},_handleGetX:function(a,b,c){c(a.getX())},_handleSetX:function(a,b,c){a.originX||(a.originX=a.getX(),this._addUndoAction({comp:a,action:function(a,b){a.setX(b)}.bind(this,a,a.originX)})),a.setX(b.x),c()},_handleGetWidth:function(a,b,c){c(a.getWidth())},_handleSetWidth:function(a,b,c){a.originWidth||(a.originWidth=a.getWidth(),this._addUndoAction({comp:a,action:function(a,b){a.setWidth(b)}.bind(this,a,a.originWidth)})),a.setWidth(b.width),c()},_handleGetHeight:function(a,b,c){c(a.getHeight())},_handleSetHeight:function(a,b,c){a.originHeight||(a.originHeight=a.getHeight(),this._addUndoAction({comp:a,action:function(a,b){a.setHeight(b)}.bind(this,a,a.originHeight)})),a.setHeight(b.height),c()},_handleShow:function(a,b,c){a.show(),c()},_handleHide:function(a,b,c){this._addUndoAction({comp:a,action:function(a){a.show()}.bind(this,a)}),a.hide(),c()},_handleToggle:function(a,b,c){a.getViewNode().isDisplayed()?a.getViewNode().hide():a.getViewNode().show(),c()},_handleFadeIn:function(a,b,c){a.getViewNode().setStyle("opacity","0"),a.show(),a.getViewNode().tween("opacity",1),c()},_handleFadeOut:function(a,b,c){this._addUndoAction({comp:a,action:function(a){a.show(),a.getViewNode().setStyle("opacity","1")}.bind(this,a)}),a.getViewNode().tween("opacity",0),c()},handleSlideIn:function(a,b,c){a.getViewNode().reveal(),c()},_handleSlideOut:function(a,b,c){this._addUndoAction({comp:a,action:function(a){a.getViewNode().reveal()}.bind(this,a)}),a.getViewNode().dissolve(),c()},_handleGetPosition:function(a,b,c){c(a.getPosition())},_handleTweenRun:function(a,b,c){a.tween&&(a.tween.kill(),TweenLite.killTweensOf(a.getViewNode()));var d=b.duration||1;delete b.duration,b.onComplete=c,a.tween=TweenLite.to(a.getViewNode(),d,b),this._addUndoAction({comp:a,action:function(a){a.tween.totalDuration(0),a.tween.reverse(),a.tween=null}.bind(this,a)})},_handleTweenPause:function(a,b,c){a.tween&&a.tween.pause(),c()},_handleTweenResume:function(a,b,c){a.tween&&a.tween.resume(),c()},_handleTweenReverse:function(a,b,c){a.tween&&a.tween.reverse(),c()},_handleAddEvent:function(a,b,c,d){var e=this._getComponentName(a),f=this.Events[b.eventName],g=function(){d.triggerEvent(b.eventName,null,e)};!f||this._componentsEvents[e]&&this._componentsEvents[e][f]||(this._componentsEvents[e]||(this._componentsEvents[e]=[]),this._componentsEvents[e][f]=g,a.getViewNode().addEvent(f,g))},_handleRemoveEvent:function(a,b){this._removeEvent(a,this.Events[b.eventName])},_handleSetStyle:function(a,b,c){this.resources.W.Theme.getStyle(b.styleId,function(b){a.setStyle(b),c()})}})}),define.experiment.newClass("wysiwyg.common.managers.scripting.ScriptingWorkerWrapper.EditorScripting.New",function(a){var b=a;b.utilize(["wysiwyg.common.managers.scripting.ScriptingComponentHandler","wysiwyg.viewer.components.traits.TPAHandlers"]),b.resources(["topology","W.Viewer"]),b.binds(["_onPageNavigation","_onSiteReady","_handlePostMessage","_handlePostMessageError"]),b.statics({Intent:{TPA:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",NATIVE:"NativeScript",TRIGGER_EVENT:"TriggerEvent",COMPONENT:"ComponentScript",RUN_SCRIPT:"Run_Script",GET_COMPONENT:"GET_COMPONENT"}}),b.methods({initialize:function(a,b){this._workerId=a||this._createWorkerId(),this._forceIframe=b,this._componentHandler=new this.imports.ScriptingComponentHandler,this._tpaHandler=new this.imports.TPAHandlers,this._iframePolyfill(),this._bindEvents()},run:function(a){var b=this._createBlob(a||"");this._worker=new Worker(b,this._workerId),this._worker.onmessage=this._handlePostMessage,this._worker.onerror=this._handlePostMessageError},executeScript:function(a,b){var c=this._componentHandler.getData(a);this._sendMessage({intent:this.Intent.RUN_SCRIPT,workerId:this._workerId,script:b.toString(),compId:a,compData:c})},triggerEvent:function(a,b,c){this._sendMessage({intent:this.Intent.TRIGGER_EVENT,workerId:this._workerId,eventType:a,compId:c,params:b})},terminate:function(){this._worker.terminate(),this._componentHandler.clean(),this._unBindEvents()},_createBlob:function(a){var b=['wix_sdk_globals ={ workerId:"{workerId}", workerMode:true };','importScripts("{api}");',"{script}"].join("");return a&&(a=this._isUrl(a)?['importScripts("',a,'");'].join(""):["(",a.toString(),")();"].join("")),b=b.substitute({workerId:this._workerId,api:this.resources.topology.wysiwyg+"/html/external/scripting/Wix-Scripting.js",script:a}),window.Blob&&!this._forceIframe?window.URL.createObjectURL(new Blob([b])):b},_bindEvents:function(){this.resources.W.Viewer.addEvent("pageTransitionEnded",this._onPageNavigation),this.resources.W.Viewer.addEvent("SiteReady",this._onSiteReady)},_unBindEvents:function(){this.resources.W.Viewer.removeEvent("pageTransitionEnded",this._onPageNavigation),this.resources.W.Viewer.removeEvent("SiteReady",this._onSiteReady)},_onPageNavigation:function(a){this.triggerEvent("PAGE_NAVIGATION",{pageId:a})},_onSiteReady:function(){this.triggerEvent("SITE_READY")},getWorkerId:function(){return this._workerId},_iframePolyfill:function(){(!window.Worker||this._forceIframe)&&(window.Worker=function(a){var b=function(b,c){function d(){e(),g()}function e(){window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent("onmessage",i)}function f(){window.removeEventListener?window.removeEventListener("message",i,!1):window.detachEvent("onmessage",i)}function g(){j.iframeEl=document.createElement("iframe"),j.iframeEl.style.visibility="hidden",j.iframeEl.style.display="none",j.iframeEl.style.width="1px",j.iframeEl.style.height="1px",j.iframeEl.id=c,j.iframeEl.src=[a,"/html/external/scripting/worker-iframe.html?workerId=",c].join(""),document.body.appendChild(j.iframeEl)}function h(){j.iframeEl.contentWindow.postMessage(JSON.stringify({workerId:c,blob:b}),"*")}function i(a){var b;try{b=JSON.parse(a.data)}catch(d){return}b.workerId===c&&(b.initialized?h():b.ready?(k=!0,l.forEach(function(a){j.postMessage(a)}.bind(j)),l=[]):b.terminate?j.terminate():b.error&&j.onerror?j.onerror.call(this,b.error):j.onmessage&&j.onmessage.call(this,a))}var j=this,k=!1,l=[];this.postMessage=function(a){k?j.iframeEl.contentWindow.postMessage(a,"*"):l.push(a)},this.terminate=function(){j.iframeEl&&(document.body.removeChild(j.iframeEl),j.iframeEl=null),f()},d()};return b}(this.resources.topology.wysiwyg))},revertActions:function(){this._componentHandler.revertActions()},_handlePostMessage:function(a){var b=JSON.parse(a.data);if(b&&b.workerId===this._workerId)switch(b.intent){case this.Intent.TPA:this._handleTPAScript(b);break;case this.Intent.NATIVE:this._handleWorkerNativeFunctions(b);break;case this.Intent.COMPONENT:this._handleComponentMessage(b);break;case this.Intent.GET_COMPONENT:this._handleGetComponent(b)}},_handleGetComponent:function(a){var b=this._componentHandler.getData(a.data.compId);this._sendMessage({intent:this.Intent.GET_COMPONENT,workerId:this._workerId,compId:a.data.compId,compData:b,callId:a.callId})},_handlePostMessageError:function(a){alert("Error: Line "+a.lineno+" in "+a.filename+": "+a.message),console.log(a)},_handleTPAScript:function(a){var b=this._getHandlerFunctionName(a.type),c=this._tpaHandler[b];"function"==typeof c&&c.call(this._tpaHandler,{msgData:a.data,callback:this._sendToCaller.bind(this,a)})},_handleComponentMessage:function(a){this._componentHandler.handleScript(a.compId,a.type,a.data,this._sendToCaller.bind(this,a),this)},_sendToCaller:function(a,b){this._sendMessage({intent:this.Intent.TPA_RESPONSE,workerId:this._workerId,callId:a.callId,type:a.type,res:b})},_sendMessage:function(a){this._worker.postMessage(JSON.stringify(a))},_handleWorkerNativeFunctions:function(a){switch(a.func){case"console":console[a.method](a.message);break;case"alert":alert(a.message)}},_getHandlerFunctionName:function(a){return"handle"+a.capitalize()},_isUrl:function(a){var b=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return b.test(a)},_createWorkerId:function(){return"WorkerScript-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})}})}),define.experiment.newDataSchema("BgImageStripProperties.BgImageStrip.New",function(){return{bgUrl:{type:"string","default":"http://static.crab.wixpress.com/media/3caf2d35d070516f2229a010d847c2d6.wix_mp",description:"Set image background"},bgSize:{type:"string","enum":[{label:"Actual Size",value:"contain"},{label:"Crop       ",value:"cover  "},{label:"Fit        ",value:"auto   "}],description:"Set background mode"},bgRepeat:{type:"string","enum":[{label:"No Tiling",value:"no-repeat"},{label:"Tile Horizontal",value:"repeat-x "},{label:"Tile Vertical",value:"repeat-y "},{label:"Tile Both",value:"repeat"}],description:"Set background tile direction"},bgPosition:{type:"string","enum":["top left","top center","top right","center left","center","center right","bottom left","bottom center","bottom right"],"default":"top left",description:"Set background position"}}}),define.experiment.newDataSchema("DocumentMediaProperties.DocumentMedia.New",function(){return{fileName:{type:"string","default":"No document selected",description:"File Name"},title:{type:"string","default":"No document selected",description:"Document Title"},showDocumentTitle:{type:"boolean","default":!0,description:"Toggle Document Title Display"}}}),define.experiment.newDataSchema("PinterestPinProperties.PinterestPinComponent.New",function(){return{counterPosition:{type:"string","enum":["above","beside","none"],"default":"beside",description:"the position of the pin counter around the button"}}}),define.experiment.dataSchema("SliderGalleryProperties.SliderAutoPlay.New",function(a){var b=a;return b.merge({autoplayInterval:{type:"number","default":"0",minimum:0,maximum:30,description:"Autoplay interval"},autoplay:{type:"boolean","default":!1,description:""},showAutoplay:{type:"boolean","default":!0,description:""},transDuration:{type:"number",minimum:0,maximum:5,"default":0,description:"Duration of the transition in seconds"},autoPlayDirection:{type:"string","default":"LTR"}})}),define.experiment.newDataSchema("SvgShapeProperties.SvgShapeComponent.New",function(){return{}}),define.experiment.newDataSchema("VKShareProperties.VKShare.New",function(){return{rightAngles:{type:"boolean","default":!1,description:"Button Right angles"}}}),define.experiment.dataSchema("WFacebookCommentProperties.FCommentOnAllPages.New",function(a){var b=a;return b.merge({canBeShownOnAllPagesBug:{type:"boolean","default":!1,description:"The component was added after the bug who-145 fix, and will be shown on all pages"}})}),define.experiment.newClass("wysiwyg.viewer.responsive.ResponsiveAlgorithm.Responsive1.New",function(a,b){var c=a;c.resources(["W.Layout","W.ComponentData","W.Data"]),c.binds(["_compareByRows","_compareByColumns","_compareByRowsNadav","_compareByAnotherArrayOrder"]),c.statics({MOBILE_WIDTH:320,COMPONENT_MOBILE_MARGIN:10,TEXT_MAX_LENGTH_FOR_RESCALING:25,CHILDREN_TREATMENT_METHOD:{RESCALE_CHILDREN:"rescaleChildren",REORGANIZE_CHILDREN:"resorganizeChildren"}}),c.methods({initialize:function(){},_convertStructureToMobileLayout:function(a,b){this._originalStructure=this._originalStructure||{},a.id&&(this._originalStructure[a.id]=this._cloneJSON(a)),this._addDebuggingHints(a),this._markComponentsAsMobileLayout(a),this._markTextComponentBlocks(a),this._modifyComponentCharacteristicsToFitMobileLayout(a),this._removeHiddenComponentChildren(a),this._markContainersTightlyWrappedByTheirParents(a),this._reparentComponentsOverlayingContainers(a),"masterPage"==b&&this._handleNonHeaderOrFooterMasterPageComponents(a),this._addBlockLayoutToStructure(a),"page"==b?this._updatePageForMobileLayout(a):this._updateHeaderAndFooterForMobileLayout(a),this._replaceBackGroupsToFlatComponents(a),this._clearComponentAnchors(a),this._updateComponentAnchors(a)
},_addBlockLayoutToStructure:function(a){this._identifyOverlayingComponentsAsGroups(a),this._replaceExplicitGroupedComponentsToGroups(a),this._getNeighborsGroups(a),this._attachTextComponentToItsCorrelatingVisual(a),this._identifyColumns(a),this._addComponentOrder(a),this._updateComponentOrderWithNeighborsInfo(a)},_addDebuggingHints:function(a){"SITE_FOOTER"==a.id,"SITE_STRUCTURE_LinkBar_0"==a.id;var b=a.children||a.components;if(b)for(var c=0;c<b.length;c++)this._addDebuggingHints(b[c])},_modifyStylesToFitMobileLayout:function(){this._mapNonMobileSkinToDefaultMobileSkin("wysiwyg.viewer.skins.gallerymatrix.MatrixGalleryPolaroidSkin","wysiwyg.viewer.skins.gallerymatrix.MatrixGalleryDefaultSkin",["mg1","mg2","mg3"]),this._mapNonMobileSkinToDefaultMobileSkin("wysiwyg.viewer.skins.gallery.SlideShowTextRight","wysiwyg.viewer.skins.gallery.SlideShowTextOverlay",["ssg1","ssg2","ssg3"])},_mapNonMobileSkinToDefaultMobileSkin:function(a,b,c){W.Skins.getSkin(b,function(b){for(var d=c,e=0;e<d.length;e++)W.Theme.getStyle(d[e],function(c){c.getSkin()==a&&c.setSkin(b)})})},_updateHeaderAndFooterForMobileLayout:function(a){for(var b=0;b<a.children.length;b++){var c=a.children[b];("SITE_FOOTER"==c.id||"SITE_HEADER"==c.id)&&this._rescaleComponentToFitWidth(c,this.CHILDREN_TREATMENT_METHOD.REORGANIZE_CHILDREN,this.MOBILE_WIDTH)}this._updateSiteSegmentLayout(a)},_updateSiteSegmentLayout:function(a){var b=this._getComponentById("SITE_HEADER",a.children),c=this._getComponentById("SITE_FOOTER",a.children),d=this._getComponentById("PAGES_CONTAINER",a.children);b.layout.x=0,d.layout.x=0,d.layout.y=b.layout.y+b.layout.height+this.COMPONENT_MOBILE_MARGIN,c.layout.x=0,c.layout.y=d.layout.y+d.layout.height+this.COMPONENT_MOBILE_MARGIN},_markComponentsAsMobileLayout:function(a){a.layoutType="mobile";var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++)this._markComponentsAsMobileLayout(b[c])},_markTextComponentBlocks:function(a){"wysiwyg.viewer.components.WRichText"==a.componentType&&(a.isText=!0);var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++)this._markTextComponentBlocks(b[c])},_modifyComponentCharacteristicsToFitMobileLayout:function(a){if(this._modifyComponentProperties(a),a.components)for(var b=0;b<a.components.length;b++)this._modifyComponentCharacteristicsToFitMobileLayout(a.components[b])},_modifyComponentProperties:function(a){var b=a.propertyQuery;if(b){var c=a.componentType;"wysiwyg.viewer.components.MatrixGallery"==c&&this.resources.W.ComponentData.getDataByQuery("#"+b,function(a){var b=a.get("numCols");b>2&&a.set("numCols",2)})}},_addBlockLayoutToStructureNadav:function(a){this._identifyOverlayingComponentsAsGroups(a),this._addReverseAnchors(a),this._addComponentOrderColumns(a)},_addReverseAnchors:function(a){var b=a.components||a.children;if(b)for(var c={},d=0;d<b.length;d++){var e=b[d];if(c[e.id]=c[e.id]||[],this._addReverseAnchors(e),e.revereseAnchors=c[e.id],e.layout&&e.layout.anchors)for(var f=0;f<e.layout.anchors.length;f++){var g=e.layout.anchors[f];c[g.targetComponent]=c[g.targetComponent]||[],c[g.targetComponent].push(g)}}},_addComponentOrderColumns:function(a){var b=a.components||a.children;if(!b||0==b.length)return a.componentsOrder=[],void 0;for(var c=0;c<b.length;c++)this._addComponentOrderColumns(b[c]);var d=this._cloneJSON(a),e=d.components||d.children;e.sort(this._compareByRowsNadav);for(var f=[],g=[];e.length;)f.push(this.createColumn(e[0],e));for(var c=0;c<f.length;c++)this.flattenColumn(f[c],g);a.componentsOrder=g},_compareByRowsNadav:function(a,b){if(this._hasSufficientYOverLap(a,b)&&!this._hasSufficientXOverLap(a,b)){if(a.layout.x<b.layout.x)return-1;if(a.layout.x>b.layout.x)return 1}return a.layout.y<b.layout.y?-1:a.layout.y>b.layout.y?1:0},flattenColumn:function(a,b){for(var c=0;c<a.children.length;c++)"column"==a.children[c].type?this.flattenColumn(a.children[c],b):b.push(a.children[c].id)},createColumn:function(a,b){b.splice(b.indexOf(a),1);var c={children:[a],type:"column"};return this._continueColumn(c,b),c},_continueColumn:function(a,b){var c=a.children[a.children.length-1],d=c.layout.anchors;if(d)if(d&&1==d.length){if("BOTTOM_TOP"==d[0].type&&d[0].distance<70){var e=this._getCompIndexByID(b,d[0].targetComponent);if(-1==e)return;var f=b[e];1==this._bottomTopCount(f.revereseAnchors)&&(a.children.push(f),b.splice(e,1),this._continueColumn(a,b))}}else{for(var g=[],h=0;h<d.length;h++){if("BOTTOM_TOP"!=d[h].type||d[h].distance>70)return;var e=this._getCompIndexByID(b,d[h].targetComponent);if(-1==e)return;var f=b[e];if(1!=this._bottomTopCount(f.revereseAnchors))return;g.push(f)}for(g.sort(this._compareByColumns),h=0;h<g.length;h++)a.children.push(this.createColumn(g[h],b))}},_bottomTopCount:function(a){for(var b=0,c=0;c<a.length;c++)"BOTTOM_TOP"==a[c].type&&b++;return b},_getCompIndexByID:function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return c;return-1},_removeHiddenComponentChildren:function(a){var b=a.components||a.children;if(b)for(var c=0;c<b.length;){var d=b[c];d.doNotShowOnMobile!==!0?(this._removeHiddenComponentChildren(d),c++):b.splice(c,1)}},_replaceExplicitGroupedComponentsToGroups:function(a){if(a.groups)for(var b=0;b<a.groups.length;b++){var c=a.groups[b];if(this._validateGroupCompIds(c,a.components)){var d=this._getComponentsFromIds(a,c),e=this._getGroupLayout(d),f="virtual_group_"+Math.random(),g={componentType:"VIRTUAL_GROUP",components:d,id:f,layout:e,originalLayout:e,skin:"undefined",styleId:"undefined",type:"undefined"};this._shiftGroupComponents(d,e.x,e.y),this._removeComponentsFromContainer(a,d),this._addComponentsToContainer(a,[g])}}var h=a.children||a.components;if(h)for(var b=0;b<h.length;b++)this._replaceExplicitGroupedComponentsToGroups(h[b])},_validateGroupCompIds:function(a,b){if(!b)return!1;for(var c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)b[e].id==a[c]&&(d=!0);if(!d)return!1}return!0},_getComponentsFromIds:function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(this._getComponentFromId(a,b[d]));return c},_getComponentFromId:function(a,b){for(var c=0;c<a.components.length;c++)if(a.components[c].id==b)return a.components[c];return null},_getGroupLayout:function(a){for(var b=Number.MAX_VALUE,c=Number.MIN_VALUE,d=Number.MAX_VALUE,e=Number.MIN_VALUE,f=0;f<a.length;f++){var g=a[f].layout;b=Math.min(b,g.x),c=Math.max(c,g.x+g.width),d=Math.min(d,g.y),e=Math.max(e,g.y+g.height)}return{x:b,y:d,width:c-b,height:e-d}},_shiftGroupComponents:function(a,b,c){for(var d=0;d<a.length;d++)a[d].layout.x-=b,a[d].layout.y-=c},_markContainersTightlyWrappedByTheirParents:function(a){var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++){var d=b[c];this._isChildContainerAndTightlyWrappedByItsParent(d,a)&&(d.wrappedTightlyByParent=!0),this._markContainersTightlyWrappedByTheirParents(d)}},_removeContainersTightlyWrappedByTheirParents:function(a){var b=a.components||a.children;if(b){for(var c=0;c<b.length;){var d=b[c];d.wrappedTightlyByParent&&(this._shiftGroupComponents(d.components,-1*d.layout.x,-1*d.layout.y),this._addComponentsToContainer(a,d.components),this._removeComponentFromContainer(a,d)),c++}for(var c=0;c<b.length;c++)this._removeContainersTightlyWrappedByTheirParents(b[c])}},_reparentComponentsOverlayingContainers:function(a){var b=a.components||a.children;if(b){for(var c=0;c<b.length;){var d=b[c],e=this._getContainerOverlayingChild(d,b);e&&this._reparentComponent(d,e,a),c++}for(c=0;c<b.length;c++)this._reparentComponentsOverlayingContainers(b[c])}},_getContainerOverlayingChild:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.id!=a.id&&this._isContainer(d)&&"PAGES_CONTAINER"!=d.id&&!(this._getSurface(d)<this._getSurface(a))&&this._areComponentsOverlay(d,a,.75))return d}},_getSurface:function(a){return a.layout.width*a.layout.height},_handleNonHeaderOrFooterMasterPageComponents:function(a){for(var b=this._getComponentById("SITE_HEADER",a.children),c=this._getComponentById("SITE_FOOTER",a.children),d=this._getComponentById("PAGES_CONTAINER",a.children),e=0;e<a.children.length;){var f=a.children[e];if(f!=b&&f!=c&&f!=d)if(this._areComponentsOverlay(f,b))this._reparentComponent(f,b,a);else if(this._areComponentsOverlay(f,c))this._reparentComponent(f,c,a);else{var g=this._isHeaderCloserToComponentThanFooter(f,a)?b:c;this._reparentComponent(f,g,a)}else e++}},_reparentComponent:function(a,b,c){this._addComponentsToContainer(b,[a]),this._removeComponentFromContainer(c,a),a.layout.y=a.layout.y-b.layout.y,a.layout.x=a.layout.x-b.layout.x},_getComponentById:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.id==a)return d}},_isHeaderCloserToComponentThanFooter:function(a,b){var c=a.layout.y+a.layout.height/2,d=this._getComponentById("SITE_HEADER",b.children),e=this._getComponentById("SITE_FOOTER",b.children),f=Math.abs(c-(d.layout.y+d.layout.height)),g=Math.abs(c-e.layout.y);return g>f},_isChildContainerAndTightlyWrappedByItsParent:function(a,b){if("SITE_PAGES"==a.id)return!1;var c=a.layout,d=b.components||b.children,e=b.layout,f=40;return 1==d.length&&this._isContainer(a)&&c.x<f&&c.y<f&&e.width-(c.x+c.width)<f&&e.height-(c.y+c.height)<f},_isContainer:function(a){var b=["Container","Page"];return b.contains(a.type)},_isVisualComponent:function(a){if(!a)return!1;var b=["wysiwyg.viewer.components.WPhoto","mobile.core.components.Container","wysiwyg.viewer.components.SlideShowGallery","wysiwyg.viewer.components.Video"];return b.contains(a.componentType)},_attachTextComponentToItsCorrelatingVisual:function(a,b){if(a.neighborGroups=a.neighborGroups||[],b&&a.isText){var c=this._getComponentNeighbors(a,b.components),d=this._findClosestVisualToComponent(c);if(d){var e=[a.id,d.id];b.neighborGroups.push(e)}}var f=a.components||a.children;if(f){for(var g=0;g<f.length;g++)this._attachTextComponentToItsCorrelatingVisual(f[g],a);this._unifyGroups(a.neighborGroups)}},_findClosestVisualToComponent:function(a){var b=null,c=Number.MAX_VALUE;return this._isVisualComponent(a.leftNeighbor)&&a.leftNeighborDistance<c&&(b=a.leftNeighbor,c=a.leftNeighborDistance),this._isVisualComponent(a.rightNeighbor)&&a.rightNeighborDistance<c&&(b=a.rightNeighbor,c=a.rightNeighborDistance),this._isVisualComponent(a.topNeighbor)&&a.topNeighborDistance<c&&(b=a.topNeighbor,c=a.topNeighborDistance),this._isVisualComponent(a.bottomNeighbor)&&a.bottomNeighborDistance<c&&(b=a.bottomNeighbor,c=a.bottomNeighborDistance),b},_getNeighborsGroups:function(a){a.neighborGroups=a.neighborGroups||[];var b=a.components||a.children;if(b){for(var c=[],d=0;d<b.length;d++){var e=this._getComponentNeighbors(b[d],b);c.push(e)}var f=this._getAverageDistanceBetweenNeighbors(c);f=this._removeOutliersAndRecalculateDistanceAverage(c,f);for(var g=[],d=0;d<b.length;d++){var h=[b[d].id],e=c[d],i=.08;e.leftNeighbor&&e.leftNeighborDistance/f<i&&h.push(e.leftNeighbor.id),e.rightNeighbor&&e.rightNeighborDistance/f<i&&h.push(e.rightNeighbor.id),e.topNeighbor&&e.topNeighborDistance/f<i&&h.push(e.topNeighbor.id),e.bottomNeighbor&&e.bottomNeighborDistance/f<i&&h.push(e.bottomNeighbor.id),h.length>1&&g.push(h)}a.neighborGroups=a.neighborGroups.concat(g),this._unifyGroups(a.neighborGroups);for(var d=0;d<b.length;d++)this._getNeighborsGroups(b[d])}},_unifyGroups:function(a){for(var b=-1;b!==a.length;){b=a.length;for(var c=a.length-1;c>=0;c--)for(var d=c-1;d>=0;d--)if(this._haveCommonElements(a[c],a[d])){this._mergeSecondArrayToFirstOne(a[d],a[c]),a.splice(c,1);break}}},_haveCommonElements:function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(a[c]==b[d])return!0;return!1},_mergeSecondArrayToFirstOne:function(a,b){for(var c=0;c<b.length;c++)a.contains(b[c])||a.push(b[c])},_getAverageDistanceBetweenNeighbors:function(a){for(var b=0,c=0,d=0;d<a.length;d++){var e=a[d];e.rightNeighbor&&(b+=e.rightNeighborDistance,c++),e.leftNeighbor&&(b+=e.leftNeighborDistance,c++),e.topNeighbor&&(b+=e.topNeighborDistance,c++),e.bottomNeighbor&&(b+=e.bottomNeighborDistance,c++)}return c>0?b/c:-1},_getComponentNeighbors:function(a,b){var c=this._getComponentBorders(a),d=null,e=Number.MAX_VALUE,f=null,g=Number.MAX_VALUE,h=null,i=Number.MAX_VALUE,j=null,k=Number.MAX_VALUE;if(b)for(var l=0;l<b.length;l++){var m=b[l];if(a.id!=m.id&&!this._areComponentsOverlay(a,m)){var n,o=this._getComponentBorders(m);this._hasYOverlap(a,m)&&(c.left>o.right&&(n=c.left-o.right,e>n&&(d=m,e=n)),c.right<o.left&&(n=o.left-c.right,g>n&&(f=m,g=n))),this._hasXOverlap(a,m)&&(c.top>o.bottom&&(n=c.top-o.bottom,i>n&&(h=m,i=n)),c.bottom<o.top&&(n=o.top-c.bottom,k>n&&(j=m,k=n)))}}return{leftNeighbor:d,leftNeighborDistance:e,rightNeighbor:f,rightNeighborDistance:g,topNeighbor:h,topNeighborDistance:i,bottomNeighbor:j,bottomNeighborDistance:k}},_getComponentBorders:function(a){return{left:a.layout.x,right:a.layout.x+a.layout.width,top:a.layout.y,bottom:a.layout.y+a.layout.height}},_removeOutliersAndRecalculateDistanceAverage:function(a,b){for(var c=2,d=0;d<a.length;d++){var e=a[d];e.leftNeighbor&&e.leftNeighborDistance>b*c&&(e.leftNeighborDistance=Number.MAX_VALUE,e.leftNeighbor=null),e.rightNeighbor&&e.rightNeighborDistance>b*c&&(e.rightNeighborDistance=Number.MAX_VALUE,e.rightNeighbor=null),e.topNeighbor&&e.topNeighborDistance>b*c&&(e.topNeighborDistance=Number.MAX_VALUE,e.topNeighbor=null),e.bottomNeighbor&&e.bottomNeighborDistance>b*c&&(e.bottomNeighborDistance=Number.MAX_VALUE,e.bottomNeighbor=null)}return b=this._getAverageDistanceBetweenNeighbors(a)},_identifyColumns:function(){},_addComponentOrder:function(a){var b=a.components||a.children;if(b){var c=this._cloneJSON(a),d=c.components||c.children;d.sort(this._compareByRows);for(var e=[],f=0;f<d.length;f++)e.push(d[f].id);for(a.componentsOrder=e,f=0;f<b.length;f++)this._addComponentOrder(b[f])}},_updateComponentOrderWithNeighborsInfo:function(a){if(a.neighborGroups&&a.neighborGroups.length>0){this._orderNeighborGroupsAccordingToComponentOrder(a);for(var b=0;b<a.componentsOrder.length;b++)for(var c=!1,d=0;d<a.neighborGroups.length&&!c;d++)for(var e=a.neighborGroups[d],f=0;f<e.length;f++)if(a.componentsOrder[b]==e[f]){c=!0;var g=e.slice(0);for(g.splice(f,1);g.length>0&&b<a.componentsOrder.length-1;){b++;var h=g.indexOf(a.componentsOrder[b]);if(-1==h){var i=g[0];a.componentsOrder.splice(a.componentsOrder.indexOf(i),1),a.componentsOrder.splice(b,0,i)}g.splice(0,1)}break}}var j=a.components||a.children;if(j)for(var b=0;b<j.length;b++)this._updateComponentOrderWithNeighborsInfo(j[b])},_orderNeighborGroupsAccordingToComponentOrder:function(a){for(var b=0;b<a.neighborGroups.length;b++){var c=a.neighborGroups[b];c.sort(this._compareByAnotherArrayOrder(a.componentsOrder))}},_compareByAnotherArrayOrder:function(a){return function(b,c){return a.indexOf(b)<a.indexOf(c)?-1:a.indexOf(b)>a.indexOf(c)?1:0}},_cloneJSON:function(a){return JSON.parse(JSON.stringify(a))},_compareByDistanceFromRoot:function(a,b){var c=Math.sqrt(Math.pow(a.layout.x,2)+Math.pow(a.layout.y,2)),d=Math.sqrt(Math.pow(b.layout.x,2)+Math.pow(b.layout.y,2));return d>c?-1:c>d?1:0},_compareByRows:function(a,b){if(!this._hasSufficientYOverLap(a,b)){if(a.layout.y<b.layout.y)return-1;if(a.layout.y>b.layout.y)return 1}return a.layout.x<b.layout.x?-1:a.layout.x>b.layout.x?1:0},_compareByColumns:function(a,b){if(!this._hasSufficientXOverLap(a,b)){if(a.layout.x<b.layout.x)return-1;if(a.layout.x>b.layout.x)return 1}return a.layout.y<b.layout.y?-1:a.layout.y>b.layout.y?1:0},_hasSufficientYOverLap:function(a,b){if(!this._hasYOverlap(a,b))return!1;var c=this._getYOverlap(a,b),d=Math.min(a.layout.height,b.layout.height);return c/d>.25},_hasSufficientXOverLap:function(a,b){if(!this._hasXOverlap(a,b))return!1;var c=this._getXOverlap(a,b),d=Math.min(a.layout.width,b.layout.width);return c/d>.25},_updatePageForMobileLayout:function(a){this._reorganizeChildren(a,this.MOBILE_WIDTH)},_reorganizeChildren:function(a,b){this._orderComponentsAccordingToGivenOrder(a);for(var c=[],d=this.COMPONENT_MOBILE_MARGIN,e=this.COMPONENT_MOBILE_MARGIN,f=0,g=a.components||a.children,h=0;h<g.length;h++){var i=g[h],j=i.layout,k=this._getComponentNeighborList(i,a),l=this._getComponentNeighborsTotalWidth(k),m=k[0]&&k[0].id==i.id&&!this._doesComponentFitLocation(l,d,e,b);if(!this._doesComponentFitLocation(j.width,d,e,b)||m){this._centerComponentsOfLastRow(c,b),c=[],0!=f&&(e=e+f+this.COMPONENT_MOBILE_MARGIN),d=this.COMPONENT_MOBILE_MARGIN;var n=!this._doesComponentFitLocation(j.width,d,e,b)||this._isEnlargeComponentToFitPageWidth(i,a);if(n){var o="VIRTUAL_GROUP"==i.componentType?this.CHILDREN_TREATMENT_METHOD.RESCALE_CHILDREN:this.CHILDREN_TREATMENT_METHOD.REORGANIZE_CHILDREN;this._rescaleComponentToFitWidth(i,o,b)}f=j.height}j.x=d,j.y=e,d=d+j.width+this.COMPONENT_MOBILE_MARGIN,f=Math.max(f,j.height),c.push(i)}this._centerComponentsOfLastRow(c,b),this._ensureContainerWrapsChildren(a)},_ensureContainerWrapsChildren:function(a){var b=a.components||a.children;if(b){for(var c=0,d=0;d<b.length;d++)c=Math.max(c,b[d].layout.y+b[d].layout.height);a.layout&&a.layout.height<c&&(a.layout.height=c)}},_getComponentNeighborList:function(a,b){for(var c=this._findComponentInGroups(a.id,b.neighborGroups||[]),d=[],e=0;e<c.length;e++){var f=this._getComponentFromArray(c[e],b.components);d.push(f)}return d},_getComponentNeighborsTotalWidth:function(a){if(0==a.length)return 0;for(var b=this.COMPONENT_MOBILE_MARGIN,c=0;c<a.length;c++)b+=a[c].layout.width+this.COMPONENT_MOBILE_MARGIN;return b},_findComponentInGroups:function(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<b.length;d++)if(a==b[c][d])return b[c];return[]},_getComponentFromArray:function(a,b){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c]},_orderComponentsAccordingToGivenOrder:function(a){a.components&&a.components.sort(this._sortByComponentsOrder(a.componentsOrder))},_sortByComponentsOrder:function(a){return function(b,c){var d=a.indexOf(b.id),e=a.indexOf(c.id);return d-e}},_isEnlargeComponentToFitPageWidth:function(a,b){return this._isComponentDirectChildOfSiteSegment(b)&&a.layout.width>.8*(this.MOBILE_WIDTH-2*this.COMPONENT_MOBILE_MARGIN)},_isComponentDirectChildContainerOfPage:function(a,b){return"mobile.core.components.Container"==a.componentType&&"mobile.core.components.Page"==b.componentType},_isComponentDirectChildOfSiteSegment:function(a){return this._isSiteSegment(a)||"mobile.core.components.Page"==a.componentType},_centerComponentsOfLastRow:function(a,b){if(0!=a.length){for(var c=0,d=0;d<a.length;d++)c+=a[d].layout.width;for(var e=Math.round((b-c)/(a.length+1)),f=e,d=0;d<a.length;d++)a[d].layout.x=f,f=f+a[d].layout.width+e}},_identifyOverlayingComponentsAsGroups:function(a){if(a.components){a.groups=a.groups||[];for(var b=[],c=this._cloneJSON(a),d=c.components||c.children;d.length>0;){var e=this._getOverlayingComponentsWithGivenComponent(d[0],d);if(0!=e.length){this._removeComponentsFromContainer(c,e);for(var f=0;f<e.length;){var g=this._getOverlayingComponentsWithGivenComponent(e[f],d);e=e.concat(g),this._removeComponentsFromContainer(c,g),f++}if(e.length>1){for(var h=[],i=0;i<e.length;i++)h.push(e[i].id);b.push(h)}}else this._removeComponentsFromContainer(c,[d[0]])}a.groups=a.groups.concat(b)}var j=a.components||a.children;if(j)for(var k=0;k<j.length;k++)this._identifyOverlayingComponentsAsGroups(j[k])},_getOverlayingComponentsWithGivenComponent:function(a,b){if(!this._isComponentSuitableForGrouping(a))return[];for(var c=[],d=0;d<b.length;d++){var e=b[d];this._isComponentSuitableForGrouping(e)&&this._areComponentsOverlay(a,e,.25)&&c.push(e)}return c},_isComponentSuitableForGrouping:function(a){if(a.isText){var b=/(<([^>]+)>)/gi,c=W.Data.getDataByQuery(a.dataQuery).get("text");if(c=c.replace(b,""),c.length>this.TEXT_MAX_LENGTH_FOR_RESCALING)return!1}if(!a.components)return!0;for(var d=!0,e=0;e<a.components.length;e++)d=d&&this._isComponentSuitableForGrouping(a.components[e]);return d},_removeComponentsFromContainer:function(a,b){for(var c=0;c<b.length;c++)this._removeComponentFromContainer(a,b[c])},_removeComponentFromContainer:function(a,b){for(var c=b.id,d=a.components||a.children,e=0;e<d.length;e++)if(d[e].id==c)return d.splice(e,1),void 0},_addComponentsToContainer:function(a,b,c){var d=a.components||a.children;if(d||(d=[]),c)for(var e=b.length-1;e>=0;e--)d.splice(c,0,b[e]);else for(var e=0;e<b.length;e++)d.push(b[e])},_replaceBackGroupsToFlatComponents:function(a){var b=a.components||a.children;if(b){for(var c=[],d=0;d<b.length;){var e=b[d];"VIRTUAL_GROUP"==e.componentType&&(this._shiftGroupComponents(e.components,-1*e.layout.x,-1*e.layout.y),this._addComponentsToContainer(a,e.components,d+1),c.push(e)),d++}this._removeComponentsFromContainer(a,c);for(var d=0;d<b.length;d++)this._replaceBackGroupsToFlatComponents(b[d])}},_doesComponentFitLocation:function(a,b,c,d){return b+a+this.COMPONENT_MOBILE_MARGIN<d},_rescaleComponentToFitWidth:function(a,b,c){var d=a.wrappedTightlyByParent?c:c-2*this.COMPONENT_MOBILE_MARGIN,e=a.layout.width/d;this._rescaleComponentHeightIfNeeded(a,e),a.layout.width=d,this._markComponentAsNeedsToEnforceItsAnchors(a),a.components&&this._applyContainerRescaleOnChildren(a,b,e,d)},_rescaleComponentHeightIfNeeded:function(a,b){this._doesComponentNeedToRescaleItsHeight(a)&&(a.layout.height=Math.round(a.layout.height/b))},_doesComponentNeedToRescaleItsHeight:function(a){var b=["wysiwyg.viewer.components.MatrixGallery","wysiwyg.viewer.components.GoogleMap","wysiwyg.viewer.components.SliderGallery"];return b.contains(a.componentType)?!1:!0},_applyContainerRescaleOnChildren:function(a,b,c,d){b==this.CHILDREN_TREATMENT_METHOD.RESCALE_CHILDREN&&this._rescaleChildren(a,c),b==this.CHILDREN_TREATMENT_METHOD.REORGANIZE_CHILDREN&&this._reorganizeChildren(a,d)},_rescaleChildren:function(a,b){for(var c=0;c<a.components.length;c++){var d=a.components[c],e=d.layout;this._rescaleComponentHeightIfNeeded(d,b),e.width=Math.round(e.width/b),e.x=Math.round(e.x/b),e.y=Math.round(e.y/b),this._markComponentAsNeedsToEnforceItsAnchors(d),d.isText&&(d.textScale=1/b),d.components&&this._rescaleChildren(d,b)}},_markComponentAsNeedsToEnforceItsAnchors:function(a){a.needsToEnforceAnchors=!0},_updateComponentAnchors:function(a){this._recalculateComponentsAnchors(a);var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++)this._updateComponentAnchors(b[c])},_recalculateComponentsAnchors:function(a){a.children?this._setSiteSegmentAnchors(a):a.components&&(this._recalculateComponentAnchorsOfSameLevel(a.components),this._addBottomParentAnchorsToContainer(a),this._removeRedundantBottomParentAnchors(a))},_clearComponentAnchors:function(a){a.layout&&(a.layout.anchors=[]);var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++)this._clearComponentAnchors(b[c])},_setSiteSegmentAnchors:function(a){var b=this._getComponentById("SITE_HEADER",a.children),c=this._getComponentById("SITE_FOOTER",a.children),d=this._getComponentById("PAGES_CONTAINER",a.children);this._addToTopAnchor(b,d,{distance:10,locked:!0,type:"BOTTOM_TOP"}),this._addToTopAnchor(d,c,{distance:10,locked:!0,type:"BOTTOM_TOP"}),c.layout.anchors=c.layout.anchors||[],c.layout.anchors.push({distance:10,locked:!0,originalValue:500,targetComponent:"SITE_STRUCTURE",topToTop:500,type:"BOTTOM_PARENT"})},_isSiteSegment:function(a){var b=["wysiwyg.viewer.components.HeaderContainer","wysiwyg.viewer.components.PagesContainer","wysiwyg.viewer.components.FooterContainer"];return b.contains(a.componentType)},_recalculateComponentAnchorsOfSameLevel:function(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=this._getComponentsBelowComponent(c,a),e=0;e<d.length;e++)this._addToTopAnchor(c,d[e]);this._removeRedundantBottomTopAnchors(a)},_getComponentsBelowComponent:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];a.id!=e.id&&this._hasXOverlap(a,e)&&a.layout.y<=e.layout.y&&c.push(e)}return c},_hasYOverlap:function(a,b){return a.layout.y==b.layout.y?!0:this._getYOverlap(a,b)>0},_getYOverlap:function(a,b){var c=a.layout.y<b.layout.y?a:b,d=c==b?a:b,e=c.layout.y+c.layout.height,f=d.layout.y+d.layout.height;return f>e?e-d.layout.y:d.layout.height},_hasXOverlap:function(a,b){return a.layout.x==b.layout.x?!0:this._getXOverlap(a,b)>0},_getXOverlap:function(a,b){var c=a.layout.x<b.layout.x?a:b,d=c==b?a:b,e=c.layout.x+c.layout.width,f=d.layout.x+d.layout.width;return f>e?e-d.layout.x:d.layout.width},_areComponentsOverlay:function(a,b,c){var d=this._hasYOverlap(a,b)&&this._hasXOverlap(a,b);if(!d||!c)return d;var e=this._getXOverlap(a,b)*this._getYOverlap(a,b),f=Math.min(a.layout.width*a.layout.height,b.layout.width*b.layout.height);return e/f>c},_addToTopAnchor:function(a,b,c){var d=b.layout.y-(a.layout.y+a.layout.height),e=b.layout.y-a.layout.y,f=d<=this.resources.W.Layout.LOCK_THRESHOLD,g=b.layout.y,h=b.layout.y+b.layout.height>a.layout.y+a.layout.height&&b.layout.y>a.layout.y+a.layout.height/2,i=h?"BOTTOM_TOP":"TOP_TOP",j={distance:d,locked:f,originalValue:g,targetComponent:b.id,topToTop:e,type:i};c&&_.assign(j,c),a.layout.anchors.push(j)},_addBottomParentAnchor:function(a,b,c){var d=Math.max(b.layout.height-(a.layout.y+a.layout.height),0),e=a.layout.y,f=d<=this.resources.W.Layout.LOCK_THRESHOLD,g=b.layout.height,h={distance:d,locked:f,originalValue:g,targetComponent:b.id,topToTop:e,type:"BOTTOM_PARENT"};c&&_.assign(h,c),a.layout.anchors.push(h)},_removeRedundantBottomTopAnchors:function(a){for(var b=0;b<a.length;b++)for(var c=b+1;c<a.length;c++)for(var d=c+1;d<a.length;d++)this._hasAnchor(a[b],a[c],"BOTTOM_TOP")&&this._hasAnchor(a[c],a[d],"BOTTOM_TOP")&&this._hasAnchor(a[b],a[d],"BOTTOM_TOP")&&this._removeAnchor(a[b],a[d],"BOTTOM_TOP")},_removeRedundantBottomParentAnchors:function(a){for(var b=a.components,c=0;c<b.length;c++)for(var d=0;d<b.length;d++)this._hasAnchor(b[c],a,"BOTTOM_PARENT")&&this._hasAnchor(b[d],a,"BOTTOM_PARENT")&&this._hasAnchor(b[c],b[d],"BOTTOM_TOP")&&this._removeAnchor(b[c],a,"BOTTOM_PARENT")},_hasAnchor:function(a,b,c){for(var d=0;d<a.layout.anchors.length;d++){var e=a.layout.anchors[d];if(e.targetComponent==b.id&&e.type==c)return!0}return!1},_removeAnchor:function(a,b,c){for(var d=null,e=0;e<a.layout.anchors.length;e++){var f=a.layout.anchors[e];f.targetComponent==b.id&&f.type==c&&(d=e)}d&&a.layout.anchors.splice(d,1)},_addBottomParentAnchorsToContainer:function(a){q=this._stringifyDataManagerDataMapForSpecPurposes;for(var b=0;b<a.components.length;b++){var c=a.components[b];this._addBottomParentAnchor(c,a)}}})}),define.experiment.newClass("wysiwyg.viewer.responsive.ResponsiveAlgorithmAPI.Responsive1.New",function(a,b){var c=a;c.utilize(["wysiwyg.viewer.responsive.ResponsiveAlgorithm"]),c.methods({initialize:function(){this._responsiveAlgorithm=new this.imports.ResponsiveAlgorithm},convertStructureToMobileLayout:function(a,b){this._responsiveAlgorithm._convertStructureToMobileLayout(a,b)},modifyStylesToFitMobileLayout:function(){this._responsiveAlgorithm._modifyStylesToFitMobileLayout()}})});
define.Class("wixapps.core.apprepo.AppPartDefinition",function(e){var t=e;t.traits(["wixapps.core.apprepo.traits.AppRepoItem"]),t.fields({_dataSelector:null,_viewName:null,_type:null,_displayName:null,_appPageId:"home"}),t.methods({initialize:function(e){this._appInstance=e},loadFromDefinition:function(e){this.setDataSelectorId(e.dataSelector),this.setViewName(e.viewName),this.setCustomizations(e.customizations),this.setEventHandlers(e.eventHandlers),this.setType(e.type),this.setDisplayName(e.displayName)},setDataSelectorId:function(e){this._dataSelector=e},getDataSelectorId:function(){return this._dataSelector},getDataSelector:function(){return this._appInstance.getDataSelectors().getById(this._dataSelector)},setViewName:function(e){this._viewName=e},getViewName:function(){return this._viewName},setType:function(e){this._type=e},getType:function(){return this._type},getTypeDef:function(){return this._appInstance.getTypesManager().getType(this._type)},setCustomizations:function(e){this._customizations=e},getCustomizations:function(){return this._customizations},setEventHandlers:function(e){this._eventHandlers=e},getEventHandlers:function(){return this._eventHandlers},setDisplayName:function(e){this._displayName=e},getDisplayName:function(){return this._displayName},setUsed:function(e){this._used=e},isUsed:function(){return this._used},getSerializableProperties:function(){return["dataSelector","viewName","type","displayName"]}})}),define.Class("wixapps.core.apprepo.AppPartsRepository",function(e){var t=e;t.inherits("wixapps.core.apprepo.base.BaseRepository"),t.utilize(["wixapps.core.apprepo.AppPartDefinition"]),t.fields({_byType:{}}),t.methods({_getInstanceClass:function(){return this.imports.AppPartDefinition},createAndRegister:function(e,t,i,n){var a=new this.imports.AppPartDefinition(this._appInstance);a.setDataSelectorId(e),a.setViewName(t),a.setType(i),a.setDisplayName(n);var s=this.register("apppart",a);return s}})}),define.Class("wixapps.core.apprepo.AppRepoTransport",function(e){var t=e;t.inherits("wixapps.core.utils.WixServiceTransportBase"),t.utilize(["wixapps.core.utils.WixAppsLogger"]),t.methods({_getServiceUrl:function(){var e=window.location.origin||this._extractBasePath(window.location.href);return e+"/apps/appBuilder/"},updateInstance:function(e,t,i,n){var a=e.toObject();this.doRequest("saved/"+t,{},a,i,n)},getSavedInstance:function(e,t,i){this.doGetRequest("saved/"+e,{},null,t,i)},getPublishedInstance:function(e,t,i){this.doGetRequest("published/"+e,{},null,t,i)},publishInstance:function(e,t,i){this.doRequest("published/"+e,{},null,t,i)}})}),define.Class("wixapps.core.apprepo.ApplicationDefinition",function(e){var t=e;t.statics({DATA_PROVIDERS_KEY:"dataProviders",DATA_SELECTORS_KEY:"dataSelectors",PARTS_DEF_KEY:"parts",TYPES_KEY:"types",VIEWS_KEY:"views",PAGES_KEY:"pages",APP_VERSION_KEY:"applicationInstanceVersion"}),t.fields({_appDef:{}}),t.methods({initialize:function(e){this._appDef=e||{}},getDataProviders:function(){return this._appDef[this.DATA_PROVIDERS_KEY]},setDataProviders:function(e){this._appDef[this.DATA_PROVIDERS_KEY]=e},getDataSelectors:function(){return this._appDef[this.DATA_SELECTORS_KEY]},setDataSelectors:function(e){this._appDef[this.DATA_SELECTORS_KEY]=e},getAppPartDefinitions:function(){return this._appDef[this.PARTS_DEF_KEY]},setAppPartDefinitions:function(e){this._appDef[this.PARTS_DEF_KEY]=e},getTypes:function(){return this._appDef[this.TYPES_KEY]},setTypes:function(e){this._appDef[this.TYPES_KEY]=e},getViewDefinitions:function(){return this._appDef[this.VIEWS_KEY]},setViewDefinitions:function(e){this._appDef[this.VIEWS_KEY]=e},setAppInstanceVersion:function(e){this._appDef[this.APP_VERSION_KEY]=e},getAppInstanceVersion:function(){return this._appDef[this.APP_VERSION_KEY]},setPages:function(e){this._appDef[this.PAGES_KEY]=e},getPages:function(){return this._appDef[this.PAGES_KEY]},toObject:function(){return this._appDef}})}),define.Class("wixapps.core.apprepo.ApplicationInstance2",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["resolveResourcePath"]),t.utilize(["wixapps.core.apprepo.ApplicationDefinition","wixapps.core.apprepo.DataProvidersRepository","wixapps.core.apprepo.DataSelectorsRepository","wixapps.core.apprepo.AppPartsRepository","wixapps.core.apprepo.PageRepository","wixapps.core.managers.TypesManager","wixapps.core.views.ViewDefinitionsRepository","wixapps.core.views.ViewsCustomizer","wixapps.core.utils.WixAppsLogger","wixapps.core.data.DataItemFactory","wixapps.core.expressions.FunctionLibrary","wixapps.integration.utils.PerformanceTracker"]),t.resources(["W.Commands"]),t.fields({_instanceId:null,_appDef:null,_basePath:null,_viewsDefRepo:null,_appInstanceVersion:1,_appPages:[],_dataProvidersRepo:null}),t.methods({initialize:function(e,t){this._instanceId=e||"<DRAFT>",this._trkr=new this.imports.PerformanceTracker,this._funcLibrary=new this.imports.FunctionLibrary,this._dataFactory=new this.imports.DataItemFactory,this._dataFactory.registerFunctionLibrary(this._funcLibrary),this._appCache=null,this._dataProvidersRepo=new this.imports.DataProvidersRepository(this),this._dataSelectorsRepo=new this.imports.DataSelectorsRepository(this),this._partsRepo=new this.imports.AppPartsRepository(this),this._typesManager=new this.imports.TypesManager,this._pagesRepo=new this.imports.PageRepository(this),this._viewsDefRepo=new this.imports.ViewDefinitionsRepository(this._dataFactory),this._customizations=new this.imports.ViewsCustomizer,this._logger=new this.imports.WixAppsLogger;for(var i=Constants.WixAppsSystemTypes,n=0;i.length>n;n++)this._typesManager.registerType(i[n]);var a=W.Config.getServiceTopologyProperty("scriptsLocationMap");if(!a||!a.wixapps)throw"wixapps topology path is undefined";this._basePath=a.wixapps+"/",t?(this._appDef=new this.imports.ApplicationDefinition(t),this._migrateDefinitions(this._appDef),this._loadAppData()):this._appDef=new this.imports.ApplicationDefinition},_migrateDefinitions:function(){},toObject:function(){var e=new this.imports.ApplicationDefinition;e.setDataProviders(this._dataProvidersRepo.toObject()),e.setDataSelectors(this._dataSelectorsRepo.toArray()),e.setAppPartDefinitions(this._partsRepo.toObject());var t=this.getDataProviders().getWixDbDataProvider();return e.setTypes(t.getManagedTypes()),e.setViewDefinitions(this._viewsDefRepo.toArray()),e.setPages(this._pagesRepo.toObject()),e.setAppInstanceVersion(this.getAppInstanceVersion()),e.toObject()},_loadAppData:function(){if(this._dataProvidersRepo.fromObject(this._appDef.getDataProviders()),!this._dataProvidersRepo.isWixDbDataProviderDefined()){var e=this._logger;e.reportError(e.Errors.WIX_DATA_PROVIDER_DOESNT_EXIST,this.$className,"_loadAppData",e.SubCategory.APP_REPO_SERVICE,e.Severity.RECOVERABLE,e.Category.EDITOR),this._dataProvidersRepo.createWixDbDataProvider()}this._dataSelectorsRepo.fromArray(this._appDef.getDataSelectors()),this._partsRepo.fromObject(this._appDef.getAppPartDefinitions()),this.loadViews(this._appDef.getViewDefinitions()),this._pagesRepo.fromObject(this._appDef.getPages()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},getAppDef:function(){return this._appDef},getDataProviders:function(){return this._dataProvidersRepo},getDataSelectors:function(){return this._dataSelectorsRepo},getAppPartDefinitions:function(){return this._partsRepo},getPages:function(){return this._pagesRepo},getTypesManager:function(){return this._typesManager},addViewDefinition:function(e){this._customizations.applyAll(e),this._viewsDefRepo.setViewDefinition(e)},setAppInstanceVersion:function(e){this._appInstanceVersion=e},getAppInstanceVersion:function(){return this._appInstanceVersion},getViewDefinitions:function(){return this._viewsDefRepo},getLogger:function(){return this._logger},getAppCache:function(){return this._appCache},resolveResourcePath:function(e){if(e){var t=e.match(/^(http:\/\/)?(images\/.*)/);if(t)return this._basePath+t[2]}return e},getDataItemFactory:function(){return this._dataFactory},isSavedInRepo:function(){return this._isSavedInRepo},setSavedInRepo:function(e){this._isSavedInRepo=e},loadViews:function(e){e&&(e.each(function(e){for(var t=this._viewsDefRepo.cloneAndMultiply(e),i=0;t.length>i;i++){var n=t[i];this._customizations.fillMissingIds(n),this.addViewDefinition(n)}}.bind(this)),this.setupCustomizations([]))},setupCustomizations:function(e){this._customizations.addRules(e),this.applyCustomizations()},applyCustomizations:function(){this._customizations.applyToViewDefinitionsRepository(this._viewsDefRepo)},getInstanceId:function(){return this._isSavedInRepo?this._instanceId:"<DRAFT>"},setInstanceId:function(e){this._instanceId=e},setApplicationId:function(e){this._applicationId=e},registerAppPage:function(e){this._appPages.push(e),e.initApp()},removeAppPage:function(e){this._appPages=this._appPages.filter(function(t){return t._appPageId!==e})},getPageDefinition:function(e){return this._pagesRepo.getById(e)},getApplicationId:function(){return this._applicationId},getTrkr:function(){return this._trkr},getViewsCustomizer:function(){return this._customizations},performCleanup:function(){this._cleanupAppPartDefinitions(),this._cleanupViewDefinitions(),this._cleanupTypes(),this._cleanupDataSelectors()},_cleanupAppPartDefinitions:function(){for(var e=W.Apps2.getAppPart2Components(),t=e.map(function(e){return e._data.get("appPartName")}),i=this.getAppPartDefinitions(),n=i.getIds(),a=0;n.length>a;a++){var s=n[a];t.contains(s)===!1&&i.remove(s)}},_cleanupViewDefinitions:function(){var e=this.getViewDefinitions(),t=e.getAllViewNamesByType();t=Object.clone(t),Object.each(t,function(t,i){for(var n=0;t.length>n;n++){var a=t[n];this._hasNoAppPartDefRefs(function(e){var t=e.getViewName()===a;return t},function(){e.removeViewDefinition({forType:i,name:a}),e.removeViewDefinition({forType:"Array",name:a})})}}.bind(this))},_cleanupTypes:function(){for(var e=this.getDataProviders().getWixDbDataProvider(),t=e.getManagedTypes(),i=0;t.length>i;i++){var n=t[i].name;this._hasNoAppPartDefRefs(function(e){var t=e.getType()===n;return t},function(){e.deleteType(n)})}},_cleanupDataSelectors:function(){for(var e=this.getDataSelectors(),t=e.getIds(),i=0;t.length>i;i++){var n=t[i];this._hasNoAppPartDefRefs(function(e){return e.getDataSelectorId()===n},function(){e.remove(n)})}},_hasNoRefsInCollection:function(e,t,i){0===e.filter(t).length&&i()},_hasNoAppPartDefRefs:function(e,t){var i=this.getAppPartDefinitions();this._hasNoRefsInCollection(i,e,t)}})}),define.Class("wixapps.core.apprepo.DataProvidersRepository",function(e){var t=e;t.inherits("wixapps.core.apprepo.base.BaseRepository"),t.utilize(["wixapps.core.data.providers.wixdb.WixDbDraftDataProvider","wixapps.core.data.providers.wixdb.WixDbPublishedDataProvider"]),t.methods({_getInstanceClass:function(e){var t=e&&e.type;return"WixDb"==t?W.Viewer.isPublicMode()?this.imports.WixDbPublishedDataProvider:this.imports.WixDbDraftDataProvider:void 0},registerWixDbDataProvider:function(e){return this.registerWithId("wixdb",e)},getWixDbDataProvider:function(){var e;return e=this.isWixDbDataProviderDefined()?this.getById("wixdb"):this.createWixDbDataProvider()},isWixDbDataProviderDefined:function(){return void 0!==this._instancesMap.wixdb},createWixDbDataProvider:function(){var e=new this.imports.WixDbDraftDataProvider(this._appInstance);return this.registerWixDbDataProvider(e),e}})}),define.Class("wixapps.core.apprepo.DataSelectorsRepository",function(e){var t=e;t.inherits("wixapps.core.apprepo.base.BaseRepository"),t.utilize(["wixapps.core.data.selectors.ManualSelectedItemDataSelector","wixapps.core.data.selectors.ManualSelectedListDataSelector","wixapps.core.data.selectors.PageSelectedItemDataSelector","wixapps.core.data.selectors.SelectedItemDataSelector"]),t.fields({_byType:{}}),t.methods({_getInstanceClass:function(e){var t=e&&e.logicalTypeName;switch(t){case"IB.ManualSelectedItem":return this.imports.ManualSelectedItemDataSelector;case"IB.ManualSelectedList":return this.imports.ManualSelectedListDataSelector;case"IB.SelectedItemInList":return this.imports.SelectedItemDataSelector;case"IB.PageSelectedItem":return this.imports.PageSelectedItemDataSelector}},createInstance:function(e,t,i,n){var a=null,s=n.itemIds||[],o=n.hiddenItems||[],r=this._getInstanceClass({logicalTypeName:e});switch(a=new r(this._appInstance),a.setDataProvider(t),a.setSelectionType(i),e){case"IB.ManualSelectedList":a.setItemIds(s),a.setHiddenItemIds(o);break;case"IB.ManualSelectedItem":s.length&&(n.itemIds=s[0]),a.setItemId(s);break;case"IB.PageSelectedItem":a.setAppPageId(n.appPageId)}return a},_register:function(e){var t=e.getSelectionType(),i=this._appInstance.getDataSelectors().register("dataSelector"+W.Utils.AppsUtils.getTimeBasedUniqueId(),e),n=this._byType[t];return n||(this._byType[t]=[],n=this._byType[t]),n.push(e),i},createAndRegister:function(e,t,i,n){return this._register(this.createInstance(e,t,i,n))},createBasedOnOtherSelector:function(e){this._appInstance.getDataProviders();var t=this._appInstance.getDataSelectors(),i=e.getLogicalTypeName(),n=e.getDataProvider(),a=e.getSelectionType(),s=e.toObject(),o=t.createAndRegister(i,n,a,s),r=t.getById(o);return r.setItemIds&&r.setItemIds(e.getItemIds()),r},getByType:function(e){return this._byType[e]||[]}})}),define.Class("wixapps.core.apprepo.PageDefinition",function(e){var t=e;t.traits(["wixapps.core.apprepo.traits.AppRepoItem"]),t.fields({_forType:null,_pageLogicClass:null,_displayName:null}),t.methods({initialize:function(e){this._appInstance=e},loadFromDefinition:function(e){this.setLogicClass(e.pageLogicClass),this.setType(e.forType),this.setDisplayName(e.displayName)},setLogicClass:function(e){this._pageLogicClass=e},getLogicClass:function(){return this._pageLogicClass},setType:function(e){this._forType=e},getType:function(){return this._forType},setDisplayName:function(e){this._displayName=e},getDisplayName:function(){return this._displayName},getSerializableProperties:function(){return["pageLogicClass","forType","displayName"]}})}),define.Class("wixapps.core.apprepo.PageRepository",function(e){var t=e;t.inherits("wixapps.core.apprepo.base.BaseRepository"),t.utilize(["wixapps.core.apprepo.PageDefinition"]),t.methods({_getInstanceClass:function(){return this.imports.PageDefinition},createAndRegister:function(e,t,i){var n=new this.imports.PageDefinition(this._appInstance);"singleItem"==e&&(n.setLogicClass("wixapps.core.logics.page.AppBuilderPageLogic"),n.setType(t)),n.setDisplayName(i);var a=this.registerWithGuid(n);return a},getPageDefByType:function(e){for(var t=0;this._instances.length>t;t++){var i=this._instances[t],n=i.instance;if(n.getType()===e)return n}return void 0},filterByType:function(e){return this.filter(function(t){return t.getType()===e})}})}),define.Class("wixapps.core.apprepo.base.BaseRepository",function(e){var t=e;t.fields({_instances:[],_instancesMap:{},_appInstance:null}),t.methods({initialize:function(e){this._appInstance=e},fromObject:function(e){Object.each(e,function(e,t){var i=this._createInstance(e);this.registerWithId(t,i)}.bind(this))},fromArray:function(e){e=e||[],Array.each(e,function(e){var t=this._createInstance(e);this.registerWithId(e.id,t)}.bind(this))},_createInstance:function(e){var t,i=this._getInstanceClass(e);if(!i)throw"No Class found for "+e;return t=new i(this._appInstance),t.loadFromDefinition(e),t},toObject:function(){for(var e={},t=0;this._getInstances().length>t;t++){var i=this._getInstances()[t];e[i.id]=i.instance.toObject()}return e},toArray:function(){return this._getInstances().map(function(e){return e.instance.toObject()})},_getInstances:function(){return this._instances},_getInstanceClass:function(){throw"Must Implement!"},register:function(e,t){var i=W.Utils.AppsUtils.getTimeBasedUniqueId(e);return this.registerWithId(i,t),i},registerWithId:function(e,t){return this._getInstances().push({id:e,instance:t}),this._instancesMap[e]=t,t.setId(e),e},registerWithGuid:function(e){var t=this.generateGUID();return this.registerWithId(t,e),t},generateGUID:function(){var e=function(){return Math.floor(65536*Math.random()).toString(16)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},remove:function(e){this._instances=this._instances.filter(function(t){return t.id!=e}),delete this._instancesMap[e]},getById:function(e){var t=this._instancesMap[e];if(!t)throw"No item of id ["+e+"]";return t},getIds:function(){return this._instances.map(function(e){return e.id})},filter:function(e){var t=this._instances.filter(function(t){return e(t.instance)});return t.map(function(e){return e.instance})}})}),define.Class("wixapps.core.apprepo.traits.AppRepoItem",function(e){var t=e;t.methods({fromObject:function(e){Object.each(e,function(e,t){this["_"+t]=e}.bind(this))},toObject:function(){var e=this.getSerializableProperties(),t={};return e.each(function(e){t[e]=this["_"+e]}.bind(this)),t},getId:function(){return this._id},setId:function(e){this._id=e},getSerializableProperties:function(){throw"Must implement me!"}})}),define.Class("wixapps.core.data.DataItemBinding",function(e){var t=e;t.inherits(),t.utilize([]),t.traits([]),t.binds(["_onSourceChanged","_onTargetChanged"]),t.fields({_source:null,_target:null,_bidirectional:!1}),t.methods({initialize:function(e,t,i){this._bidirectional=void 0===i?!1:i,this._source=e,this._target=t,this._source.addEvent(Constants.DataItemEvents.CHANGE,this._onSourceChanged),this._bidirectional&&this._target.addEvent(Constants.DataItemEvents.CHANGE,this._onTargetChanged),this._target.setValue(this._source.getValue())},_onSourceChanged:function(){this._target.setValue(this._source.getValue())},_onTargetChanged:function(){this._source.setValue(this._target.getValue())},dispose:function(){this._source.removeEvent(Constants.DataItemEvents.CHANGE,this._onSourceChanged),this._bidirectional&&this._target.removeEvent(Constants.DataItemEvents.CHANGE,this._onTargetChanged)}})}),define.Class("wixapps.core.data.DataItemFactory",function(e){var t=e;t.utilize(["wixapps.core.expressions.Expression"]),t.fields({_refResolver:null,_cfCtrlDict:{},_constructorMap:{},_funcLibrary:null,_debugMode:0}),t.statics({SANITATION_WARNING_ILLEGAL_TYPE:"Illegal type"}),t.resources(["DataItemModule"]),t.methods({initialize:function(){this._constructorMap=this.resources.DataItemModule.getConstructors()},getDataItemClassName:function(e){var t,i=typeOf(e);return"object"==i?t=e._type&&"wix:Ref"==e._type.substr(0,7)?"wixapps.core.data.DataItemProxy":e.hasOwnProperty("$expr")?"wixapps.core.data.ExprDataItem":"wixapps.core.data.CompositeDataItem":"array"==i?t="wixapps.core.data.ArrayDataItem":"function"==i||(t="wixapps.core.data.DataItem"),t},createDataItem:function(e){var t,i,n;return t=this.getDataItemClassName(e),i=this._getDataItemConstructor(t),i&&(n=new i(this),n.setValue(e),n.resetDirtyFlag(),this._debugMode>0&&(window._debug_idCounter||(window._debug_idCounter=1e3,window._debug_itemDict={}),n._debug_itemID=window._debug_idCounter++,this._debugMode>1&&W&&W.Utils&&(n._debug_whodunnit=W.Utils.getStackTrace()))),n},createComputedField:function(e,t,i,n){var a=this._getDataItemConstructor("wixapps.core.data.ComputedFieldItem");return new a(this,e,t,i,n)},createVirtualArray:function(){var e=this._getDataItemConstructor("wixapps.core.data.VirtualArrayDataItem");return new e(this)},getFactory:function(){return this},getRefResolver:function(){return this._refResolver},registerRefResolver:function(e){if(!e.deReference||"function"!==typeOf(e.deReference))throw Error("refResolver must provide function 'deReference()'");this._refResolver=e},registerComputedFieldController:function(e,t,i,n){e&&t&&(this._cfCtrlDict[this._getCfCtrlKey(e,t)]={getter:i,setter:n})},getComputedFieldGetter:function(e,t){var i=this._getCfCtrlKey(e,t);return this._cfCtrlDict[i]?this._cfCtrlDict[i].getter:void 0},getComputedFieldSetter:function(e,t){var i=this._getCfCtrlKey(e,t);return this._cfCtrlDict[i]?this._cfCtrlDict[i].setter:void 0},getFunctionLibrary:function(){return this._funcLibrary},registerFunctionLibrary:function(e){this._funcLibrary=e},_getCfCtrlKey:function(e,t){return e+"|"+t},_getDataItemConstructor:function(e){var t;return e?(e in this._constructorMap||(t=e.match(/[^\.]+$/)[0],t&&t in this.imports&&(this._constructorMap[e]=this.imports[t])),this._constructorMap[e]):void 0},sanitizeRawData:function(e){var t=this,i=["string","boolean","number","object","array"],n=[],a=function(e,s){var o=typeOf(e);if(i.contains(o)){var r="array"==o?Array:"object"==o?Object:void 0;if(r){var l=r.map(e,function(e,t){return a(e,s+"/"+(t+""))});return r.filter(l,function(e){return null!==e})}return e}return n.push({id:t.SANITATION_WARNING_ILLEGAL_TYPE,path:s,value:typeOf(e)}),null};return{processedData:a(e,""),warnings:n}},clone:function(){var e=new this.constructor;return e.registerRefResolver(this._refResolver),e._cfCtrlDict={},Object.each(this._cfCtrlDict,function(t,i){e._cfCtrlDict[i]=t}),e}})}),define.Const("DataItem",{VOID_REF:"VOID_REF"}),define.Const("DataItemEvents",{CHANGE:"dataItemChange",VALIDATION_PERFORMED:"dataItemValidationChanged",CHANGE_EVENT_ACTION_ADD:"add",CHANGE_EVENT_ACTION_DELETE:"delete",CHANGE_EVENT_ACTION_REPLACE:"replace",CHANGE_EVENT_ACTION_MOVE:"move",CHANGE_EVENT_ACTION_VISIBILITY:"visibility",bubblingEvents:["dataItemChange"]}),define.Const("DataItemEventPhase",{ON_TARGET:"onTarget",BUBBLING:"bubbling"}),define.resource("DataItemModule",{_constructorSet:null,getConstructors:function(){return this._constructorSet||(this._constructorSet=this._createConstructors()),this._constructorSet},_createConstructors:function(){var e=function(){for(var e=arguments[0],t=e.prototype,i=1;arguments.length>i;i++){var n=arguments[i],a=n.prototype;for(var s in a)a.hasOwnProperty(s)&&(t[s]=a[s])}},t=W.Classes.get("bootstrap.utils.Events"),i=function(e){return this._context=e,this._value=void 0,this._parent=void 0,this._dirtyFlag=!1,this};e(i,t),i.prototype.getValue=function(){return this._value},i.prototype.setValue=function(e){var t=this._value;this._value=e,this._value!==t&&(void 0!==t&&(this._dirtyFlag=!0),this.fireChangedEvent(this._value,t))},i.prototype.fireChangedEvent=function(e,t){this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,newValue:e,oldValue:t})},i.prototype.getTypeName=function(){switch(typeOf(this._value)){case"string":return"String";case"number":return"Number";case"boolean":return"Boolean";default:return void 0}},i.prototype.isRef=function(){return!1},i.prototype.getParent=function(){return this._parent},i.prototype.fireEvent=function(e,i){i=i||{},void 0!==i._previousTargets&&i._previousTargets.contains(this)||(i.currentTarget=this,i.phase=i.target===i.currentTarget?Constants.DataItemEventPhase.ON_TARGET:Constants.DataItemEventPhase.BUBBLING,t.prototype.fireEvent.call(this,e,i),this._parent&&Constants.DataItemEvents.bubblingEvents.contains(e)&&(i._previousTargets=i._previousTargets||[],i._previousTargets.push(this),this._fireBubblingEvent(e,i)))},i.prototype._fireBubblingEvent=function(e,t){var i={};Object.each(t,function(e,t){i[t]=e}),this._parent.fireEvent(e,i)},i.prototype.isDirty=function(){return this._dirtyFlag},i.prototype.setDirty=function(){this._dirtyFlag=!0},i.prototype.resetDirtyFlag=function(){this._dirtyFlag=!1},i.prototype._passScope=function(e){var t=!0;return e&&e.inheritsScope&&(t=e.inheritsScope(this)),t?e:void 0};var n=function(){return this._aggregatedEvents=[],this._eventFilter=[],this};n.prototype.startEventAggregation=function(e){this._eventFilter=e||[];var t=this;this.fireEvent=function(){t._aggregatingDispatchFunc.apply(t,arguments)}},n.prototype.releaseEventAggregation=function(e){e=e||Constants.DataItemEvents.CHANGE,this.fireEvent=this.constructor.prototype.fireEvent,this._aggregatedEvents.length>0&&this.fireEvent(e,{target:this,events:this._aggregatedEvents}),this._aggregatedEvents=[]},n.prototype._aggregatingDispatchFunc=function(e,t){0===this._eventFilter.length||this._eventFilter.contains(e)?t.events?this._aggregatedEvents=this._aggregatedEvents.concat(t.events):this._aggregatedEvents.push({type:e,payload:t}):this._originalFireEventFunc(e,t)};var a=function(e){return i.call(this,e),n.call(this),this._children=[],this};e(a,i,n),a.prototype.getTypeName=function(){return"Array"},a.prototype.addChild=function(e,t){var i;return e=e.className&&-1!=e.className.indexOf("wixapps.core.data")?e:this._context.getFactory().createDataItem(e,this),void 0!==t&&(i="number"==typeof t?parseInt(t,10):this.getChildIndex(t)),i>-1?this._children.splice(i,0,e):(i=this._children.length,this._children.push(e)),this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD,child:e,index:i}),e._parent=this,e},a.prototype.deleteChild=function(e){var t="number"==typeof e?parseInt(e,10):this.getChildIndex(e);if(t>-1&&this._children.length>t){var i=this._children.splice(t,1);return this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE,child:i[0],index:t}),i[0]}return null},a.prototype.moveChildByIndex=function(e,t){return e="number"==typeof e?parseInt(e,10):this.getChildIndex(e),t="number"==typeof t?parseInt(t,10):this.getChildIndex(t),e>-1&&this._children.length>e&&t>-1&&this._children.length>t?(this._children.splice(t,0,this._children.splice(e,1)[0]),this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_MOVE,child:this._children[t],index:e,to:t}),this._children[t]):null},a.prototype.replaceChild=function(e,t){var i,n;if(void 0!==t&&(i="number"==typeof t?parseInt(t,10):this.getChildIndex(t)),i>=0&&this._children.length>i){if(n=this._children[i],e.className&&e.className.contains("wixapps.core.data"))n!==e&&(this._children[i]=e,this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:e,prevChild:n,index:i}));else{var a=e;n.className===this._context.getFactory().getDataItemClassName(a)?n.setValue(a):(e=this._context.getFactory().createDataItem(a),e&&(this._children[i]=e,this._dirtyFlag=!0,e._parent=this,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:e,prevChild:n,index:i})))}return e}},a.prototype.getChildrenCount=function(){return this._children.length},a.prototype.getChildren=function(){return this._children.slice(0)},a.prototype.getValue=function(e,t){var i=[],n=this._passScope(t);return this._children.forEach(function(t){i.push(t.getValue(e,n))}),i},a.prototype.setValue=function(e){this.startEventAggregation(),this._applyData(e),this.releaseEventAggregation(Constants.DataItemEvents.CHANGE)},a.prototype.getChildIndex=function(e){return this._children.indexOf(e)},a.prototype.getChildByIndex=function(e){return this._children[e]},a.prototype.getChildValue=function(e){return this._children&&void 0!==this._children[e]?this._children[e].getValue():void 0},a.prototype.isDirty=function(){if(i.prototype.isDirty.call(this))return!0;for(var e=0;this._children.length>e;e++)if(this._children[e].isDirty())return!0;return!1},a.prototype.resetDirtyFlag=function(){i.prototype.resetDirtyFlag.call(this);for(var e=0;this._children.length>e;e++)this._children[e].resetDirtyFlag()},a.prototype._applyData=function(e){for(var t=this._children.length,i=0;e.length>i;i++)t>i?this.replaceChild(e[i],i):this.addChild(e[i]);if(e.length<this._children.length)for(var n=this._children.length-1;n>=e.length;n--)this.deleteChild(n)};var s=function(e){return i.call(this,e),n.call(this),this._children={},this};e(s,i,n),s.prototype.getValue=function(e,t){var i={};for(var n in this._children){var a=this._passScope(t);i[n]=this._children[n].getValue(e,a)}return i},s.prototype.getTypeName=function(){var e=this.getChildByRef("_type");return e&&e.getValue()||"wix:Object"},s.prototype.addChild=function(e,t){var i=this._context.getFactory().createDataItem(e);return this._children[t]=i,this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD,child:i,ref:t}),i._parent=this,i},s.prototype.deleteChild=function(e){var t=this._children[e];return t&&(t._parent=null,delete this._children[e],this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE,child:t,ref:e})),t},s.prototype.replaceChild=function(e,t){t.className&&-1!=t.className.indexOf("wixapps.core.data")&&(t=this.getChildRef(t));var i=this._children[t];if(i){if(e&&e.className&&-1!=e.className.indexOf("wixapps.core.data"))i!==e&&(this._children[t]=e,this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:e,prevChild:i,ref:t}));else{var n=e;i.className===this._context.getFactory().getDataItemClassName(n)?i.setValue(n):(e=this._context.getFactory().createDataItem(n),e&&(this._children[t]=e,this._dirtyFlag=!0,e._parent=this,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:e,prevChild:i,ref:t})))}return e}},s.prototype.getChildRef=function(e){for(var t in this._children)if(this._children[t]===e)return t},s.prototype.getChildren=function(){return Object.values(this._children)},s.prototype.getChildByRef=function(e){return this._children[e]},s.prototype.getChildValue=function(e){return this._children&&void 0!==this._children[e]?this._children[e].getValue():void 0},s.prototype.getChildrenRefs=function(){return Object.keys(this._children)},s.prototype.setValue=function(e){this.startEventAggregation(),this._applyData(e),this.releaseEventAggregation()},s.prototype.isDirty=function(){if(i.prototype.isDirty.call(this))return!0;for(var e=this.getChildrenRefs(),t=0;e.length>t;t++)if(this._children[e[t]].isDirty())return!0;return!1},s.prototype.resetDirtyFlag=function(){i.prototype.resetDirtyFlag.call(this);for(var e=this.getChildrenRefs(),t=0;e.length>t;t++)this._children[e[t]].resetDirtyFlag()},s.prototype._applyData=function(e){for(var t in e)void 0===this._children[t]?this.addChild(e[t],t):this.replaceChild(e[t],t);for(t in this._children)void 0===e[t]&&this.deleteChild(t)};var o=W.Classes.get("wixapps.core.expressions.Expression"),r=function(e){return this._exprSource=null,this._expr=null,i.call(this,e),this};e(r,i),r.prototype.setValue=function(e){this._exprSource=e,this._expr=new o(this._context.getFunctionLibrary()),this._expr.parseExpression(this._exprSource.$expr),this._value=void 0},r.prototype.getChangeDispatchers=function(e){return this._expr.getSymbolItems(e.getSymbolResolver())},r.prototype.getValue=function(e,t){return 0===e?this._exprSource:t?this._expr.evaluate(t.getSymbolResolver()):this._exprSource};var l=function(e){return i.call(this,e),this._ref=null,this._onReferencedChange_bound=this._onReferencedChange.bind(this),this};l.prototype.DEFAULT_MAX_REF_DEPTH=1,e(l,i),l.prototype.setValue=function(e){var t=this._ref;this._ref=Object.clone(e),this._resolveReference(),null===t||null!=this._ref&&this._ref.collectionId==t.collectionId&&this._ref.itemId==t.itemId||(this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this}))},l.prototype._resolveReference=function(){this._referenced&&this._referenced.removeEvent(Constants.DataItemEvents.CHANGE,this._onReferencedChange_bound),this._referenced=this._context.getRefResolver().deReference(this._ref.collectionId,this._ref.itemId),this._referenced&&this._referenced.addEvent(Constants.DataItemEvents.CHANGE,this._onReferencedChange_bound)},l.prototype._onReferencedChange=function(e){var t={};Object.each(e,function(e,i){t[i]=e}),e._previousTargets=e._previousTargets||[],e._previousTargets.push(this),t.currentTarget=this,this.fireEvent(Constants.DataItemEvents.CHANGE,t)},l.prototype._proxyCall=function(e,t){return!this._referenced&&this._ref&&this._resolveReference(),this._referenced?this._referenced[e].apply(this._referenced,t):void 0
},l.prototype.getValue=function(e){return e=void 0===e?this.DEFAULT_MAX_REF_DEPTH:e,e--,e>=0?this._proxyCall("getValue",[e]):this._ref?Object.clone(this._ref):{}},l.prototype.isRef=function(){return!0},l.prototype.getParent=function(){return this._parent},l.prototype.getTypeName=function(){return this._proxyCall("getTypeName",arguments)},l.prototype.getChildren=function(){return this._proxyCall("getChildren",arguments)},l.prototype.getChildIndex=function(){return this._proxyCall("getChildIndex",arguments)},l.prototype.getChildByIndex=function(){return this._proxyCall("getChildByIndex",arguments)},l.prototype.getChildrenRefs=function(){return this._proxyCall("getChildrenRefs",arguments)},l.prototype.addChild=function(){return this._proxyCall("addChild",arguments)},l.prototype.deleteChild=function(){return this._proxyCall("deleteChild",arguments)},l.prototype.replaceChild=function(){return this._proxyCall("replaceChild",arguments)},l.prototype.getChildByRef=function(){return this._proxyCall("getChildByRef",arguments)},l.prototype.getChildValue=function(){return this._proxyCall("getChildValue",arguments)},l.prototype.setReferencedValue=function(){return this._proxyCall("setValue",arguments)},l.prototype.startEventAggregation=function(){this._proxyCall("startEventAggregation",arguments)},l.prototype.releaseEventAggregation=function(){this._proxyCall("releaseEventAggregation",arguments)},l.prototype.getChildRef=function(){return this._proxyCall("getChildRef",arguments)},l.prototype.getReferencedDataItem=function(){return!this._referenced&&this._ref&&this._resolveReference(),this._referenced},l.prototype.moveChildByIndex=function(){return this._proxyCall("moveChildByIndex",arguments)},l.prototype.getChildrenCount=function(){return this._proxyCall("getChildrenCount",arguments)};var p=function(e,t,n,a,s){return i.call(this,e),this._onDataContextChange_bound=this._onDataContextChange.bind(this),this._type=n,this._dataContext=s,this._getterFunc=e.getComputedFieldGetter(t,a),this._setterFunc=e.getComputedFieldSetter(t,a),this._dataContext.addEvent(Constants.DataItemEvents.CHANGE,this._onDataContextChange_bound),this};e(p,t),e(p,i),p.prototype.getTypeName=function(){return this._type},p.prototype.getValue=function(){var e,t=this._value;return void 0===this._getterFunc?this._value:(e=this._getterFunc(this._dataContext,this.passValue.bind(this)),void 0!==e&&(this._value=e,this._value!==t&&this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this})),this._value)},p.prototype.setValue=function(e){if(void 0===this._setterFunc)throw Error("Computed field not writable");this._setterFunc(e,this._dataContext.setValue.bind(this._dataContext)),this.passValue(e)},p.prototype.passValue=function(e){var t=this._value;this._value=e,this._value!==t&&this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this})},p.prototype._onDataContextChange=function(){this.fireEvent(Constants.DataItemEvents.CHANGE)};var d=function(e){return i.call(this,e),this._onVirtualItemsChange_bound=this._onVirtualItemsChange.bind(this),this._onRealItemsChange_bound=this._onRealItemsChange.bind(this),this._vArray=this._context.getFactory().createDataItem([]),this._vArray.addEvent(Constants.DataItemEvents.CHANGE,this._onVirtualItemsChange_bound),this._children=[],this._ignoreChangeInReal=!1,this._ignoreChangeInVirtual=!1,this};e(d,i),d.prototype.getTypeName=function(){return"Array"},d.prototype.addEvent=function(e,t){this._vArray.addEvent(e,t)},d.prototype.addEvents=function(e){this._vArray.addEvents(e)},d.prototype.removeEvent=function(e,t){this._vArray.removeEvent(e,t)},d.prototype.removeEvents=function(e){this._vArray.removeEvents(e)},d.prototype.removeAllEvents=function(){this._vArray.removeAllEvents()},d.prototype.setChildren=function(e){for(var t=0;this._children.length>t;t++){var i=this._children[t];i.removeEvent(Constants.DataItemEvents.CHANGE,this._onRealItemsChange_bound)}this._children=e;for(var n=0;this._children.length>n;n++){var a=this._children[n];a.addEvent(Constants.DataItemEvents.CHANGE,this._onRealItemsChange_bound)}this._onRealItemsChange(),this._vArray.resetDirtyFlag()},d.prototype._onVirtualItemsChange=function(){if(!this._ignoreChangeInVirtual)for(var e=this._vArray.getChildren(),t=0;e.length>t;t++){var i=this._vArray.getChildByIndex(t),n=i.getValue(0);this._ignoreChangeInReal=!0,this._children[t].setValue(n),this._ignoreChangeInReal=!1}},d.prototype._onRealItemsChange=function(){if(!this._ignoreChangeInReal){var e=this._vArray.getChildren(),t=this._children.map(function(e){return e.getValue(0)});if(this._ignoreChangeInVirtual=!0,e.length!=t.length)this._vArray.setValue(t);else for(var i=0;t.length>i;i++)e[i].setValue(t[i]);this._ignoreChangeInVirtual=!1}},d.prototype.addChild=function(){throw"not implemented"},d.prototype.deleteChild=function(){throw"not implemented"},d.prototype.replaceChild=function(){throw"not implemented"},d.prototype.moveChildByIndex=function(){throw"not implemented"},d.prototype.getRealChildren=function(){return this._children.slice(0)},d.prototype.getChildren=function(){return this._vArray.getChildren()},d.prototype.getValue=function(e,t){return this._vArray.getValue(e,t)},d.prototype.setValue=function(){throw"not implemented"},d.prototype.getChildIndex=function(e){var t=this._vArray.getChildIndex(e);return-1!=t?t:this._children.indexOf(e)},d.prototype.getChildByIndex=function(e){return this._vArray.getChildByIndex(e)},d.prototype.getChildValue=function(e){return this._vArray.getChildValue(e)},d.prototype.isDirty=function(){return this._vArray.isDirty()||this._children.some(function(e){return e.isDirty()})},d.prototype.resetDirtyFlag=function(){this._vArray.resetDirtyFlag(),this._children.forEach(function(e){e.resetDirtyFlag()})};var h={"wixapps.core.data.DataItem":i,"wixapps.core.data.ArrayDataItem":a,"wixapps.core.data.CompositeDataItem":s,"wixapps.core.data.ExprDataItem":r,"wixapps.core.data.DataItemProxy":l,"wixapps.core.data.ComputedFieldItem":p,"wixapps.core.data.VirtualArrayDataItem":d};for(var c in h)h.hasOwnProperty(c)&&(h[c].prototype.className=c);return h}}),define.Class("wixapps.core.data.DataItemUtils",function(e){var t=e;t.methods({initialize:function(){},findExprItems:function(e){return this.findDataItems(e,"wixapps.core.data.ExprDataItem",function(e){return!(e.getParent().getChildRef&&"templates"==e.getParent().getChildRef(e)&&e.getParent().getChildValue&&"Toggle"!=e.getParent().getChildValue("name"))})},findDataItems:function(e,t,i){var n,a=[];i=i||function(){return!0};var s=typeOf(t);"function"==s?n=t:"string"==s&&(n=function(e){return e.className==t});var o=function(e){n(e)&&a.push(e),e.getChildren&&e.getChildren().each(function(e){i(e)&&o(e)})};return o(e),a},getDataItemPath:function(e,t){var i,n,a=[];for(e=e||null;t&&t!==e&&t.getParent();)i=t.getParent(),i.getChildRef?n=i.getChildRef(t):i.getChildIndex&&(n=i.getChildIndex(t)),a.push(n),t=i;return a.reverse()},resolveDataItemPath:function(e,t){for(var i,n=e;n&&t.length;)i=t.shift(),n.getChildByRef?n=n.getChildByRef(i):n.getChildByIndex&&(n=n.getChildByIndex(i));return n},createDataChangeEventList:function(e,t){for(var i=[],n=e.events||[{type:e.type,payload:{target:e.target,action:e.action}}],a=0;n.length>a;a++){var s,o=n[a],r=o.payload.action||Constants.DataItemEvents.CHANGE;if(!o.payload.ref||"_"!==o.payload.ref.charAt(0)){r==Constants.DataItemEvents.CHANGE?s=o.payload.target:o.payload.target.getChildByRef?s=o.payload.target.getChildByRef(o.payload.ref):o.payload.target.getChildByIndex&&(s=o.payload.target.getChildByIndex(o.payload.index));var l;if("delete"===r){var p=o.payload.target;l=this.getDataItemPath(t,p),l.push(o.payload.ref||o.payload.index)}else l=this.getDataItemPath(t,s);l=l.reverse(),i.push({type:r,item:s,path:l})}}return i}})}),define.Class("wixapps.core.data.DataMigrator",function(e){var t=e,i={FIELD_DELETED:"FieldDeleted",FIELD_TYPE_CHANGED:"FieldTypeChanged",FIELD_VALIDATIONS_CHANGED:"FieldValidationsChanged",FIELD_DEFAULT_VALUE_CHANGED:"FieldDefaultValueChanged",FIELD_ADDED:"FieldAdded",VALUE_CHANGED:"ValueChanged"};t.fields({_typesManager:null}),t.methods({initialize:function(e){this._typesManager=e},diffTypes:function(e,t){var n=this._typesManager;if(n.getTypeName(e)!=n.getTypeName(t))throw"type name change is not permitted. old name ["+n.getTypeName(e)+"] new name ["+n.getTypeName(t)+"]";for(var a=n.getFields(e),s=n.getFields(t),o={},r=0;s.length>r;r++){var l=s[r];o[l.name]=l}for(var p=[],d=[],h=0;a.length>h;h++){var c=a[h],u=c.name,m=o[u];if(m){if(c.type!=m.type){if(void 0===m.defaultValue)throw"field ["+u+"] with new type must have defaultValue";p.push({op:i.FIELD_TYPE_CHANGED,fieldName:u,oldField:c,newField:m})}if(!this._areEqual(c.defaultValue,m.defaultValue)){if(void 0===m.defaultValue)throw"field ["+u+"] with new validations must have defaultValue";p.push({op:i.FIELD_DEFAULT_VALUE_CHANGED,fieldName:u,oldField:c,newField:m})}if(!this._areEqual(c.validations,m.validations)){if(void 0===m.defaultValue)throw"field ["+u+"] with new validations must have defaultValue";p.push({op:i.FIELD_VALIDATIONS_CHANGED,fieldName:u,oldField:c,newField:m})}}else p.push({op:i.FIELD_DELETED,fieldName:u,oldField:c});d.push(c.name)}for(var g=0;s.length>g;g++)-1==d.indexOf(s[g].name)&&p.push({op:i.FIELD_ADDED,fieldName:s[g].name,newField:s[g]});return p},migrateItem:function(e,t){for(var n=Object.clone(t),a=0;e.length>a;a++){var s=e[a],o=s.fieldName;switch(s.op){case i.FIELD_DELETED:delete n[o];break;case i.FIELD_TYPE_CHANGED:n[o]=this._convertType(n[o],s.oldField.type,s.newField.type,s.newField.defaultValue);break;case i.FIELD_VALIDATIONS_CHANGED:this._typesManager.validateValue(n[o],s.newField)||(n[o]=s.newField.defaultValue);break;case i.FIELD_DEFAULT_VALUE_CHANGED:break;case i.FIELD_ADDED:void 0!==s.newField.defaultValue&&(n[o]=s.newField.defaultValue)}}return n},_convertType:function(e,t,i,n){return n},_areEqual:function(e,t){var i=void 0!==e&&null!==e,n=void 0!==t&&null!==t;if(i!=n)return!1;var a=typeof e,s=typeof t;if(a!=s)return!1;switch(a){case"object":var o=Object.keys(e),r=Object.keys(t);if(o.length!=r.length)return!1;for(var l=0;o.length>l;l++){var p=o[l],d=e[p],h=t[p];if(!this._areEqual(d,h))return!1}break;case"array":if(e.length!=t.length)return!1;for(var c=0;e.length>c;c++)if(!this._areEqual(e[c],t[c]))return!1;break;default:return e===t}return!0}})}),define.Class("wixapps.core.data.PrimitiveValidations",function(e){var t=e;t.fields({_byName:{}}),t.methods({initialize:function(){this._byName.arrayMaxLength=this._arrayMaxLength,this._byName.email=this._isEmail,this._byName.maxLength=this._maxLength,this._byName.minLength=this._minLength,this._byName.isNotWhitespace=this._isNotWhitespace,this._byName.isInteger=this._isInteger,this._byName.isPositive=this._isPositive,this._byName.gt=this._gt,this._byName.gte=this._gte,this._byName.lt=this._lt,this._byName.lte=this._lte,this._byName.eq=this._equals,this._byName.ne=this._notEquals},validate:function(e,t,i){var n=this._byName[e];if(!n)throw"No such validation function ["+e+"]";var a=[t];if(i&&i.length>0)for(var s=0;i.length>s;s++)a.push(i[s]);return n.apply(this,a)},_arrayMaxLength:function(e,t){return t>=e.length},_isEmail:function(e){var t=function(e){if(e.length>253)return!1;var t=e.split(".");if(2>t.length)return!1;for(var i=0;t.length>i;i++){var n=t[i];if(!n.test(/^[a-zA-Z0-9-]*$/))return!1;if(n.length>63)return!1}return!0},i=function(e){return e.test(RegExp("^[a-zA-Z0-9!$&*-=^`|~#%'+/?_\\{\\}.]*$"))},n=e.lastIndexOf("@");if(0>n)return!1;var a=e.substring(0,n),s=e.substring(n+1);return t(s)?i(a):!1},_maxLength:function(e,t){return t>=e.length},_minLength:function(e,t){return e.length>=t},_isNotWhitespace:function(e){return e.trim().length>0},_isInteger:function(e){return isFinite(e)&&parseFloat(e)==parseInt(e,10)},_isPositive:function(e){return e>0},_gt:function(e,t){return e>t},_gte:function(e,t){return e>=t},_lt:function(e,t){return t>e},_lte:function(e,t){return t>=e},_equals:function(e,t){return e==t},_notEquals:function(e,t){return e!=t}})}),define.dataItem.multi({WIXAPPS_EXTERNAL_APPS:{type:"map",items:{},metaData:{isPersistent:!1}}}),define.Class("wixapps.core.data.providers.ItemBasedDataProvider",function(e){var t=e;t.inherits("wixapps.core.data.providers.base.BaseDataProvider"),t.methods({initialize:function(e){this.parent(e)},loadFromDefinition:function(){},createItem:function(){throw"not implemented"},updateItem:function(){throw"not implemented"},deleteItem:function(){throw"not implemented"},readItem:function(){throw"not implemented"},readItems:function(){throw"not implemented"},query:function(){throw"not implemented"}})}),define.Class("wixapps.core.data.providers.ItemsLocalStore",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.fields({_dataItemFactory:null,_items:{},_markedDeleted:{}}),t.methods({initialize:function(e){this._dataItemFactory=e},clear:function(){this._items={},this._markedDeleted={}},get:function(e){return this._items[e]||null},put:function(e,t){var i=this._items[e];return i?i.setValue(t):(i=this._dataItemFactory.createDataItem(t),this._items[e]=i,this.fireEvent("itemAdded",i)),i},putIfNotDirty:function(e,t){var i=!1,n=this._items[e];return n?(i=n.isDirty(),i||n.setValue(t)):(n=this._dataItemFactory.createDataItem(t),this._items[e]=n,this.fireEvent("itemAdded",n)),{wasDirty:i,item:n}},insertDataItem:function(e,t){this._items[e]=t},remove:function(e){var t=this._items[e];if(t){var i=t.getValue();return this.fireEvent("itemRemoved",t),delete this._items[e],i}},each:function(e){Object.each(this._items,e)},removeAll:function(){for(var e in this._items)this.remove(e)},markItemAsDeleted:function(e){this._markedDeleted[e]=!0},unMarkItemAsDeleted:function(e){delete this._markedDeleted[e]},isItemMarkedAsDeleted:function(e){return this._markedDeleted[e]===!0},getItemsMarkedAsDeleted:function(){return Object.keys(this._markedDeleted)}})}),define.Class("wixapps.core.data.providers.base.BaseDataProvider",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.traits(["wixapps.core.apprepo.traits.AppRepoItem"]),t.fields({_appInstance:null,_type:null}),t.methods({initialize:function(e){this._appInstance=e,this._loadTypes(e.getTypesManager())},loadFromDefinition:function(e){this._type=e.type},_loadTypes:function(){throw"must implement me"},isTypeDefinitionReadOnly:function(){return!0},createType:function(){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},updateType:function(){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},deleteType:function(){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},getSerializableProperties:function(){return["type"]},reportDataItemChangeEvent:function(e,t,i,n){void 0!==t&&void 0!==i&&this.fireEvent("undoAppsDataChangedEvent",[e,t,i,n])}})}),define.Class("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider",function(e){var t=e;t.inherits("wixapps.core.data.providers.ItemBasedDataProvider"),t.utilize(["wixapps.core.data.providers.ItemsLocalStore","wixapps.core.data.providers.wixdb.WixDbTransport"]),t.fields({_type:"WixDb",_localStore:null,_api:null}),t.methods({initialize:function(e){this.parent(e),this._localStore=new this.imports.ItemsLocalStore(e.getDataItemFactory()),this._queryStore={},this._logger=e.getLogger(),this._typesManager=e.getTypesManager(),this._api=new this.imports.WixDbTransport(e)},loadFromDefinition:function(e){this.parent(e)},getTransport:function(){return this._api},readItem:function(e,t,i){var n=this._localStore.get(e);if(n)return t(n),void 0;if(this._api.isTempStore())return i(this._logger.Errors.ITEM_NOT_FOUND),void 0;var a=function(n){var a=this._translateLoadedItem(n.item),s=this._localStore.isItemMarkedAsDeleted(e)?void 0:this._putInCacheIfNotDirty(e,a);s?t(s):i(this._logger.Errors.ITEM_NOT_FOUND)}.bind(this);this._api.readItem(e,a,i)},readItems:function(e,t,i,n){for(var a={},s=0;t.length>s;s++)a[t[s]]=s;for(var o=function(e,t){return a[e.getChildValue("_iid")]-a[t.getChildValue("_iid")]},r=t.clone(),l=0,p=[],d=0;t.length>d;d++){var h=this._localStore.get(t[d]);h&&(r.splice(d-l.length,1),l++,p.push(h))}var c=function(e){p.append(e),p.sort(o),i(p)};r.length>0?this.query(e,{_iid:{$in:r}},{},0,-1,c,n):c([])},query:function(e,t,i,n,a,s,o){var r=JSON.stringify({typeName:e,filter:t,sort:i,skip:n,limit:a}),l=function(n){var a=[];this._queryStore[r]=1,n.items.forEach(function(e){e=this._translateLoadedItem(e);var t=e._iid;if(!this._localStore.isItemMarkedAsDeleted(t)){var i=this._localStore.get(t);if(!i||!i.isDirty()){var n=this._localStore.put(t,e);n.resetDirtyFlag(),a.push(n)}}}.bind(this));var o=!1;this._localStore.each(function(i){this._isItemModified(i)&&this._match(e,t,i.getValue(0))&&(o=!0,a.push(i))}.bind(this)),o&&this._sortQueryResults(a,i),s(a)}.bind(this);if(this._api.isTempStore()||this._queryStore[r]){var p=this.queryLocalStore(e,t,i,n,a);return s(p),void 0}this._rewriteAndQuery(e,t,i,n,a,l,o)},_isItemModified:function(e){return e.isDirty()},_rewriteAndQuery:function(e,t,i,n,a,s,o){this._api.query(e,t,i,n,a,s,o)},_translateLoadedItem:function(e){return e},queryLocalStore:function(e,t,i,n,a){var s=[];return this._localStore.each(function(i){this._match(e,t,i.getValue(0))&&s.push(i)}.bind(this)),this._sortQueryResults(s,i),this._cropQueryResults(s,n,a),s},_putInCacheIfNotDirty:function(e,t){var i=this._localStore.putIfNotDirty(e,t);return i.wasDirty||i.item.resetDirtyFlag(),i.item},_loadTypes:function(e){var t=this._appInstance.getAppDef().getTypes();t&&t.each(function(t){e.registerType(t)}.bind(this))},toObject:function(){return this.parent()},_sortQueryResults:function(e,t){e.sort(function(e,i){return this._compare(e.getValue(0),i.getValue(0),t)}.bind(this))},_cropQueryResults:function(e,t,i){if(t=void 0===t||null===t?0:t,i=void 0===i||null===i?-1:i,t>0&&e.splice(0,t),i>-1){i=Math.min(i,e.length);var n=e.length-i,a=e.length-n;e.splice(a,n)}},_match:function(e,t,i){return this._typesManager.isOf(i._type,e)?this._matchIgnoreType(t,i):!1},_matchIgnoreType:function(e,t){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],a=this._evaluatePath(t,i);"array"!=typeof a&&(a=[a]);var s=function(e){return this._matchSingleValue(n,e)}.bind(this);if(!a.some(s))return!1}return!0},_matchSingleValue:function(e,t){return"object"==typeof e?e.hasOwnProperty("$in")?e.$in.contains(t):e.hasOwnProperty("$ne")?t!=e.$ne:e.hasOwnProperty("$gt")?t>e.$gt:e.hasOwnProperty("$gte")?t>=e.$gte:e.hasOwnProperty("$lt")?e.$lt>t:e.hasOwnProperty("$lte")?e.$lte>=t:e.hasOwnProperty("$size")?e.$size==t.length:this._matchIgnoreType(e,t):t==e},_compare:function(e,t,i){var n=0;for(var a in i)if(i.hasOwnProperty(a)){var s=this._evaluatePath(e,a),o=this._evaluatePath(t,a),r=void 0===s&&void 0===o?0:void 0===s?-1:void 0===o?1:s>o?1:o>s?-1:0;if(0!==r){n=r*i[a];break}}return n},_evaluatePath:function(e,t){for(var i=t.split("."),n=e,a=0;i.length>a;a++){if(void 0===n||null===n)return n;var s=i[a],o=s.match(/^(.*)\[([0-9]+)\]$/);if(o){var r=o[1],l=o[2];n=n[r]&&n[r][l]}else n=n[s]}return n}})}),define.Class("wixapps.core.data.providers.wixdb.WixDbDraftDataProvider",function(e){var t=e;t.inherits("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider"),t.utilize(["wixapps.core.data.DataMigrator"]),t.binds(["_migrateLinks"]),t.fields({_dataMigrator:null,_typeDiffs:{},_managedTypes:{},_newTypes:[],_createdItemIds:[],_appInstance:null,_adminTypeMigrations:[]}),t.methods({initialize:function(e){this.parent(e),this._dataMigrator=new this.imports.DataMigrator(e.getTypesManager()),this._appInstance=e,this._adminTypeMigrations.push(this._migrateLinks);for(var t=this.getManagedTypes(),i=0;t.length>i;i++)this.adminTypeMigration(t[i]);this._localStore.addEvent("itemAdded",this._onItemAdded),this._localStore.addEvent("itemRemoved",this._onItemRemoved)},isTypeDefinitionReadOnly:function(){return!1},save:function(e,t){if(e=e||function(){},t=t||function(){},this._api.isTempStore())throw"cannot save draft to temp store";this._typeDiffs={},this._newTypes=[];for(var i=function(i,n){for(var a=[],s=null,o=null,r=0;i.results.length>r;r++)if(i.results[r].success){var l=i.results[r].payload,p=n[r];switch(p.name){case"CreateItem":s=Object.clone(p.params.item),s._iid=l.id,s._createdAt=l.createdAt,s._updatedAt=l.updatedAt,o=this._localStore.put(l.id,s),this._createdItemIds.erase(l.id),o.resetDirtyFlag();break;case"UpdateItem":s=Object.clone(p.params.item),s._createdAt=l.createdAt,s._updatedAt=l.updatedAt,o=this._localStore.put(s._iid,s),o.resetDirtyFlag();break;case"DeleteItem":this._localStore.unMarkItemAsDeleted(p.params.itemId)}}else a.push(i.results[r]);a.length>0?t(a):e()}.bind(this),n=this._localStore.getItemsMarkedAsDeleted(),a=[],s=0;this._createdItemIds.length>s;s++){var o=this._createdItemIds[s];a.push(this._localStore.get(o))}var r=[];this._localStore.each(function(e,t){this._createdItemIds.contains(t)||r.push(e)}.bind(this)),this._api.activateBatchMode();try{for(var l=0;n.length>l;l++)this._api.deleteItem(n[l]);for(var p=0;a.length>p;p++)this._api.createItem(a[p].getValue(0));for(var d=0;r.length>d;d++)this._api.updateItem(r[d].getValue(0));this._api.sendBatchAndDeactivate(i,t)}finally{this.getTransport().discardBatch()}},createItem:function(e,t,i){t=t||function(){},i=i||function(){};var n=e.getValue(0);n._iid||(n._iid=W.Utils.getUniqueId("i"));var a=this._localStore.get(n._iid);if(a||n._updatedAt)return i(this._logger.Errors.CREATE_ITEM_CALLED_FOR_NON_NEW),void 0;this._createdItemIds.push(n._iid);var s=this._localStore.put(n._iid,n);t(s)},updateItem:function(e,t,i){t=t||function(){},i=i||function(){};var n=e.getValue(0);if(!n._iid)return i(this._logger.Errors.UPDATE_ITEM_CALLED_FOR_NEW),void 0;var a=this._localStore.get(n._iid);if(!a)return i(this._logger.Errors.UPDATE_ITEM_CALLED_FOR_NEW),void 0;var s=this._localStore.put(n._iid,n);t(s)},deleteItem:function(e,t,i){t=t||function(){},i=i||function(){},this._createdItemIds.erase(e);var n=this._localStore.remove(e),a=this._appInstance.getTypesManager().getType(n._type),s=void 0!==a,o=n._createdAt;o&&s&&this._localStore.markItemAsDeleted(e),t(e,n)},_isItemModified:function(e){var t=e.getChildValue("_iid");return e.isDirty()||this._createdItemIds.contains(t)},_rewriteAndQuery:function(e,t,i,n,a,s,o){this._newTypes.contains(e)?s({items:[]}):this._api.query(e,t,i,n,a,s,o)},createType:function(e){var t=this._appInstance.getTypesManager();t.registerType(e);var i=t.getTypeName(e);this._addManagedType(i),this._newTypes.push(i)},updateType:function(e){var t=this._appInstance.getTypesManager(),i=t.getTypeName(e),n=t.getType(i),a=this._dataMigrator.diffTypes(n,e),s=[];return a.length>0&&this._getDiffsForType(i).append(a),t.registerType(e),a.length>0&&this._appInstance.fireEvent(Constants.WixAppEvents.TYPE_CHANGE,{typeName:i,oldType:n,newType:e}),this._localStore.each(function(e){if(e.getTypeName()==i){var t=e.getValue(0),n=e.isDirty(),o=this._dataMigrator.migrateItem(a,t);e.setValue(o),n||e.resetDirtyFlag(),s.push({dataItem:e,dataItemId:t._iid,oldValue:t,newValue:o})}}.bind(this)),s},deleteType:function(e){var t=function(){};this._appInstance.getTypesManager().removeType(e),this._localStore.each(function(i,n){i.getTypeName()==e&&this.deleteItem(n,t,t)}.bind(this)),this._removeManagedType(e)},_getDiffsForType:function(e){var t=this._typeDiffs[e];return t||(t=[],this._typeDiffs[e]=t),t},_translateLoadedItem:function(e){var t=this._getDiffsForType(e._type);return t.length>0?this._dataMigrator.migrateItem(t,e):e},_loadTypes:function(e){var t=this._appInstance.getAppDef().getTypes();t=t||[];for(var i=0;t.length>i;i++)this._addManagedType(e.getTypeName(t[i]));this.parent(e)},_addManagedType:function(e){this._managedTypes[e]=!0},_removeManagedType:function(e){delete this._managedTypes[e]},_getManagedTypes:function(){return Object.keys(this._managedTypes)},getManagedTypes:function(){for(var e=[],t=this._getManagedTypes(),i=0;t.length>i;i++){var n=t[i],a=this._appInstance.getTypesManager().getType(n);e.push(a)}return e},adminTypeMigration:function(e){for(var t=0;this._adminTypeMigrations.length>t;t++){var i=this._adminTypeMigrations[t];e=i(e)}return this.updateType(e),e},_migrateLinks:function(e){var t=Object.clone(e);return this._ensureLinksFieldOnTypes(t),t},_ensureLinksFieldOnTypes:function(e){if(e){var t=e.fields.some(function(e){return"links"===e.name});t||e.fields.push({name:"links",type:"wix:Map",defaultValue:{_type:"wix:Map"}})}}})}),define.Class("wixapps.core.data.providers.wixdb.WixDbPublishedDataProvider",function(e){var t=e;t.inherits("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider"),t.methods({createItem:function(e,t,i){var n=e.getValue(0),a=function(i){this._localStore.insertDataItem(i.id,e),n._iid=i.id,n._createdAt=i.createdAt,n._updatedAt=i.updatedAt,e.setValue(n),e.resetDirtyFlag(),t(e)}.bind(this);this._api.createItem(n,a,i)},updateItem:function(e,t,i){var n=e.getValue(0),a=function(e){n._createdAt=e.createdAt,n._updatedAt=e.updatedAt;var i=this._localStore.put(n._iid,n);i.resetDirtyFlag(),t(i)}.bind(this);this._api.updateItem(n,a,i)},deleteItem:function(e,t,i){var n=function(){this._localStore.remove(e),this._localStore.unMarkItemAsDeleted(e),t(e)}.bind(this);this._api.deleteItem(e,n,i)}})}),define.Class("wixapps.core.data.providers.wixdb.WixDbTransport",function(e){var t=e;t.inherits("wixapps.core.utils.WixServiceTransportBase"),t.resources(["W.Utils"]),t.fields({_draftStore:"<DRAFT>",_batch:null}),t.methods({_getServiceUrl:function(){var e=window.location.origin||this._extractBasePath(window.location.href);return e+"/apps/appBuilder/1/"+this._savedOrPublished()+"/"},_savedOrPublished:function(){return this.resources.W.Utils.AppsUtils.isRealPublicMode()?"viewer":"editor"},loadFromDefinition:function(e){this.parent(e),this._type=e.type},createItem:function(e,t,i){this.doRequest("CreateItem",{},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),item:e},t,i)},updateItem:function(e,t,i){this.doRequest("UpdateItem",{},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),item:e},t,i)},deleteItem:function(e,t,i){this.doRequest("DeleteItem",{},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),itemId:e},t,i)},readItem:function(e,t,i){var n=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),a=n&&"owner"===n.getUserRole();this.doRequest("ReadItem",{consistentRead:a},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),itemId:e},t,i)},query:function(e,t,i,n,a,s,o){var r=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),l=r&&"owner"===r.getUserRole();this.doRequest("Query",{consistentRead:l},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),type:e,filter:t,sort:i,skip:n,limit:-1==a?null:a},s,o)},isTempStore:function(){return"<DRAFT>"==this._appInstance.getInstanceId()},activateBatchMode:function(){if(this._batch)throw"batch already active";this._batch=[]},discardBatch:function(){this._batch=null},sendBatchAndDeactivate:function(e){if(!this._batch)throw"batch mode is not active";if(0==this._batch.length)return this._batch=null,e({results:[]},[]),void 0;for(var t=30,i=[],n=0;this._batch.length>n;n+=t)i.push(this._batch.slice(n,n+t));var a={operations:this._batch};this._batch=null;for(var s=[],o=function(e,t){for(var i=0;e.length>i;i++)s.push({success:!1,errorCode:t.code,errorDescription:t.description})},r=function(e,t){s=s.concat(t.results)},l=function(e){return function(t){this.doRequest("Batch",{},{operations:e},function(i){r(e,i),t()},function(i){o(e,i),t()})}.bind(this)}.bind(this),p=this.resources.W.Utils.AppsUtils.createTaskRunner(),d=0;i.length>d;d++)p.add("batch, chunk ("+d+")",l(i[d]));p.run(function(){e({results:s},a.operations)})},doRequest:function(e,t,i,n,a){this._batch?this._batch.push({name:e,params:i}):this.parent(e,t,i,n,a)}})}),define.Class("wixapps.core.data.selectors.AllItemsOfTypeDataSelector",function(e){var t=e;t.inherits("wixapps.core.data.selectors.ListDataSelector"),t.fields({_selectors:[]}),t.methods({initialize:function(e,t,i){this.parent(e,t),this.setDataProvider(i)},isListSelector:function(){return!0},isQueryBased:function(){return!0},getItems:function(e){this._dataProvider.query(this._forType,{},{title:1},0,-1,e)},getItemIds:function(e){this.getItems(function(t){var i=t.map(function(e){return e.getChildValue("_iid")});e(i)})},hasAnyItems:function(e){this.getItems(function(t){e(t.length>0)})},onRemoveItem:function(e){for(var t=this._appInstance.getDataSelectors().getByType(this._forType),i=0;t.length>i;i++){var n=t[i];n.isListSelector()&&n.removeItem(e)}},getLogicalTypeName:function(){return"IB.AllItemsOfTypeDataSelector"}})}),define.Class("wixapps.core.data.selectors.ItemDataSelector",function(e){var t=e;t.inherits("wixapps.core.data.selectors.base.BaseDataSelector"),t.methods({getItem:function(){throw"not implemented"},getSerializableProperties:function(){return this.parent().concat(["itemId"])}})}),define.Class("wixapps.core.data.selectors.ListDataSelector",function(e){var t=e;t.inherits("wixapps.core.data.selectors.base.BaseDataSelector"),t.binds(["_filterHiddenItems"]),t.fields({_hiddenItemIds:[]}),t.methods({loadFromDefinition:function(e){this.parent(e),this._hiddenItemIds=e.hiddenItemIds||[]},getItems:function(){throw"not implemented"},getAllItems:function(){throw"not implemented"},_filterHiddenItems:function(e){var t=[];return e.each(function(e){var i=e.getChildValue("_iid");this._hiddenItemIds.contains(i)||t.push(e)}.bind(this)),t},addItem:function(){return!1},removeItem:function(){return!1},toggleVisibility:function(e){var t=this.isHidden(e);this.setVisibility(e,t?!0:!1)},setVisibility:function(e,t){var i=this._hiddenItemIds.contains(e);if(t||i){if(!i)return;var n=this._hiddenItemIds.indexOf(e);this._hiddenItemIds.splice(n,1),this._refresh(),t=!0}else this._hiddenItemIds.push(e),this._refresh(),t=!1;this.fireEvent(Constants.DataEvents.DATA_CHANGED,{action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_VISIBILITY,dataItemId:e,visible:t})},isHidden:function(e){return this._hiddenItemIds.contains(e)},_refresh:function(e,t){e||(e=function(){}),t||(t=function(){}),this.getItems(e,t)},getHiddenItemIds:function(){return this._hiddenItemIds},setHiddenItemIds:function(e){this._hiddenItemIds=e||[]},setSelectedItemByIndex:function(e){this._selectedItemIndex=e,this.getAllItems(function(t){var i=t.getChildByIndex(e);this.setSelectedItem(i)}.bind(this),function(){})},getItemIdIndex:function(){throw"not implemented"},getSelectedItemIndex:function(){return this._selectedItemIndex},resetSelectedItem:function(){this._virtualSelectedItem&&(this._selectedItemIndex=-1,this._virtualSelectedItem.setValue({}))},setSelectedItem:function(e){this._virtualSelectedItem=this._virtualSelectedItem||this._dataItemFactory.createDataItem({}),this._virtualSelectedItem.setValue(e.getValue(0))},getSelectedItem:function(){return this._virtualSelectedItem},handleUndo:function(e,t,i){"Hide"==e&&this.setVisibility(t,i)},getSerializableProperties:function(){return this.parent().concat(["hiddenItemIds"])},isListSelector:function(){return!0}})}),define.Class("wixapps.core.data.selectors.ManualSelectedItemDataSelector",function(e){var t=e;t.inherits("wixapps.core.data.selectors.ItemDataSelector"),t.fields({_itemId:null,_virtualItem:null,Extends:"wixapps.core.data.selectors.ItemDataSelector"}),t.methods({loadFromDefinition:function(e){this.parent(e),this._itemId=e.itemId},setItemId:function(e){this._itemId=e,this._itemId&&this._refresh()},_refresh:function(e,t){e||(e=function(){}),t||(t=function(){}),this.getItem(e,t)},getItem:function(e,t){var i=function(t){this._virtualItem=this._virtualItem||this._dataItemFactory.createDataItem({}),this._virtualItem.setValue(t.getValue(0)),e(this._virtualItem)
}.bind(this);this._dataProvider.readItem(this._itemId,i,t)},getLogicalTypeName:function(){return"IB.ManualSelectedItem"},getSerializableProperties:function(){return this.parent().concat(["itemId"])}})}),define.Class("wixapps.core.data.selectors.ManualSelectedListDataSelector",function(e){var t=e;t.inherits("wixapps.core.data.selectors.ListDataSelector"),t.fields({_itemIds:null,_virtualArray:null,_virtualArrayWithoutHiddens:null}),t.methods({initialize:function(e,t){this.parent(e,t),this._itemIds=[]},loadFromDefinition:function(e){this.parent(e),this._itemIds=e.itemIds},setItemIds:function(e){this._itemIds=e,this._refresh()},getItemIds:function(){return this._itemIds},getItems:function(e,t){this._dataProvider.readItems(this.getSelectionType(),this._itemIds,function(t){t=this._filterHiddenItems(t),this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren(t),this.fireEvent("dataSelectorRefreshed"),e(this._virtualArray)}.bind(this),t)},getAllItems:function(e,t){this._dataProvider.readItems(this.getSelectionType(),this._itemIds,function(t){var i=this._dataItemFactory.createVirtualArray();i.setChildren(t),e(i)}.bind(this),t)},getItemIdIndex:function(e){if(this._hiddenItemIds.contains(e))return-1;var t=this._itemIds.filter(function(e){return!this._hiddenItemIds.contains(e)}.bind(this));return t.indexOf(e)},getItemIdRealIndex:function(e){return this._itemIds.indexOf(e)},addItem:function(e,t){var i=e.getChildValue("_iid");return void 0===t&&(t=0),this._itemIds.splice(t,0,i),this._refresh(),t},removeItem:function(e,t){return void 0===t&&(t=this._itemIds.indexOf(e)),t>=0&&(this._itemIds.splice(t,1),this._refresh()),t},moveItem:function(e,t){var i=this._itemIds.splice(e,1);this._itemIds.splice(t,0,i[0]),this._refresh(function(){this.fireEvent(Constants.DataEvents.DATA_CHANGED,{action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_MOVE,newIndex:t,oldIndex:e,dataItemId:i})}.bind(this))},duplicate:function(e,t){var i=this.getLogicalTypeName(),n=[],a=this._dataProvider,s=this._appInstance,o=[],r=this;if(t)n=Array.clone(this._itemIds);else{this._itemIds.each(function(t){a.readItem(t,function(t){var i=t.getValue(),l=i._iid;delete i._iid,delete i._updatedAt,i._type=e;var p=r._hiddenItemIds.contains(l);t=s.getDataItemFactory().createDataItem(i),a.createItem(t,function(e){var t=e.getValue(),i=t._iid;n.push(i),p&&o.push(i)},function(){})})});var l=s.getTypesManager().getType(this._forType);l=Object.clone(l),l.name=e,l.displayName=l.displayName+"_1",a.createType(l)}var p=this._appInstance.getDataSelectors().createAndRegister(i,this.getDataProvider(),e,{itemIds:n,hiddenItems:o});return p},getBiInfo:function(){return{v:this._itemIds.length-this._hiddenItemIds.length,h:this._hiddenItemIds.length}},handleUndo:function(e,t,i,n){this.parent(e,t,i,n),"Move"==e&&this.moveItem(n,i)},getLogicalTypeName:function(){return"IB.ManualSelectedList"},getSerializableProperties:function(){return this.parent().concat(["itemIds"])}})}),define.Class("wixapps.core.data.selectors.PageSelectedItemDataSelector",function(e){var t=e;t.inherits("wixapps.core.data.selectors.ItemDataSelector"),t.resources(["W.Utils"]),t.fields({_appPageId:null,_virtualArray:null}),t.methods({setAppPageId:function(e){this._appPageId=e},loadFromDefinition:function(e){this.parent(e),this._appPageId=e.appPageId},_refresh:function(e,t){e||(e=function(){}),t||(t=function(){}),this.getItem(e,t)},getItem:function(e){var t=function(t){this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren([t]),this._virtualItem=this._virtualArray.getChildByIndex(0),e(this._virtualItem)}.bind(this);this._getPageLogic(function(e){this._pageLogic=e,this._pageLogic.getDisplayedDataItem(t)})},_getPageLogic:function(e){if(this._pageLogic)return e.apply(this,[this._pageLogic]),void 0;var t=W.Viewer.getAppPages()[this._appPageId];t?e.apply(this,[t]):this.resources.W.Utils.callLater(this._getPageLogic,[e],this)},isPageBased:function(){return!0},getLogicalTypeName:function(){return"IB.PageSelectedItem"},getSerializableProperties:function(){return this.parent().concat(["appPageId"])}})}),define.Class("wixapps.core.data.selectors.SelectedItemDataSelector",function(e){var t=e;t.inherits("wixapps.core.data.selectors.ItemDataSelector"),t.methods({setListSelectorId:function(e){this._listSelectorId=e;var t=this._appInstance.getDataSelectors().getById(this._listSelectorId);this._virtualSelectedItem=t.getSelectedItem()},loadFromDefinition:function(e){this.parent(e),this._listSelectorId=e.listSelectorId,this.setListSelectorId(this._listSelectorId)},getItem:function(e){e(this._virtualSelectedItem)},getLogicalTypeName:function(){return"IB.SelectedItemInList"},getSerializableProperties:function(){return this.parent().push("listSelectorId")}})}),define.Class("wixapps.core.data.selectors.base.BaseDataSelector",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.traits(["wixapps.core.apprepo.traits.AppRepoItem"]),t.fields({_dataProvider:null,_dataProviderId:null,_appInstance:null,_dataItemFactory:null}),t.methods({initialize:function(e,t){this._appInstance=e,this._dataItemFactory=e.getDataItemFactory(),this._forType=t,this._logicalTypeName=this.getLogicalTypeName()},loadFromDefinition:function(e){this._forType=e.forType,this._type=e.type,this._id=e.id,this.setDataProvider(this._appInstance.getDataProviders().getById(e.dataProviderId))},setDataProvider:function(e){this._dataProviderId=e.getId(),this._dataProvider=e},getDataProvider:function(){return this._dataProvider},getFriendlyName:function(){return this._name},getSelectionType:function(){return this._forType},setSelectionType:function(e){this._forType=e},isListSelector:function(){return!1},isQueryBased:function(){return!1},isPageBased:function(){return!1},reset:function(){throw"not implemented"},getBiInfo:function(){return{}},handleUndo:function(){throw"not implemented"},getLogicalTypeName:function(){throw"must implement"},getSerializableProperties:function(){return["logicalTypeName","dataProviderId","forType","id"]}})}),define.Class("wixapps.core.dataservice.DataService",function(e){var t=e;t.utilize(["wixapps.core.dataservice.DataServiceTransport","wixapps.core.managers.TypesManager","wixapps.core.data.DataItemFactory"]),t.fields({_api:null,_dataItemFactory:null,_cache:null}),t.methods({initialize:function(e,t,i){this._api=e,this._dataItemFactory=t,this._cache=i,this._dataItemFactory.registerRefResolver(this)},getTransport:function(){return this._api},getDataItemFactory:function(){return this._dataItemFactory},getItemCache:function(){return this._cache},createStore:function(e,t){this._api.createStore(e,t)},createType:function(e,t,i){this._api.createType(e,t,i)},readType:function(e,t,i){this._api.readType(e,t,i)},listTypes:function(e,t){this._api.listTypes(e,t)},deleteType:function(e,t,i){this._api.deleteType(e,t,i)},createCollection:function(e,t,i,n){this._api.createCollection(e,t,i,n)},listCollections:function(e,t){this._api.listCollections(e,t)},deleteCollection:function(e,t,i){this._api.deleteCollection(e,t,i)},createItem:function(e,t,i,n){var a=t.getValue(0),s=function(n){this._cache.insertDataItem(this._cache.key(e,n.id),t),a._iid=n.id,a._hash=n.hash,t.setValue(a),i(t)}.bind(this);this._api.createItem(e,a,s,n)},updateItem:function(e,t,i,n){var a=t.getValue(0),s=function(t){a._hash=t.hash;var n=this._cache.put(this._cache.key(e,a._iid),a);i(n)}.bind(this);this._api.updateItem(e,a,s,n)},deleteItem:function(e,t,i,n){var a=function(){this._cache.remove(this._cache.key(e,t)),i(t)}.bind(this);this._api.deleteItem(e,t,a,n)},readItem:function(e,t,i,n){var a=function(t){Object.each(t.referencedItems,function(e,t){this._cache.isItemMarkedAsDeleted(t)||this._putInCacheIfNotDirty(t,e)}.bind(this));var n=this._cache.key(e,t.item._iid),a=this._cache.isItemMarkedAsDeleted(n)?null:this._putInCacheIfNotDirty(this._cache.key(e,t.item._iid),t.item);Object.each(t.unreferencedItems,function(e){var t=this._api.getLogger(),i={description:e.errorDescription,code:e.errorCode};t.reportError(i,this.$className,"readItem",t.SubCategory.DATA_SERVICE)}.bind(this)),i(a)}.bind(this);this._api.readItem(e,t,a,n)},query:function(e,t,i,n,a,s,o,r){var l=function(n){Object.each(n.referencedItems,function(e,t){this._cache.isItemMarkedAsDeleted(t)||this._putInCacheIfNotDirty(t,e)}.bind(this));var s=[],r=[];n.items.forEach(function(t){var i=this._cache.key(e,t._iid);if(!this._cache.isItemMarkedAsDeleted(i)){var n=this._cache.get(i);if(!n||!n.isDirty()){var a=this._cache.put(i,t);a.resetDirtyFlag(),s.push(a),r.push({_type:"wix:Ref<"+t._type+">",collectionId:e,itemId:t._iid})}}}.bind(this));var l=!1;this._cache.each(function(i,n){if(i.isDirty()){var a=this._cache.idsFromKey(n);a.collectionId==e&&this._match(t,i.getValue(0))&&(l=!0,s.push(i),r.push({_type:"wix:Ref<"+i.getTypeName()+">",collectionId:e,itemId:a.itemId}))}}.bind(this)),Object.each(n.unreferencedItems,function(e){var t=this._api.getLogger(),i={description:e.errorDescription,code:e.errorCode};t.reportError(i,this.$className,"readItem",t.SubCategory.DATA_SERVICE)}.bind(this)),l&&(this._sortQueryResults(s,r,i),a&&-1!=a&&(s=s.slice(0,a))),o(s,r,n.totalCount)}.bind(this);this._api.query(e,t,i,n,a,s,l,r)},queryCache:function(e,t,i,n,a){var s=[],o=[];return this._cache.each(function(i,n){var a=this._cache.idsFromKey(n);a.collectionId==e&&this._match(t,i.getValue(0))&&(s.push(i),o.push({_type:"wix:Ref<"+i.getTypeName()+">",collectionId:e,itemId:a.itemId}))}.bind(this)),this._sortQueryResults(s,o,i),this._cropQueryResults(s,o,n,a),{items:s,refList:o}},groupByAndCount:function(e,t,i,n,a,s){var o=function(s){var o="groupByAndCount",r=JSON.stringify({collectionId:e,typeName:t,filter:i,groupByField:n}),l=this._cache.key(o,r),p=this._cache.put(l,s);this._cache.markItemAsNonPersistent(l),a(p)}.bind(this);this._api.groupByAndCount(e,t,i,n,o,s)},groupByAndCountFromCache:function(e,t,i,n){var a="groupByAndCount",s=JSON.stringify({collectionId:e,typeName:t,filter:i,groupByField:n});return this._cache.get(this._cache.key(a,s))},_putInCacheIfNotDirty:function(e,t){var i=this._cache.putIfNotDirty(e,t);return i.wasDirty||i.item.resetDirtyFlag(),i.item},_sortQueryResults:function(e,t,i){for(var n=[],a=0;e.length>a;a++)n.push({item:e[a],ref:t[a]});n=n.sort(function(e,t){return this._compare(e.item.getValue(0),t.item.getValue(0),i)}.bind(this)),e.empty(),t.empty();for(var s=0;n.length>s;s++)e.push(n[s].item),t.push(n[s].ref)},_cropQueryResults:function(e,t,i,n){if(i=void 0===i||null===i?0:i,n=void 0===n||null===n?-1:n,i>0&&(e.splice(0,i),t.splice(0,i)),n>-1){n=Math.min(n,e.length);var a=e.length-n,s=e.length-a;e.splice(s,a),t.splice(s,a)}},deReference:function(e,t){return this._cache.get(this._cache.key(e,t))||null},readItemFromCache:function(e,t){return this.deReference(e,t)},_match:function(e,t){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],a=this._evaluatePath(t,i);"array"!=typeof a&&(a=[a]);var s=function(e){return this._matchSingleValue(n,e)}.bind(this);if(!a.some(s))return!1}return!0},_matchSingleValue:function(e,t){return"object"==typeof e?e.hasOwnProperty("$in")?e.$in.contains(t):e.hasOwnProperty("$ne")?t!=e.$ne:e.hasOwnProperty("$gt")?t>e.$gt:e.hasOwnProperty("$gte")?t>=e.$gte:e.hasOwnProperty("$lt")?e.$lt>t:e.hasOwnProperty("$lte")?e.$lte>=t:e.hasOwnProperty("$size")?e.$size==t.length:!1:t==e},_compare:function(e,t,i){var n=0;for(var a in i)if(i.hasOwnProperty(a)){var s=this._evaluatePath(e,a),o=this._evaluatePath(t,a),r=void 0===s&&void 0===o?0:void 0===s?-1:void 0===o?1:s>o?1:o>s?-1:0;if(0!==r){n=r*i[a];break}}return n},_evaluatePath:function(e,t){for(var i=t.split("."),n=e,a=0;i.length>a;a++){if(void 0===n||null===n)return n;var s=i[a],o=s.match(/^(.*)\[([0-9]+)\]$/);if(o){var r=o[1],l=o[2];n=n[r]&&n[r][l]}else n=n[s]}return n}})}),define.Class("wixapps.core.dataservice.DataServiceTransport",function(e){var t=e;t.inherits("wixapps.core.dataservice.DataServiceTransportBase"),t.fields({_storeId:null}),t.methods({initialize:function(e,t,i){this.parent(t,i),this._storeId=e},createStore:function(e,t){this.doRequest("CreateStore",{},{storeId:this._storeId},e,t)},createType:function(e,t,i){this.doRequest("CreateType",{},{storeId:this._storeId,type:e},t,i)},readType:function(e,t,i){this.doRequest("ReadType",{},{storeId:this._storeId,typeName:e},t,i)},listTypes:function(e,t){this.doRequest("ListTypes",{},{storeId:this._storeId},e,t)},deleteType:function(e,t,i){this.doRequest("DeleteType",{},{storeId:this._storeId,typeName:e},t,i)},createCollection:function(e,t,i,n){this.doRequest("CreateCollection",{},{storeId:this._storeId,collectionId:e,typeNames:t},i,n)},listCollections:function(e,t){this.doRequest("ListCollections",{},{storeId:this._storeId},e,t)},deleteCollection:function(e,t,i){this.doRequest("DeleteCollection",{},{storeId:this._storeId,collectionId:e},t,i)},createItem:function(e,t,i,n){this.doRequest("CreateItem",{},{storeId:this._storeId,collectionId:e,item:t},i,n)},updateItem:function(e,t,i,n){this.doRequest("UpdateItem",{},{storeId:this._storeId,collectionId:e,item:t},i,n)},deleteItem:function(e,t,i,n){this.doRequest("DeleteItem",{},{storeId:this._storeId,collectionId:e,itemId:t},i,n)},readItem:function(e,t,i,n){var a=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),s=a&&"owner"===a.getUserRole();this.doRequest("ReadItem",{consistentRead:s},{storeId:this._storeId,collectionId:e,itemId:t,autoDereferenceLevel:3},i,n)},query:function(e,t,i,n,a,s,o,r){var l=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),p=l&&"owner"===l.getUserRole();this.doRequest("Query",{consistentRead:p},{getTotalCount:s,storeId:this._storeId,collectionId:e,filter:t,sort:i,skip:n,limit:-1==a?null:a,autoDereferenceLevel:3},o,r)},groupByAndCount:function(e,t,i,n,a,s){var o=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),r=o&&"owner"===o.getUserRole();this.doRequest("GroupByAndCount",{consistentRead:r},{storeId:this._storeId,collectionId:e,type:t,filter:i,field:n},a,s)}})}),define.Class("wixapps.core.dataservice.DataServiceTransportBase",function(e){var t=e;t.utilize(["wixapps.core.utils.WixAppsLogger"]),t.resources(["W.Utils"]),t.fields({_serviceUrl:null,_userProperties:null,_accessToken:null,_logger:null}),t.methods({initialize:function(e,t){this._userProperties=e,this._accessToken=t;var i=window.location.origin||this._extractBasePath(window.location.href);this._serviceUrl=i+"/apps/lists/1/"},_extractBasePath:function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.hostname},getLogger:function(){return this._logger||(this._logger=new this.imports.WixAppsLogger),this._logger},doRequest:function(e,t,i,n,a){a||(a=function(e){throw e.description+" ("+e.code+")"});var s=function(e){var t=this.getLogger();t.reportError(e,this.$className,"doRequest",t.SubCategory.DATA_SERVICE)}.bind(this),o=function(e){if(e.success)n(e.payload);else{var t={code:e.errorCode,description:e.errorDescription};s(t),a(t)}}.bind(this),r=function(e){var t={code:e.status?e.status:-1,description:e.statusText?e.statusText:"Unspecified error occurred, possibly a connection problem"};s(t),a(t)};this._postJsonRequest(e,t,i,o,r)},_postJsonRequest:function(e,t,i,n,a){var s=this.resources.W.Utils.AppsUtils.urlBuilder(this._serviceUrl);s.combinePath(e),s.addParams(t);var o=new this.resources.W.Utils.AppsUtils.JSONNative({url:""+s,urlEncoded:!1,onSuccess:n,onFailure:a});o.options=o.options||{},o.options.headers=o.options.headers||{},o.options.headers["If-Modified-Since"]="Sat, 1 Jan 2005 00:00:00 GMT",o.options.headers["Content-Type"]="application/json; charset=utf-8",o.options.headers["x-wix-user-properties"]=this._userProperties,o.options.headers["x-wix-access-token"]=this._accessToken,o.post(JSON.stringify(i))}})}),define.Class("wixapps.core.dataservice.ItemCache",function(e){var t=e;t.fields({_dataItemFactory:null,_items:{},_markedNonPersistent:{},_markedDeleted:{}}),t.methods({initialize:function(e){this._dataItemFactory=e},get:function(e){return this._items[e]||null},put:function(e,t){var i=this._items[e];return i?i.setValue(t):(i=this._dataItemFactory.createDataItem(t),this._items[e]=i),i},putIfNotDirty:function(e,t){var i=!1,n=this._items[e];return n?(i=n.isDirty(),i||n.setValue(t)):(n=this._dataItemFactory.createDataItem(t),this._items[e]=n),{wasDirty:i,item:n}},insertDataItem:function(e,t){this._items[e]=t},remove:function(e){delete this._items[e]},key:function(e,t){return e+"/"+t},idsFromKey:function(e){var t=e.split("/");return{collectionId:t[0],itemId:t[1]}},each:function(e){Object.each(this._items,e)},removeAll:function(){for(var e in this._items)delete this._items[e]},markItemAsDeleted:function(e){this._markedDeleted[e]=!0},unMarkItemAsDeleted:function(e){delete this._markedDeleted[e]},isItemMarkedAsDeleted:function(e){return this._markedDeleted[e]===!0},getItemsMarkedAsDeleted:function(){return Object.keys(this._markedDeleted)},markItemAsNonPersistent:function(e){this._markedNonPersistent[e]=!0},unMarkItemAsNonPersistent:function(e){delete this._markedNonPersistent[e]},isItemMarkedAsNonPersistent:function(e){return this._markedNonPersistent[e]===!0},getItemsMarkedAsNonPersistent:function(){return Object.keys(this._markedNonPersistent)}})}),define.Class("wixapps.core.events.EventAggregator",function(e){var t=e;t.binds(["_aggregatingDispatchFunc"]),t.fields({_aggregatedEvents:[],_eventFilter:[],_originalFireEventFunc:null}),t.methods({initialize:function(){this._originalFireEventFunc=this.fireEvent},startEventAggregation:function(e){this._eventFilter=e||[],this.fireEvent=this._aggregatingDispatchFunc},releaseEventAggregation:function(e){e=e||Constants.DataItemEvents.CHANGE,this.fireEvent=this._originalFireEventFunc,this._aggregatedEvents.length>0&&this.fireEvent(e,{target:this,events:this._aggregatedEvents}),this._aggregatedEvents=[]},_aggregatingDispatchFunc:function(e,t){0===this._eventFilter.length||this._eventFilter.contains(e)?t.events?this._aggregatedEvents=this._aggregatedEvents.concat(t.events):this._aggregatedEvents.push({type:e,payload:t}):this._originalFireEventFunc(e,t)}})}),define.Class("wixapps.core.events.ProxyEventBus",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize(["wixapps.core.events.TreePath"]),t.fields({_map:null,_originals:[],_interceptors:[]}),t.methods({initialize:function(){this._map={same:Constants.WixAppTreeRelation.THIS,parent:Constants.WixAppTreeRelation.PARENT,ancestor:Constants.WixAppTreeRelation.ANCESTOR,sibling:Constants.WixAppTreeRelation.SIBLING,descendant:Constants.WixAppTreeRelation.DESCENDANT,"parent-descendant":Constants.WixAppTreeRelation.PARENT_DESCENDANT,"sibling-descendant":Constants.WixAppTreeRelation.SIBLING_DESCENDANT}},fireProxyEvent:function(e,t,i,n){i.sender=e,i.context=e.getViewContext(),i.data=e.getData(),i.def=e.getViewDefinition(),i.type=t,this.fireEvent(t,i,n)},addEventFilteredByScope:function(e,t,i,n,a){t||(t="same");var s=this._map[t];if(!s&&"any"!=t)throw'"'+t+'" is invalid scope value';var o=function(i){var a=i&&i.context&&i.context.getEnvironment().getTreePath(),o=e.getEnvironment().getTreePath();("any"==t||o&&a&&o.isOtherRelatedToThisAs(a,s))&&n(i)};this._originals.push(n),this._interceptors.push(o),this.addEvent(i,o,a)},removeEvent:function(e,t){var i=this._originals.indexOf(t),n=-1==i?t:this._interceptors[i];-1!=i&&(this._originals.splice(i,1),this._interceptors.splice(i,1)),this.parent(e,n)}})}),define.Const("WixAppTreeRelation",{PARENT:1,ANCESTOR:2,SIBLING:4,DESCENDANT:8,PARENT_DESCENDANT:16,SIBLING_DESCENDANT:32,THIS:64}),define.Class("wixapps.core.events.TreePath",function(e){var t=e,i=0;t.fields({_path:null}),t.methods({initialize:function(e){this._path=e?e._path.clone():[]},pushScope:function(){this._path.push(i++)},isOtherRelatedToThisAs:function(e,t){switch(t){case Constants.WixAppTreeRelation.THIS:return this._path.length==e._path.length&&this._path.every(function(t,i){return e._path[i]==t});case Constants.WixAppTreeRelation.PARENT:return!this.isRoot()&&e.get(-1)==this.get(-2);case Constants.WixAppTreeRelation.ANCESTOR:return-1!=this._path.indexOf(e.get(-1));case Constants.WixAppTreeRelation.SIBLING:return this._path.length==e._path.length&&this.get(-2)==e.get(-2);case Constants.WixAppTreeRelation.DESCENDANT:return e.isOtherRelatedToThisAs(this,Constants.WixAppTreeRelation.ANCESTOR);case Constants.WixAppTreeRelation.PARENT_DESCENDANT:return this.isRoot()||e.isOtherRelatedToThisAs(this._createTempParent(),Constants.WixAppTreeRelation.ANCESTOR);case Constants.WixAppTreeRelation.SIBLING_DESCENDANT:return this.isOtherRelatedToThisAs(e,Constants.WixAppTreeRelation.PARENT_DESCENDANT)&&!this.isOtherRelatedToThisAs(e,Constants.WixAppTreeRelation.PARENT)&&!this.isOtherRelatedToThisAs(e,Constants.WixAppTreeRelation.DESCENDANT)}},_createTempParent:function(){var e=new this.constructor(this);return e._path=this._path.slice(0,-1),e},isRoot:function(){return 1==this._path.length},get:function(e){return this._path[(this._path.length+e)%this._path.length]}})}),define.Class("wixapps.core.expressions.EvalScopeWrapper",function(e){var t=e;t.binds(["_onSourceChange","_onEvaluationContextChange"]),t.utilize(["wixapps.core.data.DataItemFactory","wixapps.core.data.DataItemUtils"]),t.fields({_source:null,_evaluationContext:null,_maxRefDepth:0,_data:null,_dataItemFactory:null,_dataItemUtils:null,_evalPending:!1,_changeUpdateTimeChunk:0}),t.methods({initialize:function(e,t,i,n){this._source=e,this._evaluationContext=t,this._viewEnvironment=i,this._maxRefDepth=n,this._dataItemFactory=this._viewEnvironment.getDataItemFactory(),this._dataItemUtils=new this.imports.DataItemUtils,this.evaluateData(),this._source.addEvent(Constants.DataItemEvents.CHANGE,this._onSourceChange),this._exprChangeDispatchers=this._getExprChangeDispatchers(this._source,this._evaluationContext),this._exprChangeDispatchers.each(function(e){e.addEvent(Constants.DataItemEvents.CHANGE,this._onEvaluationContextChange)}.bind(this))},evaluateData:function(){var e=this._source.getValue(this._maxRefDepth,this._evaluationContext);null===this._data?this._data=this._dataItemFactory.createDataItem(e):this._data.setValue(e)},getData:function(){return this._data},_onSourceChange:function(){this._requestEvaluation()},_onEvaluationContextChange:function(){this._requestEvaluation()},_requestEvaluation:function(){this._evalPending===!1&&(this._evalPending=!0,setTimeout(function(){this.evaluateData(),this._evalPending=!1}.bind(this),this._changeUpdateTimeChunk))},_getExprChangeDispatchers:function(e,t){return this._dataItemUtils.findExprItems(e).reduce(function(e,i){var n=i.getChangeDispatchers(t)||[];return Array.concat(e,n)},[]).reduce(function(e,t){return-1==e.indexOf(t)?e.concat(t):e},[])},dispose:function(){this._exprChangeDispatchers.each(function(e){e.removeEvent(Constants.DataItemEvents.CHANGE,this._onEvaluationContextChange)}),this._exprChangeDispatchers=null,this._source.removeEvent(Constants.DataItemEvents.CHANGE,this._onSourceChange),this._source=null}})}),define.Class("wixapps.core.expressions.Expression",function(e){var t=e;t.utilize(["wixapps.core.expressions.ExpressionParser"]),t.fields({_parser:null,_funcLib:null,_expr:null,_exprSource:""}),t.methods({initialize:function(e){this._parser=new this.imports.ExpressionParser,this._funcLib=e},parseExpression:function(e){this._exprSource=e,this._expr=this._parser.parseExpressionSource(e)[0]},getSymbolItems:function(e){var t=function(i,n){return"ref"==n.type?i.concat(e.resolveExpressionReference(n.content)):"function"==n.type?Array.reduce(n.params,t,i):i};return Array.reduce([this._expr],t,[]).filter(function(e){return e.addEvent})},evaluate:function(e){var t=this,i=function(n,a,s){if("function"==n.type){var o=a.getFunctionByName(n.content),r=Array.map(n.params,function(e){return i(e,a,s)});if(o||"Debug"!=n.content.slice(0,5))return o.apply(null,r);t._performDebugFunc(n.content,e,r)}else{if("primitive"==n.type)return n.content;if("ref"==n.type){var l=s.evaluateExpressionReference(n.content);if(void 0===l)throw Error("Expression: "+t._exprSource+" | Cannot resolve symbol "+n.content);return l}}};return this._expr?i(this._expr,this._funcLib,e):void 0},_performDebugFunc:function(e,t){if("Debug.symbols"==e){var i=t.listSymbols();Object.each(i,function(e,t){console.log(e,"=",t)})}},dispose:function(){this._funcLib=null,this._parser=null}})}),define.Class("wixapps.core.expressions.ExpressionLexer",function(e){var t=e;t.methods({parseExpression:function(e){if(e.length){var t=this._findString(e)||this._findSymbol(e)||this._findBracket(e);return t?Array.concat([t],this.parseExpression(e.slice(t.length))):this.parseExpression(e.slice(1))}return[]},_findString:function(e){var t=["'",'"'],i=function(e,t){if(e.length){var n=e.charAt(0);if("\\"==n&&e.length>1)return String.concat(n+e.charAt(1),i(e.slice(2),t));if(n!=t)return String.concat(n,i(e.slice(1),t))}return""},n=e.charAt(0);return t.contains(n)?String.concat('"',i(e.slice(1),n),'"'):void 0},_findSymbol:function(e){var t=/[\w\*\/\-\%\+\$]/,i=/[\w\*\/\-\%\+\.\$\[\]\?_]/,n=function(e){var t=e.charAt(0);return e.length&&t.match(i)?String.concat(t,n(e.slice(1))):""},a=e.charAt(0);return a.match(t)?String.concat(a,n(e.slice(1))):void 0},_findBracket:function(e){var t=e.charAt(0);return"("==t||")"==t?t:void 0}})}),define.Class("wixapps.core.expressions.ExpressionParser",function(e){var t=e;t.utilize(["wixapps.core.expressions.ExpressionLexer"]),t.fields({DIALECT_JS:0,DIALECT_LISP:1,_primitiveTypes:["boolean","string","number"]}),t.methods({parseExpressionSource:function(e){var t=new this.imports.ExpressionLexer(e),i=t.parseExpression(e),n="("==i[0]?this.DIALECT_LISP:this.DIALECT_JS,a=this._foldTokenList(i,n);return this._foldFunctionChain(a)},_foldTokenList:function(e,t){if(e.length){var i=this._getFunction(e,t)||this._getPrimitive(e,t)||this._getReference(e,t);if(i)return Array.concat([i.node],this._foldTokenList(i.next,t))}return[]},_foldFunctionChain:function(e){var t=this._foldFunctionChain;if(e.length>0&&e.every(function(e){return"function"==e.type})){var i=e.slice(1).reduce(function(e,i){return{type:i.type,content:i.content,params:Array.concat([e],t(i.params))}},e[0]);return[i]}return e},_getFunction:function(e,t){var i=t==this.DIALECT_LISP?0:1,n=t==this.DIALECT_LISP?1:0;if("("==e[i]&&"string"==typeOf(e[n])){var a=this._getFuncParams(e);return{next:e.slice(a.length+3),node:{type:"function",content:e[n],params:this._foldTokenList(a,t)}}}},_getFuncParams:function(e){var t=function(e,i){if(e.length&&i>0){var n=e[0],a=e.slice(1);return"("==n?Array.concat([n],t(a,i+1)):")"==n?Array.concat([n],t(a,i-1)):Array.concat([n],t(a,i))}return[]};return t(e.slice(2),1).slice(0,-1)},_getPrimitive:function(e){var t,i=e[0];return"true"==i?t=!0:"false"==i?t=!1:'"'==i.charAt(0)&&'"'==i.charAt(i.length-1)||"'"==i.charAt(0)&&"'"==i.charAt(i.length-1)?t=this._unescapeString(i.slice(1,i.length-1)):isNaN(parseFloat(i,10))?isNaN(parseInt(i,10))||(t=parseInt(i,10)):t=parseFloat(i,10),void 0!==t?{next:e.slice(1),node:{type:"primitive",content:t}}:void 0},_unescapeString:function(e){return e=e.replace(/\\/g,"")},_getReference:function(e){return{next:e.slice(1),node:{type:"ref",content:e[0]}}}})}),define.Class("wixapps.core.expressions.FunctionLibrary",function(e){var t=e,i={and:function(){for(var e=0;arguments.length>e;e++)if(arguments[e]===!1)return!1;return!0},or:function(){for(var e=0;arguments.length>e;e++)if(arguments[e]===!0)return!0;return!1},"if":function(e,t,i){return e?t:i},eq:function(e,t){return e==t},ne:function(e,t){return e!=t},not:function(e){return!e},"!":function(e){return!e},gt:function(e,t){return e>t},lt:function(e,t){return t>e},toString:function(e){return""+e},toJson:function(e){return JSON.stringify(e)},mod:function(e,t){return e%t},add:function(){for(var e=0,t=0;arguments.length>t;t++)e+=arguments[t];return e},mult:function(){for(var e=1,t=0;arguments.length>t;t++)e*=arguments[t];return e},sub:function(e,t){return e-t},div:function(e,t){return e/t},match:function(e,t,i){return e==t?i:void 0},"true?":function(e,t){return Boolean(e)===!0?t:void 0},"false?":function(e,t){return Boolean(e)===!1?t:void 0},"else":function(e,t){return void 0===e?t:e},Math:{floor:function(e){return Math.floor(e)},round:function(e){return Math.round(e)}},Array:{length:function(e){return e.length},isEmpty:function(e){return null==e||0===e.length}},String:{length:function(e){return e.length},isEmpty:function(e){return null==e||0===e.length},charAt:function(e,t){return e.charAt(t)},charCodeAt:function(e,t){return e.charCodeAt(e,t)},concat:function(){return String.concat.apply(arguments[0],arguments)},indexOf:function(e,t){return e.indexOf(t)},lastIndexOf:function(e,t){return e.lastIndexOf(t)},match:function(e,t){return e.match(RegExp(t))},replace:function(e,t,i){return e.replace(t,i)},search:function(e,t){return e.search(RegExp(t))},slice:function(e,t,i){return e.slice(t,i)},split:function(e,t){return e.split(t)},substr:function(e,t,i){return e.substr(t,i)},substring:function(e,t,i){return e.substring(t,i)},toLowerCase:function(e){return e.toLowerCase()},toUpperCase:function(e){return e.toUpperCase()},contains:function(e,t){return e.contains(t)},trim:function(e){return e.trim()},toInt:function(e){return parseInt(e,10)},toFloat:function(e){return parseFloat(e)}},Styles:{fontToTextStyle:function(e){return Constants.WixApps.TEXT_STYLE_NAMES["font_"+e]}}};t.fields({_funcTable:{}}),t.methods({initialize:function(){var e=function(t,i,n){Object.each(i,function(i,a){"function"==typeOf(i)?t[n+a]=i:typeOf("object"==i)&&e(t,i,a+".")})};this._funcTable={},e(this._funcTable,i,"")},getFunctionByName:function(e){return this._funcTable[e]}})}),define.Const("FlowLayout",{Anchors:{TOP_LEFT:"top-left",BOTTOM_LEFT:"bottom-left",TOP_RIGHT:"top-right",BOTTOM_RIGHT:"bottom-right",ALL:["top-left","bottom-left","top-right","bottom-right"]}}),define.Class("wixapps.core.layouts.FlowLayout",function(e){var t=e;t.utilize(["wixapps.core.layouts.Width","wixapps.core.layouts.Padding","wixapps.core.layouts.Spacing"]),t.fields({_anchor:null,_width:null,_model:null,_elements:null,_lines:null,_defaults:null}),t.methods({initialize:function(e){this._anchor=Array.contains(Constants.FlowLayout.Anchors.ALL,e)?e:Constants.FlowLayout.Anchors.TOP_LEFT,this._defaults={spacing:new this.imports.Spacing(5),padding:new this.imports.Padding(0)}},setModel:function(e,t){this._model=Object.clone(e),this._elements=t.slice(),this._buildLines()},getHeight:function(){return this._lines.height},_getSpacing:function(){return this._model.spacing?new this.imports.Spacing(this._model.spacing):this._defaults.spacing},_getPadding:function(e){return e.padding?new this.imports.Padding(e.padding):this._defaults.padding},positionElements:function(e,t,i){e=e||this.getHeight(),t=t||0,i=i||0;for(var n=this._getSpacing(),a=0,s=0;this._lines.length>s;s++){for(var o=this._lines[s],r=0+("default"==o.align?0:"center"==o.align?Math.floor((this._model.minWidth-o.width)/2):this._model.minWidth-o.width),l=0;o.items.length>l;l++){var p=o.items[l],d=o.elements[l];this._positionElement(e,t,i,p,d,r,a,o.height),r+=o.widths[l]+n.horizontal}a+=o.height+n.vertical}},_positionElement:function(e,t,i,n,a,s,o,r){var l=n.vAlign||"bottom";this._anchor.indexOf("bottom")>-1&&("bottom"==l?l="top":"top"==l&&(l="bottom"));var p=this._getPadding(n);"middle"==l&&(o+=Math.floor((r-p.getPaddedHeight(a))/2)),"bottom"==l&&(o+=r-p.getPaddedHeight(a)),this._anchor.indexOf("bottom")>-1&&(o=e-(o+p.getPaddedHeight(a))),this._anchor.indexOf("right")>-1&&(s=this._model.minWidth-(s+p.getPaddedWidth(a))),a.setPos(t+s+p.left,i+o+p.top)},_buildLines:function(){for(var e=function(){return{height:0,width:0,items:[],elements:[],widths:[]}},t=[e()],i=this._getSpacing(),n=0;this._model.items.length>n;n++){var a=this._elements[n],s=this._model.items[n],o=this._getPadding(s),r=void 0!==s.minWidth?new this.imports.Width(s.minWidth):new this.imports.Width(this._elements[n].getWidth()),l=void 0!==s.maxWidth?new this.imports.Width(s.maxWidth):r,p=t[t.length-1],d=p.items.length>0?i.horizontal:0;
p.width+d+r.toAbsolute(this._model.minWidth)>this._model.minWidth&&(p=e(),t.push(p),d=0);var h=Math.min(Math.max(l.toAbsolute(this._model.minWidth),r.toAbsolute(this._model.minWidth)),this._model.minWidth-(p.width+d));if(o.getPaddedWidth(a)!=h&&a.setWidth(h-o.getHorizontalPadding()),0===p.items.length){var c=-1!=this._anchor.indexOf("left")?"left":"right",u=s.align?s.align:c;p.align=u==c?"default":"center"==u?"center":"opposite"}p.items.push(s),p.elements.push(a),p.widths.push(h),p.width+=d+h;var m=o.getPaddedHeight(a);m>p.height&&(p.height=m),(s.last===!0||"true"===s.last)&&t.push(e())}0===t[t.length-1].items.length&&t.pop();for(var g=0,_=0;t.length>_;_++)g+=t[_].height;t.height=g+Math.max(t.length-1,0)*i.vertical,this._lines=t}})}),define.Class("wixapps.core.layouts.FourWayFlowLayout",function(e){var t=e;t.utilize(["wixapps.core.layouts.Spacing","wixapps.core.layouts.FlowLayout"]),t.fields({_model:null,_elements:null,_layouts:{},_spacing:null}),t.methods({setModel:function(e,t){this._model=Object.clone(e),this._elements=t.slice(),this._spacing=new this.imports.Spacing(void 0!==e.spacing?e.spacing:5);var i={},n={},a=function(t){var n=i[t];return n||(n={minWidth:e.minWidth,spacing:""+this._spacing,items:[]},i[t]=n),n}.bind(this),s=function(e){var t=n[e];return t||(t=[],n[e]=t),t};this._model.items.forEach(function(e,i){var n=Object.clone(e),o=n.anchor||Constants.FlowLayout.Anchors.TOP_LEFT;delete n.anchor,a(o).items.push(n),s(o).push(t[i])}.bind(this)),Constants.FlowLayout.Anchors.ALL.forEach(function(e){if(i[e]){var t=new this.imports.FlowLayout(e);t.setModel(i[e],n[e]),this._layouts[e]=t}else this._layouts[e]={getHeight:function(){return 0},positionElements:function(){}}}.bind(this))},getHeight:function(){var e=Constants.FlowLayout.Anchors,t=function(e,t){var i=e.getHeight(),n=t.getHeight();return i+n+(i>0&&n>0&&this._spacing.vertical>0?this._spacing.vertical:0)}.bind(this);return Math.max(t(this._layouts[e.TOP_LEFT],this._layouts[e.BOTTOM_LEFT]),t(this._layouts[e.TOP_RIGHT],this._layouts[e.BOTTOM_RIGHT]),this._model.minHeight||0)},positionElements:function(e,t,i){e=e||this.getHeight(),t=t||0,i=i||0,Constants.FlowLayout.Anchors.ALL.forEach(function(n){this._layouts[n].positionElements(e,t,i)}.bind(this))}})}),define.Class("wixapps.core.layouts.Padding",function(e){var t=e;t.fields({top:0,right:0,bottom:0,left:0}),t.methods({initialize:function(e){this.setFromString(e)},setFromString:function(e){var t=(""+e).split(/\s+/);t.length>0&&(this.top=this.bottom=this.right=this.left=parseInt(t[0],10)),t.length>1&&(this.right=this.left=parseInt(t[1],10)),t.length>2&&(this.bottom=parseInt(t[2],10)),t.length>3&&(this.left=parseInt(t[3],10))},getHorizontalPadding:function(){return this.left+this.right},getVerticalPadding:function(){return this.top+this.bottom},getPaddedWidth:function(e){return e.getWidth()+this.right+this.left},getPaddedHeight:function(e){return e.getHeight()+this.top+this.bottom}})}),define.Class("wixapps.core.layouts.Spacing",function(e){var t=e;t.fields({horizontal:0,vertical:0}),t.methods({initialize:function(e){this.setFromString(e)},setFromString:function(e){var t=(""+e).split(/\s+/);t.length>0&&(this.horizontal=this.vertical=parseInt(t[0],10)),t.length>1&&(this.vertical=this.left=parseInt(t[1],10))},toString:function(){return""+this.horizontal+" "+(""+this.vertical)}})}),define.Const("SuperFlowLayout",{Regions:{NORTH:"north",SOUTH:"south",EAST:"east",WEST:"west",CENTER:"center",ALL:["north","south","east","west","center"]}}),define.Class("wixapps.core.layouts.SuperFlowLayout",function(e){var t=e;t.utilize(["wixapps.core.layouts.FourWayFlowLayout"]),t.fields({_model:null,_elements:null,_widths:{},_heights:{north:0,middle:0,south:0},_layouts:{}}),t.methods({setModel:function(e,t){this._model=Object.clone(e),this._elements=t.slice();var i=Constants.SuperFlowLayout.Regions,n={};i.ALL.forEach(function(e){n[e]=this._model.regions&&this._model.regions[e]&&this._model.regions[e].minWidth||0}.bind(this)),this._widths={};var a=n[i.EAST]+n[i.CENTER]+n[i.WEST],s=Math.max(n[i.NORTH],n[i.SOUTH],a,this._model.minWidth||0);this._widths[i.NORTH]=this._widths[i.SOUTH]=s,this._widths[i.EAST]=n[i.EAST],this._widths[i.WEST]=n[i.WEST],this._widths[i.CENTER]=s-(n[i.EAST]+n[i.WEST]);var o={},r={},l=function(e){var t=o[e];if(!t){t={minWidth:this._widths[e],items:[]};var i=this._model.regions&&this._model.regions[e];i&&(void 0!==i.spacing&&(t.spacing=i.spacing),void 0!==i.minHeight&&(t.minHeight=i.minHeight)),o[e]=t}return t}.bind(this),p=function(e){var t=r[e];return t||(t=[],r[e]=t),t};this._model.items.forEach(function(e,n){var a=Object.clone(e),s=a.region||i.CENTER;delete a.region,l(s).items.push(a),p(s).push(t[n])}.bind(this)),i.ALL.forEach(function(e){if(o[e]){var t=new this.imports.FourWayFlowLayout;t.setModel(o[e],r[e]),this._layouts[e]=t}else this._layouts[e]={getHeight:function(){return 0},positionElements:function(){}}}.bind(this)),this._heights.north=this._layouts[i.NORTH].getHeight(),this._heights.south=this._layouts[i.SOUTH].getHeight(),this._heights.middle=Math.max(this._layouts[i.CENTER].getHeight(),this._layouts[i.EAST].getHeight(),this._layouts[i.WEST].getHeight())},getHeight:function(){return this._heights.north+this._heights.middle+this._heights.south},positionElements:function(e,t,i){e=e||this.getHeight(),t=t||0,i=i||0;var n=Constants.SuperFlowLayout.Regions,a=this._layouts,s=a[n.NORTH],o=a[n.SOUTH],r=a[n.EAST],l=a[n.WEST],p=a[n.CENTER],d=t,h=i;s.positionElements(this._heights.north,d,h),h+=this._heights.north,l.positionElements(this._heights.middle,d,h),d+=this._widths[n.WEST],p.positionElements(this._heights.middle,d,h),d+=this._widths[n.CENTER],r.positionElements(this._heights.middle,d,h),d=0,h+=this._heights.middle,o.positionElements(this._heights.south,d,h)}})}),define.Class("wixapps.core.layouts.Width",function(e){var t=e;t.fields({_kind:null,_val:null}),t.methods({initialize:function(e){if("undefined"==e||null==e||!this.setFromString(""+e))throw"Incorrect width format: ["+e+"]"},setFromString:function(e){if(e&&/^(-?[0-9]+|[0-9]+%)$/.test(e)){var t={val:parseInt(e,10),kind:"exact"};return-1!=e.indexOf("-")&&(t.kind="offset"),-1!=e.indexOf("%")&&(t.kind="percent"),this._kind=t.kind,this._val=t.val,!0}return!1},toAbsolute:function(e){return"offset"==this._kind?e+this._val:"percent"==this._kind?Math.floor(e*this._val/100):this._val}})}),define.Const("DataEditingModel",{ContainmentOptions:{NONE:"none",DIRECT:"direct",ONE_TO_MANY_REFERENCE:"one-2-many-ref",MANY_TO_MANY_REFERENCE:"many-2-many-ref"}}),define.Class("wixapps.core.logics.AbstractDataEditingModel",function(e){var t=e;t.methods({initialize:function(){},getDataService:function(){},getTypesManager:function(){},getCategories:function(){},getCategorySections:function(){},getAddNewTypesInCategory:function(){},getAddNewTypesToParent:function(){},getQueryItems:function(){},loadTree:function(){},getTreeTopLevelItems:function(){},getTreeChildren:function(){},getChildren:function(){},getContainmentOptions:function(){},removeChild:function(){},insertChild:function(){},createItem:function(){},copyItem:function(){},getCollectionOfItem:function(){},deleteItem:function(){}})}),define.Class("wixapps.core.logics.CategoryLogic",function(e){var t=e;t.inherits("wixapps.core.logics.SingleItemLogic"),t.methods({_dsp:function(e,t){return this._environment.getAppInstance().getDescriptorValue(["dataEditing","logicParams","dataSelection",e])||t},_getDescriptorValue:function(e){return this._environment.getAppInstance().getDescriptorValue(e)},generateDataSelectorPanel:function(e,t,i){this.generateSelectionList(e,t,i)},generateSelectionList:function(e,t,i,n,a){var s=this._getItemsCollection(i),o=this._dsp("categoriesSelectionFilter",null),r=this._dsp("categoriesSelectionSort",null),l=this._dsp("categoriesSelectionSkip",null),p=this._dsp("categoriesSelectionLimit",null);this._environment.getDataService().query(s,o,r,l,p,!1,function(n){var s;if(0===n.length)e.addLabel(this._dsp("noCategoriesLabel","No categories found")),s=this._dsp("addFirstCategoryLabel","Create a new category");else{e.addLabel(this._dsp("inlineHelp","Pick which category you'd like to appear and click OK.")),s=this._dsp("anotherCategoryLabel","No thanks, I'd like to create a new category");var o=this._generateCategoriesComboSection(n,e,t,i);o.runWhenReady(function(e){a&&a.apply(this,[e])})}var r=e.addButtonField(null,s,null,null,"withArrow");r.addEvent(Constants.CoreEvents.CLICK,function(){this._createNewListAndSelect(e,t,i)}.bind(this))}.bind(this))},_createCategoryListData:function(e){for(var t,i=this._getItemsCollection(this._logicParams),n=[],a=0;e.length>a;a++)t=e[a].getValue(),n.push({value:i+"/"+t._iid,label:t.title});return n},_generateCategoriesComboSection:function(e,t,i,n){return t.addBreakLine(20),this._generateCategoriesCombo(e,t,i,n)},_generateCategoriesCombo:function(e,t,i,n){var a=this._createCategoryListData(e),s=t.addComboBoxField("",a);if(s.addEvent("inputChanged",function(e){this._changeSelectedCategory(i,e.value)}.bind(this)),n.collectionId&&n.itemId){for(var o=n.collectionId+"/"+n.itemId,r=-1,l=0;a.length>l;l++)if(a[l].value==o){r=l;break}-1!=r?s.setValue(o):a.length>0&&this._changeSelectedCategory(i,a[0].value)}return s},_createNewListAndSelect:function(e,t){var i=e.injects();if(i.Config.siteNeverSavedBefore())i.EditorDialogs.openWixAppsSiteMustBeSaved();else{var n=this._dsp("newItemType","Category"),a=this._dsp("newItemCollection","Categories"),s=this.getDataEditingModel().getItemTemplate(n,!0),o=this._dsp("newItemOverrides",{title:"New Category"});Object.each(o,function(e,t){s.getChildByRef(t).setValue(e)}),this._environment.getDataService().createItem(a,s,function(n){this._changeSelectedCategory(t,a+"/"+n.getChildValue("_iid")),e._dialogWindow.closeDialog(),i.Commands.executeCommand("WAppsEditorCommands.OpenEditDataDialog",{selectedComp:this._environment.getAppPart()})}.bind(this),function(e){i.EditorDialogs.openErrorDialog(this._dsp("newItemErrorTitle","Error creating new category"),this._dsp("newItemErrorDescription","Please try again in a few minutes"),e.code+"\n"+e.description,null)}.bind(this))}},_changeSelectedCategory:function(e,t){this._fixingItemNotFound=!1;var i=e.get("appLogicParams"),n=t.split("/")[0],a=t.split("/")[1],s={};s=Object.merge(s,e._data),i.itemId={type:"AppPartParam",value:a},i.collectionId={type:"AppPartParam",value:n};var o={};o=Object.merge(o,e._data),e.fireDataChangeEvent(void 0,o,s)},getSelectedIId:function(e,t){return t.itemId},getDataEditingMetaInfo:function(){var e=this._environment.getAppInstance(),t=e.getDescriptorValue(["dataEditing","dataSelectionLabel"])||"Choose Category",i=e.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",n=this._environment.getAppPart().getPartDef().name,a=this._logicParams?this._environment.getDataService().deReference(this._logicParams.collectionId,this._logicParams.itemId):null;return a&&(n=n+" - "+a.getChildValue("title"),n.length>35&&(n=n.substr(0,35)+"...")),{title:n,hasDataEdit:!0,hasDataSelection:!0,dataSelectionLabel:t,dataEditingLabel:i}}})}),define.Class("wixapps.core.logics.DescriptorDataEditingModel",function(e){var t=e;t.utilize(["wixapps.core.logics.AbstractDataEditingModel"]),t.fields({_logicEnv:null,_descriptor:null,_categories:[],_sectionsByCat:{},_addNewByCat:{},_sections:{},_trees:{}}),t.methods({initialize:function(e){this._logicEnv=e,this._descriptor=e.getAppInstance().getAppDescriptor(),this._parse()},getDataService:function(){return this._logicEnv.getDataService()},getTypesManager:function(){return this._logicEnv.getTypesManager()},getCategories:function(){return this._categories},getDataEditingHelpId:function(){return this._getDescriptorValue(["dataEditing","helpId"])},getItemEditingHelpId:function(){return this._getDescriptorValue(["dataEditing","itemEditingHelpId"])},getPotentialParentsTree:function(e,t){var i=this._getDescriptorValue(["dataEditing","typeMetaData",e,"parentsTreeId"]);this.loadTree(i,function(){t(this.getFullTree(i))}.bind(this))},getCategorySections:function(e){return this._sectionsByCat[e]},getCategoryHeight:function(e){for(var t=this._getDescriptorValue(["dataEditing","categories"]),i=0;t.length>i;i++)if(t[i].name==e)return t[i].height},getAddNewTypesInCategory:function(e){return this._addNewByCat[e]||[]},getAddNewTypesToParent:function(e){var t=this._getDescriptorValue(["dataEditing","typeMetaData",e.getTypeName(),"addChildrenTypes"]);if(t)return t;var i=this._getChildrenTypeField(e.getTypeName());if(i){for(var n=this.getTypesManager(),a=n.getArrayAllowedTypes(i.type),s=[],o=0;a.length>o;o++){var r=n.isRef(a[o])?n.getReferredType(a[o]):a[o];s.contains(r)||s.push(r),s.combine(n.getExtendingTypes(r))}return s}return[]},getQueryItems:function(e,t){var i=function(e){t(e)},n=function(e){throw e};this.getDataService().query(e.collectionId,e.filter,e.sort,e.skip,e.limit,!1,i,n)},getQueryNoResultsMessage:function(e){return e.noResultsMessage||"No items"},loadTree:function(e,t){var i=function(e){t(e)},n=function(e){throw e},a=this._getDescriptorValue(["dataEditing","trees",e]),s=a.collectionId,o=a.topLevelSorting||{};this.getDataService().query(s,{},o,0,null,!1,i,n)},getTreeTopLevelItems:function(e){var t=this._getDescriptorValue(["dataEditing","trees",e]),i=t.collectionId,n=t.topLevelSorting||{};return this.getDataService().queryCache(i,{},n,0,-1).items},getTreeChildren:function(e,t){var i=this._getChildrenTypeField(t.getTypeName());if(!i)return[];var n=this._getDescriptorValue(["dataEditing","trees",e]),a=n.includedTypes||[],s=t.getChildByRef(i.name),o=[];return s.getChildren().forEach(function(e){a.contains(e.getTypeName())&&o.push(e)}),o},getFullTree:function(e){for(var t=this.getTreeTopLevelItems(e),i=[],n=0;t.length>n;n++)i.push({title:t[n].getChildValue("title"),item:t[n],children:this._getTreeChildrenRecursive(e,t[n])});return i},getNoChildrenForItemMessage:function(e){return this._getDescriptorValue(["dataEditing","typeMetaData",e,"noChildrenMessage"])||"No Items"},_getTreeChildrenRecursive:function(e,t){for(var i=[],n=this.getTreeChildren(e,t),a=0;n.length>a;a++)i.push({title:n[a].getChildValue("title"),item:n[a],children:this._getTreeChildrenRecursive(e,n[a])});return i},getChildren:function(e){var t=this._getChildrenTypeField(e.getTypeName());if(!t)return[];var i=e.getChildByRef(t.name);return i.getChildren()},getContainmentOptions:function(e,t){return this.getContainmentOptionsByTypeNames(e.getTypeName(),t.getTypeName())},getContainmentOptionsByTypeNames:function(e,t){var i=this._getChildrenTypeField(e);if(!i)return[];for(var n=this.getTypesManager().getArrayAllowedTypes(i.type),a=[],s=this.getTypesManager(),o=0;n.length>o;o++){var r;if(s.isOf(t,n[o]))r=Constants.DataEditingModel.ContainmentOptions.DIRECT,a.contains(r)||a.push(r);else if(s.isOf(t,s.getReferredType(n[o]))){var l=this._getParentTypeField(t);r=l&&!s.isArray(l.type)?Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE,a.contains(r)||a.push(r)}}return a},getContainmentType:function(e,t){var i=this.getTypesManager();t.isRef()&&(t=t.getReferencedDataItem());for(var n=this.getChildren(e),a=0;n.length>a;a++){var s=n[a];if(s===t)return Constants.DataEditingModel.ContainmentOptions.DIRECT;if(s.isRef()&&s.getReferencedDataItem()===t){var o=this._getParentTypeField(t.getTypeName());return o&&!i.isArray(o.type)?Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE}}return null},getItemBreadCrumbs:function(e){var t="",i=this.getItemParents(e);return 1==i.length&&(t=i[0].getChildValue("title")+"/"),t+=e.getChildValue("title")},getItemParents:function(e){var t=this._getParentTypeField(e.getTypeName());if(!t){var i=e.getParent()&&e.getParent().getParent();return i?[i]:[]}var n=e.getChildByRef(t.name);return null==n.getValue()?[]:this.getTypesManager().isArray(n.getTypeName())?n.getChildren():[n]},getChildContainmentOptions:function(e){var t=this._getParentTypeField(e);return t?this._getFieldAcceptableTypes(t):this._getContainmentOptions(e)},removeChild:function(e,t){var i=this._getChildrenTypeField(e.getTypeName());if(i){var n=e.getChildByRef(i.name);this._removeFromArray(n,t)}var a=this._getParentTypeField(t.getTypeName());if(a){var s=t.getChildByRef(a.name);if(this.getTypesManager().isArray(s.getTypeName()))this._removeFromArray(s,e);else if(this._areDataItemsEqual(s,e)){var o={_type:a.type,collectionId:Constants.DataItem.VOID_REF,itemId:Constants.DataItem.VOID_REF};s.setValue(o)}}return t},insertChild:function(e,t,i,n){var a=this._getChildrenTypeField(e.getTypeName());if(!a)throw"child ["+t+"] cannot be added to parent ["+e+"] because parent has no children field definition in descriptor";var s=e.getChildByRef(a.name),o=t;if(i==Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE||i==Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE){var r=this.getCollectionOfItem(t);if(!r)throw"CollectionId for child ["+t+"] is unknown";o={_type:"wix:Ref<"+t.getTypeName()+">",collectionId:r,itemId:t.getChildValue("_iid")};var l=this._getParentTypeField(t.getTypeName());if(l){var p=this.getCollectionOfItem(e),d={_type:"wix:Ref<"+e.getTypeName()+">",collectionId:p,itemId:e.getChildValue("_iid")};if(i==Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE){var h=t.getChildByRef(l.name);h.addChild(d)}else{var c=t.getChildByRef(l.name);c.setValue(d)}}}s.addChild(o,n)},getItemTemplate:function(e,t){var i=Object.clone(this._getDescriptorValue(["dataEditing","typeMetaData",e,"newItemTemplate"]));i._type=e,t&&(i._iid=this._generateId());var n=this.getDataService().getDataItemFactory().createDataItem(i);return this.getTypesManager().applyDefaults(n)},getItemDefaultCollection:function(e){return this._getDescriptorValue(["dataEditing","typeMetaData",e,"collectionId"])},getItemDefaultNewChild:function(e){return this._getDescriptorValue(["dataEditing","typeMetaData",e,"defaultChildType"])},getTypeFriendlyName:function(e){return this._getDescriptorValue(["dataEditing","typeMetaData",e,"friendlyName"])},copyItem:function(e,t){var i=Object.clone(e.getValue(0));i._iid=this._generateId(),delete i._hash;var n=this.addToCache(t,i);return n.setDirty(),n},copyDependentItem:function(e){var t=Object.clone(e.getValue(0));return this._logicEnv.getDataItemFactory().createDataItem(t)},addExistingToCache:function(e,t){var i=this.getDataService().getItemCache(),n=i.key(e,t.getChildValue("_iid"));i.insertDataItem(n,t)},addToCache:function(e,t){var i=this.getDataService().getItemCache(),n=t._iid;return i.put(i.key(e,n),t)},deleteItem:function(){},getCollectionOfItem:function(e){var t=e.getChildValue("_iid");if(!t)return null;var i=this._descriptor.collections;e.isRef()&&(e=e.getReferencedDataItem());for(var n=0;i.length>n;n++)if(this.getDataService().deReference(i[n].id,t)===e)return i[n].id;return null},_areDataItemsEqual:function(e,t){return e.isRef()&&(e=e.getReferencedDataItem()),t.isRef()&&(t=t.getReferencedDataItem()),e===t},_removeFromArray:function(e,t){for(var i=e.getChildren(),n=0,a=0;i.length>n;n++,a++){var s=i[n];this._areDataItemsEqual(s,t)&&(e.deleteChild(a),a--)}},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_generateId:function(){for(var e,t=this._CHARS,i=[],n=0,a=0;36>a;a++)8==a||13==a||18==a||23==a?i[a]="-":14==a?i[a]="4":(2>=n&&(n=0|33554432+16777216*Math.random()),e=15&n,n>>=4,i[a]=t[19==a?8|3&e:e]);return i.join("")},_getFieldAcceptableTypes:function(e){var t,i=[];if(this.getTypesManager().isArray(e.type)){t=this.getTypesManager().getArrayAllowedTypes(e.type);for(var n=0;t.length>n;n++)i.push(this.getTypesManager().getReferredType(t[n]));return{relation:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE,types:i}}return i.push(this.getTypesManager().getReferredType(e.type)),{relation:Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE,types:[i]}},_getContainmentOptions:function(e){var t,i=this._getDescriptorValue(["dataEditing","childrenField"]),n=[];for(var a in i){var s=this._getChildrenTypeField(a);t=this._getFieldAcceptableTypes(s).types,t.contains(e)&&n.push(a)}return 0===n.length?{relation:Constants.DataEditingModel.ContainmentOptions.NONE}:{relation:Constants.DataEditingModel.ContainmentOptions.DIRECT,types:n}},_getChildrenTypeField:function(e){var t=this._getDescriptorValue(["dataEditing","typeMetaData",e,"childrenField"]);if(t){var i=this.getTypesManager();return i.getField(i.getType(e),t)}return null},_getParentTypeField:function(e){var t=this._getDescriptorValue(["dataEditing","typeMetaData",e,"parentField"]);if(t){var i=this.getTypesManager();return i.getField(i.getType(e),t)}return null},_getDescriptorValue:function(e){return this._logicEnv.getAppInstance().getDescriptorValue(e)},_getCollectionAllowedTypes:function(e){for(var t=this._descriptor.collections||[],i=0;t.length>i;i++)if(t[i].id==e)return t[i].allowedTypes;return[]},_parse:function(){for(var e=this._getDescriptorValue(["dataEditing","categories"])||{},t=0;e.length>t;t++){var i=e[t].name;this._categories.push(i),this._sectionsByCat[i]=e[t].items||[];for(var n=0;this._sectionsByCat[i].length>n;n++){var a=this._sectionsByCat[i][n];this._sections[i+"/"+a.name]=a}e[t].newTypes&&(this._addNewByCat[i]=e[t].newTypes)}}})}),define.Class("wixapps.core.logics.EditItemLogic",function(e){var t=e;t.inherits("wixapps.core.logics.SingleItemLogic"),t.binds(["onSuccess","_saveItem","_cancel","_onSaveSuccess","_onSaveFailure","_addSubItem"]),t.utilize(["wixapps.core.utils.DataServiceSaver","wixapps.core.logics.DescriptorDataEditingModel"]),t.methods({initialize:function(e){e.newDataServiceContext(),this.parent(e),this._saver=new this.imports.DataServiceSaver,this._model=new this.imports.DescriptorDataEditingModel(e)},run:function(e,t,i,n){if(this._viewName=e,this._callBacks=i,n&&n.type){var a=this._model.getItemTemplate(n.type,!0);this._model.addExistingToCache(t.collectionId,a),this.onSuccess(a)}else this.parent(e,t,i)},onSuccess:function(e){var t=this._environment;this._item=e;var i=t.getTypesManager(),n=t.getProxyFactory();i.applyDefaults(e);var a=n.createView(e,this._viewName);this._proxy=a,a.addEvent("saveItem",this._saveItem),a.addEvent("cancel",this._cancel),a.addEvent("itemMoved",this._onItemMoved),a.addEvent("addSubItem",this._addSubItem),this._onBeforeItemRendered(a),this._callBacks.showProxy(a)},_addSubItem:function(e){var t=e.params.addToField,i=e.params.type,n=this._model.getItemTemplate(i,!1),a=this._item.getChildByRef(t);a.addChild(n,0)},_createItemOfType:function(e){var t=this._environment.getAppInstance().getDescriptorValue(["dataEditing","typeMetaData",e]);return this._environment.getDataItemFactory().createDataItem(t.newItemTemplate)},_onItemMoved:function(e){var t=e.sender;t.getViewContext().getData();var i=e.data.getValue();i.splice(e.cause.oldIdx,1),i.splice(e.cause.idx,0,e.cause.dataItem.getValue()),e.data.setValue(i),e.data.fireChangedEvent(),t.getViewContext().getData().fireChangedEvent()},_saveItem:function(){this._saver.saveChanges(this._environment.getDataService(),this._onSaveSuccess,this._onSaveFailure)||this._cancel()},_onSaveSuccess:function(e){var t=this._environment.getDataService().getItemCache();this._environment.popDataServiceContext();var i=this._environment.getDataService().getItemCache();this._saver.copyChanges(t,i,e,this._environment),this._environment.getAppInstance().fireEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,{}),this.injects().Commands.executeCommand("WViewerCommands.MediaZoom.Close")},_onSaveFailure:function(){},_validateAfterSave:function(){},_cancel:function(){this._environment.popDataServiceContext(),this.injects().Commands.executeCommand("WViewerCommands.MediaZoom.Close")},dispose:function(){this._proxy.removeEvent("saveItem",this._saveItem),this._proxy.removeEvent("cancel",this._cancel),this._proxy.removeEvent("itemMoved",this._onItemMoved),this.parent()}})}),define.Class("wixapps.core.logics.EditableQueryLogic",function(e){var t=e;t.inherits("wixapps.core.logics.QueryLogic"),t.binds(["_addItem"]),t.utilize(["wixapps.core.utils.DataServiceSaver"]),t.methods({initialize:function(e){this.parent(e),this._saver=new this.imports.DataServiceSaver},_onBeforeItemRendered:function(e){e.addEvent("addItem",this._addItem),e.addEvent("deleteItem",this._deleteItem),e.addEvent("setValue",this._setValue)},_addItem:function(e){this._environment.getAppInstance().getZoomHandler().openZoomForNewItem(e.params.zoomPartName,{hideNextPrevBtns:!0},{type:e.params.type})},_deleteItem:function(){},_setValue:function(){}})}),define.Class("wixapps.core.logics.GroupByAndCountLogic",function(e){function t(e,t){return e>t?1:t>e?-1:0}var i=e;i.inherits("wixapps.core.logics.LogicBase"),i.binds(["onSuccess","onFailure","_validateAfterSave","_processResult"]),i.utilize(["wixapps.core.logics.DescriptorDataEditingModel"]),i.resources(["W.Utils"]);var n={byKeyAsc:function(e,i){return t(e.key,i.key)},byKeyDesc:function(e,i){return t(i.key,e.key)},byCountAsc:function(e,i){return t(e.count,i.count)},byCountDesc:function(e,i){return t(i.count,e.count)}};i.fields({_environment:null,_logicParams:null,_countsMapDataItem:null,_countsArrayDataItem:null}),i.methods({initialize:function(e){this._environment=e,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._validateAfterSave)},run:function(e,t,i){return this._viewName=e,this._callBacks=i,this._logicParams=t,t.collectionId&&t.type&&t.field?(this._doQuery(!0),void 0):(this.onFailure({description:"'collectionId' and 'type' and 'field' should be defined",code:-1}),void 0)},_doQuery:function(e){var t=this._environment,i=this._logicParams,n=this._callBacks,a=i.filter||{},s=t.getDataService().groupByAndCountFromCache(i.collectionId,i.type,a,i.field);e&&s?this.onSuccess(s):(t.getDataService().groupByAndCount(i.collectionId,i.type,a,i.field,this.onSuccess,this.onFailure),this._countsArrayDataItem||this._showLoading(n))},onSuccess:function(e){this._countsMapDataItem!==e&&(this._countsMapDataItem&&this._countsMapDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._processResult),this._countsMapDataItem=e,this._countsMapDataItem.addEvent(Constants.DataItemEvents.CHANGE,this._processResult)),this._processResult()},getDataEditingModel:function(){return new this.imports.DescriptorDataEditingModel(this._environment)},_processResult:function(){var e=this._environment,t=e.getProxyFactory(),i=[];if(Object.each(this._countsMapDataItem.getValue(),function(e,t){i.push({count:e,key:t})}),this._logicParams.sort&&n[this._logicParams.sort]&&(i=i.sort(n[this._logicParams.sort])),this._logicParams.limit&&(i=i.slice(0,this._logicParams.limit)),this._logicParams.normalizeTo)for(var a=parseInt(this._logicParams.normalizeTo),s=i.reduce(function(e,t){return e>t.count?e:t.count},-1),o=0;i.length>o;o++)i[o].normalized=Math.ceil(i[o].count*a/s);if(this._countsArrayDataItem)this._countsArrayDataItem.setValue(i);else{this._countsArrayDataItem=e.getDataItemFactory().createDataItem(i);var r=t.createView(this._countsArrayDataItem,this._viewName);this._callBacks.showProxy(r)}},onFailure:function(e){this._showError(this._callBacks,e)},_validateAfterSave:function(){this._doQuery(!1)},_showLoading:function(e){e.showLoadingIndicator()},_showError:function(e,t){var i=Object.clone(t);i._type="Error";var n=this._environment.getProxyFactory(),a=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Viewer").isPublicMode()?"ErrorInPublished":"ErrorInEditor";if(n.getViewDefinition(i._type,a)){var s=n.createView(this._environment.getDataItemFactory().createDataItem(i),a);e.showProxy(s)}else e.showErrorIndicator(t.code,t.description)},getDataEditingMetaInfo:function(){var e=this._environment.getAppInstance(),t=e.getDescriptorValue(["dataEditing","dataSelectionLabel"])||"Choose Category",i=e.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",n=this._environment.getAppPart().getPartDef().name,a=this._environment.getAppPart().getPartDef().logicParams||{};return{title:n,hasDataEdit:!0&&a.allowDataEditing!==!1,hasDataSelection:!0&&a.allowDataSelection!==!1,dataSelectionLabel:t,dataEditingLabel:i}},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._validateAfterSave),this._countsMapDataItem&&this._countsMapDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._processResult)}})}),define.Class("wixapps.core.logics.LogicBase",function(e){var t=e;t.binds(["_onDetailsUpdated"]),t.fields({_environment:null,USER_ROLES:{NONE:"none",MEMEBER:"member",OWNER:"owner"},_userRole:"none"}),t.methods({initialize:function(e){this._environment=e,this._activateOwnerVariable()},run:function(){},getDataEditingModel:function(){},getDataEditingMetaInfo:function(){var e=this._environment.getAppPart().getPartDef().logicParams||{};return{title:"",hasDataSelection:!1||e.allowDataSelection===!0,dataSelectionLabel:"",dataEditingLabel:"",hasDataEdit:!0&&e.allowDataEditing!==!1}},_getLastTenItems:function(){return[]},getLastTenItemsZoomParams:function(e,t,i,n){this._getLastTenItems(e,function(e){if(n=n||"title",i=i||"_iid",0===e.length)return{list:[],selectedIndex:0};var a=e[0].getValue()[i],s=e.map(function(e){return{id:e.getChildByRef(i).getValue(),title:e.getChildByRef(n).getValue()}}),o=s.getIndexByField("id",a);t({list:s,selectedIndex:o})})},sendEmail:function(e,t,i,n,a,s,o,r,l){var p={to:e,cc:t,bcc:i,from:n,subject:a,htmlMessage:s,plainTextMessage:o,metaSiteId:r},d=this.injects(),h=d.Config.getServiceTopologyProperty("emailServer"),c=this._isPreviewMode();c&&(h+="Secured");var u=[];u.push(h),u.push("?accept=json&contentType=json"),u.push("&appUrl="+encodeURIComponent(window.location.href)),c&&u.push("&wixSession="+d.CookiesManager.getCookie("wixSession")),this._sendJsonCORS(u.join(""),p,"POST",l)},_sendJsonCORS:function(e,t,i,n){var a=function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?(i.open(e,t,!0),i.withCredentials="true"):"undefined"!=typeof XDomainRequest&&(i=new XDomainRequest,i.open(e,t),i.setRequestHeader=function(){}),i},s=function(e){if(!r.responseText)return{success:!1,errorDescription:"Invalid ajax response, no responseText",errorCode:-9001};var t=JSON.parse?JSON.parse:eval;try{return t(e)}catch(i){return{success:!1,errorDescription:"Invalid JSON object",errorCode:-9e3}}},o=function(e){return e.errorDescription+" ("+e.errorCode+")"},r=a(i,e);r.onabort=function(){n(!1,"request aborted")},r.ontimeout=function(){n(!1,"request timeout")},r.onerror=function(){n(!1,o(s(r.responseText)))},r.onload=function(){var e=s(r.responseText);n(e.success,e.success?e:o(e))},r.send(JSON.stringify(t))},_sendJsonCORSWide:function(e,t,i,n){var a=function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?(i.open(e,t,!0),i.withCredentials=!1):"undefined"!=typeof XDomainRequest&&(i=new XDomainRequest,i.open(e,t),i.setRequestHeader=function(){}),i},s=function(e){if(!r.responseText)return{success:!1,errorDescription:"Invalid ajax response, no responseText",errorCode:-9001};var t=JSON.parse?JSON.parse:eval;try{var i=t(e);return i.success=!0,i}catch(n){return{success:!1,errorDescription:"Invalid JSON object",errorCode:-9e3}}},o=function(e){return e.errorDescription+" ("+e.errorCode+")"},r=a(i,e);r.onabort=function(){n(!1,"request aborted")},r.ontimeout=function(){n(!1,"request timeout")},r.onerror=function(){n(!1,o(s(r.responseText)))},r.onload=function(){var e=s(r.responseText);n(e.success,e.success?e:o(e))},r.send(JSON.stringify(t))},_activateOwnerVariable:function(){this._isPreviewMode()?this._userRole=this.USER_ROLES.OWNER:this.injects().SiteMembers.getMemberDetails(this._onDetailsUpdated,this._onDetailsUpdated)},_setupCommonVars:function(e){this._proxy=e,this._userRole=this._userRole||this.USER_ROLES.NONE,this._isPreviewMode()&&(this._userRole=this.USER_ROLES.OWNER),e.getViewContext().getEnvironment().setVar("userRole",this._userRole)
},_onDetailsUpdated:function(e){this._userRole=this._isPreviewMode()||e.owner===!0?this.USER_ROLES.OWNER:"ACTIVE"==e.status?this.USER_ROLES.MEMEBER:this.USER_ROLES.NONE,this._proxy&&this._proxy.getViewContext().getEnvironment().setVar("userRole",this._userRole)},_isPreviewMode:function(){return"site"!=this.injects().Viewer.getViewMode()},isDeletable:function(){return!0},_getParamsFromURL:function(){if(this._urlParams)return this._urlParams;var e={},t=window.location.search;if(t.length>1){t=t.substr(1);for(var i=t.split("&"),n=0;i.length>n;n++){var a=i[n].split("=");e[a[0]]=e[a[0]]||[],e[a[0]].push(a[1])}}return this._urlParams=e,e}})}),define.Class("wixapps.core.logics.QueryLogic",function(e){var t=e;t.inherits("wixapps.core.logics.LogicBase"),t.binds(["onSuccess","onFailure","_validateAfterSave"]),t.utilize(["wixapps.core.logics.DescriptorDataEditingModel"]),t.traits(["wixapps.core.logics.QueryTrait"]),t.fields({_environment:null,_logicParams:null}),t.methods({initialize:function(e){this._environment=e,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._validateAfterSave),this._dataItemFactory=this._environment.getAppInstance().getDataItemFactory(),this.parent(e)},getSelectedIId:function(e,t){return t.itemId},_getItemsCollection:function(e){return e.collectionId},run:function(e,t,i){this._viewName=e,this._callBacks=i,this.fetchData(t,this.onSuccess,this.onFailure)},onSuccess:function(e){var t=this._environment;t.getTypesManager();var i=t.getProxyFactory();this._virtualArray=e;var n=i.createView(this._virtualArray,this._viewName);this._setupCommonVars(n),this._onBeforeItemRendered(n),this._callBacks.showProxy(n)},onFailure:function(e){this._showError(this._callBacks,e)},_validateAfterSave:function(){this.run(this._viewName,this._logicParams,this._callBacks)},getDataEditingModel:function(){return new this.imports.DescriptorDataEditingModel(this._environment)},_getLastTenItems:function(e,t){var i=this.getDataEditingModel().getItemDefaultCollection(e);this.getDataEditingModel().getDataService().query(i,{_type:e},{_updatedAt:-1},0,10,!1,t)},_onBeforeItemRendered:function(){},_showLoading:function(e){e.showLoadingIndicator()},_getResourceSync:function(){var e=null;return this.resource.getResourceValue("W.Viewer",function(t){e=t}),e},getDataEditingMetaInfo:function(){var e=this._environment.getAppInstance(),t=e.getDescriptorValue(["dataEditing","dataSelectionLabel"])||"Choose Category",i=e.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",n=this._environment.getAppPart().getPartDef().name,a=this._logicParams?this._environment.getDataService().deReference(this._logicParams.collectionId,this._logicParams.itemId):null;a&&(n=n+" - "+a.getChildValue("title"),n.length>35&&(n=n.substr(0,35)+"..."));var s=this._environment.getAppPart().getPartDef().logicParams||{};return{title:n,hasDataEdit:!0&&s.allowDataEditing!==!1,hasDataSelection:!0&&s.allowDataSelection!==!1,dataSelectionLabel:t,dataEditingLabel:i}},generateDataSelectorPanel:function(){},_showError:function(e,t){var i=Object.clone(t);i._type="Error";var n=this._environment.getProxyFactory(),a=this._getResourceSync("W.Viewer").isPublicMode()?"ErrorInPublished":"ErrorInEditor";if(n.getViewDefinition(i._type,a)){var s=n.createView(this._environment.getDataItemFactory().createDataItem(i),a);e.showProxy(s)}else e.showErrorIndicator(t.code,t.description)},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._validateAfterSave)}})}),define.Class("wixapps.core.logics.QueryTrait",function(e){var t=e;t.binds(["_parseResult"]),t.methods({initialize:function(e){this._dataItemFactory=this._environment.getAppInstance().getDataItemFactory(),this.parent(e)},fetchData:function(e,t,i){this._onFetchDataSuccess=t;var n=this._environment;if(this._logicParams=e,!e.collectionId)return i({description:"'collectionId' should be defined",code:-1}),void 0;var a=null,s=null;e.filter&&e.filter.length&&(a=JSON.parse(e.filter)),e.sort&&e.sort.length&&(s=JSON.parse(e.sort));var o=e.skip||0,r=Number(e.limit)||50;n.getTypesManager().getType(e.resultType);var l=!!e.getTotalCount;n.getDataService().query(e.collectionId,a,s,o,r,l,this._parseResult,i)},_parseResult:function(e,t,i){this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren(e),this._setTotalResultCount(i),this._onFetchDataSuccess(this._virtualArray)},_setTotalResultCount:function(){}})}),define.Class("wixapps.core.logics.SingleItemLogic",function(e){var t=e;t.inherits("wixapps.core.logics.LogicBase"),t.binds(["onSuccess","onFailure","_validateAfterSave"]),t.utilize(["wixapps.core.logics.DescriptorDataEditingModel"]),t.fields({_environment:null,_logicParams:null,_fixingItemNotFound:!1}),t.methods({initialize:function(e){this._environment=e,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._validateAfterSave)},getSelectedIId:function(e,t){return t.itemId},run:function(e,t,i){var n=this._environment;if(this._viewName=e,this._callBacks=i,this._logicParams=t,!t.collectionId||!t.itemId)return this.onFailure({description:"'collectionId' and 'itemId' should be defined",code:-1}),void 0;var a=n.getDataService().readItemFromCache(t.collectionId,t.itemId);a?this.onSuccess(a):(n.getDataService().readItem(t.collectionId,t.itemId,this.onSuccess,this.onFailure),this._showLoading(i))},onSuccess:function(e){var t=this._environment,i=t.getTypesManager(),n=t.getProxyFactory();i.applyDefaults(e);var a=n.createView(e,this._viewName);this._onBeforeItemRendered(a),this._callBacks.showProxy(a)},onFailure:function(e){this._logicParams["wixapps:first-load-after-add-to-stage"]===!0&&-1021==e.code?this._fixItemNotFound():this._showError(this._callBacks,e)},_validateAfterSave:function(){var e=this._logicParams,t=this._environment.getDataService().readItemFromCache(e.collectionId,e.itemId);t||this.onFailure({code:-1021,description:"Item not found"})},_fixItemNotFound:function(){this._fixingItemNotFound=!0;var e=this._getItemsCollection(this._logicParams),t=function(t){if(this._fixingItemNotFound){if(this._fixingItemNotFound=!1,0===t.length)return this.onFailure({description:"No items found in collection "+e,code:-1021}),void 0;var i=t[0],n=i.getChildValue("_iid");if(!n)return this.onFailure({description:"New selected item id not found",code:-1}),void 0;var a=this._environment.getAppPart().getDataItem().get("appLogicParams");a.itemId={type:"AppPartParam",value:n},this._environment.getAppPart().getDataItem().fireDataChangeEvent()}}.bind(this),i=function(e){this._fixingItemNotFound&&(this._fixingItemNotFound=!1,this._showError(this._callBacks,e))}.bind(this);this.getDataEditingModel().getDataService().query(e,{},{_updatedAt:-1},0,-1,!1,t,i)},_getItemsCollection:function(e){return e.collectionId},getDataEditingModel:function(){return new this.imports.DescriptorDataEditingModel(this._environment)},_getLastTenItems:function(e,t){var i=this.getDataEditingModel().getItemDefaultCollection(e);this.getDataEditingModel().getDataService().query(i,{_type:e},{_updatedAt:-1},0,10,!1,t)},_onBeforeItemRendered:function(){},_showLoading:function(e){e.showLoadingIndicator()},_getResourceSync:function(){var e=null;return this.resource.getResourceValue("W.Viewer",function(t){e=t}),e},_showError:function(e,t){var i=Object.clone(t);i._type="Error";var n=this._environment.getProxyFactory(),a=this._getResourceSync("W.Viewer").isPublicMode()?"ErrorInPublished":"ErrorInEditor";if(n.getViewDefinition(i._type,a)){var s=n.createView(this._environment.getDataItemFactory().createDataItem(i),a);e.showProxy(s)}else e.showErrorIndicator(t.code,t.description)},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._validateAfterSave)}})}),define.Class("wixapps.core.logics.TwoLevelCategoryLogic",function(e){var t=e;t.inherits("wixapps.core.logics.CategoryLogic"),t.methods({_getItemsCollection:function(){return this._getTopLevelCollection()},_getTopLevelItemType:function(){return this._dsp("topLevelItemType","Category")},_getMidLevelItemType:function(){return this._dsp("midLevelItemType","Section")},_getTopLevelCollection:function(){return this._dsp("topLevelCollection","Categories")},_getMidLevelCollection:function(){return this._dsp("midLevelCollection","Sections")},_generateCategoriesComboSection:function(e,t,i,n){return this._generateCategoriesCombo(e,t,i,n)},_createCategoryListData:function(e){for(var t,i=[],n=0;e.length>n;n++){t=e[n].getValue(),i.push({value:this._getTopLevelCollection()+"/"+t._iid,label:t.title});for(var a=this._getDescriptorValue(["dataEditing","typeMetaData",e[n].getTypeName(),"childrenField"]),s=e[n].getChildByRef(a).getChildren(),o=0;s.length>o;o++){var r=s[o];r.getTypeName()==this._getMidLevelItemType()&&i.push({value:this._getMidLevelCollection()+"/"+r.getChildValue("_iid"),label:" - "+r.getValue().title})}}return i}})}),define.Class("wixapps.core.logics.page.AppBuilderPageLogic",function(e){var t=e;t.inherits("wixapps.core.logics.page.PageLogicBase"),t.fields({_environment:null}),t.methods({initialize:function(e,t){this._environment=e,this._type=t},generateLinkParams:function(e){return e.getChildValue("_type")!==this._type?{}:{title:e.getChildValue("title"),params:{itemId:e.getChildValue("_iid")}}},uriFromParams:function(e){var t="";return e.itemId&&(t=e.itemId),t},paramsFromUri:function(e){var t={};return t.itemId=e,t},fetchDataItem:function(e,t,i){var n=this._environment.getAppInstance().getDataProviders().getWixDbDataProvider();n.readItem(e.itemId,t,i)},fetchSampleDataItem:function(e,t){var i=this._environment.getAppInstance().getDataProviders().getWixDbDataProvider(),n=i.queryLocalStore(this._type,{},{},0,1);n&&0!==n.length?e(n[0]):i.query(this._type,{},{},0,1,function(t){if(t&&t.length>0)e(t[0]);else{var i=this._environment.getAppInstance(),n=i.getDataItemFactory(),a=n.createDataItem({_type:this._type,_iid:"SampleData"});i.getTypesManager().applyDefaults(a),e(a)}}.bind(this),t)}})}),define.Class("wixapps.core.logics.page.EventsPageLogic",function(e){var t=e;t.inherits("wixapps.core.logics.page.PageLogicBase"),t.fields({_environment:null}),t.methods({initialize:function(e){this._environment=e},generateLinkParams:function(e){return{title:e.getChildValue("title"),params:{collectionId:this._getCollectionId(),itemId:e.getChildValue("_iid")}}},_getCollectionId:function(){return"Events"},getSampleDataItem:function(){return{collectionId:"Events",itemId:"Talk1"}},fetchSampleDataItem:function(e,t){this.fetchDataItem(this.getSampleDataItem(),e,t)},fetchDataItem:function(e,t,i){var n=this._environment.getDataService(),a=e.collectionId,s=e.itemId,o=function(e){var n=this._environment.options.acceptableTypes;!n||n.length>0||n.contains(e.getTypeName())?t(e):i({code:-10003,description:"Page expected ["+n+" ] but received "+e.getTypeName()})}.bind(this),r=function(e){i(e)}.bind(this),l=n.readItemFromCache(a,s);l?t(l):this._environment.getDataService().readItem(a,s,o,r)}})}),define.Class("wixapps.core.logics.page.ItemFromPageLogic",function(e){var t=e;t.inherits("wixapps.core.logics.page.PageDependentLogicBase"),t.utilize(["wixapps.core.utils.SocialShareHandler"]),t.fields({_environment:null}),t.binds(["_handleShareRequest"]),t.methods({initialize:function(e){this._environment=e,this._sharer=new this.imports.SocialShareHandler},_onBeforeItemRendered:function(e){e.addEvent("sharePost",this._handleShareRequest)},_handleShareRequest:function(e){var t="",i=e.data.getChildValue("_type");"PhotoPost"==i&&(t=e.data.getChildValue("photo").src),this._sharer.handleShareRequest(e.params.service,window.location.href,e.data.getChildValue("title"),t)},_onDataLoaded:function(e){var t=this._params.acceptableTypes;if(t&&t.length>0&&!t.contains(e.getTypeName()))throw"Part expected ["+t+" ] but received "+e.getTypeName();this.parent(e)},getDataEditingMetaInfo:function(){var e=this._environment.getAppInstance(),t=e.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",i=this._environment.getAppPart().getPartDef().name;return{title:i,hasDataEdit:!0,hasDataSelection:!1,dataSelectionLabel:"",dataEditingLabel:t}}})}),define.Class("wixapps.core.logics.page.ListFromPageLogic",function(e){var t=e;t.inherits("wixapps.core.logics.page.PageDependentLogicBase"),t.fields({_environment:null}),t.methods({initialize:function(e){this._environment=e},_onDataLoaded:function(e){this.parent(e)},_onBeforeItemRendered:function(e){var t=this._getParentPageLogic().getCurrentPage(),i=this._getParentPageLogic().getPageCount();e.getViewContext().getEnvironment().setVar("pageCount",i),e.getViewContext().getEnvironment().setVar("pageNum",t),e.getViewContext().getEnvironment().setVar("hasPrev",t>0),e.getViewContext().getEnvironment().setVar("hasNext",i-1>t)},getDataEditingMetaInfo:function(){var e=this._environment.getAppInstance(),t=e.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",i=this._environment.getAppPart().getPartDef().name;return{title:i,hasDataEdit:!0,hasDataSelection:!1,dataSelectionLabel:"",dataEditingLabel:t}}})}),define.Class("wixapps.core.logics.page.MenuPageLogic",function(e){var t=e;t.inherits("wixapps.core.logics.page.PageLogicBase"),t.fields({_environment:null}),t.methods({initialize:function(e){this._environment=e},generateLinkParams:function(e){return{title:e.getChildValue("title"),params:{collectionId:this._getCollectionId(),itemId:e.getChildValue("_iid")}}},_getCollectionId:function(){return"Items"},getSampleDataItem:function(){return{collectionId:"Items",itemId:"SampleItem1"}},fetchSampleDataItem:function(e,t){this.fetchDataItem(this.getSampleDataItem(),e,t)},fetchDataItem:function(e,t,i){var n=this._environment.getDataService(),a=e.collectionId,s=e.itemId,o=function(e){var n=this._environment.options.acceptableTypes;!n||n.length>0||n.contains(e.getTypeName())?t(e):i({code:-10003,description:"Page expected ["+n+" ] but received "+e.getTypeName()})}.bind(this),r=function(e){i(e)}.bind(this),l=n.readItemFromCache(a,s);l?t(l):this._environment.getDataService().readItem(a,s,o,r)}})}),define.Class("wixapps.core.logics.page.PageDependentLogicBase",function(e){var t=e;t.inherits("wixapps.core.logics.SingleItemLogic"),t.binds(["_onDataLoaded"]),t.methods({initialize:function(e){this.parent(e)},run:function(e,t,i){this._viewName=e,this._callBacks=i,this._params=t;var n=this,a=function(){var e=n._environment.getAppPart().getViewNode().getParent('[comp$="AppPage"]');if(e&&e.getLogic&&e.getLogic().getPrimaryLogic()&&W.Viewer.isSiteReady()){var t=e.getLogic();n._parentPageLogic=t.getPrimaryLogic(),t.registerForDataItemLoaded(n._onDataLoaded)}else W.Utils.callLater(a)};this._showLoading(i),a()},_getParentPageLogic:function(){return this._parentPageLogic},isDeletable:function(){return!1},_onDataLoaded:function(e){this.onSuccess(e)}})}),define.Class("wixapps.core.logics.page.PageLogicBase",function(e){var t=e;t.inherits("wixapps.core.logics.LogicBase"),t.methods({generateLinkParams:function(){},uriFromParams:function(e){return Object.toQueryString(e)},paramsFromUri:function(e){return this._fromQueryString(e)},_fromQueryString:function(e){var t={};if(void 0!==e&&e.length>0){e=e.split("&");for(var i=0;e.length>i;i++){var n=e[i].split("=");t[n[0]]=unescape(n[1])}}return t},fetchDataItem:function(){}})}),define.Class("wixapps.core.logics.page.QueryPageLogic",function(e){var t=e;t.inherits("wixapps.core.logics.page.PageLogicBase"),t.traits(["wixapps.core.logics.QueryTrait"]),t.binds(["_onDataSaved"]),t.fields({_environment:null}),t.methods({initialize:function(e){this._environment=e,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._onDataSaved),this._currentPage=0,this._pageCount=1},generateLinkParams:function(e,t,i){var n=this._environment.getAppPage().getDataItem().get("pageUriSEO"),a={title:n},s=Object.clone(this._params);switch(i){case"nextPage":this.getPageCount()>this.getCurrentPage()+1&&(s.page=this.getCurrentPage()+1);break;case"prevPage":this.getCurrentPage()>0&&(s.page=this.getCurrentPage()-1);break;case"tag":var o=e.getValue().key||e.getValue();s.filter='{"tags":"'+o+'" }';break;case"query":s=Object.clone(t),delete s.filterType,delete s.filterView,delete s.limit,delete s.resultType}return a.params=this._removeDefaultParams(s),a},_removeDefaultParams:function(e){var t=this._environment.getAppPage().getBaseParams();for(var i in t)e[i]==t[i]&&delete e[i];return delete e.skip,delete e.getTotalCount,e},uriFromParams:function(e){return Object.toQueryString(e)},paramsFromUri:function(e){return this._fromQueryString(e)},_getCollectionId:function(){return this._environment.options.collectionId},fetchSampleDataItem:function(e,t){this.fetchDataItem({collectionId:this._getCollectionId()},e,t)},_onDataSaved:function(){this._params&&this.fetchDataItem(this._params,this._callBacks.onSuccess,this._callBacks.onFailure)},fetchDataItem:function(e,t,i){this._callBacks={onSuccess:t,onFailure:i},this._params=e,e.getTotalCount=!0,this._currentPage=e.page||0,e.skip=this._currentPage*Number(e.limit),this.fetchData(e,t,i),this._limit=e.limit},_setTotalResultCount:function(e){this._totalResult=e,this._pageCount=Math.ceil(e/Number(this._limit))},getCurrentPage:function(){return this._currentPage},getPageCount:function(){return this._pageCount},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._onDataSaved),this.parent()}})}),define.Class("wixapps.core.logics.page.SingleItemPageLogic",function(e){var t=e;t.inherits("wixapps.core.logics.page.PageLogicBase"),t.fields({_environment:null}),t.methods({initialize:function(e){this._environment=e},generateLinkParams:function(e){return{title:e.getChildValue("title"),params:{itemId:e.getChildValue("_iid")}}},_getCollectionId:function(){return this._environment.options.collectionId},fetchSampleDataItem:function(e,t){this._environment.getDataService().query(this._getCollectionId(),null,null,0,1,!1,function(t){e(t[0])},t)},fetchDataItem:function(e,t,i){var n=this._environment.getDataService(),a=e.collectionId,s=e.itemId,o=function(e){var n=this._environment.options.acceptableTypes;!n||n.length>0||n.contains(e.getTypeName())?t(e):i({code:-10003,description:"Page expected ["+n+" ] but received "+e.getTypeName()})}.bind(this),r=function(e){i(e)}.bind(this),l=n.readItemFromCache(a,s);l?t(l):this._environment.getDataService().readItem(a,s,o,r)},uriFromParams:function(e){var t="";return e.itemId&&(t=e.itemId),t},paramsFromUri:function(e){var t={};return t.itemId=e,t}})}),define.Class("wixapps.core.managers.TypesManager",function(e){var t=e;t.utilize(["wixapps.core.data.PrimitiveValidations"]),t.fields({_validator:null,_typesMap:{},_extendingTypes:{}}),t.methods({initialize:function(){this._validator=new this.imports.PrimitiveValidations},getType:function(e){return this._typesMap[e]},getTypeName:function(e){return e.name||e._iid},registerType:function(e){var t=this.getTypeName(e);if(this._typesMap[t]=e,e.baseTypes&&"array"!=typeOf(e.baseTypes))throw"Type ["+t+'] "baseTypes" field should be an array';if(e.baseTypes){for(var i=0;e.baseTypes.length>i;i++){var n=e.baseTypes[i],a=this._extendingTypes[n];a||(a=[],this._extendingTypes[n]=a),a.contains(t)||a.push(t)}var s={},o=function(e){if(this.getBaseTypes(e).forEach(function(e){o(e)}),e.fields)for(var i=0;e.fields.length>i;i++){var n=e.fields[i];if(s[n.name]){if(s[n.name].type!=n.type)throw"Type ["+t+"] is invalid. Field ["+n.name+"] is defined both as ["+n.type+"] and as ["+s[n.name].type+"]"}else s[n.name]=n}}.bind(this);o(e)}},removeType:function(e){for(var t=this._extendingTypes[e]||[],i=0;t.length>i;i++){var n=t[i],a=this._typesMap[n];a.baseTypes&&a.baseTypes.erase(e)}delete this._extendingTypes[e],delete this._typesMap[e]},getExtendingTypes:function(e){var t=function(e,i){var n=this._extendingTypes[e];n&&n.forEach(function(e){t(e,i),i[e]=!0})}.bind(this),i={};return t(e,i),Object.keys(i)},getBaseTypeNames:function(e){return e&&e.baseTypes?e.baseTypes:[]},getBaseTypes:function(e){var t=[];return this.getBaseTypeNames(e).forEach(function(i){var n=this.getType(i);if(!n)throw"Base type ["+i+"] of type ["+this.getTypeName(e)+"] not found";t.push(n)}.bind(this)),t},getField:function(e,t){var i;return this._getInheritanceTreeDFS(e).forEach(function(e){if(e.fields)for(var n=0;e.fields.length>n;n++)e.fields[n].name==t&&(i=this._mergeFieldDefinitions(i,e.fields[n]))}.bind(this)),i},getFields:function(e){var t={};return this._getInheritanceTreeDFS(e).forEach(function(e){if(e.fields)for(var i=0;e.fields.length>i;i++){var n=e.fields[i].name;t[n]=this._mergeFieldDefinitions(t[n],e.fields[i])}}.bind(this)),Object.values(t)},isOf:function(e,t){var i=function(e){if(e==t)return!0;var n=this.getType(e);return this.getBaseTypeNames(n).some(function(e){return i(e,t)})}.bind(this);return i(e,t)},_getInheritanceTreeDFS:function(e){var t={},i=[],n=function(e){var a=this.getTypeName(e);t[a]||(t[a]=!0,i.push(e),this.getBaseTypes(e).forEach(n))}.bind(this);return n(e),i},_mergeFieldDefinitions:function(e,t){return e?(!e.defaultValue&&t.defaultValue&&(e.defaultValue=t.defaultValue),t.validations&&(e.validations=e.validations?e.validations.concat(t.validations):t.validations.clone()),e):Object.clone(t)},applyDefaults:function(e){function t(e){return n[e.collectionId+"/"+e.itemId]}function i(e){n[e.collectionId+"/"+e.itemId]=!0}var n={},a=function(e){if(e.isRef()){var n=e.getValue(0);if(t(n))return e;i(n)}var s=e.getTypeName();if(this.isArray(s))return e.getChildren().forEach(function(e){a(e)}.bind(this)),e;if(this.isSimple(s))return e;var o=this.getType(s);if(!o)return e;for(var r=this.getFields(o),l=0;r.length>l;l++){var p=r[l],d=e.getChildByRef(p.name);if(!d&&void 0!==p.defaultValue){var h=this.isSimple(p.type)?p.defaultValue:this.isArray(p.type)?Array.clone(p.defaultValue):Object.clone(p.defaultValue);e.addChild(h,p.name)}}return e.getChildrenRefs().forEach(function(t){var i=e.getChildByRef(t);a(i)}.bind(this)),e}.bind(this);return a(e)},validateDataItem:function(e){return this._validateDataItem(e,{validations:[]})},_validateDataItem:function(e,t){var i=e.getTypeName(),n=!0;if(e.isRef())return!0;if(t.validations&&t.validations.length>0){var a=e.getValue();n=this.validateValue(a,t)&&n}if("Array"==i)e.getChildren().forEach(function(e){e&&(n=this.validateDataItem(e)&&n)}.bind(this));else if(!this.isSimple(i)){var s=this.getType(i);this.getFields(s).forEach(function(t){if(t.computed!==!0){var i=e.getChildByRef(t.name);i&&(n=this._validateDataItem(i,t)&&n)}}.bind(this))}return e.fireEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,{target:e,valid:n}),n},validateValue:function(e,t){for(var i=t.validations||[],n=0;i.length>n;n++){var a=i[n];if(!this._validator.validate(a.func,e,a.params||[]))return!1}return!0},isSimple:function(e){return e&&e.test(/^(String|Boolean|Number)$/)},isArray:function(e){return e&&e.test(/^Array(<.+>)?$/)},getArrayAllowedTypes:function(e){var t=e&&e.match(/^Array<(.+)>$/),i=[];if(t){var n=t[1];n.split(",").forEach(function(e){i.push(e.trim())})}return i},isRef:function(e){return e&&e.test(/^wix:Ref<.+>$/)},getReferredType:function(e){var t=e&&e.match(/^wix:Ref<(.+)>$/);return t&&t[1].trim()},isNative:function(e){return this.isSimple(e)||this.isArray(e)},getAllTypes:function(){return Object.values(this._typesMap)},getDefaultDataForType:function(e){if(Constants.WixAppsDefaultTypeValues.hasOwnProperty(e))return Constants.WixAppsDefaultTypeValues[e];for(var t=this.getBaseTypeNames(this.getType(e)),i=0;t.length>i;i++){var n=this.getDefaultDataForType(t[i]);if(n)return n}return void 0},getUniqueFieldName:function(e,t,i){var n=this.getType(e),a=function(e){var i=n.fields&&n.fields.some(function(i){return i.displayName===e&&i.name!==t});return!i};if(a(i))return i;for(var s=2;!a(i+" ("+s+")");s++);return i+" ("+s+")"}})}),define.Class("wixapps.core.types.AppBuilderTypesHelper",function(e){var t=e;t.utilize(["wixapps.core.managers.TypesManager"]),t.resources(["W.Utils"]),t.binds(["isDisplayableField","isMandatoryField","isLinkableField"]),t.fields({_nonDisplayableFields:[{key:"name",value:"links"}],_mandatoryFields:[{key:"name",value:"title"}],_linkableFields:[{key:"type",value:"String"},{key:"type",value:"wix:Image"}],_typesManager:null,_utils:null}),t.methods({initialize:function(){this._typesManager=new this.imports.TypesManager,this._utils=this.resources.W.Utils.AppsUtils},_getFields:function(e){if("object"!==this._utils.getType(e))throw"AppBuilderTypesHelper:: invalid type definition. got ["+e+"] of type ["+this._utils.getType(e)+"] instead of an object.";return this._typesManager.getFields(e)},getDisplayableFields:function(e){var t=this._getFields(e);return t.filter(this.isDisplayableField)},getMandatoryFields:function(e){var t=this._getFields(e);return t.filter(this.isMandatoryField)},getLinkableFields:function(e){var t=this._getFields(e);return t.filter(this.isLinkableField)},isDisplayableField:function(e){return this._nonDisplayableFields.some(function(t){return e[t.key]!==t.value})},isMandatoryField:function(e){return this._mandatoryFields.some(function(t){return e[t.key]===t.value})},isLinkableField:function(e){return this._linkableFields.some(function(t){return e[t.key]===t.value})}})}),define.Class("wixapps.core.utils.AppLint",function(e){var t=e;t.binds(["_traverseCompNodes","_traverseLayoutNodes"]),t.fields({_lintRules:{},_traverseCache:{}}),t.methods({initialize:function(){this._lintRules={layout_in_comp:{walkFunc:this._traverseCompNodes,cond:function(e){return e.comp&&e.comp.layout},message:"Layout placed inside the comp instead alongside it."},dimension_in_comp:{walkFunc:this._traverseCompNodes,cond:function(e){return e.comp&&(e.comp.width||e.comp.height)},message:'Width/height placed inside the "comp" instead of the "layout" node.'},dimensions_as_string:{walkFunc:this._traverseLayoutNodes,cond:function(e){return e.width&&"string"==typeOf(e.width)&&!String.contains(e.width,"%")||e.height&&"string"==typeOf(e.height)&&!String.contains(e.height,"%")},message:"Width/height specified as a string where integer number might be used."},hbox_flexbox_conflict:{walkFunc:this._traverseCompNodes,cond:function(e){return e.comp&&"HBox"===e.comp.name&&e.comp.items?Array.some(e.comp.items,function(e){return e.layout&&void 0!==e.layout.width&&void 0!==e.layout["box-flex"]}):void 0},message:'"Width" property superfluous when horizontal "box-flex" specified.'},vbox_flexbox_conflict:{walkFunc:this._traverseCompNodes,cond:function(e){return e.comp&&"VBox"===e.comp.name&&e.comp.items?Array.some(e.comp.items,function(e){return e.layout&&void 0!==e.layout.height&&void 0!==e.layout["box-flex"]}):void 0},message:'"Height" property superfluous when vertical "box-flex" specified.'},box_dimension_100:{walkFunc:this._traverseCompNodes,cond:function(e){if(e.comp&&e.comp.items){if("VBox"===e.comp.name)return Array.some(e.comp.items,function(e){return e.layout&&"100%"==e.layout.height});if("HBox"===e.comp.name)return Array.some(e.comp.items,function(e){return e.layout&&"100%"==e.layout.width})}},message:'Width/height set to "100%" inside HBox/VBox is rendered inconsistently across the browsers.'}}},formatResult:function(e){var t=this._getNodePath,i="* AppLint *\n";return i+=e.length+" warning(s)\n",i+"	"+Array.map(e,function(e){return e.message+"\n"+e.nodes.map(function(e){return"		"+t(e)}).join("\n")}).join("\n	")},lintDescriptor:function(e){var t=this;return e=this._mapRelationships(e),this._traverseCache={},Object.values(this._lintRules).map(function(i){return t._applyRule(i,e)}).filter(function(e){return e})},_applyRule:function(e,t){var i=e.walkFunc(t).filter(e.cond);return i.length>0?{nodes:i,message:e.message}:void 0},_getNodePath:function(e){for(var t=[];e;)t.push(e),e=e._parent;return t.map(function(e){return Object.keys(e).filter(function(e){return["name","id","_iid","forType"].contains(e)}).map(function(t){return e[t]}).join(", ")}).filter(function(e){return e}).reverse().join(" > ")},_memoize:function(e,t){return e in this._traverseCache||(this._traverseCache[e]=t()),this._traverseCache[e]},_traverseCompNodes:function(e){var t=function(e){var i=[];return"array"===typeOf(e)?Array.forEach(e,function(e){i=i.concat(t(e))}):("object"===typeOf(e)&&i.push(e),e.comp&&e.comp.items&&e.comp.items.forEach(function(e){i=i.concat(t(e))}),e.comp&&e.comp.cases&&Object.each(e.comp.cases,function(e){i=i.concat(t(e))}),e.comp&&e.comp.columns&&"Table"==e.comp.name&&e.comp.columns.forEach(function(e){Array.forEach(["item","header","footer"],function(n){void 0!==e[n]&&(i=i.concat(t(e[n])))})})),i};return t(e.views)},_traverseLayoutNodes:function(e){return this._traverseCompNodes(e).map(function(e){return e.layout}).filter(function(e){return e})},_mapRelationships:function(e){var t=function(e,i){var n=typeOf(e);("object"==n||"array"==n)&&Object.each(e,function(i){t(i,e)}),e._parent=i},i=Object.clone(e);return t(i,null),i}})}),define.utils("AppsUtils",function(){var e=0,t=0;return{getTimeBasedUniqueId:function(i){var n=(new Date).getTime();t=n;var a=n===t?++e+"":"";return i=i?i.replace(/[^A-Za-z0-9_-]/g,""):"",i+n.toString(36)+a},getType:function(e){return Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},isRealPublicMode:function(){var e=this.getResourceValueSync("W.Viewer").isPublicMode(),t=window.viewMode&&"preview"===window.viewMode&&window.top===window;return e&&!t},getUserRole:function(e){var t=this.isRealPublicMode();if(!t)return e("owner"),void 0;var i=function(t){t.owner===!0?e("owner"):"ACTIVE"===t.status?e("member"):e("none")}.bind(this);resource.getResourceValue("W.SiteMembers",function(e){e.getMemberDetails(i,i)})},getResourceValueSync:function(e){var t=void 0;return resource.getResourceValue(e,function(e){t=e}),t},createTaskRunner:function(){return{_tasks:[],_onDone:null,_done:function(){if(1>this._tasks.length)return this._onDone&&this._onDone(),void 0;var e=this._tasks.shift();e.func(this._done.bind(this))},add:function(e,t){this._tasks.push({name:e,func:t})},run:function(e){this._onDone=e,this._done()}}},deepEquals:function(e,t){var i=void 0!==e&&null!==e,n=void 0!==t&&null!==t;if(i!=n)return!1;var a=typeOf(e),s=typeOf(t);if(a!=s)return!1;switch(a){case"object":var o=Object.keys(e),r=Object.keys(t);if(o.length!=r.length)return!1;for(var l=0;o.length>l;l++){var p=o[l];if(!this.deepEquals(e[p],t[p]))return!1}break;case"array":if(e.length!=t.length)return!1;for(var d=0;e.length>d;d++)if(!this.deepEquals(e[d],t[d]))return!1;break;default:return e===t}return!0},combinePath:function(e,t){return(e.length>0&&"/"===e[e.length-1]?e:e+"/")+(t.length>0&&"/"===t[0]?t.substr(1):t)},urlBuilder:function(e){var t=this;return{_url:e,_params:{},addParam:function(e,t){return this._params[e]=t,this},addParams:function(e){return Object.merge(this._params,e),this},combinePath:function(e){return this._url=t.combinePath(this._url,e),this},toString:function(){var e=0==Object.keys(this._params).length?"":"?"+Object.toQueryString(this._params);return this._url+e}}},JSONNative:new Class({Extends:Request,options:{secure:!0},initialize:function(e){this.parent(e),Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(e){var t=this.response.json=Function.attempt(function(){return JSON.parse(e)});null==t?this.onFailure():this.onSuccess(t,e)}})}}),define.Class("wixapps.core.utils.DataServiceSaver",function(e){var t=e;t.methods({saveChanges:function(e,t,i){var n,a=e.getItemCache(),s=[],o=[],r=[],l=a.getItemsMarkedAsDeleted(),p=l.length;a.each(function(e,t){(e.isDirty()||!e.getChildValue("_hash"))&&s.push(t)});var d=function(){this._inSaveProcess=!1,r.length>0?i():t(o)}.bind(this),h=function(e,t){return function(){"create"==t?o.unshift(e):o.push(e),s.length+p==o.length+r.length&&d()}},c=function(e){return function(t){n=t,r.push(e),s.length+p==o.length+r.length&&d()}};return s.forEach(function(t){var i=a.get(t);i.getChildValue("_hash")?e.updateItem(a.idsFromKey(t).collectionId,i,h(t,"update"),c(t)):e.createItem(a.idsFromKey(t).collectionId,i,h(t,"create"),c(t))
}),l.forEach(function(t){var i=a.idsFromKey(t);e.deleteItem(i.collectionId,i.itemId,h(t,"delete"),c(t))}),s.length>0||l.length>0?!0:!1},copyChanges:function(e,t,i,n){try{i.forEach(function(i){if(e.isItemMarkedAsDeleted(i))t.remove(i);else{var n=t.put(i,e.get(i).getValue(0));n.resetDirtyFlag()}})}catch(a){var s=n.getLogger();s.reportError(s.Errors.UNABLE_TO_REFRESH_AFTER_SAVE,this.$className,"onSuccess",s.SubCategory.DATA_EDITING)}},deleteItem:function(){}})}),define.Class("wixapps.core.utils.DataTypesUtils",function(e){var t=e;t.fields({_wixTypeMap:{string:"String",number:"Number","boolean":"Boolean",object:"wix:Object"},_typeDefaultValues:{String:"",Number:0,Boolean:!0}}),t.methods({initialize:function(){},generateTypeDefinitionFromData:function(e,t,i){var n=Object.keys(t).map(function(e){var n=this._wixTypeMap[typeOf(t[e])],a=i?t[e]:this._typeDefaultValues[n];return{_type:"wix:Field",name:e,type:n,defaultValue:a}}.bind(this)).filter(function(e){return Boolean(e.type)});return{_iid:e,_type:"wix:Type",fields:n}}})}),define.component("wixapps.core.utils.ListCursor",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.traits([]),t.skinParts({}),t.states(),t.dataTypes(),t.fields({_currentItemIndex:-1}),t.methods({initialize:function(e,t){this._data=e,0>t?this.removeSelection():this.setSelectedIndex(t)},next:function(){this.setSelectedIndex(this._currentItemIndex+1)},prev:function(){this.setSelectedIndex(this._currentItemIndex-1)},last:function(){this.setSelectedIndex(this._getItemsLength()-1)},first:function(){this.setSelectedIndex(0)},_getItemsLength:function(){return this._data.getChildren().length},setSelectedIndex:function(e,t){var i=this._currentItemIndex,n=this._getItemsLength();this._currentItemIndex=0===n?-1:e>=n?0:0>e?n-1:e,t||this.fireChangeEvent(this._currentItemIndex,i)},removeSelection:function(){this._currentItemIndex=-1},fireChangeEvent:function(e,t){this.fireEvent(Constants.WixAppEvents.SELECTED_INDEX_CHANGED,{index:e||this._currentItemIndex,oldIndex:void 0===t?-1:t})},getCurrentItemIndex:function(){return this._currentItemIndex}})}),define.Class("wixapps.core.utils.Map",function(e){var t=e;t.fields({_keys:[],_values:[]}),t.methods({get:function(e){var t=this._keys.indexOf(e);return t>-1?this._values[t]:void 0},put:function(e,t){var i=this._keys.indexOf(e);-1===i?(this._keys.push(e),this._values.push(t)):this._values[i]=t},containsKey:function(e){return this._keys.indexOf(e)>-1},containsValue:function(e){return this._values.indexOf(e)>-1},remove:function(e){var t=this._keys.indexOf(e);if(t>-1){var i=this._values[t];return this._keys.splice(t,1),this._values.splice(t,1),i}return void 0},getKeys:function(){return this._keys.concat()},getValues:function(){return this._values.concat()},getEntries:function(){return this._keys.map(function(e,t){return{key:e,value:this._values[t]}}.bind(this))},clear:function(){this._keys=[],this._values=[]}})}),define.Class("wixapps.core.utils.SocialShareHandler",function(e){var t=e;t.utilize(["core.components.image.ImageUrlNew","wixapps.core.utils.WixAppsLogger","wixapps.integration.managers.WixAppsLocalizer"]),t.resources(["W.Viewer","W.MessagesController"]),t.statics({GOOGLE_SHARE_URL:"https://plus.google.com/share?url=",FANCY_SHARE_URL:"http://www.thefancy.com/fancyit?ItemURL=",PINTEREST_SHARE_URL:"http://pinterest.com/pin/create/button/?url=",TWITTER_SHARE_URL:"https://twitter.com/share?url=",FACEBOOK_SHARE_URL:"http://www.facebook.com/sharer.php?u="}),t.methods({initialize:function(){this._imgUtils=new this.imports.ImageUrlNew,this._logger=new this.imports.WixAppsLogger,this._localizer=new this.imports.WixAppsLocalizer},handleShareRequest:function(e,t,i,n){this.resources.W.Viewer.isPublicMode()?(this._service=e,this._url=t,this._title=i,this._imageUrl=n,this._processShareRequest()):this._dismissShareRequest()},_processShareRequest:function(){var e="";switch(this._service){case"google":e=this._getGoogleShareUrl();break;case"fancy":e=this._getFancyShareUrl();break;case"pinterest":e=this._getPinterestShareUrl();break;case"twitter":e=this._getTwitterShareUrl();break;case"facebook":e=this._getFacebookShareUrl()}this._logger.reportEvent(this._logger.Events.USER_SHARED_PAGE,{c1:encodeURIComponent(this._url),c2:this._service}),window.open(e,"_blank")},_getGoogleShareUrl:function(){var e=this.GOOGLE_SHARE_URL;return e+=this._getSharePageURL()},_getFancyShareUrl:function(){var e=this.FANCY_SHARE_URL;return e+=this._getSharePageURL(),e+="&Title="+this._getShareTitle(),e+="&ImageURL="+this._getImageUrl()},_getPinterestShareUrl:function(){var e=this.PINTEREST_SHARE_URL;return e+=this._getSharePageURL(),e+="&media="+this._getImageUrl(),e+="&description="+this._getShareTitle()},_getTwitterShareUrl:function(){var e=this.TWITTER_SHARE_URL;return e+=this._getSharePageURL()+encodeURIComponent("\n"),e+="&text="+this._getShareTitle()},_getFacebookShareUrl:function(){var e=this.FACEBOOK_SHARE_URL;return e+=this._getSharePageURL(!0),e+="&t="+this._getShareTitle()},_dismissShareRequest:function(){var e=this._localizer.localize("OH_OH_MSG_TITLE"),t=this._localizer.localize("SHARE_BLOCKED_IN_PREVIEW_MSG_DESC");this.resources.W.MessagesController.showMessage(e,t)},_getSharePageURL:function(e){var t="deeplink_referrer=socialB_"+this._service;return this._url=this._addQueryParamToUrl(this._url,t),e&&(this._url=this._url.replace("#!","/#!")),encodeURIComponent(this._url)},_addQueryParamToUrl:function(e,t){var i=e.split("#"),n=-1!=e.indexOf("?")?"&":"?";return i[0]+=n+t,i.join("#")},_getShareTitle:function(){return this._title?encodeURIComponent(this._title):""},_getImageUrl:function(){if(this._imageUrl){var e=this._imgUtils.getImageUrlExactSizeKeepRatio({x:250,y:250},this._imageUrl);return encodeURIComponent(e)}return""}})}),define.Class("wixapps.core.utils.UserExperienceKeyHandler",function(e){var t=e;t.fields({}),t.statics({KEYS:{DELETE_ITEM_CONFIRM:"wixapps_delete_item_confirmation",DELETE_FIELD_CONFIRM:"wixapps_delete_field_confirmation"}}),t.methods({setItem:function(e,t){Object.values(this.KEYS).contains(e)&&localStorage.setItem(e,t)},setItemIfNotDefined:function(e,t){this.isSet(e)||this.setItem(e,t)},getItem:function(e){return Object.values(this.KEYS).contains(e)?localStorage.getItem(e):void 0},isSet:function(e){var t=localStorage.getItem(e);return t}})}),define.Class("wixapps.core.utils.WixAppsLogger",function(e){var t=e;t.statics({LISTS_EVENT_SOURCE:60,Type:{ERROR:10,USER_ACTION:40},Category:{EDITOR:1,VIEWER:2,CORE:3,SERVER:4},SubCategory:{GENERAL:0,PROXY:1,APP_LOGIC:2,DATA_SERVICE:3,DATA_ITEMS:4,CORE_WIRING:5,DATA_EDITING:6,APP_BUILDER:7,APP_REPO_SERVICE:8},Severity:{RECOVERABLE:10,WARNING:20,ERROR:30,FATAL:40},Errors:{GENERIC_ERROR:{code:-2e4,description:"WixApps unspecified error"},APP_INSTANCE_NOT_LOADED:{code:-20001,description:"Application instance failed to load"},UNABLE_TO_REFRESH_AFTER_SAVE:{code:-20002,description:"Failed to update views after data save"},UNABLE_TO_LOAD_DATA_ITEM_FROM_PARAMS:{code:-20003,description:"Failed to load data item from url params"},CREATE_ITEM_CALLED_FOR_NON_NEW:{code:-20004,description:"CreateItem called with a non-new item"},UPDATE_ITEM_CALLED_FOR_NEW:{code:-20005,description:"UpdateItem called with a new item"},ITEM_NOT_FOUND:{code:-20006,description:"ReadItem called with unknown item"},WIX_DATA_PROVIDER_DOESNT_EXIST:{code:-20007,description:"Data provider wasn't found in loaded app definition"},FAILED_TO_LOAD_EXTERNAL_APP_MANIFEST:{code:-20008,description:"Failed to load external app manifest"},APP_PART2_FAILED_TO_LOAD:{code:-20009,description:"Failed to load app part"}},Events:{APP_BUILDER_SAVE:{id:100,description:"App builder - save"},APP_BUILDER_PART_ADDED:{id:101,description:"App builder - part added"},APP_BUILDER_FIELD_ADDED:{id:102,description:"App builder - field added"},APP_BUILDER_PART_LOADED:{id:103,description:"App builder - part loaded in published"},APP_BUILDER_ORGANIZE_CLICKED:{id:104,description:"App builder - organized clicked"},APP_BUILDER_PART_ERROR:{id:105,description:"App builder - part error"},USER_SHARED_PAGE:{id:106,description:"User shared page"},APP_BUILDER_PUBLISH:{id:107,description:"App builder - publish"},APP_PART_COPIED:{id:108,description:"App Builder - app part copied"},APP_PART_PASTED:{id:109,description:"App Builder - app part pasted"},APP_PART_DELETED:{id:110,description:"App Builder - List deleted"},APP_BUILDER_APP_LINK_CLICKED:{id:111,description:"App Builder - List Item selected, item will open in separate page"},APP_BUILDER_MOVED_TO_APP_PAGE_IN_PREVIEW:{id:112,description:"App Builder - Moved to app page in preview"},APP_BUILDER_MOVED_TO_APP_PAGE_IN_VIEWER:{id:113,description:"App Builder - Moved to app page in viewer"}}}),t.methods({reportError:function(e,t,i,n,a,s){try{var o={desc:e.description||this.Errors.GENERIC_ERROR.description,errorCode:e.code||this.Errors.GENERIC_ERROR.code,type:this.Type.ERROR,issue:n||this.SubCategory.GENERAL,severity:a||this.Severity.ERROR,category:s||this.getDefaultCategory()};LOG.reportError(o,t,i,{src:this.LISTS_EVENT_SOURCE,desc:e.description})}catch(r){}},reportEvent:function(e,t){try{var i={type:this.Type.USER_ACTION,desc:e.description,biEventId:e.id,biAdapter:"lists",category:this.getDefaultCategory()};t=t||{},t.src=this.LISTS_EVENT_SOURCE,LOG.reportEvent(i,t)}catch(n){}},getDefaultCategory:function(){return W.Viewer.isPublicMode()?this.Category.VIEWER:this.Category.EDITOR}})}),define.Class("wixapps.core.utils.WixServiceTransportBase",function(e){var t=e;t.utilize(["wixapps.core.utils.WixAppsLogger"]),t.resources(["W.Utils"]),t.fields({_logger:null,_appInstance:null}),t.methods({initialize:function(e){this._appInstance=e},_getServiceUrl:function(){},getLogger:function(){return this._logger||(this._logger=new this.imports.WixAppsLogger),this._logger},doRequest:function(e,t,i,n,a){this._doRequestInternal(e,t,i,"POST",n,a)},doGetRequest:function(e,t,i,n,a){this._doRequestInternal(e,t,i,"GET",n,a)},_extractBasePath:function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.hostname},_doRequestInternal:function(e,t,i,n,a,s){s||(s=function(e){throw e.description+" ("+e.code+")"}),a||(a=function(){}),n||(n="POST");var o=function(e){var t=this.getLogger();t.reportError(e,this.$className,"doRequest",t.SubCategory.DATA_SERVICE)}.bind(this),r=function(e){if(e.success)a(e.payload);else{var t={code:e.errorCode,description:e.errorDescription};o(t),s(t)}}.bind(this),l=function(e){var t={code:e.status?e.status:-1,description:e.statusText?e.statusText:"Unspecified error occurred, possibly a connection problem"};o(t),s(t)};this._postJsonRequest(e,t,i,n,r,l)},_postJsonRequest:function(e,t,i,n,a,s){var o=this.resources.W.Utils.AppsUtils.urlBuilder(this._getServiceUrl());o.combinePath(e),o.addParams(t);var r=new this.resources.W.Utils.AppsUtils.JSONNative({url:""+o,urlEncoded:!1,onSuccess:a,onFailure:s,method:n,data:i?JSON.stringify(i):""});r.options=r.options||{},r.options.headers=r.options.headers||{},r.options.headers["If-Modified-Since"]="Sat, 1 Jan 2005 00:00:00 GMT",r.options.headers["Content-Type"]="application/json; charset=utf-8",r.options.headers.Accept="application/json",r.send()}})}),define.Class("wixapps.core.views.ProxyFactory",function(e){var t=e;t.utilize(["wixapps.core.events.ProxyEventBus","wixapps.core.views.ViewEnvironment","wixapps.core.views.ViewContext","wixapps.core.data.DataItemUtils","wixapps.core.expressions.EvalScopeWrapper","wixapps.core.views.ViewEvaluationContext"]),t.fields({_viewRepository:null,_dataItemFactory:null,_typesManager:null,_managers:null,_defaultByTypeAndMode:{},_byName:{},_eventDispatcher:null,_resourceResolverFunction:null,_lifecycleManager:null,_dataItemUtils:null,_defaultTypeForProxy:{}}),t.methods({initialize:function(e,t,i,n,a,s,o,r){this._viewRepository=i,this._dataItemFactory=e,this._typesManager=t,this._eventDispatcher=n||new this.imports.ProxyEventBus,this._resourceResolverFunction=a,this._nameSpace=s,this._lifecycleManager=o,this._hostingComponent=r,this._dataItemUtils=new this.imports.DataItemUtils},registerProxy:function(e,t,i,n){this._byName[e]=t,n=n||[],n.forEach(function(t){this._defaultByTypeAndMode[t.forType+"|"+t.forMode]=e}.bind(this)),i=i||"",this._defaultTypeForProxy[e]=i},createView:function(e,t,i){i=i||"view";var n=new this.imports.ViewEnvironment(this._dataItemFactory,this._typesManager,this,t,e.getTypeName(),i,this._eventDispatcher,[],void 0,void 0,this._lifecycleManager),a=new this.imports.ViewContext(n,e);return this._createViewInternal(a,t)},getViewDefinition:function(e,t){var i=this._viewRepository.getViewDefinition(e,t);if(i)return i;for(var n=this._typesManager.getBaseTypeNames(this._typesManager.getType(e)),a=0;n.length>a;a++){var s=this.getViewDefinition(n[a],t);if(s)return s}return void 0},hasViewDefinition:function(e,t){var i=this._viewRepository.hasViewDefinition(e,t);if(i)return!0;for(var n=this._typesManager.getBaseTypeNames(this._typesManager.getType(e)),a=0;n.length>a;a++){var s=this.hasViewDefinition(n[a],t);if(s)return!0}return!1},getDefaultProxy:function(e,t){var i=this._defaultByTypeAndMode[e+"|"+t];if(i)return i;for(var n=this._typesManager.getBaseTypeNames(this._typesManager.getType(e)),a=0;n.length>a;a++){var s=this.getDefaultProxy(n[a],t);if(s)return s}return void 0},getProxyClassByName:function(e){return this._byName[e]},_createViewInternal:function(e,t){var i=e.getData().getTypeName(),n=e.getEnvironment(),a=this.getViewDefinition(i,t);if(!a)throw"View definition ["+t+"] for type ["+i+"] is missing in the repository";var s=a.getChildValue("mode")||n.getMode()||"view",o=a.getChildByRef("comp");if(!o||!o.getChildValue("name"))throw"View definition ["+t+"] for type ["+i+"] is incorrect. Missing comp.name attribute";var r=a.getChildValue("forType");n.setViewName(t),n.setVar("viewName",t),n.setForType(r),n.setVar("viewDataType",i),n.setMode(s),n.getTreePath().pushScope(),n.addIncludedView(r,t),this._setupViewVariables(n,a),a=this.createNewEvaluationScope(a,e);var l=this.createProxyFromItemDefinition(e,a);return l.proxy},_resolveItemDataForProxy:function(e,t,i){var n=e.resolveTypeForPath(t);if(n||(n=this._defaultTypeForProxy[i]),!n)throw"Unable to resolve Type of field ["+t+"] in item ["+JSON.stringify(e.getData().getValue())+"]";var a,s=this._typesManager.getType(e.getData().getTypeName()),o=this._typesManager.getField(s,t);if(o&&o.hasOwnProperty("defaultValue")&&(a=this._dataItemFactory.createDataItem(o.defaultValue)),!a){var r=this._typesManager.getDefaultDataForType(n);if(void 0===r)throw"Unable to resolve default value for type ["+n+"] it might be missing in the ProxyMap";a=this._dataItemFactory.createDataItem(r)}return a},createProxyFromItemDefinition:function(e,t){var i=t.getChildValue("id"),n=e.getEnvironment();if(!i)throw"ID not defined for an item in ["+JSON.stringify(t.getValue())+"] in view for ["+n.getForType()+"|"+n.getViewName()+"]";var a=t.getChildByRef("value"),s=e.getData(),o=this._dataItemFactory,r=t.getChildByRef("comp")||t.addChild({},"comp"),l=!0;if(a){var p=o.createDataItem(t.getChildValue("value"));t.getChildByRef("value").addEvent(Constants.DataItemEvents.CHANGE,function(){p.setValue(t.getChildValue("value"))}),s=p}else{var d=t.getChildValue("data")||"this";if(s=e.evaluatePath(d),!s){l=!1;var h=this._resolveProxyName(e.getData().getTypeName(),r,n.getViewName(),n.getForType(),n.getMode());"view"===h.type?(r=o.createDataItem({name:"Empty"}),s=o.createDataItem({})):s=this._resolveItemDataForProxy(e,d,h.name)}if(!s)throw"Evaluation of ["+d+"] on type ["+e.getData().getTypeName()+"] did not generate child context"}var c=this._createProxy(e,s,r,i);return c.setIsBound(l),{id:i,proxy:c}},_createProxy:function(e,t,i,n){var a=e.getEnvironment(),s=i.getChildValue("mode")||a.getMode(),o=t.getTypeName(),r=a.getViewName(),l=this._resolveProxyName(o,i,r,a.getForType(),s);if(!l.name)throw"Cannot resolve view/proxy for type ["+o+"] in mode ["+s+"] in context of view ["+r+"]";if("view"==l.type)return e=e.newContextForData(t),this._createViewInternal(e,l.name);i.getParent()&&"new"===i.getParent().getChildValue("scope")&&(e=e.newContextForData(t));var p=this._byName[l.name];if(!p)throw"Proxy ["+l.name+"] for type ["+o+"] in mode ["+s+"] is not registered in factory";return new p(e,t,i,n)},_setupViewVariables:function(e,t){var i=t.getChildByRef("vars");if(i)for(var n=i.getChildrenRefs(),a=0;n.length>a;a++){var s=n[a],o=i.getChildByRef(s);e.setVar(s,o.getValue(0)),o.addEvent(Constants.DataItemEvents.CHANGE,function(e,t,i){return function(){e.setVar(t,i.getValue(0))}}(e,s,o))}},resolveResourcePath:function(e){return this._resourceResolverFunction&&this._resourceResolverFunction(e)||e},getNameSpace:function(){return this._nameSpace},getHostingComponent:function(){return this._hostingComponent},_resolveProxyName:function(e,t,i,n){var a=t.getChildValue("name"),s=a||i;if(this.hasViewDefinition(e,s))return{name:s,type:"view"};if(a)return{name:a,type:"proxy"};throw"Component [name] was not defined in view ["+i+"|"+n+"] for data type ["+e+"]"},createNewEvaluationScope:function(e,t){if(this._dataItemUtils.findExprItems(e).length>0){var i=new this.imports.ViewEvaluationContext(t),n=new this.imports.EvalScopeWrapper(e,i,t.getEnvironment());return n.getData()}return e}})}),define.Class("wixapps.core.views.ViewBuilder",function(e){var t=e;t.utilize(["wixapps.core.views.ViewsCustomizer","wixapps.core.managers.TypesManager","wixapps.integration.managers.AppBuilderLocalizer"]),t.resources(["W.Utils"]),t.fields({_delimiter:"_",_typesManager:null,_types:null,_views:null,_data:null,_templates:null,_fieldTemplates:null,_fieldTemplatesByType:null,_utils:null,_localizer:null,_typesTemplatesMap:null}),t.methods({initialize:function(){if(this._typesManager=new this.imports.TypesManager,this._localizer=new this.imports.AppBuilderLocalizer,this._utils=this.resources.W.Utils.AppsUtils,!Constants)throw"ViewBuilder:: where is Constants?";Constants.AppBuilderViewTemplates&&this.registerTemplates(),Constants.AppBuilderTemplates&&this.registerBundles(),this._buildTypesTemplateMap()},registerBundles:function(){for(var e in Constants.AppBuilderTemplates)if(Constants.AppBuilderTemplates.hasOwnProperty(e)){var t=Constants.AppBuilderTemplates[e];this._registerTypes([t.type]),this._registerData(t.data),this._registerViews([t.view]),this._registerTemplates([t.template])}},registerTemplates:function(){var e=Constants.AppBuilderViewTemplates;this._registerTypes(e.types),this._registerData(e.data),this._registerViews(e.views),this._registerTemplates(e.templates),this._registerFieldTemplates(e.fieldTemplates)},_buildTypesTemplateMap:function(){this._typesTemplatesMap={};for(var e in this._fieldTemplates)if(this._fieldTemplates.hasOwnProperty(e)){var t=this._fieldTemplates[e];t.hasOwnProperty("category")&&(this._typesTemplatesMap.hasOwnProperty(t.category)?this._typesTemplatesMap[t.category].push(e):this._typesTemplatesMap[t.category]=[e])}},getViewTemplateDefinition:function(e){var t=this._getTemplateDef(e),i={id:t.id,friendlyName:this._localizer.localize("TEMPLATE_BUNDLE_NAME_"+t.id),description:this._localizer.localize("TEMPLATE_BUNDLE_DESC_"+t.id),defaultWidth:t.defaultWidth,type:null,view:null,data:null};i.type=this._getTypeDef(t.type),i.type.name=i.type.name+this._delimiter+this._utils.getTimeBasedUniqueId(),i.type.displayName||(i.type.displayName=this._localizer.localize("TEMPLATE_BUNDLE_TYPE_NAME_"+t.id)),i.view=this.imports.ViewsCustomizer.fillMissingIds(this._getViewDef(t.type,t.viewName)),i.view.forType=i.type.name,i.view.name=this._utils.getTimeBasedUniqueId(i.view.name+this._delimiter);var n,a,s;for(a=t.data.length,i.data=[],n=0;a>n;n++)s=this._getDataItem(t.data[n]),s._iid=this._utils.getTimeBasedUniqueId(s._iid+this._delimiter)+this._delimiter+n,s._type=i.type.name,i.data.push(s);return i=this._addPredefinedExtraFields(i,t.extraFields)},_addPredefinedExtraFields:function(e,t){if(!t||0===t.length)return e;for(var i=0;t.length>i;i++){var n=t[i],a=e.type.fields.some(function(e){return e.name===n.typeField.name});if(a===!0)throw"ViewBuilder:: field with name ["+n.typeField.name+"] already defined for type ["+e.type.name+"] ";e.type.fields.push(n.typeField);var s=this.getDefaultExtraFieldParams(e.view,n.containerId);n.hasOwnProperty("params")&&(s=Object.merge(s,n.params));var o=this.createFieldDefinitionFromTemplate(n.typeField.name,n.fieldTemplateName,n.typeField.type,s);if(this.addFieldToView(e.view,n.containerId,o),n.typeField.hasOwnProperty("defaultValue")||(n.typeField.defaultValue=this._typesManager.getDefaultDataForType(n.typeField.type)),n.typeField.hasOwnProperty("defaultValue")&&void 0!==n.typeField.defaultValue)for(var r=0;e.data.length>r;r++){var l=e.data[r];l[n.typeField.name]=n.typeField.defaultValue}}return e},getTemplateBundles:function(){var e=Object.values(this._templates),t=e.filter(function(e){return e.hasOwnProperty("showOrder")});t.sort(function(e,t){return e.showOrder-t.showOrder});var i=e.filter(function(e){return!e.hasOwnProperty("showOrder")});i.sort(function(e,t){return e.id>t.id});var n=[].concat(t,i);return n},getListViewTemplateDefinition:function(e){var t=this._getViewDef("Array","ListTemplate");return t=this._localizer.localizeView(t),this.imports.ViewsCustomizer.fillMissingIds(t),t.name=e,this.imports.ViewsCustomizer.applyRule(t,{fieldId:"listItem",key:"comp.name",mode:"view",value:e}),t},_registerInner:function(e,t,i){var n,a,s=e.length;for(n=0;s>n;n++)a=e[n],i[t(a)]=a},_registerTypes:function(e){this._types=this._types||{},this._registerInner(e,function(e){return e.name},this._types)},_registerViews:function(e){this._views=this._views||{},this._registerInner(e,function(e){return e.forType+"|"+e.name},this._views)},_registerData:function(e){this._data=this._data||{},this._registerInner(e,function(e){return e._iid},this._data)},_registerTemplates:function(e){this._templates=this._templates||{},this._registerInner(e,function(e){return e.id},this._templates)},_registerFieldTemplates:function(e){this._fieldTemplates=this._fieldTemplates||{},this._fieldTemplatesByType=this._fieldTemplatesByType||{},this._registerInner(e,function(e){return e.forType+"|"+e.name},this._fieldTemplates);var t,i,n=e.length;for(t=0;n>t;t++){i=e[t];var a=i.forType,s=i.forType+"|"+i.name;this._fieldTemplatesByType[a]||(this._fieldTemplatesByType[a]=[]),this._fieldTemplatesByType[a].push(s)}},_getTypeDef:function(e){if(this._types.hasOwnProperty(e))return Object.clone(this._types[e]);throw"ViewBuilder:: type ["+e+"] doesn't exist"},_getViewDef:function(e,t){var i=e+"|"+t;if(this._views.hasOwnProperty(i))return Object.clone(this._views[i]);throw"ViewBuilder:: view for type ["+e+"] with name ["+t+"] doesn't exist"},_getDataItem:function(e){if(this._data.hasOwnProperty(e))return Object.clone(this._data[e]);throw"ViewBuilder:: data item ["+e+"] doesn't exist"},_getTemplateDef:function(e){if(this._templates.hasOwnProperty(e))return this._templates[e];throw"ViewBuilder:: template ["+e+"] doesn't exist"},_getFieldTemplateDef:function(e,t){var i=[e,t].join("|");if(this._fieldTemplates.hasOwnProperty(i))return Object.clone(this._fieldTemplates[i]);throw"ViewBuilder:: field template ["+i+"] doesn't exist"},getTypesAndTemplatesMap:function(){return Object.clone(this._typesTemplatesMap)},getDefaultTemplateKey:function(e){var t=this._getFieldTemplatesByType(e);return t.length>0?t[0]:void 0},_getFieldTemplatesByType:function(e){var t=this._fieldTemplatesByType[e];return Object.values(t)},getExtraFieldContainers:function(e){var t,i,n,a,s,o={},r=this._findCompNames(e,"FieldBox");for(t=0;r.length>t;t++){if(n=r[t],s=[],n.comp.hasOwnProperty("items"))for(i=0;n.comp.items.length>i;i++)a=n.comp.items[i],s.push(a);o[n.id]=s}return o},getViewFieldsMapping:function(e){var t,i,n,a,s,o=[],r=function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&("Field"===e.comp.name||"TextField"===e.comp.name)}.bind(this),l=this._findCompNames(e,"FieldBox");for(t=0;l.length>t;t++){n=l[t];var p=n.id;if(n.comp&&n.comp.editorData&&n.comp.editorData.displayName){var d=n.comp.editorData.displayName;this._localizer.isValidKey(d)&&(d=this._localizer.localize(this._localizer.getKeyValue(d),p)),p=d}if(o.push({containerId:n.id,containerName:p,containerFields:[],hasFields:!1,orientation:n.comp.orientation}),n.comp.items){for(i=0;n.comp.items.length>i;i++)a=n.comp.items[i],r(a)&&(this.isFieldHidden(e,a.id)?this.removeFieldFromView(e,a.id):(s=a.comp.items[0],o[t].containerFields.push({id:a.id,data:a.data,compName:s.comp.name,fieldType:a.comp.name,containerId:n.id,containerName:p})));o[t].containerFields.length>0&&(o[t].hasFields=!0)}}return o},getDefaultExtraFieldParams:function(e,t){var i=this._getExtraFieldContainerById(e,t);return i.comp.editorData},getBaseFieldTemplate:function(e,t,i){var n=this._getFieldTemplateDef(e,t);return this._cleanFieldTemplateDef(n),this._uniqify(n),this._fixFieldTemplateData(n,i),this._localizer.localizeView(n)},createFieldDefinitionFromTemplate:function(e,t,i,n){var a=this.getBaseFieldTemplate(i,t,e);return a=this._applyExtraFieldParamsToFieldDefinition(a,n)},_applyExtraFieldParamsToFieldDefinition:function(e,t){var i=e.comp.name;if("Field"===i&&(e.comp.labelPosition=t.labelPosition||"none",e.comp.spacers=Object.merge({},e.comp.spacers,t.spacers),t.hasOwnProperty("alignment")&&(e.comp["box-align"]=t.alignment)),"TextField"===i){e.comp.labelPosition=t.labelPosition||"none",e.comp.spacers=Object.merge({},e.comp.spacers,t.spacers);var n=e.comp.items[0];t.hasOwnProperty("alignment")&&(n.layout=n.layout||{},n.layout["text-align"]=t.alignment),n.hasOwnProperty("comp")&&t.hasOwnProperty("textStyle")&&(t.textStyle.hasOwnProperty("styleName")&&(n.comp.style=t.textStyle.styleName),t.textStyle.hasOwnProperty("bold")&&(n.comp.bold=t.textStyle.bold))}return e},addFieldToView:function(e,t,i,n){var a=this._getExtraFieldContainerById(e,t),s=a.comp.editorData;delete i.comp["box-align"],delete i.comp.spacers,delete i.comp.labelPosition,i.comp.labelPosition=s.labelPosition||"none",i.comp.spacers=Object.merge({},i.comp.spacers,s.spacers);var o=i.comp.name;if("Field"===o&&s.hasOwnProperty("alignment")&&(i.comp["box-align"]=s.alignment),"TextField"===o){var r=i.comp.items[0];s.hasOwnProperty("alignment")&&(r.layout=r.layout||{},r.layout["text-align"]=s.alignment)}i.comp.hidden=!1,a.comp.items=a.comp.items||[],n=void 0!==n&&n>=0?n:a.comp.items.length,a.comp.items.splice(n,0,i)},removeFieldFromView:function(e,t){for(var i,n=this._findCompNames(e,"FieldBox"),a=0;n.length>a;a++){var s=n[a];s.comp.items&&(s.comp.items=s.comp.items.filter(function(e){return e.id===t&&(i=e),e.id!==t}))}return i},moveField:function(e,t,i,n){var a=this.removeFieldFromView(e,t);a&&this.addFieldToView(e,i,a,n)},replaceFieldInView:function(e,t,i){for(var n=this._getExtraFieldContainerById(e,t),a=0;n.comp.items.length>a;a++){var s=n.comp.items[a];s.id===i.id&&n.comp.items.splice(a,1,i)}},reorderExtraFields:function(e,t,i,n){var a=this._getExtraFieldContainerById(e,t),s=a.comp.items[i];a.comp.items[i]=a.comp.items[n],a.comp.items[n]=s},getPageLinkFields:function(e){return this._find(e,function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&("Field"===e.comp.name||"TextField"===e.comp.name)&&e.comp.hasOwnProperty("pageLink")}.bind(this))},removePageLinks:function(e,t){for(var i=this.getPageLinkFields(e),n=0;i.length>n;n++){var a=i[n].comp;a.pageLink===t&&delete a.pageLink}return e},getViewFieldByTypeField:function(e,t){return results=this._find(e,function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&("Field"===e.comp.name||"TextField"===e.comp.name)&&e.data===t}.bind(this)),results.length>0?results[0]:void 0},_getDisplayedFields:function(e){return this._find(e,function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&"links"!=e.comp.hasOwnProperty("name")&&("Field"===e.comp.name||"TextField"===e.comp.name)&&(e.comp.hasOwnProperty("hidden")===!1||e.comp.hasOwnProperty("hidden")&&(e.comp.hidden===!1||"false"===e.comp.hidden))}.bind(this))},_getHiddenFields:function(e){return this._find(e,function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&("Field"===e.comp.name||"TextField"===e.comp.name)&&e.comp.hasOwnProperty("hidden")&&(e.comp.hidden===!0||"true"===e.comp.hidden)}.bind(this))},isFieldHidden:function(e,t){var i=this._getHiddenFields(e);return i.some(function(e){return e.id===t})},_getExtraFieldContainerById:function(e,t){var i=this._find(e,function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&"FieldBox"===e.comp.name&&e.hasOwnProperty("id")&&e.id===t}.bind(this));if(0===i.length)throw"view ["+e.forType+"|"+e.name+"] has no extra field container with id ["+t+"]";return i[0]},_cleanFieldTemplateDef:function(e){delete e.customizations,delete e.name,delete e.forType,delete e.category},_uniqify:function(e){for(var t,i=this._find(e,function(e){return"string"===this._utils.getType(e)&&e.test(/\[[a-zA-z0-9_-]*?\]/gi)}.bind(this)),n={},a=0;i.length>a;a++){t=i[a].match(/\[[a-zA-z0-9_-]*?\]/gi);for(var s=0;t.length>s;s++)n[t[s]]=t[s].replace(/[\[\]]/gi,"")+this._delimiter+this._utils.getTimeBasedUniqueId()}for(var o=this._find(e,function(e){if("object"===this._utils.getType(e)&&(e.hasOwnProperty("id")||e.hasOwnProperty("fieldId"))){var t=e.id||e.fieldId;return"string"===this._utils.getType(t)&&t.test(/\[[a-zA-z0-9_-]*?\]/gi)}return!1}.bind(this)),r=0;o.length>r;r++){var l,p=o[r];p.hasOwnProperty("id")&&(l="id"),p.hasOwnProperty("fieldId")&&(l="fieldId");for(var d;null!==(d=/\[[a-zA-z0-9_-]*?\]/gi.exec(p[l]));)d=d[0],p[l]=p[l].replace(d,n[d])}return e},_find:function(e,t,i){i=i||function(){return!0};var n=[],a=function(e){if(void 0!==e&&null!==e&&(t(e)&&n.push(e),i(e)))switch(this._utils.getType(e)){case"object":for(var s in e)e.hasOwnProperty(s)&&a(e[s]);break;case"array":for(var o=0;e.length>o;o++)a(e[o])}}.bind(this);return a(e),n},_findCompNames:function(e,t){if("string"===this._utils.getType(t)&&(t=[t]),"array"!==this._utils.getType(t))throw"ViewBuilder::_findCompNames - argument compNames should be string of an array of strings but got '"+t+"'.";return this._find(e,function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&t.contains(e.comp.name)}.bind(this))},_fixFieldTemplateData:function(e,t){for(var i=this._find(e,function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("data")}.bind(this)),n=0;i.length>n;n++){var a=i[n].data.split(".").filter(function(e){return e.length});0===a.length?i[n].data=t:"this"===a[0]?(a[0]=t,i[n].data=a.join(".")):(a=[t].concat(a),i[n].data=a.join("."))}return e},findById:function(e,t){return this._find(e,function(e){return"object"===this._utils.getType(e)&&e.hasOwnProperty("id")&&e.id===t}.bind(this))}})}),define.Class("wixapps.core.views.ViewContext",function(e){var t=e;t.fields({_parent:null,_data:null,_computedFields:{}}),t.methods({initialize:function(e,t,i){this._env=e.newCopy(),this._data=t,this._parent=i},getEnvironment:function(){return this._env},getData:function(){return this._data},getParent:function(){return this._parent},newContextForData:function(e){return new this.constructor(this._env,e,this)},newContextFromPath:function(e){var t=this.evaluatePath(e);return t?new this.constructor(this._env,t,this):void 0},evaluatePath:function(e){return this._evaluatePathRecursive(e.split("."),this._data)},_evaluatePathRecursive:function(e,t){if(0===e.length)return t;var i=e.shift(),n=t,a=-1,s=i.match(/^(.*)\[([0-9]+)\]$/);if(s&&(i=s[1],a=s[2]),"parent"==i)return this._parent?this._parent._evaluatePathRecursive(e,-1==a?this._parent._data:this._parent._data.getChildByIndex(a)):void 0;if("this"==i)return this._evaluatePathRecursive(e,-1==a?this._data:this._data.getChildByIndex(a));if(0===i.indexOf("$")){if(n=this._env.getVar(i.substr(1)),!n)return void 0
}else{if(!n.getChildByRef)return void 0;var o=n.getChildByRef(i);if(n=o?o:this._getComputedChild(n,i),!n)return void 0}if(-1!=a){if(!n.getChildByIndex)return void 0;if(n=n.getChildByIndex(a),!n)return void 0}return this._evaluatePathRecursive(e,n)},_getComputedChild:function(e,t){var i=this._env.getTypesManager(),n=e.getTypeName();if(i.isNative(n)||"wix:Object"==n)return void 0;var a=i.getType(n);if(!a)return void 0;var s=i.getField(a,t);return s&&s.computed===!0?this._env.getDataItemFactory().createComputedField(s.name,s.type,n,e):void 0},resolveTypeForPath:function(e){var t=e.split(".").length>1||0===e.indexOf("$")||0===e.indexOf("parent");if(t)return void 0;var i=this._data.getTypeName(),n=e,a=-1,s=n.match(/^(.*)\[([0-9]+)\]$/);if(s&&(n=s[1],a=s[2]),"this"==n)return i;var o=this._env.getTypesManager(),r=o.getType(i),l=o.getField(r,n);if(!l)return void 0;if(-1==a)return l.type;var p=o.getArrayAllowedTypes(l.type);return p.length>0?p[0]:void 0}})}),define.Class("wixapps.core.views.ViewDefinitionsOverrideRepository",function(e){var t=e;t.fields({_byTypeAndName:{},_baseViewDefRepo:null,_customizations:null,_dataItemFactory:null}),t.methods({initialize:function(e,t,i){this._baseViewDefRepo=e,this._customizations=t,this._dataItemFactory=i},getViewDefinition:function(e,t){var i=this._byTypeAndName[e+"|"+t];if(!i){var n=this._baseViewDefRepo.getViewDefinition(e,t);if(!n)return void 0;var a=n.getValue(0);this._customizations.applyAll(a),i=this._dataItemFactory.createDataItem(a),this._byTypeAndName[e+"|"+t]=i}return i},hasViewDefinition:function(e,t){return this._baseViewDefRepo.hasViewDefinition(e,t)},getAllViewDefinitions:function(){var e=Object.values(this._byTypeAndName);return e.sort(function(e,t){var i=function(e,t){return e>t?1:e==t?0:-1},n=i(e.getChildByRef("forType").getValue(),t.getChildByRef("forType").getValue());return 0!==n?n:i(e.getChildByRef("name").getValue(),t.getChildByRef("name").getValue())}),e}})}),define.Class("wixapps.core.views.ViewDefinitionsRepository",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["_onClonedViewChanged"]),t.utilize(["wixapps.core.data.DataItemFactory","wixapps.core.views.ViewsCustomizer"]),t.fields({_dataItemFactory:null,_clonedTargets:[],_byTypeAndName:{},_byTypeAndNameRaw:{},_byType:{}}),t.methods({initialize:function(e){this._dataItemFactory=e},clone:function(){var e=this.getAllViewDefinitions(),t=this.constructor,i=new t(this._dataItemFactory);return e.forEach(function(e){i.setViewDefinition(e.getValue(0),!0)}),i._byTypeAndNameRaw=this._byTypeAndNameRaw,i},cloneAndMultiply:function(e){var t=[];if("array"==typeOf(e.name)){for(var i=0;e.name.length>i;i++){var n=Object.clone(e);n.name=e.name[i],t.push(n)}return t}return t.push(Object.clone(e)),t},setViewDefinition:function(e,t){var i=e.name,n=e.forType,a=n+"|"+i;this._byTypeAndNameRaw[a]=e;var s=this._byTypeAndName[a];t&&!s&&(s=this.getViewDefinition(n,i)),s&&s.setValue(e);var o=this._byType[n];return o||(o=this._byType[n]=[]),o.push(i),s},removeViewDefinition:function(e){var t=e.forType,i=e.name,n=t+"|"+i;delete this._byTypeAndName[n],delete this._byTypeAndNameRaw[n],this._byType[t],this._byType[t].erase(i)},getViewDefinition:function(e,t){var i=e+"|"+t,n=this._byTypeAndName[i];return!n&&this._byTypeAndNameRaw[i]&&(n=this._dataItemFactory.createDataItem(this._byTypeAndNameRaw[i]),this._byTypeAndName[i]=n,n.addEvent(Constants.DataItemEvents.CHANGE,function(e){this.fireEvent(Constants.DataItemEvents.CHANGE,e),this._clonedTargets.forEach(function(t){t._onClonedViewChanged(e)})}.bind(this))),n},getViewDefinitionsByType:function(e){var t=this._byType[e]||[];return t.map(function(t){return this.getViewDefinition(e,t)}.bind(this))},hasViewDefinition:function(e,t){return!!this._byTypeAndNameRaw[e+"|"+t]},cloneAndListen:function(e){for(var t=e.getAllViewDefinitions(),i=0;t.length>i;i++)this.setViewDefinition(t[i].getValue(),!0),t[i].addEvent(Constants.DataItemEvents.CHANGE,this._onClonedViewChanged);this._byTypeAndNameRaw=e._byTypeAndNameRaw,e._clonedTargets.push(this)},_onClonedViewChanged:function(e){this.setViewDefinition(e.currentTarget.getValue(),!0)},getAllViewDefinitions:function(){var e=Object.values(this._byTypeAndName);return e.sort(function(e,t){var i=function(e,t){return e>t?1:e==t?0:-1},n=i(e.getChildByRef("forType").getValue(),t.getChildByRef("forType").getValue());return 0!==n?n:i(e.getChildByRef("name").getValue(),t.getChildByRef("name").getValue())}),e},toArray:function(){var e=[];return Object.keys(this._byTypeAndNameRaw).forEach(function(t){this._byTypeAndName[t]?e.push(this._byTypeAndName[t].getValue()):e.push(Object.clone(this._byTypeAndNameRaw[t]))}.bind(this)),e.sort(function(e,t){var i=function(e,t){return e>t?1:e==t?0:-1},n=i(e.forType,t.forType);return 0!==n?n:i(e.name,t.name)}),e},getAllViewNamesByType:function(){return this._byType},duplicateListViewDefinition:function(e,t,i,n,a){a||(a=n);var s=this.getViewDefinition("Array",t);s&&(s=s.getValue(),s.forType="Array",s.name=i,s.id=W.Utils.getUniqueId("view"),this.imports.ViewsCustomizer.applyRule(s,{fieldId:"listItem",key:"comp.name",mode:"view",value:i}),e.addViewDefinition(s));var o=e.getViewDefinitions().getViewDefinition(n,t);o=o.getValue(),o.forType=a,o.name=i,e.addViewDefinition(o)}})}),define.Class("wixapps.core.views.ViewEnvironment",function(e){var t=e;t.utilize(["wixapps.core.events.TreePath"]),t.fields({_dataItemFactory:null,_typesManager:null,_proxyFactory:null,_viewName:null,_forType:null,_mode:null,_eventsDispatcher:null,_includedViews:null,_treePath:null,_vars:null}),t.methods({initialize:function(e,t,i,n,a,s,o,r,l,p,d){this._dataItemFactory=e,this._typesManager=t,this._proxyFactory=i,this._viewName=n,this._forType=a,this._mode=s,this._eventsDispatcher=o,r instanceof Array&&(r=this._dataItemFactory.createDataItem(r)),this._includedViews=r,this._vars={parent:l,vars:{}},this._treePath=new this.imports.TreePath(p),this._lifecycleManager=d},newCopy:function(){return new this.constructor(this._dataItemFactory,this._typesManager,this._proxyFactory,this._viewName,this._forType,this._mode,this._eventsDispatcher,this._includedViews,this._vars,this._treePath,this._lifecycleManager)},setViewName:function(e){this._viewName=e},setForType:function(e){this._forType=e},setMode:function(e){this._mode=e},getDataItemFactory:function(){return this._dataItemFactory},getTypesManager:function(){return this._typesManager},getProxyFactory:function(){return this._proxyFactory},getViewName:function(){return this._viewName},getForType:function(){return this._forType},getMode:function(){return this._mode},getEventsDispatcher:function(){return this._eventsDispatcher},getIncludedViews:function(){return this._includedViews.getValue()},getTreePath:function(){return this._treePath},getLifecycleManager:function(){return this._lifecycleManager},addIncludedView:function(e,t){var i=e+"|"+t;-1==this._includedViews.getValue().indexOf(i)&&this._includedViews.addChild(i)},addEventIncludedViewsChanged:function(e){this._includedViews.addEvent(Constants.DataItemEvents.CHANGE,e)},removeEventIncludedViewsChanged:function(e){this._includedViews.removeEvent(Constants.DataItemEvents.CHANGE,e)},getVars:function(){var e=function(t){if(!t)return{};var i=e(t.parent);return Object.each(t.vars,function(e,t){i[t]=e.getValue()}),i};return e(this._vars)},getVar:function(e){for(var t=this._vars;t;t=t.parent){var i=t.vars[e];if(i)return i}return void 0},setVar:function(e,t){var i=this._vars.vars[e];return i?i.setValue(t):(i=this._dataItemFactory.createDataItem(t),this._vars.vars[e]=i),i}})}),define.Class("wixapps.core.views.ViewEvaluationContext",function(e){var t=e;t.fields({_viewContext:null}),t.methods({initialize:function(e){this._viewContext=e},getSymbolResolver:function(){return this},resolveExpressionReference:function(e){return this._viewContext.evaluatePath(e)},evaluateExpressionReference:function(e){var t=this.resolveExpressionReference(e);return t?t.getValue(void 0,this):void 0},listSymbols:function(){var e={};this._data;var t={};return Object.merge(e,t)},inheritsScope:function(e){return!("wixapps.core.data.CompositeDataItem"==e.className&&e.getParent()&&e.getParent().getChildRef&&"templates"==e.getParent().getChildRef(e)&&e.getParent().getChildValue&&"Toggle"!=e.getParent().getChildValue("name"))}})}),define.Class("wixapps.core.views.ViewsCustomizer",function(e){var t=e;t.binds(["addRule"]),t.fields({_byIndex:[],_byTypeAndView:{}}),t.methods({addRules:function(e){e.forEach(this.addRule)},addRule:function(e){var t=this.getByTypeAndView(e.forType,e.view);t.push(this._byIndex.length),this._byIndex.push(e)},replaceRule:function(e){for(var t=-1,i=0;this._byIndex.length>i;i++){var n=this._byIndex[i];if(n.forType===e.forType&&n.view===e.view&&n.fieldId===e.fieldId&&n.mode===e.mode&&n.key===e.key){t=i;break}}-1==t?this.addRule(e):this._byIndex[t]=e},clearRules:function(){this._byIndex=[],this._byTypeAndView={}},getByTypeAndView:function(e,t){var i=e+"|"+t,n=this._byTypeAndView[i];return void 0===n&&(n=[],this._byTypeAndView[i]=n),n},applyToViewDefinitionsRepository:function(e){e.getAllViewDefinitions().forEach(function(e){var t=e.getValue(0);this.applyAll(t),e.setValue(t)}.bind(this))},applyAll:function(e){var t=[];t=t.concat(this.getByTypeAndView(e.forType,e.name)),t=t.concat(this.getByTypeAndView("*",e.name)),t=t.concat(this.getByTypeAndView(e.forType,"*")),t=t.concat(this.getByTypeAndView("*","*")),t.sort(function(e,t){return e-t}),t.forEach(function(t){this.applyRule(e,this._byIndex[t])}.bind(this))}}),t.statics({applyRule:function(e,t){var i=e.mode||"view",n=this._findApplicableFields(e,t);n.forEach(function(e){if("object"==typeof e){var n=e.mode||i;if("*"==t.mode||t.mode==n)for(var a=e,s=t.key.split("."),o=0;s.length>o;o++){var r=s[o];if(o==s.length-1){var l=t.value;/^\s*(\+|-)?\d+\s*$/.test(t.value)&&(l=parseInt(l,10)),void 0===l?delete a[r]:a[r]=l}else a[r]||(a[r]={}),a=a[r]}}})},fillMissingIds:function(e){return this._fillMissingIdsForItem(e,0),e},getCurrentRule:function(e,t){var i=Object.clone(t);return i.value=this.getCurrentValue(e,t),i},getCurrentValue:function(e,t){for(var i=this._findApplicableFields(e,t),n=0;i.length>n;n++)for(var a=i[n],s=t.key.split("."),o=0;s.length>o;o++){var r=s[o];if(o==s.length-1){if(void 0!==a[r])return a[r];break}if(!a[r])break;a=a[r]}return void 0},_findApplicableFields:function(e,t){var i=[];return"vars"==t.fieldId?i.push(e.vars):this._findApplicableFieldsOnItem(e,t,0,i),i},_findApplicableFieldsOnItem:function(e,t,i,n){var a=e.id||e.data||i,s=this;("*"==t.fieldId||t.fieldId==a)&&n.push(e),e.comp&&e.comp.items&&e.comp.items.forEach(function(e,i){s._findApplicableFieldsOnItem(e,t,i,n)}),e.comp&&e.comp.templates&&Object.each(e.comp.templates,function(e){s._findApplicableFieldsOnItem(e,t,0,n)}),e.comp&&e.comp.cases&&Object.each(e.comp.cases,function(e){"array"===typeOf(e)?e.forEach(function(e){s._findApplicableFieldsOnItem(e,t,0,n)}):s._findApplicableFieldsOnItem(e,t,0,n)}),e.comp&&e.comp.columns&&"Table"==e.comp.name&&e.comp.columns.forEach(function(e){Array.forEach(["item","header","footer"],function(i){void 0!==e[i]&&s._findApplicableFieldsOnItem(e[i],t,0,n)})})},_fillMissingIdsForItem:function(e,t){e.id=e.id||e.data||"def_"+t;var i=t+1,n=this;return e.comp&&e.comp.items&&e.comp.items.forEach&&e.comp.items.forEach(function(e){i=n._fillMissingIdsForItem(e,i)}),e.comp&&e.comp.templates&&Object.each(e.comp.templates,function(e){i=n._fillMissingIdsForItem(e,i)}),e.comp&&e.comp.cases&&Object.each(e.comp.cases,function(e){"array"===typeOf(e)?e.forEach(function(e){i=n._fillMissingIdsForItem(e,i)}):i=n._fillMissingIdsForItem(e,i)}),e.comp&&e.comp.columns&&"Table"==e.comp.name&&e.comp.columns.forEach(function(e){Array.forEach(["item","header","footer"],function(t){void 0!==e[t]&&(i=n._fillMissingIdsForItem(e[t],i))})}),i}})}),define.Class("wixapps.core.views.proxies.ArrayProxy",function(e){var t=e;t.inherits("wixapps.core.views.proxies.Proxy"),t.utilize(["wixapps.core.views.ViewContext"]),t.fields({_children:[],_components:[]}),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._loadTemplates()},_createChildren:function(){for(var e=this._data.getChildren(),t=0;e.length>t;t++){var i=e[t];this._addChild(i,t,e.length)}},_getItemTemplate:function(e){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(e)},_addPositionInParentVars:function(e,t,i){var n=e.getEnvironment();n.setVar("indexInParent",t),n.setVar("indexOneInParent",t+1),n.setVar("positionInParent",0===t&&i>1?"first":t==i-1?"last":"middle"),n.setVar("isOddIndexInParent",1==t%2)},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def)},_processDefinitionsChangeList:function(e){this.parent(e);var t=e.filter(function(e){return"templates"==e.path[e.path.length-1]});t.length&&this._loadTemplates()},_addChild:function(e,t,i){var n=this._viewContext.getEnvironment().getProxyFactory(),a=this._viewContext.newContextForData(e),s=this._def.getChildValue("mode");s&&s!=a.getEnvironment().getMode()&&a.getEnvironment().setMode(s),this._addPositionInParentVars(a,t,i);var o=n.createProxyFromItemDefinition(a,this._itemTemplate).proxy;this._children.push(o)},_createChildComponents:function(e){this._children.forEach(function(t){var i=t.createComponent();this._components.push(i),e.grab(i)}.bind(this))}})}),define.Class("wixapps.core.views.proxies.CompositeProxy",function(e){var t=e;t.inherits("wixapps.core.views.proxies.Proxy"),t.utilize(["wixapps.core.views.ViewContext"]),t.fields({_ids:[],_children:[],_components:[],_itemsDefAsRaw:{}}),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n)},_isReloadRequired:function(){var e=this._itemsDefAsRaw,t=this._def.getChildValue("items")||[];if(t.length!=e.length)return!0;for(var i=0;e.length>i;i++){var n=e[i],a=t[i],s=n.comp&&n.comp.name||"unspecified",o=a.comp&&a.comp.name||"unspecified";if(s!=o||n.data!=a.data||n.id!=a.id)return!0}return!1},_createChildProxies:function(){for(;this._children.length>0;){var e=this._children.pop();e.isDisposed()||e.dispose()}this._ids=[],this._components=[];var t=this._def.getChildByRef("items");if(this._itemsDefAsRaw=t?t.getValue():[],t){var i=this._viewContext.getEnvironment().getProxyFactory();t.getChildren().forEach(function(e){var t=i.createProxyFromItemDefinition(this._viewContext,e);this._ids.push(t.id),this._children.push(t.proxy)}.bind(this))}},_createChildComponents:function(e){e.set("html",""),this._components=[],this._children.forEach(function(t){var i=t.createComponent();this._components.push(i),e.grab(i)}.bind(this))},_reloadProxy:function(){},_processDefinitionsChangeList:function(e){if(this.parent(e),!this.isDisposed()){if(e.length&&this._isReloadRequired())return this._reloadProxy(),void 0;var t=e.filter(function(e){return 4==e.path.length&&"layout"==e.path[1]});t.length&&this._onChildLayoutPropertyChange(t)}},_onChildLayoutPropertyChange:function(){}})}),define.Class("wixapps.core.views.proxies.Proxy",function(e){var t=e;t.binds(["_onDataChangedInternal","_onDefinitionsChangedInternal"]),t.utilize(["wixapps.core.data.DataItemUtils"]),t.fields({_viewContext:null,_data:null,_def:null,_disposed:!1,_fieldId:null,_isBound:!0}),t.methods({initialize:function(e,t,i,n){this._viewContext=e,this._data=t,this._def=i,this._fieldId=n,this._dataItemUtils=new this.imports.DataItemUtils,this._validateDataType(),this._setVarsFromDef();var a=i.getChildValue("events");a&&Object.each(a,function(e,t){this._registerProxyEvents(t,this._createTranslator(e))}.bind(this)),this._data.addEvent(Constants.DataItemEvents.CHANGE,this._onDataChangedInternal),this._def.addEvent(Constants.DataItemEvents.CHANGE,this._onDefinitionsChangedInternal)},_createTranslator:function(e){var t,i={};return"object"==typeOf(e)?(t=e.event,Object.each(e,function(e,t){"event"!==t&&(i[t]=e)})):t=e+"",function(e){i.cause=e,this.fireEvent(t,i)}.bind(this)},setIsBound:function(e){this._isBound=e},getIsBound:function(){return this._isBound},isDisposed:function(){return this._disposed},dispose:function(){this._disposed||(this._disposed=!0,this._data.removeEvent(Constants.DataItemEvents.CHANGE,this._onDataChangedInternal),this._data=null,this._def.removeEvent(Constants.DataItemEvents.CHANGE,this._onDefinitionsChangedInternal),this._viewContext=null,this._def=null)},addEvent:function(e,t){this._viewContext.getEnvironment().getEventsDispatcher().addEvent(e,t)},addEventFilteredByScope:function(e,t,i){this._viewContext.getEnvironment().getEventsDispatcher().addEventFilteredByScope(this._viewContext,e,t,i)},removeEvent:function(e,t){this._viewContext.getEnvironment().getEventsDispatcher().removeEvent(e,t)},fireEvent:function(e,t,i){this._viewContext.getEnvironment().getEventsDispatcher().fireProxyEvent(this,e,t,i)},setupProxy:function(){},createComponent:function(){},_registerProxyEvents:function(){},_onDefinitionsChangedInternal:function(e){var t=this._createChangeEventList(e);t.length&&this._processDefinitionsChangeList(t)},_processDefinitionsChangeList:function(e){if(!this._shouldDefinitionChangesBeIgnored(e)){this._setVarsFromDef();var t=e.filter(function(e){return 1==e.path.length});t.length&&this._onDefPropertyChanged(t)}},_shouldDefinitionChangesBeIgnored:function(e){return e.some(function(e){return 1==e.path.length&&"name"===e.path[0]})},_createChangeEventList:function(e){for(var t=[],i=e.events||[{type:e.type,payload:{target:e.target}}],n=0;i.length>n;n++){var a,s=i[n],o=s.payload.action||Constants.DataItemEvents.CHANGE;o==Constants.DataItemEvents.CHANGE?a=s.payload.target:s.payload.target.getChildByRef?a=s.payload.target.getChildByRef(s.payload.ref):s.payload.target.getChildByIndex&&(a=s.payload.target.getChildByIndex(s.payload.index));var r=this._dataItemUtils.getDataItemPath(this._def,a).reverse();t.push({type:o,item:a,path:r})}return t},_onDefPropertyChanged:function(){},_setVarsFromDef:function(){var e=this._def.getChildValue("vars");if(e){var t=this._viewContext.getEnvironment();Object.each(e,function(e,i){t.setVar(i,e)})}},_onDataChanged:function(){},_onDataChangedInternal:function(e){this._disposed||(this._validateDataType(),this._onDataChanged(e))},_validateDataType:function(){var e=this._getAcceptableDataTypes();if(e&&e.length>0){for(var t=this._viewContext.getEnvironment().getTypesManager(),i=this._data.getTypeName(),n=0;e.length>n;n++)if(t.isOf(i,e[n]))return;throw"Proxy "+this.$className+" accepts only ["+e+"] but received ["+i+"]"}},_getAcceptableDataTypes:function(){return[]},getViewContext:function(){return this._viewContext},getData:function(){return this._data},getViewDefinition:function(){return this._def},getFieldId:function(){return this._fieldId},getFullFieldId:function(){return this._viewContext._env.getForType()+"|"+this._viewContext._env.getViewName()+"|"+this._fieldId},setWidth:function(){},getWidth:function(){return 0},getHeight:function(){return 0},setPos:function(){}})}),define.Const("WixApps",{TEXT_STYLES:{Title:"font_0",Menu:"font_1","Page title":"font_2","Heading XL":"font_3","Heading L":"font_4","Heading M":"font_5","Heading S":"font_6","Body L":"font_7","Body M":"font_8","Body S":"font_9","Body XS":"font_10"},TEXT_STYLE_NAMES:{font_0:"Title",font_1:"Menu",font_2:"Page title",font_3:"Heading XL",font_4:"Heading L",font_5:"Heading M",font_6:"Heading S",font_7:"Body L",font_8:"Body M",font_9:"Body S",font_10:"Body XS"},EDIT_TEMPLATE_NAME:"EditPanel"}),define.Const("WixAppEvents",{FULL_DATA_EDITOR_SAVED:"wix:fullDataEditorSaved",APP_PART_RESIZE:"wix:appPartResize",APP_VIEW_READY:"wix:appViewready",APP_VIEW_CREATED:"wix:appViewCreated",APP_ZOOM_READY:"wix:appZoomready",APP_CONTENT_RESIZE:"wix:appContentResize",PROXY_IRRECOVERABLE:"wix:proxyIrrecoverable",TYPE_CHANGE:"wix:typeChange",FIELD_ADDED:"wix:fieldAdded",FIELD_REMOVED:"wix:fieldRemoved",ITEM_CHANGED:"wix:itemChanged",SELECTED_INDEX_CHANGED:"wix:selectedItemChanged",PROXY_SIZE_INVALID:"wix:proxySizeInvalid"}),define.component("wixapps.integration.components.AppPage",function(e){var t=e;t.inherits("core.components.Page"),t.utilize(["wixapps.core.utils.WixAppsLogger"]),t.binds(["_onLogicClassLoaded","_onDataItemLoaded","_onDataItemLoadError"]),t.dataTypes(["AppPage"]),t.resources(["W.Utils"]),t.fields({_itemLoadedCallbacks:[],_isAppBuilder:!1}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._logger=new this.imports.WixAppsLogger},getPrimaryLogic:function(){return this._pagePrimaryLogic},_onAllSkinPartsReady:function(){this._appPageId=this._data.get("appPageId");var e=this._data.get("appInnerID")||"1",t=this.resources.W.Viewer.getAppDataHandler(),i=t.getAppData(e);"appbuilder"==i.type&&(this._isAppBuilder=!0),this._getAppInstance(e,function(e){if(this._appInstance=e,!this._appInstance){var t=this._logger;return t.reportError(t.Errors.APP_INSTANCE_NOT_LOADED,this.$className,"render",t.SubCategory.CORE_WIRING),void 0}this._appInstance.registerAppPage(this)}.bind(this))},initApp:function(){this._pageDefinition=this._appInstance.getPageDefinition(this._appPageId);var e=this._getLogicClassName(this._pageDefinition);W.Classes.get(e,this._onLogicClassLoaded)},_getLogicClassName:function(e){return this._isAppBuilder?e.getLogicClass():e.logic.display.type},_getAppInstance:function(e,t){this._isAppBuilder?this._getWixAppsManager().getApplicationInstance(e,t):t(this._getWixAppsManager().getApp(e))},_getWixAppsManager:function(){return this._isAppBuilder?W.Apps2:W.Apps},_onLogicClassLoaded:function(e){var t=this._pageDefinition.getType?this._pageDefinition.getType():void 0;this._pagePrimaryLogic=new e(this.getEnvironment(),t),this._primaryLogicLoaded=!0,this.fireEvent("pageLogicLoaded"),this._fetchDataItem()},updateParams:function(e){"string"==typeof e&&(e=this._getParams(e)),this._fetchDataItem(e)},_fetchDataItem:function(e){return this._primaryLogicLoaded===!1?(W.Utils.callLater(this._fetchDataItem,[e],this),void 0):(e||(e=this._getParams()),this._pagePrimaryLogic.fetchDataItem(e,this._onDataItemLoaded,this._onDataItemLoadError),void 0)},getBaseParams:function(){var e={};if(this.getEnvironment().options){var t=this.getEnvironment().options;Object.each(t,function(t,i){void 0===e[i]&&(e[i]=t)})}return e},_getParams:function(e){if(void 0===e){var t=W.Utils.hash.getHashParts();e=t.extData}var i=this.getBaseParams(),n=this.getPrimaryLogic().paramsFromUri(e);return i=Object.merge(i,n)},registerForDataItemLoaded:function(e){this._itemLoadedCallbacks.push(e),this._dataItemLoaded&&e(this._dataItem)},getDisplayedDataItem:function(e){this.registerForDataItemLoaded(e)},_onDataItemLoaded:function(e){this._dataItem=e,this._dataItemLoaded=!0,this._itemLoadedCallbacks.each(function(t){t(e)})},_onDataItemLoadError:function(){var e=this.resources.W.Viewer,t=e.getCurrentPageId()===this._data.get("id");if(e.isPublicMode()&&t){this._logger.reportError(this._logger.Errors.UNABLE_TO_LOAD_DATA_ITEM_FROM_PARAMS,this.$className,"_onDataItemLoadError",this._logger.SubCategory.CORE_WIRING);var i=W.Data.getDataMap().SITE_STRUCTURE.get("mainPage");e.goToPage(i.replace("#",""))}else this._pagePrimaryLogic.fetchSampleDataItem(this._onDataItemLoaded,this._onDataItemLoadError)},getLogger:function(){return this._logger},getEnvironment:function(){if(this._isAppBuilder)return this.getAppBuilderEnviroment();if(!this._environment){var e=this;if(this._environment={_context:[{dataService:e._appInstance.getDataService(),itemCache:e._appInstance.getItemCache(),dataItemFactory:e._appInstance.getDataItemFactory()}],getDataItemFactory:function(){return this._getContext().dataItemFactory},getTypesManager:function(){return e._appInstance.getTypesManager()},getDataService:function(){return this._getContext().dataService},getItemCache:function(){return this._getContext().itemCache},getAppInstance:function(){return e._appInstance},getLogger:function(){return e.getLogger()},_getContext:function(){return this._context[this._context.length-1]},getAppPage:function(){return e},getAppPageId:function(){return e.getDataItem().get("appPageId")}},this._pageDefinition.logic.display.options){var t={};Object.each(this._pageDefinition.logic.display.options,function(e,i){t[i]=e}),this._environment.options=t}}return this._environment},getAppBuilderEnviroment:function(){var e=this;return{getAppInstance:function(){return e._appInstance}}}})}),define.component("wixapps.integration.components.AppPart",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["wixapps.core.utils.WixAppsLogger","wixapps.core.views.ViewsCustomizer","wixapps.core.views.ViewDefinitionsOverrideRepository","wixapps.core.dataservice.ItemCache","wixapps.core.dataservice.DataService","wixapps.core.events.ProxyEventBus","wixapps.core.views.ProxyFactory","wixapps.integration.proxies.ProxyMap","wixapps.integration.managers.AppResizeHandler","wixapps.integration.managers.LifecycleManager"]),t.traits(["wixapps.integration.components.traits.SizeRefreshHandler"]),t.binds(["_onLogicLoaded","_onContentResize","_onAppPartRenderComplete","getAppPageUrl"]),t.skinParts({inlineContent:{type:"htmlElement"}}),t.states(["loading","error","rendering","content"]),t.dataTypes(["AppPart"]),t.fields({_eventDispatcher:null,_resizeHandler:null,EDITOR_META_DATA:{general:{help:!1,settings:!0,design:!1},custom:[{label:"EDIT_DATA_BUTTON",command:"WAppsEditorCommands.OpenEditDataDialog",commandParameter:{}}]}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._logger=new this.imports.WixAppsLogger,this._appInstance=null,this._eventDispatcher=new this.imports.ProxyEventBus,this.setState("content"),this._resizeHandler=new this.imports.AppResizeHandler,this._resizeHandler.activateResizeHandler(this._eventDispatcher,this._view),this._lifecycleManager=new this.imports.LifecycleManager(this._eventDispatcher,!0),this._eventDispatcher.addEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize),this.injects().Commands.registerCommand("WViewerCommands.AppDataChange",!0),this.setMaxH(8e3)},render:function(){try{this.getAppInstance()}catch(e){this.setState("error");var t=this._logger;t.reportError(t.Errors.APP_INSTANCE_NOT_LOADED,this.$className,"render",t.SubCategory.CORE_WIRING)}},initApp:function(){if(!this._isDisposed){if(this._appInstance.addEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._onContentResize),this._customizations=new this.imports.ViewsCustomizer(this._appInstance.getDataItemFactory()),this._viewDefinitions=new this.imports.ViewDefinitionsOverrideRepository(this._appInstance.getViewDefRepo(),this._customizations,this._appInstance.getDataItemFactory()),this._applyCustomizationRulesToDefinitions(),this._proxyFactory=new this.imports.ProxyFactory(this._appInstance.getDataItemFactory(),this._appInstance.getTypesManager(),this._viewDefinitions,this._eventDispatcher,this._appInstance.resolveResourcePath,this._appInstance.getPackageName(),this._lifecycleManager,this),(new this.imports.ProxyMap).registerComponentProxies(this._proxyFactory),this._partDef=this._appInstance.getPartDefinition(this._data.get("appPartName")),!this._partDef)throw Error("AppPart.initApp partName ["+this._data.get("appPartName")+"] not found in app descriptor");this._allowHeightResize=this._partDef.allowHeightResize||!1,this._allowHeightResize||(this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]),this._partDef.minWidth&&this.setMinW(this._partDef.minWidth),this._loadPartLogic(),this._view.set("partid",this._appInstance.getPackageName()+"_"+this._partDef.id)}},getCustomizationDefaultValue:function(e,t,i,n){var a={forType:e,viewName:t,fieldId:i,key:n},s=this._appInstance.getViewDefRepo(),o=s.getViewDefinition(e,t);if(!o)throw"View "+e+"|"+t+" not found in repository";return o=o.getValue(0),this._customizations.getCurrentValue(o,a)},_applyCustomizationRulesToDefinitions:function(){this._customizations.clearRules(),this._customizations.addRules(this._data.get("appLogicCustomizations"));var e=this._appInstance.getViewDefRepo();this._viewDefinitions.getAllViewDefinitions().forEach(function(t){var i=e.getViewDefinition(t.getChildValue("forType"),t.getChildValue("name")).getValue(0);this._customizations.applyAll(i),t.setValue(i)}.bind(this)),this.fireEvent("customizationApplied")},getPartDef:function(){return this._partDef},getHelpId:function(){return this._partDef.helpId?this._partDef.helpId:this._appInstance.getAppDescriptor().helpId},getAppPartViewDefRepo:function(){return this._viewDefinitions},getViewDef:function(){return this._mainProxy?this._mainProxy.getViewDefinition():void 0},getViewsCustomizer:function(){return this._customizations},getMainProxy:function(){return this._mainProxy},getAppInstance:function(){return this._appInstance||(this._appInstance=W.Apps.getApp(this._data.get("appInnerID")),this._appInstance.registerAppPart(this)),this._appInstance},getLogger:function(){return this._logger},getLogicParams:function(){var e={};this._partDef.logic.display.options&&Object.each(this._partDef.logic.display.options,function(t,i){e[i]=t});var t=!1,i=this._data.get("appLogicParams");return Object.each(i,function(i,n){"wixapps:first-load-after-add-to-stage"==n?(t=!0,e["wixapps:first-load-after-add-to-stage"]=!0):e[n]=i.value}),t&&delete i["wixapps:first-load-after-add-to-stage"],e},getEnvironment:function(){if(!this._environment){var e=this;this._environment={_context:[{dataService:e._appInstance.getDataService(),itemCache:e._appInstance.getItemCache(),dataItemFactory:e._appInstance.getDataItemFactory()}],getProxyFactory:function(){return e._proxyFactory},getDataItemFactory:function(){return this._getContext().dataItemFactory},getTypesManager:function(){return e._appInstance.getTypesManager()},getDataService:function(){return this._getContext().dataService},getItemCache:function(){return this._getContext().itemCache},getAppPart:function(){return e},getAppInstance:function(){return e._appInstance},getViewDefRepo:function(){return e._appInstance.getViewDefRepo()},getLogger:function(){return e.getLogger()},_getContext:function(){return this._context[this._context.length-1]},newDataServiceContext:function(){var t=this.getDataService(),i=t.getDataItemFactory().clone(),n=new e.imports.ItemCache(i),a=new e.imports.DataService(t.getTransport(),i,n);this._context.push({dataService:a,itemCache:n,dataItemFactory:i})},popDataServiceContext:function(){if(2>this._context.length)throw"no data service context to pop";return this._context.pop().dataService}}}return this._environment},_loadPartLogic:function(){W.Classes.get(this._partDef.logic.display.type,this._onLogicLoaded)},_onLogicLoaded:function(e){var t=this.getEnvironment();this._disposeLogic(),this._logic=new e(t),this.fireEvent("logicLoaded"),this.getViewNode().fireEvent("logicLoaded"),this._runLogic()},_runLogic:function(){var e=this.getLogicParams(),t=this,i={showProxy:function(e){t.setState("rendering"),t._mainProxy&&t._mainProxy.dispose(),t._mainProxy=e,t._lifecycleManager.reset(),t._mainComponent=t._mainProxy.createComponent(),t._skinParts.inlineContent.set("html",""),t._skinParts.inlineContent.adopt(t._mainComponent),t._allowHeightResize&&t._mainProxy.getElement().setStyle("height",t.getHeight()),t._mainProxy.setupProxy(),window.requestAnimFrame(function(){t._lifecycleManager.performAction(t._onAppPartRenderComplete)}),t._setupMainProxyListeners.call(t,t._mainProxy)},showLoadingIndicator:function(){t.setState("loading")},hideLoadingIndicator:function(){t.setState("content")},showErrorIndicator:function(e,i){e=e||-1,i=i||"Unspecified error",t.setState("error");var n=t._logger;n.reportError({code:e,description:i},this.$className,"showErrorIndicator",n.SubCategory.APP_LOGIC)}},n=this._data.get("viewName");n||(n=this._partDef.views[0],this._data.set("viewName",n,!0)),this._logic.run(n,e,i,this._extraLogicParams)},_onAppPartRenderComplete:function(){this.fireEvent("proxyDisplayed",this._mainProxy),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this.setState("content"),window.requestAnimFrame(function(){this._updateHeight()
}.bind(this))},_setupMainProxyListeners:function(e){var t=this;e.addEvent("innerCompResize",function(){t._userResize||t._allowHeightResize||t._wCheckForSizeChangeAndFireAutoSized(1)}),e.addEvent("wix:zoom-link:open-zoom",function(e){var i=e.zoomParams,n=t.getPartDef().zoomPartName,a=t._logic.getZoomExtraParams&&t._logic.getZoomExtraParams(),s=Object.merge(i.extraParams,a);t.getAppInstance().getZoomHandler().openZoomForItemsList(i.list,i.selectedIndex,n,s)}),e.addEvent("wix:edit-link:open-editor",function(e){var i=e.zoomParams,n=t.getPartDef().zoomPartName;t.getAppInstance().getZoomHandler().openZoomForItemsList(i.list,i.selectedIndex,n)}),e.addEvent("wix:app-link:navigate",function(e){t._navigateToAppPage(e)})},getAppPageUrl:function(e,t,i,n){var a;if("samePage"==e&&(e=W.Viewer.getPagesData()[W.Viewer.getCurrentPageId()].get("appPageId")),a=W.Viewer.getAppPages()[e],!a)return this.injects().Utils.callLater(this.getAppPageUrl,[e,t,i,n],this),void 0;var s=this,o=function(){if(!s._isDisposed){var e=a.getPrimaryLogic().generateLinkParams(t,s.getLogicParams(),i),o=a._data.get("id"),r=e.title,l=e.params,p=a.getPrimaryLogic().uriFromParams(l),d=W.Utils.hash.getHashPartsString(o,r,p);n(o,r,p,d)}};a.getPrimaryLogic()?o():a.addEvent("pageLogicLoaded",o)},_navigateToAppPage:function(e){var t=e.appPageId,i=e.dataItem;this.getAppPageUrl(t,i,function(e,t,i){W.Utils.hash.setHash(e,t,i)})},_getMinPhysicalHeight:function(){var e=0;return e=this._mainProxy&&this._mainProxy.getElement()?this._mainProxy.getElement().getSize().y:parseInt(this._view.get("height")||0,10)},_onAllSkinPartsReady:function(){this._activateHandlers(),this._skinParts.inlineContent.setStyles({position:"relative"})},_activateHandlers:function(){},hasChildren:function(){return!1},isContainer:function(){return!1},_onDataChange:function(){this._ignoreUpdate||this._appInstance&&this._runLogic()},getAppPartLogic:function(){return this._logic},_ruleFits:function(e,t){var i=!0;for(var n in t)t[n]!=e[n]&&(i=!1);return i},getCustomization:function(e){var t=[];if(!e)return this._data.get("appLogicCustomizations");for(var i=this._data.get("appLogicCustomizations"),n=i.length-1;n>-1;n--)this._ruleFits(i[n],e)&&t.push(i[n]);return t},clearCustomizations:function(e,t){if(e)for(var i=this._data.get("appLogicCustomizations"),n=i.length-1;n>-1;n--)this._ruleFits(i[n],e)&&i.splice(n,1);else this._data.set("appLogicCustomizations",[]);this._ignoreUpdate=!t,this._data.fireDataChangeEvent(),this._ignoreUpdate=!1,this._applyCustomizationRulesToDefinitions(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))},applyCustomizationRule:function(e,t){var i,n,a=this._data.get("appLogicCustomizations");e.type="AppPartCustomization";for(var s=0;a.length>s;s++)if(i=a[s],i.forType===e.forType&&i.view===e.view&&i.fieldId===e.fieldId&&i.mode===e.mode&&i.key===e.key){n=a.splice(s,1);break}a.push(e),this._ignoreUpdate=!t;var o=n?n[0]:void 0,r=this.getCustomizationDefaultValue(e.forType,e.view,e.fieldId,e.key),l=o?!this.injects().Utils.areObjectsEqual(e,o):r!=e.value;l&&this.injects().Commands.executeCommand("WViewerCommands.AppDataChange",[e,o,this]),this._data.fireDataChangeEvent(this._data,e,o,this,!0),this._ignoreUpdate=!1,this._applyCustomizationRulesToDefinitions(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))},_onResize:function(){return this._mainProxy?(this._allowHeightResize===!1?this.setHeight(this._getMinPhysicalHeight(),!1,!1):this._mainProxy&&this._mainProxy.getElement().setStyle("height",this.getHeight()),this.parent(),this._userResize=!0,this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),this._userResize=!1,void 0):this.parent()},_onContentResize:function(){this._lifecycleManager.performAction(function(){this._updateHeight()}.bind(this))},_updateHeight:function(){this._allowHeightResize===!1&&(this.setHeight(this._getMinPhysicalHeight(),!1,!1),this.fireEvent("autoSizeChange"))},setExtraLogicParams:function(e){this._extraLogicParams=e},getEventDispatcher:function(){return this._eventDispatcher},isDeleteable:function(){return this._logic&&0==this._logic.isDeletable()?!1:!0},_disposeLogic:function(){this._logic&&this._logic.dispose&&this._logic.dispose()},dispose:function(){this._disposeLogic(),this.parent()}})}),define.component("wixapps.integration.components.AppPart2",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["wixapps.integration.managers.ViewHolder","wixapps.integration.utils.GeometryUtils","wixapps.core.utils.WixAppsLogger","wixapps.integration.utils.FunctionCallThrottle"]),t.traits(["wixapps.integration.components.traits.SizeRefreshHandler"]),t.resources(["W.Utils","W.Viewer","W.Commands"]),t.binds(["_onError","_onAppViewReady","_initApp","_retrieveData","_onContentResize","_onResizeEnd","_onViewDefinitionsChanged","_onAppDataChanged","checkSizeLimits"]),t.skinParts({inlineContent:{type:"htmlElement"},error:{type:"htmlElement"}}),t.states(["loading","error","rendering","content"]),t.dataTypes(["AppBuilderComponent"]),t.fields({_viewHolder:null,_allowHeightResize:!1,_appPartDefinition:null,_appInstance:null,_appPartData:null,isWixApps2:!0,_geometryUtils:null,_needsDuplication:!1}),t.methods({initialize:function(){this.parent.apply(this,arguments),this._utils=this.resources.W.Utils.AppsUtils,this._geometryUtils=new this.imports.GeometryUtils,this.setState("loading"),this.addEvent("resizeEnd",this._onResizeEnd),this.setMaxH(8e3),this._checkSizeLimitsDebounce=this.imports.FunctionCallThrottle.debounceFunction(this.checkSizeLimits,500)},_onAllSkinPartsReady:function(){W.Apps2.getApplicationInstance(this._data.get("appInnerID"),function(e){var t;if(!e)return this.setState("error"),t=new this.imports.WixAppsLogger,t.reportError(t.Errors.APP_INSTANCE_NOT_LOADED,this.$className,"_onAllSkinPartsReady",t.SubCategory.APP_BUILDER),void 0;try{this._appInstance=e,e.getViewDefinitions().addEvent(Constants.DataItemEvents.CHANGE,this._onViewDefinitionsChanged),this._viewHolder=new this.imports.ViewHolder(e.getDataItemFactory(),this._appInstance.getTypesManager(),e.getViewDefinitions(),e.resolveResourcePath,"",!0,this),this._viewHolder.setContainer(this._skinParts.inlineContent),this._viewHolder.getEventDispatcher().addEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize);var i=this._appInstance.getAppPartDefinitions(),n=this._data.get("appPartName");this._appPartDefinition=i.getById(n),this._initApp()}catch(a){return this.setState("error"),t=new this.imports.WixAppsLogger,t.reportError(t.Errors.APP_PART2_FAILED_TO_LOAD,this.$className,"_onAllSkinPartsReady",t.SubCategory.APP_BUILDER),void 0}}.bind(this))},_initApp:function(){this._viewName=this._appPartDefinition.getViewName(),this._forType=this._appPartDefinition.getType();var e=this._appPartDefinition.getDataSelectorId(),t=this._appInstance.getDataSelectors();this._dataSelector=t.getById(e),this._dataSelector.isListSelector()?this._dataSelector.getItems(this._retrieveData,this._onError):this._dataSelector.getItem(this._retrieveData,this._onError),this._appPartDefinition.setUsed(!0)},_retrieveData:function(e){this._appPartData=e,this.setState("rendering"),this._viewHolder.getEventDispatcher().addEvent(Constants.WixAppEvents.APP_VIEW_CREATED,this._onAppViewReady),this._viewHolder.setupViewHolder(e,this._viewName),e.addEvent(Constants.DataItemEvents.CHANGE,this._onAppDataChanged)},_onError:function(e){this.setState("error"),this._reportError(e)},getEventDispatcher:function(){return this._viewHolder&&this._viewHolder.getEventDispatcher?this._viewHolder.getEventDispatcher():null},_onAppViewReady:function(){this.setState("content"),this._allowHeightResize===!0?this._viewHolder.setContentHeight(this.getHeight()):this.fireEvent("autoSized"),this._view.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this._reportLoaded()},_onResize:function(){this._viewHolder&&(this._allowHeightResize===!1?this._viewHolder.performActionWhenReady(function(){this.setHeight(this._getMinPhysicalHeight(),!1,!1)}.bind(this)):this._viewHolder&&this._viewHolder.setContentHeight(this.getHeight()),this.parent(),this._viewHolder.getEventDispatcher().fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),this._wCheckForSizeChangeAndFireAutoSized(3))},_onContentResize:function(){this._viewHolder.performActionWhenReady(function(){this._updateHeight()}.bind(this))},_updateHeight:function(){this._allowHeightResize===!1&&this.setHeight(this._getMinPhysicalHeight(),!1,!1),this.fireEvent("autoSizeChange")},_getMinPhysicalHeight:function(){if(this._viewHolder){var e=this._viewHolder.getRootProxy();if(e&&e.getElement())return e.getElement().getSize().y}return parseInt(this._view.get("height")||0,10)},_onResizeEnd:function(){this.checkSizeLimits()},_onViewDefinitionsChanged:function(){this._isDisposed||this._viewHolder.performActionWhenReady(this._checkSizeLimitsDebounce)},_onAppDataChanged:function(){this._isDisposed||this._viewHolder.performActionWhenReady(this._checkSizeLimitsDebounce)},checkSizeLimits:function(e){if(!this._isDisposed){e=void 0===e?0:e,this._viewHolder.getGeometryMap().reset();var t=this._geometryUtils.getOverflowRegions(this._skinParts.inlineContent,this._viewHolder.getGeometryMap());if(t.length>0&&t.length!==e){var i=t.reduce(function(e,t){return Math.max(e,t.left+t.right)},-1/0);if(this.setWidth(this.getWidth()+i),t.length>1)return window.requestAnimFrame(function(){this.checkSizeLimits(t.length)}.bind(this)),void 0}this._viewHolder.invalidateSize()}},getAcceptableDataTypes:function(){return["AppBuilderComponent"]},getAppInstance:function(){return this._appInstance},getAppPartData:function(){return this._appPartData},getAppPartDefinition:function(){return this._appPartDefinition},setAppPartDefinition:function(e){this._appPartDefinition=e},getViewDefinition:function(){return this._appInstance.getViewDefinitions().getViewDefinition(this._forType,this._viewName)},getViewHolder:function(){return this._viewHolder},getUniqueFieldName:function(e,t){return this.getAppInstance().getTypesManager().getUniqueFieldName(this._forType,e,t)},getDataSelector:function(){return this._dataSelector},getAppPageUrl:function(e,t,i,n){var a=function(i){this._pagePrimaryLogic=new i(this.getEnvironment(),this._forType);var a=this._pagePrimaryLogic.generateLinkParams(t),s=a.title,o=a.params,r=this._pagePrimaryLogic.uriFromParams(o),l=W.Viewer.getAppPages()[e];if(l){var p=l._data.get("id"),d=W.Utils.hash.getHashPartsString(p,s,r);n(p,s,r,d)}}.bind(this),s=this._appInstance.getPageDefinition(e),o=s.getLogicClass();W.Classes.get(o,a)},getEnvironment:function(){var e=this;return{getAppInstance:function(){return e._appInstance}}},isDuplicatable:function(){return this.getDataSelector()&&!this.getDataSelector().isPageBased()},isDeleteable:function(){return!this.getDataSelector()||!this.getDataSelector().isPageBased()},getShowOnAllPagesChangeability:function(){return this.getDataSelector()&&!this.getDataSelector().isPageBased()},markNeedsDuplication:function(){this._needsDuplication=!0},onDuplicate:function(e){if(this._needsDuplication){var t=this._forType+"_dup_"+this._utils.getTimeBasedUniqueId();e&&(t=this._forType);var i=this._viewName+"_dup_"+this._utils.getTimeBasedUniqueId();this._appInstance.getViewDefinitions().duplicateListViewDefinition(this._appInstance,this._viewName,i,this._forType,t);var n=this._dataSelector.duplicate(t,e),a=this._appInstance.getAppPartDefinitions(),s=a.createAndRegister(n,i,t);this._appPartDefinition=a.getById(s),this._data.set("appPartName",s),this._needsDuplication=!1,this._initApp()}},_reportLoaded:function(){if(this.resources.W.Viewer.isPublicMode()){var e=this._appInstance.getLogger(),t={c1:this._appInstance.getInstanceId(),c2:this._appPartDefinition.getId(),g2:rendererModel&&rendererModel.userId};e.reportEvent(e.Events.APP_BUILDER_PART_LOADED,t)}},_reportError:function(e){if(this.resources.W.Viewer.isPublicMode()){var t=this._appInstance.getLogger(),i={c1:this._appInstance.getInstanceId(),c2:this._appPartDefinition.getId(),g2:rendererModel&&rendererModel.userId,i1:JSON.stringify(e)};t.reportEvent(t.Events.APP_BUILDER_PART_ERROR,i)}},dispose:function(){this._appInstance&&(this._appInstance.getViewDefinitions()&&this._appInstance.getViewDefinitions().removeEvent(Constants.DataItemEvents.CHANGE,this._onViewDefinitionsChanged),this._appPartData&&this._appPartData.removeEvent(Constants.DataItemEvents.CHANGE,this._onAppDataChanged),this._viewHolder&&(this._viewHolder.getEventDispatcher()&&this._viewHolder.getEventDispatcher().removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewReady),this._viewHolder.dispose())),this._appPartDefinition&&this._appPartDefinition.setUsed(!1),this._viewHolder=null,this._dataSelector=null,this.parent()}})}),define.component("wixapps.integration.components.Area",function(e){var t=e;t.inherits("core.components.Container"),t.skinParts({inlineContent:{type:"htmlElement"}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),"default"===i.styleNS&&(this._styleNameSpace="core.components.Container")},setStyle:function(e){this._setStyleInProgress=!0,this.parent(e),this._setStyleInProgress=!1,this.fireEvent(Constants.DisplayEvents.SKIN_CHANGE)},_replaceSkin:function(e){this.parent(e),this._setStyleInProgress||this.fireEvent(Constants.DisplayEvents.SKIN_CHANGE)}})}),define.component("wixapps.integration.components.ClippedParagraph",function(e){var t=e;t.inherits("wysiwyg.viewer.components.WRichText"),t.utilize(["wixapps.integration.utils.ParagraphLinesMap","wixapps.integration.utils.ParagraphClipping"]),t.skinParts({richTextContainer:{type:"htmlElement"}}),t.propertiesSchemaType("ClippedParagraphProperties"),t.resources(["W.Theme"]),t.fields({_paragraphClipping:null,_paragraphLineMap:null}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._paragraphClipping=new this.imports.ParagraphClipping,this._paragraphLineMap=new this.imports.ParagraphLinesMap},render:function(){this._clipTextContent(),this._setLinksDataToElements("VIEW")},_updateText:function(){},_onAllSkinPartsReady:function(){this.parent(),this.resources.W&&this.resources.W.Theme&&this.resources.W.Theme.addEvent("propertyChange",function(e){if(0===e.name.indexOf("font_")){var t=this._data.get("text"),i=this.getRichTextContainer();this._paragraphClipping.rebuildCache(t,i),this._clipTextContent()}}.bind(this)),this._view.setStyles({overflow:"hidden",position:"absolute",width:this.getWidth(),"white-space":"normal"})},_onDataChange:function(){this.parent(),this._skinParts&&this._clipTextContent()},_clipTextContent:function(){var e=this._data.get("text"),t=parseInt(this.getComponentProperty("maxLines"),10)||0,i=parseInt(this.getComponentProperty("minLines"),10)||0,n=this.getComponentProperty("pack")+"",a=this.getRichTextContainer();a.isVisible()&&(a.setStyles({width:this.getWidth()}),t?this._clipParagraphByLines(e,a,this.getWidth(),i,t,n):this._clipParagraphBySize(e,a,this.getWidth(),this.getHeight()),("true"===this.getComponentProperty("showTooltip")||this.getComponentProperty("showTooltip")===!0)&&(this._paragraphClipping.isClipped()?a.setAttribute("title",e.replace(/<.*?>/gi,"")):a.removeAttribute("title")))},_clipParagraphBySize:function(e,t,i,n){this._paragraphClipping.clipParagraph(e,t,i,n)},_clipParagraphByLines:function(e,t,i,n,a,s){var o=e!==this._paragraphClipping.getLastTextContent();o&&t.set("html",e),this._paragraphClipping.hideEllipsis(),this._paragraphLineMap.updateMap(t),this._paragraphClipping.showEllipsis();var r=Math.min(a,this._paragraphLineMap.getLineNum()),l=this._paragraphLineMap.getParagraphHeight(r),p=l/r;this._paragraphClipping.clipParagraph(e,t,i,l);var d=0;if("none"!==s&&a>r){var h=parseInt((a-r)*p,10);l+=h,"bottom"===s?d=h:"middle"===s&&(d=Math.floor(h/2))}n>0&&(l=Math.max(l,p*n)),t.setStyle("margin-top",d),this.setHeight(l,void 0,!1),this._view.setStyles({height:l}),this.fireEvent("autoSizeChange")},_onResize:function(){(this._isRendered===!0||Browser.ie)&&this.getRichTextContainer().getParents("body").length&&this._clipTextContent()}})}),define.oldComponent({name:"wixapps.integration.components.Expander",skinParts:{icon:{type:"htmlElement"},summary:{type:"htmlElement"},content:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_toggle"],_states:["expand","collapsed"],initialize:function(e,t,i){this.parent(e,t,i),this._createSummary=i.createSummaryFunc,this._createContent=i.createContentFunc,this._initialState=i.initialState,this._noIcon=i.noIcon},_onAllSkinPartsReady:function(e){this._noIcon&&e.icon.hide(),e.icon.addEvent("click",this._toggle),e.summary.addEvent("click",this._toggle),this._createSummary(e.summary),this._createContent(e.content),this.setState(this._initialState||"expand")},setOpen:function(){this.setState("expand")},setClosed:function(){this.setState("collapsed")},_toggle:function(){"expand"==this.getState()?this.setClosed():this.setOpen()},_onResize:function(){this.parent()}}}),define.component("wixapps.integration.components.HorizontalRepeater",function(e){var t=e;t.inherits("wysiwyg.viewer.components.VerticalRepeater"),t.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),t.traits([]),t.binds([]),t.skinParts({inlineContent:{type:"htmlElement"}}),t.states(),t.fields({}),t.methods({})}),define.component("wixapps.integration.components.Icon",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_onClick"]),t.skinParts({img:{type:"htmlElement"}}),t.dataTypes(["Icon"]),t.methods({_onAllSkinPartsReady:function(e){e.img.addEvent("click",this._onClick)},render:function(){this._skinParts.img.set("src",this._data.get("url")),this._skinParts.img.set("width",this._data.get("width")),this._skinParts.img.set("height",this._data.get("height")),this._skinParts.img.set("title",this._data.get("title")),this._view.setStyles({width:this._data.get("width"),height:this._data.get("height")})},_onClick:function(e){this.fireEvent(Constants.CoreEvents.CLICK,e)}})}),define.component("wixapps.integration.components.ImageButton",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_onClick","_onMouseEnter","_onMouseLeave","_onMouseDown","_onMouseUp"]),t.skinParts({}),t.propertiesSchemaType("ImageButtonProperties"),t.dataTypes(["Icon"]),t.methods({_isSprite:function(){return this.getComponentProperty("isSprite")},_startX:function(){return this.getComponentProperty("startPositionX")},_startY:function(){return this.getComponentProperty("startPositionY")},_dir:function(){return this.getComponentProperty("spriteDirection")},_bgPos:function(e,t){return void 0===e&&(e=this._startX()),void 0===t&&(t=this._startY()),e+"px "+t+"px"},_onAllSkinPartsReady:function(){this._view.addEvent("click",this._onClick),this._view.addEvent("mousedown",this._onMouseDown),this._view.addEvent("mouseup",this._onMouseUp),this._view.addEvent("mouseenter",this._onMouseEnter),this._view.addEvent("mouseleave",this._onMouseLeave)},_onClick:function(e){this.fireEvent(Constants.CoreEvents.CLICK,e)},_onMouseDown:function(){if(this._isSprite()){var e=parseInt(this._startX(),10),t=parseInt(this._startY(),10),i=parseInt(this._data.get("width"),10),n=parseInt(this._data.get("height"),10),a="horizontal"===this._dir();a?e-=2*i:t-=2*n,this._view.firstChild.setStyle("background-position",this._bgPos(e,t))}},_onMouseUp:function(){if(this._isSprite()){var e=parseInt(this._startX(),10),t=parseInt(this._startY(),10),i=parseInt(this._data.get("width"),10),n=parseInt(this._data.get("height"),10),a="horizontal"===this._dir();a?e-=i:t-=n,this._view.firstChild.setStyle("background-position",this._bgPos(e,t))}},_onMouseEnter:function(){var e=this._isSprite();if(e&&"false"!==e){var t=parseInt(this._startX(),10),i=parseInt(this._startY(),10),n=parseInt(this._data.get("width"),10),a=parseInt(this._data.get("height"),10),s="horizontal"===this._dir();s?t-=n:i-=a,this._view.firstChild.setStyle("background-position",this._bgPos(t,i))}},_onMouseLeave:function(){this._isSprite()&&this._view.firstChild.setStyle("background-position",this._bgPos())},_renderImage:function(){this._view.empty();var e=new Element("img");e.set("src",this._data.get("url")),e.set("width",this._data.get("width")),e.set("height",this._data.get("height")),e.set("title",this._data.get("title")),this._view.grab(e)},_renderSprite:function(){this._view.empty();var e=new Element("span"),t={"background-image":"url("+this._data.get("url")+")","background-repeat":"no-repeat","background-position":this._bgPos(),width:this._data.get("width"),height:this._data.get("height"),display:"inline-block"};e.setStyles(t),this._view.grab(e)},render:function(){this._view.setStyles({width:this._data.get("width"),height:this._data.get("height")}),this._isSprite()?this._renderSprite():this._renderImage()}})}),define.oldComponent({name:"wixapps.integration.components.InlineText",imports:["mobile.core.components.base.BaseComponent"],skinParts:{},Class:{Extends:"wysiwyg.viewer.components.WRichText",_updateText:function(){var e=this._data.get("text");e=e.replace("<p","<span"),e=e.replace("</p","</span"),this._view.set("html",e)},getRichTextContainer:function(){return this._skinParts?this._view:null}}}),define.component("wixapps.integration.components.LinkSelector",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_onClick"]),t.skinParts({description:{type:"htmlElement"}}),t.states(["normal","nonEditable"]),t.dataTypes(["Text"]),t.fields({_descriptionVisibility:!1}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._descriptionVisibility=i&&i.descriptionVisible||!1,this._isEditable=i&&void 0!==i.isEditable?i.isEditable:!0},_onAllSkinPartsReady:function(e){this._isEditable?(this.setState("normal"),e.description.addEvent("click",this._onClick)):this.setState("nonEditable")},_onClick:function(e){this.fireEvent(Constants.CoreEvents.CLICK,e)},render:function(){this.parent(),this.setDescriptionVisibility(this._descriptionVisibility)},setDescriptionVisibility:function(e){this._descriptionVisibility=e,this._skinParts.description.set("text",e?this._data.get("text"):""),this._skinParts.description.set("title",e?"":this._data.get("text"))}})}),define.oldComponent({name:"wixapps.integration.components.MultiColumnList",imports:["wysiwyg.viewer.utils.ComponentSequencer"],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:[],_columns:3,_columnWidth:0,initialize:function(e,t,i){if(this.parent(e,t,i),this._sequencer=new this.imports.ComponentSequencer,!i||!i.sequencingHook)throw Error("No sequencer");this._sequencer.resolveItem=i.sequencingHook},_onAllSkinPartsReady:function(){this._sequencer.addEvent("componentSetup",function(e){this._onDisplayerCreation(e.compView,e.method,e.index)}.bind(this)),this._sequencer.addEvent("productionFinished",function(e){this._onSequencerFinished(e)}.bind(this))},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){this._columnWidth=this._view.getSize().x/this._columns,this._sequencer.createComponents(this._skinParts.itemsContainer,this._data.get("items").slice(0,this._numCols*this._numRows))},_onSequencerFinished:function(){},_onDisplayerCreation:function(e){e.setStyles({width:this._columnWidth})},getSequencer:function(){return this._sequencer}}}),define.component("wixapps.integration.components.PaginatedGridGallery",function(e){var t=e;t.inherits("wysiwyg.viewer.components.MatrixGallery"),t.utilize(["wysiwyg.viewer.utils.MatrixTransitions","wysiwyg.viewer.utils.GalleryUtils"]),t.resources(["W.Utils"]),t.traits(["wysiwyg.viewer.components.traits.GalleryAutoplay"]),t.binds(["next","prev","_onTransitionComplete","_onRollOut","_onMouseMove","_onClick","_onRollOverViewCreated"]),t.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement",optional:!0},rolloverHolder:{type:"htmlElement",optional:!0},rolloverContent:{type:"htmlElement",optional:!0},title:{type:"htmlElement",optional:!0},description:{type:"htmlElement",optional:!0},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!0}}),t.states({rendering:["pending","ready"],itemSelection:["rollover","idle"],linkableComponent:["link","noLink"],slideshow:["autoplayOn","autoplayOff"]}),t.propertiesSchemaType("PaginatedGridGalleryProperties"),t.fields({_pageItemsCount:0,_currentItemIndex:0,_displayerDict:{},_transitionPending:!1,_transitionUtils:null,_linkUtils:null,_hasRollOver:!0,_NO_LINK_PROPAGATION:!0}),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this._transitionsOn=!1,this._transitionUtils=new this.imports.MatrixTransitions,this._linkUtils=this.resources.W.Utils.linkUtils,this._view.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onMouseMove),this._view.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onRollOut),"fixedRowNumber"in i&&(this._fixedRowNumber=i.fixedRowNumber===!0),void 0===i.sequencingHook&&(this._sequencer.resolveItem=function(){return{comp:"wysiwyg.viewer.components.ImageLite",skin:"mobile.core.skins.InlineSkin"}}),i.rolloverHook&&(this._rolloverSequencer=new this.imports.ComponentSequencer,this._rolloverSequencer.resolveItem=i.rolloverHook,this._rolloverSequencer.addEvent("componentSetup",this._onRollOverViewCreated)),i.sequencingHook&&!i.rolloverHook&&(this._hasRollOver=!1)},getSequencer:function(){return this._sequencer},getRolloverSequencer:function(){return this._rolloverSequencer},_onAllSkinPartsReady:function(){this.parent(),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.itemsContainer.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder&&(this._skinParts.rolloverHolder.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder.setStyles({overflow:"hidden"}),this._resetRollOver());var e=this.injects().Utils.getCSSBrowserFeature("user-select"),t={cursor:"pointer"};e&&(t[e]="none"),this._skinParts.buttonPrev.setStyles(t),this._skinParts.buttonNext.setStyles(t),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.CLICK,function(e){e.stopPropagation(),this.prev()}.bind(this)),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.CLICK,function(e){e.stopPropagation(),this.next()}.bind(this)),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._transitionUtils.setupTransitionMap(this._calcItemPosition.bind(this),this._skinParts.itemsContainer),this._checkSkinPartsVisibility()},_getRowNumber:function(){return this._fixedRowNumber===!0?parseInt(this.getComponentProperty("maxRows"),10):this.parent()},_calculateItemSize:function(){if(this._skinParts&&this._data.get("items").length>0){var e={x:this.getWidth(),y:this.getHeight()},t=e.x-this._widthDiff,i=e.y-this._heightDiff;this._itemWidth=Math.max(Math.floor((t-(this._numCols-1)*this._gap)/this._numCols),0),this._itemHeight=Math.max(Math.floor((i-(this._numRows-1)*this._gap)/this._numRows),0)}},_onResize:function(){this.parent(),this._skinParts&&this._updateRollover()},_onResizeEnd:function(){this._skinParts&&this._skinParts.itemsContainer.getChildren().forEach(function(e,t){this._updateDisplayerGeometry(e,t)}.bind(this))},_onDataChange:function(e){this._currentItemIndex=0,this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber(),10),this._componentReady&&e===this._data&&this._skinParts.itemsContainer.empty(),this.parent.apply(this,arguments),this._checkSkinPartsVisibility()},render:function(){var e=this._data.get("items");this._displayerDict={},this._skinParts.counter&&this._skinParts.counter.set("text",this._getCounterText(this._currentItemIndex,e.length)),this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber(),10),this._displayedItems=this._getPageItems(e,this._currentItemIndex);var t=this._displayedItems;e.length>this._pageItemsCount?(this._nextPageItems=this._getPageItems(e,this._getNextPageItemIndex()),this._prevPageItems=this._getPageItems(e,this._getPrevPageItemIndex()),t=t.concat(this._nextPageItems).concat(this._prevPageItems),this._skinParts.buttonNext.setStyles({display:"block"}),this._skinParts.buttonPrev.setStyles({display:"block"})):(this._skinParts.buttonNext.setStyles({display:"none"}),this._skinParts.buttonPrev.setStyles({display:"none"})),this._sequencer.createComponents(this._skinParts.itemsContainer,t)},_getPageItems:function(e,t){for(var i=[],n=Math.min(this._numItems-1,t+this._pageItemsCount-1),a=t;n>=a;a++)i.push(e[a]);return i},_translateRefList:function(e){var t,i,n,a=[],s=this._skinParts.itemsContainer.children,o=typeOf(e[0]);e=e.slice(0);for(var r=0;s.length>r;r++)t=s[r],i=t.getLogic().getDataItem(),n="string"===o?"#"+i.get("id"):i,e.contains(n)&&(a.push(t),e.splice(e.indexOf(n),1));return a},_checkSkinPartsVisibility:function(){this._skinParts&&(this._updateRollover(),this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.setStyle("cursor",this.getComponentProperty("expandEnabled")?"pointer":"default"))},_updateState:function(){},_onDisplayerCreation:function(e,t,i){var n,a=e.getViewNode();n=e.getRef?e.getRef():"#"+e.getDataItem().get("id"),a.addClass("galleryDisplayer"),this._displayerDict[n]=e,this._updateDisplayerGeometry(a,i)},_updateDisplayerGeometry:function(e,t){this._setupItem(e),t>=this._displayedItems.length&&e.setStyles({top:1.5*-this._itemHeight,position:"absolute"})},_onSequencerFinished:function(e){e.elements=e.elements.slice(0,this._displayedItems.length),this.parent(e),this._transitionPending=!1,this.fireEvent("transitionFinished")},gotoNext:function(){this.next()},next:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&(this._currentItemIndex=this._getNextPageItemIndex(),this._goto(this._nextPageItems,0))},prev:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&(this._currentItemIndex=this._getPrevPageItemIndex(),this._goto(this._prevPageItems,1))},_getNextPageItemIndex:function(){var e=this._currentItemIndex+this._pageItemsCount;return e>=this._numItems&&(e=0),e},_getPrevPageItemIndex:function(){var e=this._currentItemIndex-this._pageItemsCount;return 0>e&&(e=(this._getTotalPageCount()-1)*this._pageItemsCount),e},_getTotalPageCount:function(){var e=Math.floor(this._numItems/this._pageItemsCount);return this._numItems%this._pageItemsCount>0&&e++,e},_getCounterText:function(e){var t=Math.floor(e/this._pageItemsCount),i=Math.max(this._getTotalPageCount(),1);return t+1+""+"/"+(i+"")},_goto:function(e,t){this._transitionPending=!0,this._resetRollOver();var i=this._translateRefList(this._displayedItems),n=this._translateRefList(e),a=this._transitionUtils.getTransition(this.getComponentProperty("transition"));this._setupAllItems(n),a(i,n,this._numCols,this._numRows,t,parseFloat(this.getComponentProperty("transDuration")),function(){Array.each(i,function(e){e.getLogic?e.getLogic().dispose():e.destroy&&e.destroy()}),this._onTransitionComplete(n)}.bind(this))},_onTransitionComplete:function(){this.render()},_updateRollover:function(){if(this._highlightedDisplayer){var e=this._highlightedDisplayer.getCoordinates(this._skinParts.rolloverHolder.getParent());this._skinParts.rolloverHolder.setStyles({visibility:"visible",position:"absolute",padding:0,left:e.left,top:e.top,width:e.width,height:e.height}),this._skinParts.rolloverHolder.uncollapse(),this.setState("idle"),window.requestAnimFrame(function(){if(this._highlightedDisplayer){this._updateDisplayerInfo(this._highlightedDisplayer.getLogic().getDataItem());
var e=this._highlightedDisplayer.getLogic().getDataItem();if(e.getType&&"Image"===e.getType()){var t=this.getSkinPart("link");this._linkUtils.linkifyElement(this,t,e,!0)}this.setState("rollover")}}.bind(this))}},_onMouseMove:function(e){if(this._transitionPending!==!0){var t=this._findDisplayerFromPosition(e.page);t&&this._skinParts.rolloverHolder&&this._hasRollOver?this._highlightedDisplayer!==t&&(this._highlightedDisplayer=t,this._updateRollover()):this._resetRollOver()}},_onRollOut:function(e){e.relatedTarget&&!e.relatedTarget.getParents().contains(this._view)&&this._resetRollOver()},_findDisplayerFromPosition:function(e){var t,i=this._skinParts.itemsContainer.getPosition(),n={x:e.x-i.x,y:e.y-i.y},a=Math.floor(n.x/(this._itemWidth+this._gap)),s=Math.floor(n.y/(this._itemHeight+this._gap));if(a>=0&&s>=0){var o=s*this._numCols+a;this._galleryItems.length>o&&(t=this._galleryItems[o])}return t},_findDisplayer:function(e){for(;e;){if(e===this._skinParts.itemsContainer)return null;if(this._galleryItems.contains(e))return e;e=e.getParent()}return null},_updateDisplayerInfo:function(e){if(this._skinParts.rolloverHolder&&this._rolloverSequencer){var t=this._skinParts.rolloverContent||this._skinParts.rolloverHolder;this._rolloverSequencer.createComponents(t,[e])}else e&&e.getData&&"title"in e.getData()&&"description"in e.getData()&&(this._skinParts.title.set("text",e.get("title")),this._skinParts.description.set("text",e.get("description")))},_onRollOverViewCreated:function(e){this._setupItem(e.compView)},_hideRollOverHolder:function(){this.setState("idle"),this._skinParts.rolloverHolder.collapse()},_resetRollOver:function(){this._hideRollOverHolder(),this._highlightedDisplayer=null},_onClick:function(e){var t;if(e.rightClick===!1&&this.getComponentProperty("expandEnabled")===!0){var i=this._highlightedDisplayer||this._findDisplayer(e.target);if(i&&(t=i.getLogic().getDataItem(),t.get)){var n=t.get("id"),a=this._data.get("items"),s=a.indexOf("#"+n);this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._data,currentIndex:s,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:function(e,t){this.injects().Data.getDataItem(e,function(e){t({id:e.get("id"),title:e.get("title")})})}.bind(this)})}}}})}),define.component("wixapps.integration.components.SiteButton",function(e){var t=e;t.inherits("wysiwyg.viewer.components.SiteButton"),t.methods({getStyleNameSpace:function(){return this._styleNameSpace||"wysiwyg.viewer.components.SiteButton"},_setSkinPartElements:function(e){if(e.link&&"a"===e.link.tagName.toLowerCase()){var t=new Element("div");for(Browser.ie?(t.clearAttributes(),t.mergeAttributes(e.link),t.removeAttribute("uid")):t.attributes=e.link.attributes,t.setStyles(e.link.getStyles());e.link.children.length>0;)t.appendChild(e.link.removeChild(e.link.firstChild));t.className=e.link.className,e.link.parentNode.replaceChild(t,e.link),e.link=t}this._validateSkinParts(e),this._skinPartElements=e,this._tryCreatingComponentParts()},_setMinimumWidthAccordingToText:function(){this._skinParts.label.parentNode.setStyle("overflow","hidden")}})}),define.oldComponent({name:"wixapps.integration.components.Toggle",skinParts:{on:{type:"htmlElement"},off:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["toggle"],_states:["on","off"],initialize:function(e,t,i){this.parent(e,t,i),this._createOnHook=i.createOnHook,this._createOffHook=i.createOffHook,this._initialState=i.initialState,this._listensToPartsClick=i.listensToPartsClick},_onAllSkinPartsReady:function(e){this._listensToPartsClick&&(e.on.addEvent("click",this.toggle),e.off.addEvent("click",this.toggle)),this._createOnHook(e.on),this._createOffHook(e.off),this.setState("on"==this._initialState?"on":"off")},turnOn:function(){this.setState("on")},turnOff:function(){this.setState("off")},toggle:function(){"on"==this.getState()?this.turnOff():this.turnOn(),this.fireEvent("wix:toggle",{state:this.getState()})},_onResize:function(){this.parent()}}}),define.oldComponent({name:"wixapps.integration.components.VerticalListEditor",skinParts:{inlineContent:{type:"htmlElement"}},imports:[],Class:{Extends:"wysiwyg.viewer.components.VerticalRepeater",Binds:["_sequencingHook","_onItemsUpdated","_startDragChild","_onItemEndDrag","_onItemDrag"],initialize:function(e,t,i){this.parent(e,t,i),this._sequencer.addEvent("productionFinished",this._onItemsUpdated),this._dragEnabled=i.dragEnabled,this._dragEventsHandler=i.dragEventHandler||{onDragItemCopyCreated:function(){},disposeDragItemCopy:function(e){e.getLogic().dispose()}},this._maxDragIndex=void 0!==i.maxDragIndex?i.maxDragIndex:-1},render:function(){this._data&&(this._sequencer.createComponents(this._skinParts.inlineContent,this._data.get("items")),this._hideShowContainers())},setDragEnabled:function(e){this._dragEnabled=e},_onItemsUpdated:function(e){if(0!==e.elements.length){this._items=e.elements;for(var t=0;this._items.length>t;t++)this._listenToItem(this._items[t],t)}},_listenToItem:function(e,t){var i=this;e.hasClass("container")||(e.addEvent("click",function(){i.fireEvent("itemClick",{idx:t,element:e,dataItem:i._data.get("items")[t]})}),e.addEvent(Constants.CoreEvents.MOUSE_DOWN,function(n){i._startDragChild(e,t,n)}))},_startDragChild:function(e,t,i){if(this._dragEnabled&&"INPUT"!=i.target.tagName){this._startIdx=t,this._body=this._body||$$("body"),this._basePos=this._view.getPosition().y,this._itemPos=e.getPosition().y;var n=i.client.y+window.getScroll().y;this._deltaY=n-this._itemPos,this._startMousePos=n,this._startedDrag=!1,this._body.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onItemDrag),this._body.addEvent(Constants.CoreEvents.MOUSE_UP,this._onItemEndDrag),this._body.addClass("blockSelection")}},_doStartDrag:function(){var e=this._data.get("items"),t=this._items[this._startIdx];this._movedItem=t.dispose();var i=e[this._startIdx];this.createFloatingItem(i,e)},createFloatingItem:function(e,t){this._childCopy=this._sequencer.createComponent(this._view,e,this._startIdx,t);var i=this._childCopy.get("comp");if(i)this._childCopy.addEvent(Constants.ComponentEvents.WIXIFIED,function(){this._childCopy.getLogic().setDragged()}.bind(this));else for(var n=this._childCopy.getElements("[comp]"),a=0;n.length>a;a++){var s=n[a];s.addEvent(Constants.ComponentEvents.WIXIFIED,function(){var e=this.getLogic();e.setDragged&&e.setDragged()})}this._childCopy.setStyles({position:"absolute",left:"0px",top:this._itemPos-this._basePos,width:"100%"}),this._view.grab(this._childCopy),this._dragEventsHandler.onDragItemCopyCreated(this._childCopy)},_onItemDrag:function(e){var t=e.client.y+window.getScroll().y,i=3;if(!this._startedDrag&&Math.abs(t-this._startMousePos)>i&&(this._startedDrag=!0,this._doStartDrag()),this._startedDrag){var n=t-this._basePos-this._deltaY+this._view.getScrollTop();this._childCopy.setStyle("top",n);var a=this._getNewItemIndex(e);if(!(this._maxDragIndex>a)){var s=this._items[a];a>this._items.length-1?this._movedItem.inject(this._skinParts.inlineContent):a>-1&&this._movedItem.inject(s,"before"),this._hideShowContainers()}}},_getNewItemIndex:function(e){for(var t,i,n=-1,a=e.client.y+window.getScroll().y,s=0;this._items.length-1>s;s++)if(i=this._items[s].getPosition().y+(this._items[s+1].getPosition().y-this._items[s].getPosition().y)/2,n=s,i>a){t=!0;break}if(!t){var o=this._items.length-1;i=this._items[o].getPosition().y+this._items[o].getSize().y/2,n=i>a?o:o+1}return n},_hideShowContainers:function(){var e=this._skinParts.inlineContent.getElements(".container");Array.each(e,function(e){var t=e.getElement(".container-box"),i=e.getNext();!i||i&&i.hasClass("container")?(t.removeClass("hidden"),e.setStyle("opacity","0.4")):(t.addClass("hidden"),e.setStyle("opacity","1"))})},_onItemEndDrag:function(){if(this._body.removeEvent(Constants.CoreEvents.MOUSE_MOVE,this._onItemDrag),this._body.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onItemEndDrag),this._body.removeClass("blockSelection"),this._startedDrag){var e=this._skinParts.inlineContent.getChildren().indexOf(this._movedItem);this._dragEventsHandler.disposeDragItemCopy(this._childCopy),this.fireEvent("itemMoved",{idx:e,oldIdx:this._startIdx,dataItem:this._data.get("items")[this._startIdx]})}}}}),define.component("wixapps.integration.components.WPhoto",function(e){var t=e;t.inherits("wysiwyg.viewer.components.WPhoto"),t.utilize([]),t.traits([]),t.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*",hookMethod:"_setImageArgs"}}),t.dataTypes(["Image"]),t.propertiesSchemaType("WPhotoProperties"),t.methods({getStyleNameSpace:function(){return this._styleNameSpace||"wysiwyg.viewer.components.WPhoto"},_setSkinPartElements:function(e){if(e.link&&"a"===e.link.tagName.toLowerCase()){for(fakeLink=new Element("div"),Browser.ie?(fakeLink.clearAttributes(),fakeLink.mergeAttributes(e.link),fakeLink.removeAttribute("uid")):fakeLink.attributes=e.link.attributes,fakeLink.setStyles(e.link.getStyles());e.link.children.length>0;)fakeLink.appendChild(e.link.removeChild(e.link.firstChild));fakeLink.className=e.link.className,e.link.parentNode.replaceChild(fakeLink,e.link),e.link=fakeLink}this._validateSkinParts(e),this._skinPartElements=e,this._tryCreatingComponentParts()}})}),define.component("wixapps.integration.components.dialogs.MessageDialog",function(e){var t=e;t.inherits("core.editor.components.dialogs.MessageDialog"),t.skinParts({text:{type:"htmlElement"},details:{type:"htmlElement"},isDontShowAgain:{type:"htmlElement"},isDontShowAgainCont:{type:"htmlElement"}}),t.resources(["W.Resources","W.AppsEditor2"]),t.methods({initialize:function(e,t,i){this._dontShowAgainKey=i.dontShowAgainKey,this.parent(e,t,i)},_onAllSkinPartsReady:function(e){this.parent(e),this._skinParts.isDontShowAgainCont.appendText(this.resources.W.Resources.get("EDITOR_LANGUAGE","DONT_SHOW_AGAIN"))},_onDialogClosing:function(e){if(this._skinParts.isDontShowAgain.checked){var t=this.resources.W.AppsEditor2.getUserExperienceKeyHandler();t.setItem(this._dontShowAgainKey,!0)}this.parent(e)}})}),define.component("wixapps.integration.components.inputs.BUISelector",function(e){var t=e;t.inherits("wysiwyg.editor.components.inputs.BaseInput"),t.traits(["wysiwyg.editor.components.traits.BindValueToData"]),t.binds([]),t.skinParts({bold:{type:"wysiwyg.editor.components.inputs.CheckBoxImage",argObject:{}},underline:{type:"wysiwyg.editor.components.inputs.CheckBoxImage",argObject:{}},italic:{type:"wysiwyg.editor.components.inputs.CheckBoxImage",argObject:{}}}),t.states({label:["hasLabel","noLabel"]}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),i=i||{},this._value=i.value||{bold:!1,underline:!1,italic:!1}},render:function(){},_onAllSkinPartsReady:function(){this.parent(),this.isEnabled()?(this._skinParts.bold.enable(),this._skinParts.underline.enable(),this._skinParts.italic.enable()):(this._skinParts.bold.disable(),this._skinParts.underline.disable(),this._skinParts.italic.disable()),this._skinParts.bold.setBackground("icons/font/fonts_bold.png",null,{w:27,h:33}),this._skinParts.underline.setBackground("icons/font/fonts_underline.png",null,{w:27,h:33}),this._skinParts.italic.setBackground("icons/font/fonts_italic.png",null,{w:27,h:33})},setValue:function(e){this._value=e,this._skinParts.bold.setValue(this._value.bold),this._skinParts.underline.setValue(this._value.underline),this._skinParts.italic.setValue(this._value.italic)},getValue:function(){return this._value.bold=this._skinParts.bold.getValue(),this._value.underline=this._skinParts.underline.getValue(),this._value.italic=this._skinParts.italic.getValue(),this._value},_onEnabled:function(){this.parent(),this._skinParts.bold.enable(),this._skinParts.underline.enable(),this._skinParts.italic.enable()},_onDisabled:function(){this.parent(),this.isReady()&&(this._skinParts.bold.disable(),this._skinParts.underline.disable(),this._skinParts.italic.disable())},_changeEventHandler:function(e){var t=this.getValue(),i={value:t,origEvent:e,compLogic:this};this.fireEvent("inputChanged",i)},_listenToInput:function(){this._skinParts.bold.addEvent("inputChanged",this._changeEventHandler),this._skinParts.underline.addEvent("inputChanged",this._changeEventHandler),this._skinParts.italic.addEvent("inputChanged",this._changeEventHandler)},_stopListeningToInput:function(){this._skinParts.bold.removeEvent("inputChanged",this._changeEventHandler),this._skinParts.underline.removeEvent("inputChanged",this._changeEventHandler),this._skinParts.italic.removeEvent("inputChanged",this._changeEventHandler)}})}),define.component("wixapps.integration.components.inputs.CheckBoxGroupInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.binds(["_handleSingleCheckboxClick"]),t.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),t.dataTypes(["MultiSelectableList"]),t.states({validity:["valid","invalid"]}),t.fields({}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validity")}.bind(this)),this._checkboxGroupName=i.checkboxGroupName||"cbGroup"},_onAllSkinPartsReady:function(){this._createCheckboxGroup()},_createCheckboxGroup:function(){var e=function(e){this._optionsData=Object.values(e),this._bindCheckboxGroupToData(this._skinParts.collection)}.bind(this);this._selectedOptions=this.getDataItem().get("selected");var t=this.getDataItem().get("items").filter(function(e){return e.get("enabled")});t.length>0&&"string"==typeof t[0]?this.injects().Data.getDataByQueryList(t,e):e(t)},_bindCheckboxGroupToData:function(e){e.empty();for(var t=0;this._optionsData.length>t;t++){var i=this._optionsData[t],n=i.get("value"),a=new Element("Input",{type:"checkbox",name:this._checkboxGroupName,value:n,idInData:t});e.grab(a,"bottom"),e.addEvent("click",this._handleSingleCheckboxClick),e.innerHTML+=i.get("text")+"<BR/>"}this._setSelected(e)},_setSelected:function(e){var t=this.getDataItem().get("selected"),i=e.getElements('input[name="'+this._checkboxGroupName+'"]');t&&Array.each(t,function(e){var t=this._optionsData.indexOf(e);t>-1&&i.length>t&&i[t].set("checked","checked")}.bind(this))},_handleSingleCheckboxClick:function(e){var t=e.target,i=this.getDataItem().get("selected"),n=t.getAttribute("idInData"),a=this._optionsData[n];t.checked?i.push(a):i.erase(a),this.getDataItem().set("selected",i),this.getDataItem().fireDataChangeEvent("selected",i),this.fireEvent("selectionChanged",a)},setError:function(e){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",e)}})}),define.dataSchema("DateInputProperties",{allowEmpty:{type:"boolean","default":!0,description:"If set to false will not have empty options in the combo-boxes and the default value will be set to the current date."}}),define.component("wixapps.integration.components.inputs.DateInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_userChange"]),t.skinParts({year:{type:Constants.ComponentPartTypes.HTML_ELEMENT},month:{type:Constants.ComponentPartTypes.HTML_ELEMENT},day:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),t.states({validation:["invalid"],allowEmpty:["allowEmpty","hideEmpty"]}),t.dataTypes(["Text"]),t.propertiesSchemaType("DateInputProperties"),t.fields({_invalidDateString:"Invalid Date",_emptyYearText:"YYYY",_emptyMonthText:"MM",_emptyDayText:"DD"}),t.methods({initialize:function(e,t,i){this.parent(e,t,i)},showValidationMessage:function(e){this.setState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text",e)},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text","")},_onAllSkinPartsReady:function(){this._skinParts.year.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.month.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.day.addEvent(Constants.CoreEvents.CHANGE,this._userChange);var e=new Option(this._emptyYearText,this._emptyYearText);e.addClass("empty"),this._skinParts.year.options.add(e),e=new Option(this._emptyMonthText,this._emptyMonthText),e.addClass("empty"),this._skinParts.month.options.add(e);var t,i=(new Date).getFullYear();for(t=new Date(0).getFullYear();i+6>t;t++)this._skinParts.year.options.add(new Option(t,t));for(t=1;13>t;t++)this._skinParts.month.options.add(new Option(t,t))},render:function(){var e,t,i=this._data.get("text"),n=new Date(i),a=n.getFullYear(),s=n.getMonth()+1,o=n.getDate(),r=this._allowEmpty();if(this.setState(r?"allowEmpty":"hideEmpty","allowEmpty"),r){if(""+n==this._invalidDateString){if(0===this._skinParts.day.options.length){for(t=new Option(this._emptyDayText,this._emptyDayText),t.addClass("empty"),this._skinParts.day.options.add(t),e=1;this._getDaysForMonth(a,s)+1>e;e++)this._skinParts.day.options.add(new Option(e,e));this._setSelectedValue(this._skinParts.day,this._emptyDayText)}return}if(0===n.getTime()){this._skinParts.day.innerHTML="",t=new Option(this._emptyDayText,this._emptyDayText),t.addClass("empty"),this._skinParts.day.options.add(t);var l=this._getDaysForMonth(a,s);for(e=1;l>=e;e++)this._skinParts.day.options.add(new Option(e,e));return this._setSelectedValue(this._skinParts.year,this._emptyYearText),this._setSelectedValue(this._skinParts.month,this._emptyMonthText),this._setSelectedValue(this._skinParts.day,this._emptyDayText),void 0}}for(this._skinParts.day.innerHTML="",t=new Option(this._emptyDayText,this._emptyDayText),t.addClass("empty"),this._skinParts.day.options.add(t),e=1;this._getDaysForMonth(a,s)+1>e;e++)this._skinParts.day.options.add(new Option(e,e));this._setSelectedValue(this._skinParts.year,a),this._setSelectedValue(this._skinParts.month,s),this._setSelectedValue(this._skinParts.day,o)},_setSelectedValue:function(e,t){var i=Array.from(e.options).filter(function(e){return e.value==t});i.length&&(i[0].selected=!0)},_isValidDate:function(){return this._skinParts.year.getSelected()[0].value!=this._emptyYearText&&this._skinParts.month.getSelected()[0].value!=this._emptyMonthText&&this._skinParts.day.getSelected()[0].value!=this._emptyDayText},_isEmptyDate:function(){return this._skinParts.year.getSelected()[0].value==this._emptyYearText&&this._skinParts.month.getSelected()[0].value==this._emptyMonthText&&this._skinParts.day.getSelected()[0].value==this._emptyDayText},_userChange:function(){var e=new Date(0);if(this._isEmptyDate())this.getDataItem().set("text",e.toISOString()),this.fireEvent("selectionChanged",e.toISOString());else if(this._isValidDate()){e.setFullYear(this._skinParts.year.getSelected()[0].value),e.setMonth(this._skinParts.month.getSelected()[0].value-1);var t=this._getDaysForMonth(e.getFullYear(),e.getMonth()+1);e.setDate(this._skinParts.day.getSelected()[0].value>t?t:this._skinParts.day.getSelected()[0].value),this.getDataItem().set("text",e.toISOString()),this.fireEvent("selectionChanged",e.toISOString())}else this.getDataItem().set("text",this._invalidDateString),this.fireEvent("selectionChanged",this._invalidDateString)},_allowEmpty:function(){return this.getComponentProperty("allowEmpty")===!0||"true"===this.getComponentProperty("allowEmpty")},_getDaysForMonth:function(e,t){return e=e||(new Date).getFullYear(),t=t,new Date(e,t,0).getDate()}})}),define.component("wixapps.integration.components.inputs.InlineTextInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_onPreviewClicked","_onInputBlur","_onKeyUp"]),t.skinParts({preview:{type:"htmlElement"},input:{type:"htmlElement"}}),t.states(["preview","input"]),t.dataTypes(["Text"]),t.fields({}),t.methods({render:function(){this.setState("preview");var e=this.getDataItem().get("text");this._skinParts.preview.set("text",e),this._skinParts.input.set("value",e)},_onAllSkinPartsReady:function(){this._listenToInput()},getValue:function(){return this._skinParts.preview.get("text")},_onPreviewClicked:function(){this._skinParts.input.set("value",this.getValue()),this.setState("input"),this._skinParts.input.select()},_onKeyUp:function(e){e=e||window.event,13==e.code&&this._onInputCaptureDone(e)},_onInputBlur:function(e){this._onInputCaptureDone(e)},_onInputCaptureDone:function(e){var t=this.getValue(),i=this._skinParts.input.get("value");if(i&&i!==t){this._skinParts.preview.set("text",i),this._data.set("text",i);var n={value:i,origEvent:e,compLogic:this};this.fireEvent("inputChanged",n)}this.setState("preview")},_listenToInput:function(){this._skinParts.preview.addEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._onKeyUp),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},_stopListeningToInput:function(){this._skinParts.preview.removeEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._onKeyUp),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},dispose:function(){this._stopListeningToInput(),this.parent()}})}),define.component("wixapps.integration.components.inputs.LocationSelector",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_handleSearch","_handleAddressKeyDown"]),t.skinParts({address:{type:Constants.ComponentPartTypes.HTML_ELEMENT},viewMode:{type:Constants.ComponentPartTypes.HTML_ELEMENT},message:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),t.states({validation:["invalid"],viewMode:["loading","error","found","search"]}),t.dataTypes(["GeoMap"]),t.propertiesSchemaType("GoogleMapProperties"),t.fields({API_KEY:"AIzaSyBnz6ANN4hVboRWYKZGVT44WJjfmsso9B4",geocoder:null}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.setState("search","viewMode")},showValidationMessage:function(e){this.setState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",e),this._skinParts.message.uncollapse())},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",""),this._skinParts.message.collapse())},render:function(){var e=this.getDataItem().get("address");this._skinParts.address.value=e},_onAllSkinPartsReady:function(){this._skinParts.address.addEvent(Constants.CoreEvents.KEY_DOWN,this._handleAddressKeyDown),this._skinParts.address.addEvent(Constants.CoreEvents.BLUR,this._handleSearch),this._skinParts.viewMode.addEvent(Constants.CoreEvents.CLICK,this._handleSearch)},_handleAddressKeyDown:function(e){if(13==e.code)e.stop(),this._getGeoLocationFromAddress(this._skinParts.address.value);else{var t=this.getDataItem();t.set("latitude",-1970,!0),t.set("longitude",-1970,!0),this.setState("search","viewMode")}},_handleSearch:function(){"search"===this.getState("viewMode")&&this._getGeoLocationFromAddress(this._skinParts.address.value)},_getGeoLocationFromAddress:function(e){if(this.setState("loading","viewMode"),null===this.geocoder){var t=new Request.JSONP({url:"http://maps.googleapis.com/maps/api/js?key="+this.API_KEY+"&sensor=true",onComplete:function(){var t=window.google;this.geocoder=new t.maps.Geocoder,this._getGeoLocationFromAddress(e)}.bind(this)});return t.send(),void 0}var i=this.getDataItem();return 0===e.trim().length?(this.resetInvalidState(),i.set("latitude",1970,!0),i.set("longitude",1970,!0),i.set("address","",!0),i.fireDataChangeEvent(),this.setState("search","viewMode"),void 0):(this.geocoder.geocode({address:e},function(t,i){var n=this.getDataItem(),a=window.google;if(i==a.maps.GeocoderStatus.OK){this.resetInvalidState();var s=t[0].geometry.location;n.set("latitude",s.lat(),!0),n.set("longitude",s.lng(),!0),n.set("address",t[0].formatted_address,!0),n.fireDataChangeEvent(),this.setState("found","viewMode")}else this.showValidationMessage("We couldn't find this address, enter another one or leave it empty"),n.set("address",e,!0),n.set("latitude",-1970,!0),n.set("longitude",-1970,!0),n.fireDataChangeEvent(),this.setState("error","viewMode")}.bind(this)),void 0)}})}),define.dataSchema("TextInputProperties",{label:"string",placeholder:"string"}),define.component("wixapps.integration.components.inputs.TextInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_changeEventHandler","_fireBlur","_fireKeyUp","_selectPresetFieldContent","_deselectPresetFieldContent"]),t.skinParts({input:{type:"htmlElement"}}),t.states({label:["hasLabel","noLabel"],validation:["invalid"]}),t.dataTypes(["Text"]),t.propertiesSchemaType("TextInputProperties"),t.fields({}),t.methods({render:function(){this.setLabel(this.getComponentProperty("label")),this.setValue(this.getDataItem().get("text"),!1),this.setPlaceholder(this.getComponentProperty("placeholder"))},_onAllSkinPartsReady:function(){this.addEvent("inputChanged",function(e){this._ignoreUpdate=!0,this.getDataItem().set("text",e.value),this._ignoreUpdate=!1}.bind(this)),this.resetInvalidState(),this._listenToInput()},dispose:function(){this._stopListeningToInput(),this.parent()},setPlaceholder:function(e){this._skinParts.input.set("placeholder",e),window.Modernizr&&!window.Modernizr.input.placeholder&&this._placeholderPolyFill()},_placeholderPolyFill:function(){function e(e){var t=e.target;""===t.get("value")&&t.get("placeholder")&&(t.addClass("isPlaceholder"),t.set("value",t.get("placeholder")))}function t(e){var t=e.target;t.hasClass("isPlaceholder")&&(t.removeClass("isPlaceholder"),t.set("value",""))}this.hasPlaceholder||(this.hasPlaceholder=!0,this._skinParts.input.addEvent("focus",t),this._skinParts.input.addEvent("blur",e),e({target:this._skinParts.input}))},setLabel:function(e){e&&"string"==typeof e?(this.setState("hasLabel","label"),this._skinParts.label.set("html",e),this._skinParts.label.uncollapse()):(this.setState("noLabel","label"),this._skinParts.label.set("html",""),this._skinParts.label.collapse())},showValidationMessage:function(e){this.setState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",e),this._skinParts.message.uncollapse())},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",""),this._skinParts.message.collapse())},setValue:function(e,t){var i=this._skinParts.input;this.hasPlaceholder&&i.removeClass("isPlaceholder"),this._ignoreUpdate||i.set("value",e),t?i.set("isPreset","true"):i.erase("isPreset")},_changeEventHandler:function(e){if(!e.code||W.Utils.isInputKey(e.code)){this._skinParts.input.set("isPreset","");var t=this.getValue();t=this.injects().Utils.convertToHtmlText(t);var i={value:t,origEvent:e,compLogic:this};this.fireEvent("inputChanged",i)}},_selectPresetFieldContent:function(e){e.target.get("isPreset")&&(e.target.get("isSelected")||(e.target.set("isSelected","true"),e.target.select()))},_deselectPresetFieldContent:function(e){e.target.erase("isSelected")},_fireBlur:function(e){this.fireEvent(Constants.CoreEvents.BLUR,e)},_fireKeyUp:function(e){this.fireEvent(Constants.CoreEvents.KEY_UP,e)},_listenToInput:function(){this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.CLICK,this._selectPresetFieldContent),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._deselectPresetFieldContent),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_stopListeningToInput:function(){this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.CLICK,this._selectPresetFieldContent),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._deselectPresetFieldContent),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur)},getValue:function(){var e=this._skinParts.input,t="";return e.hasClass("isPlaceholder")||(t=e.get("value")),t}})}),define.dataSchema("TimeInputProperties",{resolution:{type:"string","enum":["hours","half-hour","quarter-hour","minutes","seconds"],"default":"minutes",description:"Specify the resolution of the time selector"},hourFormat:{type:"string","enum":["12h","24h"],"default":"12h",description:"Specify the format of the hour field in the time selector (12h / 24h)"},allowEmpty:{type:"boolean","default":!0,description:"If set to false will not have empty options in the combo-boxes and the default value will be set to the current date."}}),define.component("wixapps.integration.components.inputs.TimeInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_userChange"]),t.skinParts({hours24:{type:Constants.ComponentPartTypes.HTML_ELEMENT},hours12:{type:Constants.ComponentPartTypes.HTML_ELEMENT},minutes:{type:Constants.ComponentPartTypes.HTML_ELEMENT},seconds:{type:Constants.ComponentPartTypes.HTML_ELEMENT},ampm:{type:Constants.ComponentPartTypes.HTML_ELEMENT},message:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),t.states({resolution:["hours","half-hour","quarter-hour","minutes","seconds"],hourFormat:["12h","24h"],allowEmpty:["allowEmpty","hideEmpty"],validation:["invalid"]}),t.dataTypes(["Text"]),t.propertiesSchemaType("TimeInputProperties"),t.fields({_options:{minutes:[],quarterHour:[],halfHour:[]},_invalidDateString:"Invalid Date",_emptyHoursText:"HH",_emptyMinutesText:"MI",_emptySecondsText:"SS"}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._buildMinuteOptionCache()},showValidationMessage:function(e){this.setState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text",e)},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text","")},render:function(){var e=this._data.get("text"),t=this.getComponentProperty("resolution"),i=this.getComponentProperty("hourFormat"),n=this._allowEmpty();if(this.setState(t,"resolution"),this.setState(i,"hourFormat"),this.setState(n?"allowEmpty":"hideEmpty","allowEmpty"),!n||e!=this._invalidDateString){var a=new Date(e);isNaN(a.getTime())&&(a=n?new Date(0):new Date);var s=a.getHours(),o=a.getMinutes(),r=a.getSeconds();this._clearOptions(this._skinParts.minutes),"quarter-hour"==t&&(this._populateOptions(this._skinParts.minutes,this._options.quarterHour),o=15*parseInt((o+7.5)/15,10)%60,s=a.getMinutes()>52?s+1:s),"half-hour"==t&&(this._populateOptions(this._skinParts.minutes,this._options.halfHour),o=30*parseInt((o+15)/30,10)%60,s=a.getMinutes()>45?s+1:s),0===this._skinParts.minutes.options.length&&this._populateOptions(this._skinParts.minutes,this._options.minutes),n&&0===a.getTime()?(this._setSelectedValue(this._skinParts.hours12,this._emptyHoursText),this._setSelectedValue(this._skinParts.hours24,this._emptyHoursText),this._setSelectedValue(this._skinParts.minutes,this._emptyMinutesText),this._setSelectedValue(this._skinParts.seconds,this._emptySecondsText)):(0===s?(this._setSelectedValue(this._skinParts.hours12,12),this._setSelectedValue(this._skinParts.ampm,"PM")):(this._setSelectedValue(this._skinParts.hours12,s%12),this._setSelectedValue(this._skinParts.ampm,s>12?"PM":"AM")),this._setSelectedValue(this._skinParts.hours24,s),this._setSelectedValue(this._skinParts.minutes,o),this._setSelectedValue(this._skinParts.seconds,r))
}},_setSelectedValue:function(e,t){var i=Array.from(e.options).filter(function(e){return e.value==t});i.length&&(i[0].selected=!0)},_clearOptions:function(e){e.innerHTML=""},_populateOptions:function(e,t){for(var i=0;t.length>i;i++)e.options.add(t[i])},_formatTimePart:function(e,t){return t=t||" ",(t+e).substr(-2)},_onAllSkinPartsReady:function(){this._populateStaticOptions(),this._skinParts.hours24.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.hours12.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.minutes.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.seconds.addEvent(Constants.CoreEvents.CHANGE,this._userChange)},_isValidDate:function(){return!("24h"!=this.getState("hourFormat")&&this._skinParts.hours12.getSelected()[0].value==this._emptyHoursText||"12h"!=this.getState("hourFormat")&&this._skinParts.hours24.getSelected()[0].value==this._emptyHoursText||"hours"!=this.getState("resolution")&&this._skinParts.minutes.getSelected()[0].value==this._emptyMinutesText||"seconds"==this.getState("resolution")&&this._skinParts.seconds.getSelected()[0].value==this._emptySecondsText)},_isEmptyDate:function(){var e="24h"==this.getState("hourFormat")&&this._skinParts.hours24.getSelected()[0].value==this._emptyHoursText||"12h"==this.getState("hourFormat")&&this._skinParts.hours12.getSelected()[0].value==this._emptyHoursText,t=this._skinParts.minutes.getSelected()[0].value==this._emptyMinutesText,i=this._skinParts.seconds.getSelected()[0].value==this._emptySecondsText;return"hours"==this.getState("resolution")?e:"seconds"==this.getState("resolution")?e&&t&&i:e&&t},_userChange:function(){var e,t=new Date(0);this._isEmptyDate()?(this.getDataItem().set("text",t.toISOString()),this.fireEvent("selectionChanged",t.toISOString())):this._isValidDate()?("12h"==this.getState("hourFormat")?(e=this._skinParts.hours12.getSelected()[0].value,e="PM"==this._skinParts.ampm.getSelected()[0].value?(parseInt(e,10)+12)%24:parseInt(e,10)):(e=this._skinParts.hours24.getSelected()[0].value,e=parseInt(e,10)),t.setHours(e),"hours"!=this.getState("resolution")?t.setMinutes(parseInt(this._skinParts.minutes.getSelected()[0].value,10)):t.setMinutes(0),"seconds"==this.getState("resolution")?t.setSeconds(parseInt(this._skinParts.seconds.getSelected()[0].value,10)):t.setSeconds(0),t.setDate(5),this.getDataItem().set("text",t.toISOString()),this.fireEvent("selectionChanged",t.toISOString())):(this.getDataItem().set("text",this._invalidDateString),this.fireEvent("selectionChanged",this._invalidDateString))},_buildMinuteOptionCache:function(){var e,t,i;for(i=new Option(this._emptyMinutesText,this._emptyMinutesText),i.addClass("empty"),this._options.quarterHour.push(i),this._options.halfHour.push(i),this._options.minutes.push(i),e=0;60>e;e++)t=this._formatTimePart(e,"0"),i=new Option(t,e),0===e%15&&this._options.quarterHour.push(i),0===e%30&&this._options.halfHour.push(i),this._options.minutes.push(i)},_populateStaticOptions:function(){var e,t,i;for(this._skinParts.ampm.options.add(new Option("AM","AM")),this._skinParts.ampm.options.add(new Option("PM","PM")),i=new Option(this._emptyHoursText,this._emptyHoursText),i.addClass("empty"),this._skinParts.hours12.options.add(i),e=1;13>e;e++)t=this._formatTimePart(e),this._skinParts.hours12.options.add(new Option(t,e));for(i=new Option(this._emptyHoursText,this._emptyHoursText),i.addClass("empty"),this._skinParts.hours24.options.add(i),e=0;24>e;e++)t=this._formatTimePart(e),this._skinParts.hours24.options.add(new Option(t,e));for(i=new Option(this._emptySecondsText,this._emptySecondsText),i.addClass("empty"),this._skinParts.seconds.options.add(i),e=0;60>e;e++)t=this._formatTimePart(e,"0"),this._skinParts.seconds.options.add(new Option(t,e))},_allowEmpty:function(){return this.getComponentProperty("allowEmpty")===!0||"true"===this.getComponentProperty("allowEmpty")}})}),define.Class("wixapps.integration.gui.BasePresenter",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.fields({_appPart:null,_appInstance:null,_dataItemFactory:null,_typesManager:null,_model:null}),t.methods({initialize:function(e){this._appPart=e,this._appInstance=this._appPart.getAppInstance(),this._dataItemFactory=this._appInstance.getDataItemFactory(),this._typesManager=this._appInstance.getTypesManager(),this.createModel()},exportVars:function(){return{}},createModel:function(){throw"not implemented."},setupPresenter:function(e){this._dialogPanel=e},getModel:function(){return this._model},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.ChooseTemplatePresenter",function(e){var t=e;t.utilize(["wixapps.integration.managers.AppBuilderLocalizer"]),t.fields({_appInstance:null,_templateBundles:null,_onTemplateSelectedCB:null,_builderDialogPanel:null,_model:null,_localizer:null}),t.methods({initialize:function(e,t,i){this._appInstance=e,this._templateBundles=i,this._onTemplateSelectedCB=t,this._localizer=new this.imports.AppBuilderLocalizer},setupPresenter:function(e){var t=this._appInstance.getDataItemFactory();this._builderDialogPanel=e,this._model=t.createDataItem([]),this._getTemplateData()},_getLocalizedTitle:function(e){return this._localizer.localize("TEMPLATE_BUNDLE_NAME_"+e.id,e.friendlyName)},_getLocalizedDescription:function(e){return this._localizer.localize("TEMPLATE_BUNDLE_DESC_"+e.id,e.description)},_getTemplateData:function(){var e=this._templateBundles.map(function(e){var t="images/templates/"+e.id.toLowerCase()+".jpg";return{imageData:{_type:"wix:Image",src:t,width:360,height:280},title:this._getLocalizedTitle(e),description:this._getLocalizedDescription(e),id:e.id}}.bind(this));this._model.setValue(e)},onTemplateChosen:function(e){var t=e.data.getChildValue("id");this._onTemplateSelectedCB(t),this._builderDialogPanel.closeDialog(),e.cause.stopPropagation();var i=localStorage.getItem("app-builder-first-time-experience");i||(W.Commands.executeCommand("WEditorCommands.ShowHelpDialog","FirstTimeInAppBuilder"),localStorage.setItem("app-builder-first-time-experience","true"))},onTemplateMouseOver:function(e){var t=e.sender.getElement();t&&t.setStyles({"border-color":"#29a7eb","-webkit-box-shadow":"0px 2px 11px 2px rgba(0, 0, 0, .4)","box-shadow":"0px 2px 11px 2px rgba(0, 0, 0, .4)"});var i=t.getElement("[vcfield='hoverButton']");if(i){i.uncollapse();var n=i.getViewProxy();n._onAppResize&&n._onAppResize();var a=i.getElement("a");a&&a.setStyle("cursor","pointer")}var s=t.getElement("[vcfield='imageData']");if(s){var o=s.getElement("a");o&&o.setStyle("cursor","pointer")}},onTemplateMouseOut:function(e){var t=e.sender.getElement();t&&t.setStyles({"border-color":"transparent","-webkit-box-shadow":"none","box-shadow":"none"});var i=t.getElement("[vcfield='hoverButton']");if(i){i.collapse();var n=i.getViewProxy();n._onAppResize&&n._onAppResize()}},getModel:function(){return this._model},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.CollectionSettingsPresenter",function(e){var t=e;t.utilize(["wixapps.integration.managers.AppBuilderLocalizer"]),t.binds(["_buildModel"]),t.fields({_appInstance:null,_localizer:null,_selectedItems:{},_editState:"idle",_newDisplayName:null,_isNameValid:!0,_enableApplyBtn:!1}),t.resources(["W.ClipBoard","W.Commands","W.Preview"]),t.methods({initialize:function(e,t){this._appInstance=e,this._typeName=t,this._localizer=new this.imports.AppBuilderLocalizer,this._dataItemFactory=this._appInstance.getDataItemFactory();var i=this._appInstance.getTypesManager().getType(this._typeName);this._typeDisplayName=i.displayName,this._newDisplayName=this._typeDisplayName},setupPresenter:function(e){var t=this._appInstance.getDataItemFactory();this._model=t.createDataItem({}),this._builderDialogPanel=e,this._buildModel(),this._updateMetadata()},exportVars:function(){return{metaData:this._metaData}},_buildModel:function(){var e=this._appInstance.getAppPartDefinitions().filterByType(this._typeName,!0),t=this._appInstance.getPages().filterByType(this._typeName),i={lists:e.map(function(e){return{displayName:e.getDisplayName(),id:e.getId()}}),pages:t.map(function(e){return{displayName:e.getDisplayName(),id:e.getId()}})};this._model.setValue(i),this._updateMetadata()},_updateMetadata:function(){var e={collectionName:this._newDisplayName,isNameValid:this._isNameValid,enableApplyBtn:this._enableApplyBtn};this._metaData?this._metaData.setValue(e):this._metaData=this._dataItemFactory.createDataItem(e)},onDuplicateList:function(e){var t=this.resources.W.Preview.getPreviewManagers().Apps2,i=e.data.getChildValue("id"),n=t.getAppPartComponent(i);this.resources.W.ClipBoard.duplicateComp(n,n.getParentComponent().getViewNode()),this._builderDialogPanel.closeDialog()},onAddNewList:function(){this._builderDialogPanel.closeDialog(),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.CreateAppByCollection",{typeName:this._typeName,appInstance:this._appInstance}),this._builderDialogPanel.closeDialog()},onEditPage:function(){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.EditPageTemplate",{type:this._typeName,appInstance:this._appInstance}),this._builderDialogPanel.closeDialog()},onNameChange:function(e){this._newDisplayName=e.data.getValue();var t=this._isDisplayNameExists(this._newDisplayName),i=this._newDisplayName!==this._typeDisplayName;this._enableApplyBtn=i&&!t,this._isNameValid=!t,this._updateMetadata()},onNameApply:function(){if(this._newDisplayName)if(this._isDisplayNameExists(this._newDisplayName))this._isNameValid=!1,this._updateMetadata();else{var e=this._appInstance.getTypesManager(),t=e.getType(this._typeName);t.displayName=this._newDisplayName,e.registerType(t),this._typeDisplayName=this._newDisplayName,this._resetEditingState()}else this._resetEditingState()},onNameBlur:function(){this._resetEditingState()},_resetEditingState:function(){this._isNameValid=!0,this._newDisplayName=this._typeDisplayName,this._enableApplyBtn=!1,this._updateMetadata()},_isDisplayNameExists:function(e){var t=this._appInstance.getDataProviders().getWixDbDataProvider(),i=t.getManagedTypes(),n=i.map(function(e){return e.displayName});return n.contains(e)&&e!=this._typeDisplayName},getModel:function(){return this._model},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.CustomizationBinding",function(e){var t=e;t.binds(["_onInputProxyChange","_onColorSelectorChange","_onCustomizationChange"]),t.fields({_appInstance:null,_customization:null,_inputToCustomizationFn:null,_customizationToInputFn:null,_inputProxy:null,_listener:null}),t.resources(["W.Commands","W.UndoRedoManager"]),t.utilize(["wixapps.integration.utils.FunctionCallThrottle","wixapps.core.views.ViewsCustomizer"]),t.methods({initialize:function(e){this._appPart=e,this._appInstance=this._appPart.getAppInstance()},setupAutoPanelBinding:function(e,t,i,n,a){this._inputProxy=e,this._customization=t,this._inputToCustomizationFn=n,this._customizationToInputFn=a;var s=this._customization.value;void 0===s&&(s=i),this._updateInputProxyValue(s),this._inputProxy.addEvent("inputChanged",this._onInputProxyChange),this._inputProxy.addEvent("colorChanged",this._onColorSelectorChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.CustomizationChangeMade",this,this._onCustomizationChange)},setListener:function(e){this._listener=e},_updateInputProxyValue:function(e){if(this._customizationToInputFn){var t=this._customizationToInputFn(e);void 0!==t&&(e=t)}void 0!==e&&this._inputProxy.setValue(e)},updateInputProxyValueWithNewRule:function(e){e.forType==this._customization.forType&&e.view==this._customization.view&&e.fieldId==this._customization.fieldId&&e.mode==this._customization.mode&&e.key==this._customization.key&&this._updateInputProxyValue(e.value)},_onInputProxyChange:function(e){this._processProxyValue(e.value)},_onColorSelectorChange:function(e){var t=e.color;"value"===e.source&&(t=e.color.getHex()),this._processProxyValue(t)},_processProxyValue:function(e){var t=this._customization;if(this._inputToCustomizationFn){var i=this._inputToCustomizationFn(e);if(void 0===i)return;e=i}var n=this._appInstance.getViewDefinitions().getViewDefinition(t.forType,t.view),a=n.getValue();this.resources.W.UndoRedoManager.startTransaction();var s={forType:t.forType,view:t.view,fieldId:t.fieldId,mode:t.mode,key:t.key,value:e},o=this._appInstance.getViewsCustomizer().getCurrentRule(a,s);this.applyCustomizationRule(a,s),n.setValue(a),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.CustomizationChange",{viewDef:a,viewRepo:this._appInstance.getViewDefinitions(),newRule:s,oldRule:o,appPart:this._appPart})},_onCustomizationChange:function(e){this.updateInputProxyValueWithNewRule(e.rule)},applyCustomizationRule:function(e,t){var i=this.imports.ViewsCustomizer.getCurrentRule(e,t);this.imports.ViewsCustomizer.applyRule(e,t),this._listener&&this._listener(t.key,i.value,t.value)},dispose:function(){this._inputProxy.removeEvent("inputChanged",this._onInputProxyChange),this._inputProxy.removeEvent("colorChanged",this._onColorSelectorChange),this._inputProxy=null,this._appInstance=null,this._inputToCustomizationFn=null,this._customizationToInputFn=null}})}),define.Class("wixapps.integration.gui.CustomizeItemsPresenter",function(e){var t=e;t.inherits("wixapps.integration.gui.BasePresenter"),t.utilize(["wixapps.core.data.DataItemUtils"]),t.binds(["_createDataStructure","_onFieldAdded","onItemMoved","_onFieldRemoved","_updateModel"]),t.resources(["W.Utils","W.Commands","W.AppsEditor2","W.EditorDialogs"]),t.fields({_typeDef:{},_viewBuilder:null,_typesHelper:null,_fieldHighlighter:null,_dataItemUtils:null}),t.methods({initialize:function(e,t,i,n,a){this._typeDef=i,this._viewBuilder=this.resources.W.AppsEditor2.getViewBuilder(),this._typesHelper=this.resources.W.AppsEditor2.getTypesHelper(),this._dataItemFactory=e.getDataItemFactory(),this._viewDataItem=n.getViewDefinition(),this._parentUpdateModel=a,this._fieldHighlighter=this.resources.W.AppsEditor2.getFieldHighlighter(),this._dataItemUtils=new this.imports.DataItemUtils,this.parent(n)},createModel:function(){this._model=this._dataItemFactory.createDataItem([])},setupPresenter:function(e){this.parent(e),this._createDataStructure(),this._isReady=!0},onTypeChanged:function(e){this._typeDef=e.newType,this._createDataStructure()},onViewChanged:function(e){if(e.phase==Constants.DataItemEventPhase.ON_TARGET){var t=this._dataItemUtils.createDataChangeEventList(e,this._data),i=t.some(function(e){return"add"==e.type||"delete"==e.type});i&&this._createDataStructure()}},_loc:function(e,t){return this.resources.W.AppsEditor2.localize(e,t)},_onFieldAdded:function(){this._createDataStructure()},_onFieldRemoved:function(){this._createDataStructure()},_getFieldDisplayName:function(e){var t=this._typeDef.fields.filter(function(t){return t.name===e});if(0===t.length)throw"CustomizeItemsPresenter:: field ["+e+"] was not found in type definition.";return t[0].displayName},_getFieldIconClass:function(e){switch(e.compName){case"Label":return"text";case"Image":return"image";case"Video":return"video";case"RichText":return"richtext";case"Button2":return"button";default:return"text"}},_createDataStructure:function(){var e=[],t=this._viewDataItem.getValue(),i=this._viewBuilder.getViewFieldsMapping(t),n=this._addShownContainersAndFields(i,e);this._addHiddenContainer(e),this._addHiddenFields(n,e),this._model.setValue([]),this._model.setValue(e)},_addShownContainersAndFields:function(e,t){for(var i,n,a,s={},o=0;e.length>o;o++)if(i=e[o],t.push({isContainer:!0,displayName:i.containerName,containerId:i.containerId,dragEnabled:!1,hasFields:i.hasFields,iconType:"none",fieldIcon:"none",showEditLabel:!1,orientation:i.orientation,hideEditLink:!1}),i.hasFields&&(n=i.containerFields,n.length>0))for(var r=0;n.length>r;r++){a=n[r];var l={isContainer:!1,containerId:a.containerId,hasFields:!1,displayName:this._getFieldDisplayName(a.data),iconType:"arrow",dragEnabled:!0,fieldIcon:this._getFieldIconClass(a),showEditLabel:!1,hideEditLink:!1,boxOrientation:i.orientation};s[a.data]=!0,t.push(Object.merge(l,a))}return s},_addHiddenContainer:function(e){e.push({isContainer:!0,displayName:this._loc("DESIGN_PANEL_HiddenFields"),containerId:"Hidden",dragEnabled:!1,hasFields:!0,iconType:"none",fieldIcon:"none",showEditLabel:!1,orientation:"-- Not relevant --",hideEditLink:!1})},_addHiddenFields:function(e,t){for(var i=this._typesHelper.getDisplayableFields(this._typeDef),n=0;i.length>n;n++){var a=i[n];if(e.hasOwnProperty(a.name)===!1){var s={isContainer:!1,data:a.name,displayName:a.displayName,type:a.type,containerId:"Hidden",hasFields:!1,iconType:"hidden",dragEnabled:!0,fieldIcon:"text",showEditLabel:!1,hideEditLink:!0,boxOrientation:"-- Not relevant --"};t.push(s)}}},runWhenReady:function(e){this._isReady?e():this.resources.W.Utils.callLater(this.runWhenReady,[e])},addField:function(){this.resources.W.AppsEditor2.openAddFieldDialog(this._appPart)},onItemMoved:function(e){var t=e.cause.oldIdx,i=e.cause.idx,n=e.sender,a=n.getViewContext().getData().getValue(),s=a[t],o=s.id,r=s.displayName,l=s.data,p=s.type,d="hidden"===s.containerId.toLowerCase();a.splice(t,1);var h=this._viewDataItem.getValue(),c=Object.clone(h);if(t!=i){var u=this._getContainerByIndex(t,a),m=this._getContainerByIndex(i,a);if(!u||!m)return this._createDataStructure(),void 0;t-=u.indexInList+1,i-=m.indexInList+1;var g=u.data.containerId,_=m.data.containerId;"Hidden"==_?this.resources.W.Commands.executeCommand("WAppsEditor2Commands.HideField",{appPart:this._appPart,fieldId:o}):d?this.resources.W.Commands.executeCommand("WAppsEditor2Commands.AddExtraField",{appPartLogic:this._appPart,typeFieldId:l,fieldTemplateKey:this._viewBuilder.getDefaultTemplateKey(p),fieldDisplayName:r,extraFieldContainerId:_}):(_===g?this._viewBuilder.reorderExtraFields(h,g,t,i):this._viewBuilder.moveField(h,o,_,i),this._viewDataItem.setValue(h),W.UndoRedoManager.startTransaction(),W.Commands.executeCommand("WAppsEditor2Commands.Undo.ViewDefinitionChange",{viewRepo:this._appInstance.getViewDefinitions(),oldValue:c,newValue:h,appPart:this._appPart}),W.UndoRedoManager.endTransaction()),this._createDataStructure()}},_getContainerByIndex:function(e,t){var i,n=t;for(i=e-1;i>=0;i--)if(n[i].isContainer)return{data:n[i],indexInList:i}},onFieldClicked:function(e){var t=e.data.getValue();"Hidden"!==t.containerId&&this.resources.W.AppsEditor2.openEditFieldDialog(t,this._appPart,this._updateModel)},_updateModel:function(){this._createDataStructure(),this._parentUpdateModel()},onEditFieldBox:function(e){var t=e.data.getValue();this.resources.W.AppsEditor2.openEditFieldBoxDialog(t,this._appPart,this._createDataStructure)},openListSettingsPanel:function(){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.CloseAppBuilderManageDialog"),this.resources.W.Commands.executeCommand(Constants.EditorUI.OPEN_PROPERTY_PANEL,{forceOpen:!0})},getAcceptableDataTypes:function(){return["AppBuilderComponent",""]},onFieldMouseOver:function(e){var t=e.sender.getData().getChildValue("id"),i=e.sender.getData().getChildValue("containerId");this._fieldHighlighter.highlightField({appPart:this._appPart,fieldId:t,containerId:i})},onFieldMouseOut:function(){this._fieldHighlighter.removeHighlightField({appPart:this._appPart})},onFieldBoxMouseOver:function(e){e.data.getChildByRef("showEditLabel").setValue(!0)},onFieldBoxMouseOut:function(e){e.data.getChildByRef("showEditLabel").setValue(!1)},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.DataEditPresenter",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize(["wixapps.integration.utils.SelectionMarker","wixapps.integration.gui.EditViewGenerator","wixapps.integration.gui.ManageItemsPresenter"]),t.traits([]),t.binds(["_onModelChanged","_onOriginalItemChanged"]),t.resources(["W.AppsGUI","W.Utils","W.EditorDialogs","W.AppsEditor2","W.Commands"]),t.fields({_generatedViewPart:null,_metaData:null,_presetViewName:"AppBuilder",_editViewGenerator:null,_appPart:null,_typesManager:null,_itemsData:null,_model:null,_currentIndex:-1,_isInRichTextEditing:!1}),t.methods({initialize:function(e,t,i,n,a,s){this._appPart=e,this._isExpandedFunc=a,this._onExpand=s,this._usedDataSelector=i,this._listCursor=t,this._itemsData=n,this._typeName=this._appPart.getAppPartDefinition().getType(),this._appInstance=this._appPart.getAppInstance(),this._typesManager=this._appInstance.getTypesManager(),this._typeDef=this._typesManager.getType(this._typeName),this._dataItemFactory=this._appInstance.getDataItemFactory(),this._editViewGenerator=new this.imports.EditViewGenerator(this._typesManager),this._isInRichTextEditing=!1,this.resources.W.Commands.registerCommand("WAppsEditor2Commands.BeforeStartEditingText",!0),this.resources.W.Commands.registerCommandListenerByName("WAppsEditor2Commands.BeforeStartEditingText",this,this._onBeforeStartEditingText);var o=this.resources.W.Commands.getCommand("WEditorCommands.StopEditingText");o&&o.registerListener(this,this._onStopEditingText);var r={_iid:"NULL_ITEM",_type:this._typeName};this._model=this._dataItemFactory.createDataItem(r),this._typesManager.applyDefaults(this._model),this._model.addEvent(Constants.DataItemEvents.CHANGE,this._onModelChanged)},_onBeforeStartEditingText:function(){this._isInRichTextEditing=!0,this._updateMetadata()},_onStopEditingText:function(){this._isInRichTextEditing=!1,this._updateMetadata()},exportVars:function(){return{generatedViewPart:this._generatedViewPart,metaData:this._metaData}},_updateOriginalDataItem:function(){this._originalDataItem&&this._originalDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._onOriginalItemChanged);var e=this._listCursor.getCurrentItemIndex();this._originalDataItem=this._itemsData.getChildByIndex(e),this._originalDataItem&&this._originalDataItem.addEvent(Constants.DataItemEvents.CHANGE,this._onOriginalItemChanged)},setupPresenter:function(){0>this._listCursor.getCurrentItemIndex()&&this._listCursor.next(),this.rebuildModel(),this.updateGeneratedViewPart(),this._updateMetadata()},getModel:function(){return this._model},rebuildModel:function(e){this._updateOriginalDataItem(),this._originalDataItem?(this._model.setValue(this._originalDataItem.getValue()),e&&this._updateMetadata()):this._updateMetadata()},_onModelChanged:function(){!this._ignoreOriginalChanges&&this._originalDataItem&&(this._ignoreModelChanges=!0,this._originalDataItem.setValue(this._model.getValue()),this._ignoreModelChanges=!1,this._updateMetadata())},_onOriginalItemChanged:function(){this._ignoreModelChanges||this._originalDataItem&&(this._ignoreOriginalChanges=!0,this._model.setValue(this._originalDataItem.getValue()),this._ignoreOriginalChanges=!1)},gotoNext:function(){this._listCursor.next()},gotoPrev:function(){this._listCursor.prev()},createDataItem:function(){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{appPart:this._appPart,dataSelector:this._usedDataSelector})},removeDataItem:function(){var e=this._listCursor.getCurrentItemIndex(),t=this._itemsData.getChildByIndex(e);if(t){var i=t.getChildValue("_iid");this.resources.W.Commands.executeCommand("WAppsEditor2Commands.RemoveDataItem",{appPart:this._appPart,dataItemId:i})}},duplicateDataItem:function(){var e=this._model.getValue();delete e._createdAt,delete e._updatedAt,e._iid=this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId(),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{appPart:this._appPart,rawData:e})},hideItem:function(){var e=this._listCursor.getCurrentItemIndex();if(e>=0){var t=this._usedDataSelector.getItemIds()[e];this._setVisibility(t,!1)}},organizeClicked:function(){this._onExpand()},showItem:function(){var e=this._getCurrentDataItemId();this._setVisibility(e,!0)},createField:function(){this.resources.W.AppsEditor2.openAddFieldDialog(this._appPart,!0)},selectItems:function(){W.Commands.executeCommand("WAppsEditor2Commands.DataItemSelectionRequested",{dataSelector:this._appPart.getDataSelector(),type:this._typeName,appInstance:this._appInstance})},_setVisibility:function(e,t){if(e){var i=this._usedDataSelector.isHidden(e);this._usedDataSelector.setVisibility(e,t),W.UndoRedoManager.startTransaction(),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataSelectorChange",{changeType:"Hide",selector:this._usedDataSelector,dataItemId:e,newValue:t,oldValue:i,appPart:this._appPart}),this._updateMetadata(),W.UndoRedoManager.endTransaction()}},_getCurrentDataItemId:function(){var e=this._listCursor.getCurrentItemIndex();return e>=0?this._usedDataSelector.getItemIds()[e]:void 0},onTypeChanged:function(e){this._typeDef=e.newType,this._typesManager.applyDefaults(this._model),this.updateGeneratedViewPart(),this.rebuildModel(!0)},updateGeneratedViewPart:function(){var e=this._editViewGenerator.generateViews(this._presetViewName,this._typeDef);this._generatedViewPart?this._generatedViewPart.setValue(e):this._generatedViewPart=this._dataItemFactory.createDataItem(e)},_updateMetadata:function(){var e=this._model.getChildValue("_iid"),t=this._usedDataSelector.getHiddenItemIds().contains(e),i=this._appPart.getDataSelector().isListSelector()===!1,n=this.resources.W.AppsEditor2.getTypesHelper().getDisplayableFields(this._typeDef),a=this._isInRichTextEditing,s=this._typeDef.displayName,o={hidden:t,noItems:0===this._itemsData.getChildren().length,pagingLabel:this._createPagingLabel(),noFields:0===n.length,expanded:this._isExpandedFunc(),isList:i,noAvailItems:!0,isInRichTextEditing:a,typeFriendlyName:s};this._metaData?this._metaData.setValue(o):this._metaData=this._dataItemFactory.createDataItem(o)},getAppPart:function(){return this._appPart},onPanelExpand:function(){this._updateMetadata();var e=this._appPart.getAppInstance().getLogger();e.reportEvent(e.Events.APP_BUILDER_ORGANIZE_CLICKED,{})},_createPagingLabel:function(){var e=this._listCursor.getCurrentItemIndex()+1,t=this._itemsData.getChildren().length,i=this.resources.W.AppsEditor2.localize("DATA_EDIT_PANEL_ITEM_COUNT");return i=i.replace("%index%",e).replace("%total%",t)},dispose:function(){this._model.removeEvent(Constants.DataItemEvents.CHANGE,this._onModelChanged),this._originalDataItem&&this._originalDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._onOriginalItemChanged),this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.BeforeStartEditingText");var e=this.resources.W.Commands.getCommand("WEditorCommands.StopEditingText");e&&e.unregisterListener(this)}})}),define.Class("wixapps.integration.gui.DataItemsSelectionPresenter",function(e){var t=e;t.utilize(["wixapps.integration.managers.AppBuilderLocalizer"]),t.binds(["_buildModel"]),t.fields({_appInstance:null,_localizer:null,_selectedItems:{}}),t.methods({initialize:function(e,t,i,n,a){this._dataSelector=e,this._type=t,this._appInstance=i,this._okCallback=n||function(){},this._cancelCallback=a||function(){},this._localizer=new this.imports.AppBuilderLocalizer,this._dataItemFactory=this._appInstance.getDataItemFactory()},setupPresenter:function(e){var t=this._appInstance.getDataItemFactory();this._builderDialogPanel=e,this._model=t.createDataItem([]),this.resource.getResourceValue("W.AppsEditor2",function(e){this._appsEditor2Mgr=e,this._allItemsOfTypeSelector=e.getAllItemsOfTypeDataSelector(this._type,this._appInstance),this._allItemsOfTypeSelector.getItems(this._buildModel)}.bind(this)),this._updateMetadata()},exportVars:function(){return{metaData:this._metaData}},_buildModel:function(e){for(var t=this._dataSelector.getItemIds(),i=this._dataSelector.getHiddenItemIds(),n=[],a=[],s=0;e.length>s;s++){var o=e[s],r=o.getChildValue("_iid"),l=i.contains(r),p=t.contains(r)||l,d={id:r,title:o.getChildValue("title"),selected:p,hidden:l};if(p){var h=t.indexOf(r);n.splice(h,0,d),this._setItemSelectionState(r,!0,l)}else a.push(d)}this._model.setValue(n.append(a)),this._updateMetadata()},_updateMetadata:function(){var e={selectionCountLabel:this._createSelectionCount()};this._metaData?this._metaData.setValue(e):this._metaData=this._dataItemFactory.createDataItem(e)},_createSelectionCount:function(){var e=Object.keys(this._selectedItems).length+"",t=this._model.getChildren().length+"",i=this._appsEditor2Mgr.localize("DATA_ITEMS_SELECTION_ITEM_COUNT");return i=i.replace("%count%",e).replace("%total%",t)},onItemClick:function(e){var t=e.context._data.getChildValue("id"),i=e.context._data.getChildValue("hidden"),n=e.data.getValue();this._setItemSelectionState(t,n,i)},selectAll:function(){this._updateAllItemsWithSelection(!0)},selectNone:function(){this._updateAllItemsWithSelection(!1)},_updateAllItemsWithSelection:function(e){for(var t=this._model.getValue(),i=0;t.length>i;i++){var n=t[i];n.selected=e,this._setItemSelectionState(n.id,e,n.hidden)}this._model.setValue(t)},_setItemSelectionState:function(e,t,i){t?this._selectedItems[e]={selected:!0,hidden:i}:delete this._selectedItems[e],this._updateMetadata()},onBeforeDialogClose:function(e){e&&"OK"==e.result?(this._updateDataSelector(),this._okCallback(this._dataSelector)):this._cancelCallback()},_updateDataSelector:function(){var e=[],t=[];Object.each(this._selectedItems,function(i,n){var a=this._dataSelector.getItemIdIndex(n);a=a>=0?a:e.length,e.splice(a,0,n),i.hidden&&t.push(n)}.bind(this)),this._dataSelector.setItemIds(e),this._dataSelector.setHiddenItemIds(t)},getModel:function(){return this._model},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.EditViewGenerator",function(e){var t=e;t.binds(["_generateFieldRepeater"]),t.utilize(["wixapps.integration.gui.EditViewGeneratorIdioms"]),t.resources(["W.AppsEditor2"]),t.fields({_idioms:null,_viewBuilder:null,_typesHelper:null,_typesManager:null}),t.methods({initialize:function(e){this._idioms=new this.imports.EditViewGeneratorIdioms,this._viewBuilder=this.resources.W.AppsEditor2.getViewBuilder(),this._typesHelper=this.resources.W.AppsEditor2.getTypesHelper(),this._typesManager=e},generateViews:function(e,t){var i=this._typesHelper.getDisplayableFields(t),n=i.map(this._generateFieldRepeater);return n.forEach(function(e){this._injectUniqueIDs(e)}.bind(this)),n},_injectUniqueIDs:function(e){var t=0,i=function(e){e.id||(e.id="def"+(t++ +"")),e.comp&&e.comp.items&&e.comp.items.forEach(i)};i(e)},_createEditFieldLabel:function(e){var t=e.displayName||e.name,i=this._idioms.label(t);return i.layout={spacerAfter:5},i},_generateFieldRepeater:function(e){return this._idioms.vbox([this._createEditFieldLabel(e),this._idioms.vspacer(5),this._viewBuilder.getBaseFieldTemplate(e.type,Constants.WixApps.EDIT_TEMPLATE_NAME,e.name),this._idioms.vspacer(15)])}})}),define.Class("wixapps.integration.gui.EditViewGeneratorIdioms",function(e){var t=e;t.resources(["W.Utils"]),t.methods({initialize:function(){this._utils=this.resources.W.Utils.AppsUtils},label:function(e){return{value:e,comp:{name:"Label"}}},inlineTextInput:function(e,t){var i={value:e,comp:{name:"InlineTextInput"}};return t&&(i.comp.events={inputChanged:t}),i},boundLabel:function(e){return{id:this._utils.getTimeBasedUniqueId(),data:e,comp:{name:"Label"}}},link:function(e,t){var i=this.button(e,t);return i.comp.align="right",i.comp.skin="wixapps.integration.skins.editor.LinkButton",i},hspacer:function(e){return{comp:{name:"HSpacer",size:e}}},vspacer:function(e){return{comp:{name:"VSpacer",size:e}}},hbox:function(e){return this.container("HBox",e)},vbox:function(e){return this.container("VBox",e)},container:function(e,t){return{comp:{name:e,items:t}}},vlist:function(e){return{comp:{name:"VerticalList",templates:{item:e}}}},button:function(e,t){return{comp:{name:"Button",label:e,skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:t}}}},linkSelector:function(e){return{id:this._utils.getTimeBasedUniqueId(),data:e,comp:{name:"LinkSelector"}}}})}),define.Class("wixapps.integration.gui.EventBinding",function(e){var t=e;t.binds(["_onInternalEvent"]),t.fields({_presenter:null,_eventDispatcher:null,_handledEvents:[]}),t.methods({initialize:function(e,t){this._eventDispatcher=e,this._presenter=t
},setupHandlers:function(e){this._handledEvents=this._getRelevantEventTypes(e),this._handledEvents.each(function(e){this._eventDispatcher.addEvent(e,this._onInternalEvent)}.bind(this))},_getEventType:function(e){return"string"==typeOf(e)?e:e.event},_getEventsRecursively:function(e){var t=[];for(var i in e)if(i){var n=e[i];"events"==i&&(t=t.concat(Object.values(n).map(this._getEventType))),("object"==typeOf(n)||"array"==typeOf(n))&&(t=t.concat(this._getEventsRecursively(n)))}return t},_getRelevantEventTypes:function(e){return this._getEventsRecursively(e).map(function(e){return"string"==typeOf(e)?e:e.event}).filter(function(e){return e&&0===e.indexOf("presenter.")}).reduce(function(e,t){return-1==e.indexOf(t)?e.concat(t):e},[])},_onInternalEvent:function(e){var t=e.type,i=t.split(".");if(i.length>1&&"presenter"==i[0]){var n=this._presenter[i[1]];if(!n||"function"!==typeOf(n))throw"EventBinding: function '"+i[1]+"()' not defined on the presenter '"+this._presenter.className+"'";n.call(this._presenter,e)}},dispose:function(){this._handledEvents.each(function(e){this._eventDispatcher.removeEvent(e,this._onInternalEvent)}.bind(this)),this._eventDispatcher=null,this._presenter=null}})}),define.Class("wixapps.integration.gui.FieldBoxEditPresenter",function(e){var t=e;t.binds(["updateModel"]),t.fields({_fieldBoxMetaData:null,_appPart:null,_viewName:null,_updateModel:null,_appInstance:null,_customizationTemplate:null}),t.methods({initialize:function(e,t,i){this._fieldBoxMetaData=e,this._appPart=t,this._appInstance=t.getAppInstance(),this._updateModel=i},setupPresenter:function(){var e=this._appPart.getAppPartDefinition(),t=this._appPart.getAppPartDefinition().getType(),i=e.getViewName();this._customizationTemplate={forType:t,view:i,fieldId:this.getFieldBoxId(),mode:"view"}},getAppInstance:function(){return this._appInstance},getAppPart:function(){return this._appPart},getCustomizationTemplate:function(){return this._customizationTemplate},getFieldBoxId:function(){return this._fieldBoxMetaData.containerId},getFieldBoxName:function(){return this._fieldBoxMetaData.containerName},getFieldBoxOrientation:function(){return this._fieldBoxMetaData.orientation},getItemView:function(){var e=this._appPart.getAppPartDefinition().getType(),t=this._appPart.getAppPartDefinition().getViewName();return this._appInstance.getViewDefinitions().getViewDefinition(e,t)},isFieldBoxVertical:function(){return"vertical"===this._fieldBoxMetaData.orientation},updateModel:function(){this._updateModel()},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.FieldEditPresenter",function(e){var t=e;t.binds(["_fieldDisplayNameChanged"]),t.fields({_editedFieldMetaData:null,_appPart:null,_appInstance:null,_customizationTemplate:null,_fieldInfo:null,_typeDef:null,_associatedProxy:null,_fieldDisplayNameDataItem:null}),t.methods({initialize:function(e,t,i){this._editedFieldMetaData=e,this._appPart=t,this._updateModel=i,this._appInstance=t.getAppInstance()},setupPresenter:function(){var e=this._appPart.getViewNode();this._associatedProxy=this._findAssociatedProxy(this.getFieldId(),e);var t=this._appPart.getAppPartDefinition(),i=t.getViewName(),n=this._appInstance.getTypesManager();this._typeName=t.getType(),this._typeDef=n.getType(this._typeName),this._customizationTemplate={forType:this._typeName,view:i,fieldId:this.getFieldId(),mode:"view"}},getAppInstance:function(){return this._appInstance},getAppPart:function(){return this._appPart},getCustomizationTemplate:function(){return this._customizationTemplate},getItemView:function(){var e=this._appPart.getAppPartDefinition().getType(),t=this._appPart.getAppPartDefinition().getViewName();return this._appInstance.getViewDefinitions().getViewDefinition(e,t)},getAssociatedProxy:function(){return this._associatedProxy},getEditedFieldMetaData:function(){return this._editedFieldMetaData},getFieldId:function(){return this._editedFieldMetaData.id},getFieldName:function(){return this._editedFieldMetaData.data},getFieldType:function(){return this._editedFieldMetaData.fieldType},getFieldContainerId:function(){return this._editedFieldMetaData.containerId},getFieldContainerName:function(){return this._editedFieldMetaData.containerName},setFieldContainerId:function(e){this._editedFieldMetaData.containerId=e},setFieldContainerName:function(e){this._editedFieldMetaData.containerName=e},getCompName:function(){return this._editedFieldMetaData.compName},getBoxOrientation:function(){return this._editedFieldMetaData.boxOrientation},getFieldInfo:function(){var e=this.getFieldName();return this._typeDef.fields.first(function(t){return t.name===e})},getFieldDisplayName:function(){return this._editedFieldMetaData.displayName},setFieldDisplayName:function(e){this._fieldDisplayNameChanged(e)},_fieldDisplayNameChanged:function(e){var t=this.getFieldInfo();t.displayName=this._appPart.getUniqueFieldName(t.name,e),this._editedFieldMetaData.displayName=t.displayName,this._appInstance.getDataProviders().getWixDbDataProvider().updateType(this._typeDef),this._appInstance.fireEvent(Constants.WixAppEvents.TYPE_CHANGE,{typeName:this._typeName,oldType:this._typeDef,newType:this._typeDef})},_findAssociatedProxy:function(e,t){var i=t.getElements("[hasproxy]").map(function(e){return e.getViewProxy()}).filter(function(t){return t.getFieldId()===e});return i.length>0?i[0]:null},updateModel:function(){this._updateModel()},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.ListAddedPresenter",function(e){var t=e;t.inherits("wixapps.integration.gui.BasePresenter"),t.resources(["W.Editor"]),t.fields({_dontShowAgainDataItem:null}),t.methods({initialize:function(e){this.parent(e)},createModel:function(){var e=this._appPart.getAppPartDefinition().getType(),t={_type:e};this._model=this._dataItemFactory.createDataItem(t),this._typesManager.applyDefaults(this._model),this._dontShowAgainDataItem=this._dataItemFactory.createDataItem(!0),this._model.addEvent(Constants.DataItemEvents.CHANGE,this._onModelChanged)},exportVars:function(){return{dontShowAgain:this._dontShowAgainDataItem}},onDontShowAgainChange:function(e){this._dontShowAgainDataItem.setValue(e.data.getValue())},onBeforeDialogClose:function(e){if("OK"===e.result){var t=this.resources.W.Editor.getEditorPreferences(),i=t.get("dontShowAgainDialogs");this._dontShowAgainDataItem.getValue()===!0||"true"===this._dontShowAgainDataItem.getValue()?i.include("AppBuilderListAdded"):i.erase("AppBuilderListAdded"),t.fireDataChangeEvent()}}})}),define.Class("wixapps.integration.gui.ManageItemsPresenter",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize([]),t.traits([]),t.binds(["onItemMoved","onShowHideItem","onSelectionChanged","_onSharedDataChange"]),t.resources(["W.Utils","W.Commands","W.AppsEditor2"]),t.fields({_viewsCustomizer:null,_dataSelector:null,_model:null,_idioms:null,_selectedItemIndex:-1,_metaData:null}),t.methods({initialize:function(e,t,i,n,a){this._appPart=e,this._appInstance=e.getAppInstance(),this._typeDef=n,this._typeName=this._typeDef.name,this._itemsData=i,this._appPartDataSelector=t,this._dataItemFactory=this._appInstance.getDataItemFactory(),this._model=this._dataItemFactory.createDataItem([]),this._listCursor=a,this._itemsData.addEvent(Constants.DataItemEvents.CHANGE,this._onSharedDataChange)},setupPresenter:function(){this.rebuildModel(),this._isReady=!0},runWhenReady:function(e){this._isReady?e():W.Utils.callLater(this.runWhenReady,[e])},rebuildModel:function(){this._createModel(),this._updateMetadata()},_loc:function(e,t){return this.resources.W.AppsEditor2.localize("MANAGE_ITEMS_PANEL_"+e,t)},_onSharedDataChange:function(){this.rebuildModel()},_getNoTitleFieldText:function(e){return this._loc("TextWhenTitleFieldWasNotFound")+" "+e},_createModel:function(){for(var e=[],t=this._appPartDataSelector.getHiddenItemIds(),i=this._listCursor.getCurrentItemIndex(),n=this._itemsData.getChildren(),a=this._getTitleFieldName(),s=0;n.length>s;s++){var o=n[s],r=o.getChildValue("_iid"),l=t.contains(r),p={itemId:r,title:null!==a?o.getChildValue(a):this._getNoTitleFieldText(s),hidden:l,iconType:l?"hidden":"arrow",selected:i==s};e.push(p)}this.resources.W.Utils.AppsUtils.deepEquals(this._model.getValue(),e)||(this._model.setValue([]),this._model.setValue(e))},exportVars:function(){return{metaData:this._metaData}},_updateMetadata:function(){var e={noItems:0===this._itemsData.getChildren().length,noAvailItems:!0};this._metaData?this._metaData.setValue(e):this._metaData=this._dataItemFactory.createDataItem(e)},onTypeChanged:function(e){this._typeDef=e.newType,this.rebuildModel()},getModel:function(){return this._model},onAddItem:function(){W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{appPart:this._appPart,onDataItemAdded:function(){this.rebuildModel()}.bind(this)})},onItemMoved:function(e){var t=e.cause.oldIdx,i=e.cause.idx;W.UndoRedoManager.startTransaction(),this._appPartDataSelector.moveItem(t,i),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataSelectorChange",{changeType:"Move",selector:this._appPartDataSelector,dataItemId:this._appPartDataSelector.getItemIds()[t],newValue:i,oldValue:t,appPart:this._appPart}),W.UndoRedoManager.endTransaction()},onShowHideItem:function(){this.rebuildModel()},selectItems:function(){W.Commands.executeCommand("WAppsEditor2Commands.DataItemSelectionRequested",{dataSelector:this._appPartDataSelector,type:this._typeName,appInstance:this._appInstance})},onSelectionChanged:function(e){var t=e.cause.idx;0>t||this._listCursor.setSelectedIndex(t)},_getTitleFieldName:function(e){for(var t="1000",i=function(e){var i=e.type,n=e.name,a=e.displayName,s=t;return s=a.test(/title/i)?17:a.test(/description/i)?18:"String"===i?20:"wix:RichText"===i?25:t,{mark:s,fieldName:n}},n=this.resources.W.AppsEditor2.getTypesHelper().getDisplayableFields(e||this._typeDef),a={mark:t,fieldName:null},s=0;n.length>s;s++){var o=n[s],r=i(o);r.mark<=a.mark&&(a=r)}return a.fieldName},dispose:function(){this._itemsData.removeEvent(Constants.DataItemEvents.CHANGE,this._onSharedDataChange),this.parent()},getAcceptableDataTypes:function(){return["AppBuilderComponent",""]}})}),define.Class("wixapps.integration.gui.MoveFieldPresenter",function(e){var t=e;t.binds(["_createDataStructure"]),t.fields({_viewBuilder:null}),t.methods({initialize:function(e,t,i,n,a){this._fieldId=e,this._containerName=t,this._appPart=i,this._updateModel=a,this._appInstance=i.getAppInstance(),this._viewBuilder=n,this._dataItemFactory=this._appInstance.getDataItemFactory(),this._model=this._dataItemFactory.createDataItem({}),this._viewDataItem=this._appPart.getViewDefinition(),this._viewDefinitionRaw=this._viewDataItem.getValue()},setupPresenter:function(e){this._builderDialogPanel=e,this._model.setValue(this._createDataStructure())},_createDataStructure:function(){var e=this._viewBuilder.getViewFieldsMapping(this._viewDefinitionRaw),t=this._containerName,i=e.map(function(e){return{value:e.containerId,text:e.containerName,enabled:!0,description:""}}).filter(function(e){return e.text!==t});return{possibleContainers:{selectedValue:i[0].value,items:i}}},onContainerChosen:function(e){var t=e.context.getData().getValue().possibleContainers;if(t){var i=t.items.filter(function(e){return e.value===t.selectedValue})[0],n=Object.clone(this._viewDefinitionRaw);this._viewBuilder.moveField(this._viewDefinitionRaw,this._fieldId,i.value),this._appPart.getViewDefinition().setValue(this._viewDefinitionRaw),this._updateModel(i.value,i.text),this._builderDialogPanel.closeDialog(),W.UndoRedoManager.startTransaction(),W.Commands.executeCommand("WAppsEditor2Commands.Undo.ViewDefinitionChange",{viewRepo:this._appInstance.getViewDefinitions(),oldValue:n,newValue:this._viewDefinitionRaw,appPart:this._appPart}),W.UndoRedoManager.endTransaction()}},onCancel:function(){this._builderDialogPanel.closeDialog()},getModel:function(){return this._model},dispose:function(){this._viewDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._createDataStructure),this.parent()}})}),define.component("wixapps.integration.gui.SelectionHandler",function(e){var t=e;t.utilize(["wixapps.integration.utils.ProxySelector","wixapps.integration.utils.SelectionMarker"]),t.traits([]),t.binds(["_onComponentSelectionChange","_onSelectorAction"]),t.resources(["W.Preview","W.Commands"]),t.skinParts({}),t.states(),t.dataTypes(),t.fields({_proxySelector:null,_selectionMarker:null,_appPart:null,_currentItemIndex:-1,_currentDataItem:null}),t.methods({initialize:function(){this._selectionMarker=new this.imports.SelectionMarker,this._proxySelector=new this.imports.ProxySelector,this.resources.W.Commands.registerCommand("WAppsEditor2Commands.SelectionChanged"),this.resources.W.Commands.registerCommandListenerByName("WEditorCommands.SelectedComponentChange",this,this._onComponentSelectionChange,null,!0),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged),this._proxySelector.addEvent(this.imports.ProxySelector.SELECTION_ACTION,this._onSelectorAction)},next:function(){this.setSelectedIndex(++this._currentItemIndex)},prev:function(){this.setSelectedIndex(--this._currentItemIndex)},last:function(){this.setSelectedIndex(this._appPart.getAppPartData().getChildren().length-1)},first:function(){this.setSelectedIndex(0)},setSelectedIndex:function(e,t){var i=this._currentItemIndex,n=this._appPart.getAppPartData().getChildren().length,a=this._appPart.getDataSelector();return 0===n?(this._currentItemIndex=-1,a.isListSelector()&&a.resetSelectedItem(),void 0):(this._currentItemIndex=e>=n?n-1:0>e?0:e,a.isListSelector()&&a.setSelectedItemByIndex(this._currentItemIndex),this._markCurrentProxy(i,t),void 0)},removeSelection:function(){this._selectionMarker.unmarkSelectedSubComponent(),this._currentItemIndex=-1,this._currentDataItem=void 0},getCurrentItemIndex:function(){return this._currentItemIndex},getCurrentDataItem:function(){return this._currentDataItem},_onEditModeChanged:function(e){this._appPart&&"PREVIEW"==e&&this.removeSelection()},_onComponentSelectionChange:function(e){this.removeSelection(),"wixapps.integration.components.AppPart2"==e.comp.className&&(this._appPart=e.comp,this.resources.W.Commands.executeCommand("WAppsEditor2Commands.RefreshAppBuilderManageDialog",{appPart:this._appPart}),this._typeName=null,this._appPart.getAppPartDefinition()&&(this._typeName=this._appPart.getAppPartDefinition().getType()),this.resources.W.Preview.getPreviewManagersAsync(function(e){this._selectionMarker.initUIColors(e.Theme,this._appPart)},this),this._proxySelector.deactivateProxySelectorIfActivated(),this._proxySelector.activateProxySelector(this._appPart,function(e){return e.getViewContext()&&e.getViewContext().getEnvironment()&&e.getViewContext().getEnvironment().getForType()==this._typeName}.bind(this)),this._markCurrentProxy())},_onSelectorAction:function(e){if(e.action==this.imports.ProxySelector.ACTION_MOUSE_DOWN&&this._appPart){var t=e.proxyList[e.proxyList.length-1];if(this._currentDataItem=t.getData(),this._appPart.getDataSelector().isListSelector()){var i=this._currentDataItem.getParent()||this.appPart.getAppPartData();this.setSelectedIndex(i.getChildIndex(this._currentDataItem))}else this.setSelectedIndex(0)}},_markCurrentProxy:function(e,t){if(this._appPart&&this._appPart.getDataSelector()){var i=this._currentDataItem;this._currentDataItem=this._appPart.getDataSelector().isListSelector()?this._appPart.getAppPartData().getChildByIndex(this._currentItemIndex):this._appPart.getAppPartData();var n=this._findProxyByDataItem(this._currentDataItem);n&&(this._selectionMarker.unmarkSelectedSubComponent(),this._selectionMarker.markSelectedSubComponent(n.getElement()),t||this.notifySelectionChanged(e,i))}},notifySelectionChanged:function(e,t){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.SelectionChanged",{index:this._currentItemIndex,dataItem:this._currentDataItem,oldIndex:e||-1,oldDataItem:t||null,typeName:this._typeName,appPart:this._appPart})},enableClickPropagation:function(){this._proxySelector.enableClickPropagation()},stopClickPropagation:function(){this._proxySelector.stopClickPropagation()},_findProxyByDataItem:function(e){var t=this._appPart.getViewNode().getElements("[hasproxy]").map(function(e){return e.getViewProxy()}).filter(function(t){return t.getData()===e});return t[0]},dispose:function(){this.resources.W.Commands.unregisterListener(this),this._selectionMarker.unmarkSelectedSubComponent()}})}),define.resource("wixapps.integration.gui.WixAppsGUIViews",[{name:"AddFieldDefaultValueView",forType:"wix:Object",vars:{isOpen:!1},comp:{name:"HBox",items:[{data:"$isOpen",comp:{name:"SwitchBox",cases:{"default":[{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"15"}},{comp:{name:"HBox",items:[{value:"Default value",comp:{name:"Label",style:"Body L"},layout:{"box-flex":1}}],css:{height:30}}},{id:"dataEditFieldContainer",comp:{name:"VBox"}}]}}],"false":[{value:"@Add_Field_Set_a_default_value_for_this_field@",comp:{name:"Button",skin:"wixapps.integration.skins.editor.LinkButton",align:"left",css:{cursor:"pointer"},events:{click:"openDefaultValueSelector"}}}]}},layout:{"box-flex":1,spacer:20}}],css:{width:"100%"}}},{name:"ChooseTemplate",forType:"Array",comp:{name:"VBox","box-align":"center",items:[{comp:{name:"Gallery",skin:"wysiwyg.viewer.skins.paginatedgrid.wixapps.TemplateChooserGallerySkin",columns:"2",rows:"1",gap:"10",transition:"swipe_horiz_All",expandEnabled:"false",autoplay:"false",templates:{item:{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"12"}},{comp:{name:"VBox",items:[{id:"hoverBorder",comp:{name:"VBox",items:[{comp:{name:"HBox",items:[{data:"title",comp:{name:"Label",style:"Heading XL",singleLine:"true",color:"#0099FF",bold:"true"},layout:{"box-flex":1,"text-align":"center"}}]}},{comp:{name:"HBox",items:[{comp:{name:"VBox","box-align":"center",items:[{data:"imageData",comp:{name:"Image",css:{cursor:"pointer"}},layout:{height:"225px",width:"300px",spacerBefore:4,spacerAfter:5}}],css:{"-webkit-border-radius":"3px","border-radius":"3px","-webkit-box-shadow":"0px 1px 2px 1px rgba(0, 0, 0, .2)","box-shadow":"0px 1px 2px 1px rgba(0, 0, 0, .2)",background:"#fff",border:"1px solid #e1e1e1"}},layout:{height:"235px",width:"310px",spacer:10}}]}},{comp:{name:"HBox",items:[{data:"description",comp:{name:"Label"},layout:{"box-flex":1,spacer:20}}]},layout:{spacerBefore:10,height:"30px",width:"330px"}},{comp:{name:"HBox",items:[{id:"hoverButton",comp:{name:"Button",hidden:"true",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",label:"@CHOOSE_THIS_LIST@",css:{margin:"auto",position:"relative"}},layout:{height:"32px",width:"100px",cursor:"pointer"}}],css:{"-moz-box-pack":"center","text-align":"center"}},layout:{spacerBefore:"*",width:300,height:32}},{comp:{name:"VSpacer",size:"15"}}],css:{width:"330px",height:"385px",border:"solid 2px transparent","background-color":"#fff","-webkit-border-radius":"6px","border-radius":"6px"},events:{click:"presenter.onTemplateChosen","dom:mouseover":"presenter.onTemplateMouseOver","dom:mouseout":"presenter.onTemplateMouseOut"}},layout:{spacerBefore:10,spacerAfter:25,"box-align":"center"}}],css:{width:"330px",height:"420px",cursor:"pointer"}}},{comp:{name:"HSpacer",size:"13"}}]}}}},layout:{width:"820px",height:"420px"}}],css:{width:"100%",height:"100%",background:"#fff",border:"solid 1px #ccc","-webkit-border-radius":"5px","border-radius":"5px"}}},{name:"CollectionSettings",forType:"wix:Object",comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"5"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"10"}},{value:"@COLLECTION_SETTINGS_COLLECTION_NAME@",comp:{name:"Label",bold:"true"},layout:{spacerAfter:10,"padding-top":"2px"}},{comp:{name:"VBox",items:[{data:"$presenter.metaData.collectionName",comp:{name:"TextInput",events:{keyup:"presenter.onNameChange"}}},{comp:{name:"HBox",hidden:{$expr:"eq($presenter.metaData.isNameValid, true)"},items:[{value:"@COLLECTION_SETTINGS_NAME_ALREADY_TAKEN@",comp:{name:"Label",color:"#FF0000"}}]},layout:{"box-flex":1,spacerBefore:7}}]},layout:{"box-flex":1}},{comp:{name:"HSpacer",size:"10"}},{comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonSilverSkin",label:"@UPDATE@",height:"22",enabled:{$expr:"$presenter.metaData.enableApplyBtn"},css:{"font-size":"11px","font-weight":"bold"},events:{click:"presenter.onNameApply"}},layout:{width:100}},{comp:{name:"HSpacer",size:"10"}}]}},{comp:{name:"VSpacer",size:"17"}},{comp:{name:"VBox",items:[{comp:{name:"HBox",items:[{value:"@COLLECTION_SETTINGS_LISTS@",comp:{name:"Label",singleLine:"true",bold:"true",fontSize:"15"}},{comp:{name:"HSpacer",size:"*"}},{value:{_type:"wix:Image",src:"images/icons/q-mark.png",height:13,width:10,title:""},comp:{name:"ImageButton",isSprite:"false"}}]}},{comp:{name:"VSpacer",size:"5"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"*"}},{comp:{name:"Button2",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",label:"@COLLECTION_SETTINGS_NEW_LIST@",height:"22",css:{"font-size":"11px"},events:{click:"presenter.onAddNewList"}},layout:{width:100}}]},layout:{spacerAfter:11}},{data:"lists",comp:{name:"VerticalList",hidden:{$expr:"eq(Array.length(lists), 0)"},templates:{item:{comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"center",items:[{data:"displayName",comp:{name:"Label"}},{comp:{name:"HSpacer",size:"*"}},{comp:{name:"Button2",skin:"wixapps.integration.skins.editor.EditorButtonSilverSkin",label:"@DUPLICATE@",height:"22",css:{"font-size":"11px","font-weight":"bold"},events:{click:"presenter.onDuplicateList"}}}]},layout:{spacer:8}}],css:{"border-top":"1px solid #CCC"}}}}}}],css:{border:"solid 1px #CCC","border-radius":"5px 5px 5px 5px",padding:"11px 10px","padding-bottom":"0px",background:"#FFFFFF"}}},{comp:{name:"VSpacer",size:"9"}},{comp:{name:"VBox",hidden:{$expr:"eq(Array.length(pages), 0)"},items:[{comp:{name:"HBox",items:[{value:"@COLLECTION_SETTINGS_PAGES@",comp:{name:"Label",singleLine:"true",bold:"true",fontSize:"15"}},{comp:{name:"HSpacer",size:"*"}},{value:{_type:"wix:Image",src:"images/icons/q-mark.png",height:13,width:10,title:""},comp:{name:"ImageButton",isSprite:"false"}}]}},{comp:{name:"VSpacer",size:"10"}},{data:"pages",comp:{name:"VerticalList",templates:{item:{comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"center",items:[{data:"displayName",comp:{name:"Label"}},{comp:{name:"HSpacer",size:"*"}},{comp:{name:"Button2",skin:"wixapps.integration.skins.editor.EditorButtonSilverSkin",label:"@COLLECTION_SETTINGS_EDIT_PAGE@",height:"22",css:{"font-size":"11px","font-weight":"bold"},events:{click:"presenter.onEditPage"}}}]},layout:{spacerBefore:6,spacerAfter:8}}],css:{"border-top":"1px solid #CCC"}}}}}}],css:{border:"solid 1px #CCC","border-radius":"5px 5px 5px 5px",padding:"11px 10px","padding-bottom":"0px",background:"#FFFFFF"}}}],css:{"padding-top":"10px"}}},{name:"CustomizeItemsView",forType:"Array",comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"right",items:[{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@ADD_FIELD@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.addField"}}},{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{value:"@LIST_SETTINGS@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.openListSettingsPanel"}}},{comp:{name:"HSpacer",size:"20"}}]}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{value:"@CUSTOMIZE_ITEMS_DESCRIPTION@",comp:{name:"Label"},layout:{"box-flex":1}},{comp:{name:"HSpacer",size:"10"}}]}},{comp:{name:"VSpacer",size:"10"}},{data:"this",comp:{name:"VerticalListEditor",cssClass:"groupsWrapper",dragEnabled:"true",maxDragIndex:"1",templates:{item:{comp:{name:"VBox",cssClass:{$expr:"if(isContainer, 'container', '')"},items:[{data:"isContainer",comp:{name:"Switch",cases:{"default":{comp:{name:"DraggableListItem",skin:"wixapps.integration.skins.editor.DesignDraggableItemSkin",orientation:"horizontal","box-align":"center",dragEnabled:"true",hideEditLink:{$expr:"hideEditLink"},iconType:{$expr:"iconType"},items:[{comp:{name:"HBox","box-align":"center",items:[{comp:{name:"Css",cssClass:"iconContainer",items:[{comp:{name:"Css",cssClass:{$expr:"String.concat('fieldType icon-',fieldIcon)"}}}]}},{data:"displayName",comp:{name:"Label"}}]}}],css:{width:"271px"},events:{click:"presenter.onFieldClicked","dom:mouseover":"presenter.onFieldMouseOver","dom:mouseout":"presenter.onFieldMouseOut"}}},"true":{comp:{name:"VBox",cssClass:"group",items:[{comp:{name:"HBox",items:[{data:"displayName",comp:{name:"Label",bold:"true",css:{"padding-left":"6px"}}},{comp:{name:"HBox",hidden:{$expr:"or(eq(containerId, 'Hidden'), not(hasFields))"},items:[{value:"@EDIT@",comp:{name:"Label",hidden:{$expr:"not(showEditLabel)"},color:"#0099FF",css:{"padding-left":"5px",cursor:"pointer"}}},{id:"arrowIcon",value:{_type:"wix:Image",src:"images/icons/arrow_from_sprite.png",width:8,height:8},comp:{name:"Icon"},layout:{spacerBefore:5}}],events:{click:"presenter.onEditFieldBox"}}}],events:{"dom:mouseover":"presenter.onFieldBoxMouseOver","dom:mouseout":"presenter.onFieldBoxMouseOut"}},layout:{spacerAfter:5,spacerBefore:10,"line-height":"18px"}},{comp:{name:"VBox",cssClass:"container-box",items:[{comp:{name:"DraggableListItem",skin:"wixapps.integration.skins.DropTargetSkin",css:{width:"260px",height:"34px"}}}]}}],css:{"margin-top":"10px",width:"100%"}}}}}}],css:{width:"100%"}}}},css:{height:"402px","overflow-y":"auto","overflow-x":"none"},events:{itemMoved:"presenter.onItemMoved"}},layout:{spacerAfter:30}}]}},{name:"SimpleCustomizeFields",forType:"Array",comp:{name:"VBox",items:[{value:"Edit field settings",comp:{name:"Label"}},{comp:{name:"List2",templates:{item:{value:{$expr:"or(isContainer, eq(iconType, 'hidden'))"},comp:{name:"SwitchBox",orientation:"horizontal",cases:{"default":[],"false":[{value:"",comp:{name:"Label"},layout:{spacerBefore:10,spacerAfter:5}},{comp:{name:"VBox",items:[{data:"displayName",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],events:{click:"presenter.onFieldClicked","dom:mouseover":"presenter.onFieldMouseOver","dom:mouseout":"presenter.onFieldMouseOut"}}}]}}}}},layout:{spacerBefore:5,spacerAfter:15}}]}},{name:"CustomizeItems2",forType:"Array",comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"middle",items:[{comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",label:"<< Settings",css:{margin:"auto",position:"relative"},events:{click:"presenter.backToSettings"}},layout:{height:"32px",width:"80px",cursor:"pointer"}},{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@ADD_FIELD@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],events:{click:"presenter.addField"}},layout:{cursor:"pointer",spacerAfter:5}}]}},{comp:{name:"VSpacer",size:"10"}},{value:"@CUSTOMIZE_ITEMS_DESCRIPTION@",comp:{name:"Label",color:"#878787"}},{data:"this",comp:{name:"DragAndDropVList",cssClass:"groupsWrapper",templates:{item:{comp:{name:"VBox",cssClass:{$expr:"if(isContainer, 'container', '')"},items:[{data:"isContainer",comp:{name:"Switch",cases:{"default":{comp:{name:"DraggableListItem",skin:"wixapps.integration.skins.editor.DesignDraggableItemSkin",orientation:"horizontal","box-align":"center",dragEnabled:"true",hideEditLink:{$expr:"hideEditLink"},iconType:{$expr:"iconType"},items:[{comp:{name:"HBox","box-align":"center",items:[{comp:{name:"Css",cssClass:"iconContainer",items:[{comp:{name:"Css",cssClass:{$expr:"String.concat('fieldType icon-',fieldIcon)"}}}]}},{data:"displayName",comp:{name:"Label"}}]}}],css:{width:"244px"},events:{click:"presenter.onFieldClicked","dom:mouseover":"presenter.onFieldMouseOver","dom:mouseout":"presenter.onFieldMouseOut"}}},"true":{comp:{name:"VBox",cssClass:"group",items:[{comp:{name:"HBox",items:[{data:"displayName",comp:{name:"Label",bold:"true",css:{"padding-left":"6px"}}},{comp:{name:"HBox",hidden:{$expr:"or(eq(containerId, 'Hidden'), not(hasFields))"},items:[{value:"@EDIT@",comp:{name:"Label",hidden:{$expr:"not(showEditLabel)"},color:"#0099FF",css:{"padding-left":"5px",cursor:"pointer"}}},{id:"arrowIcon",value:{_type:"wix:Image",src:"images/icons/arrow_from_sprite.png",width:8,height:8},comp:{name:"Icon"},layout:{spacerBefore:5}}],events:{click:"presenter.onEditFieldBox"}}}],events:{"dom:mouseover":"presenter.onFieldBoxMouseOver","dom:mouseout":"presenter.onFieldBoxMouseOut"}},layout:{spacerAfter:5,spacerBefore:10,"line-height":"18px"}},{comp:{name:"VBox",cssClass:"container-box",items:[{comp:{name:"DraggableListItem",skin:"wixapps.integration.skins.DropTargetSkin",css:{width:"244px",height:"34px"}}}]}}],css:{"margin-top":"10px"}}}}}}]}}},events:{itemMoved:"presenter.onItemMoved"}}}]}},{name:"DataEditView",forType:"[MODEL_TYPE]",comp:{name:"VBox",items:[{comp:{name:"VBox",hidden:{$expr:"or($presenter.metaData.noItems, $presenter.metaData.noFields)"},items:[{comp:{name:"VBox",hidden:{$expr:"not($presenter.metaData.hidden)"},items:[{comp:{name:"HBox",items:[{comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"center",items:[{id:"exIcon",value:{_type:"wix:Image",src:"images/icons/hidden.png",width:16,height:16},comp:{name:"Icon"},layout:{spacer:10}},{value:"@ITEM_HIDDEN@",comp:{name:"Label"},layout:{width:100,spacerAfter:"*"}},{value:"@UNHIDE_ITEM@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",events:{"dom:click":"presenter.showItem"}},layout:{spacerAfter:10,"text-align":"right",width:100}}]},layout:{spacer:5}}]},layout:{"box-flex":1,"background-color":"#CCEBFF",border:"1px solid #c8e5f7","border-top-color":"#bfdbf0",spacer:10}}]},layout:{spacerAfter:10}}]}},{id:"toolBar",comp:{name:"HBox",hidden:{$expr:"$presenter.metaData.isList"},"box-align":"left",items:[{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"5"}},{value:"@ORGANIZE@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.organizeClicked"}}},{comp:{name:"HSpacer",size:"15"}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"5"}},{value:"@ADD_ITEM@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.createDataItem"}}},{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-587",startPositionY:"-19",tooltipValue:"@DUPLICATE@"}}],css:{cursor:"pointer"},events:{click:"presenter.duplicateDataItem"}}},{comp:{name:"HSpacer",hidden:{$expr:"$presenter.metaData.hidden"},size:"3"}},{comp:{name:"VBox",hidden:{$expr:"$presenter.metaData.hidden"},items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-668",startPositionY:"-19",tooltipValue:"@HIDE@"}}],css:{cursor:"pointer"},events:{click:"presenter.hideItem"}}},{comp:{name:"HSpacer",size:"3"}},{comp:{name:"VBox",items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-770",startPositionY:"-19",tooltipValue:"@DELETE@"}}],css:{cursor:"pointer"},events:{click:"presenter.removeDataItem"}}},{comp:{name:"HSpacer",size:"15"}}]}},{comp:{name:"VSpacer",size:"15"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{comp:{name:"VBox",items:{$expr:"$presenter.generatedViewPart"}}},{comp:{name:"HBox",items:[{value:"@ADD_FIELD_TO_ALL_ITEMS@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",events:{"dom:click":"presenter.createField"}},layout:{"box-flex":1,"text-align":"right",spacerAfter:20}}]}},{comp:{name:"VSpacer",size:"15"}}]},layout:{width:268}}]},layout:{height:{$expr:"if($presenter.metaData.hidden, 406, 444)"},"overflow-y":{$expr:"if($presenter.metaData.isInRichTextEditing, 'hidden', 'auto')"},"overflow-x":"hidden"}},{comp:{name:"VBox",items:[{id:"navigationButtons",comp:{name:"HBox","box-align":"center",items:[{value:{_type:"wix:Image",src:"images/icons/horizontal_arrowbuttons_sprite.png",height:41,width:60,title:""},comp:{name:"ImageButton",spriteDirection:"vertical",startPositionX:"0",startPositionY:"-169",events:{click:"presenter.gotoPrev"}}},{value:{$expr:"$presenter.metaData.pagingLabel"},comp:{name:"Label",color:"#595959"},layout:{"box-flex":1,"text-align":"center"}},{value:{_type:"wix:Image",src:"images/icons/horizontal_arrowbuttons_sprite.png",height:41,width:60,title:""},comp:{name:"ImageButton",spriteDirection:"vertical",startPositionX:"0",startPositionY:"-46",events:{click:"presenter.gotoNext"}}}],css:{margin:"0px",padding:"0px",height:"41px"}}}]},layout:{"border-top":"solid 1px #d3d3d3",spacerBefore:10}}]}},{comp:{name:"VBox",hidden:{$expr:"or (not($presenter.metaData.noItems), $presenter.metaData.noFields)"},items:[{comp:{name:"VSpacer",size:"*"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@NO_ITEMS@",comp:{name:"Label"}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"VBox",hidden:{$expr:"$presenter.metaData.isList"},items:[{value:"@CLICK_TO_ADD_ITEM@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],events:{click:"presenter.createDataItem"}}},{comp:{name:"VBox",hidden:{$expr:"$presenter.metaData.noAvailItems"},items:[{value:"Click to select existing items",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],events:{click:"presenter.selectItems"}},layout:{spacerBefore:5}}]}},{comp:{name:"HSpacer",size:"*"}}]}},{comp:{name:"VSpacer",size:"*"}}]}},{comp:{name:"VBox",hidden:{$expr:" not($presenter.metaData.noFields) "},items:[{comp:{name:"VSpacer",size:"*"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@NO_FIELDS@",comp:{name:"Label"}},{comp:{name:"VSpacer",size:"5"}},{comp:{name:"VBox",items:[{value:"@CLICK_TO_ADD_FIELD@",comp:{name:"Label",bold:"true",css:{"text-decoration":"underline",cursor:"pointer"}}}],events:{click:"presenter.createField"}}}]}},{comp:{name:"HSpacer",size:"*"}}]}}]}}],css:{width:"100%"}}},{name:"DataPanelTitleView",forType:"wix:Object",comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"5"}},{value:{$expr:"$presenter.metaData.itemTitle"},comp:{name:"Label",style:"Heading S",singleLine:"true","line-height":"1.4"},layout:{"box-flex":1}},{value:{$expr:"$presenter.metaData.typeFriendlyName"},comp:{name:"Label",style:"Body L",prefix:"@COLLECTION@: ",singleLine:"true","line-height":"1.4"},layout:{"box-flex":1}},{comp:{name:"VSpacer",size:"5"}}]},layout:{"box-flex":1}}],css:{width:230}}},{name:"DataEdit2",forType:"[MODEL_TYPE]",comp:{name:"VBox",items:[{comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",label:"<< Back to Items",css:{margin:"auto",position:"relative"},events:{click:"presenter.backToSettings"}},layout:{height:32,width:"100%",cursor:"pointer","box-flex":1}},{comp:{name:"VBox",items:[{id:"navigationButtons",comp:{name:"HBox","box-align":"center",items:[{comp:{name:"Button",cssClass:"previous",skin:"wixapps.integration.skins.editor.HorizontalArrowButtonSkin",label:"Previous",events:{click:"presenter.gotoPrev"}},layout:{width:34,height:41,spacerBefore:2}},{data:"title",comp:{name:"Label",style:"Heading M",singleLine:"true",color:"#404040"},layout:{"text-align":"center","box-flex":1,"letter-spacing":"-0.1em"}},{comp:{name:"Button",cssClass:"next",skin:"wixapps.integration.skins.editor.HorizontalArrowButtonSkin",label:"Next",events:{click:"presenter.gotoNext"}},layout:{width:34,height:41,spacerAfter:2}}]},layout:{height:"41px","background-color":"#E0E0E0"}}]},layout:{spacerBefore:10}},{comp:{name:"VBox",hidden:{$expr:"or($presenter.metaData.noItems, $presenter.metaData.noFields)"},items:[{comp:{name:"VBox",hidden:{$expr:"not($presenter.metaData.hidden)"},items:[{comp:{name:"HBox",items:[{comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"center",items:[{id:"exIcon",value:{_type:"wix:Image",src:"images/icons/hidden.png",width:16,height:16},comp:{name:"Icon"},layout:{spacer:10}},{value:"@ITEM_HIDDEN@",comp:{name:"Label"},layout:{width:100,spacerAfter:"*"}},{value:"@UNHIDE_ITEM@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",events:{"dom:click":"presenter.toggleItemVisibility"}},layout:{spacerAfter:10,"text-align":"right",width:100}}]},layout:{spacer:5}}]},layout:{"box-flex":1,"background-color":"#CCEBFF",border:"1px solid #c8e5f7","border-top-color":"#bfdbf0"}}]},layout:{spacerAfter:10}}]}},{id:"toolBar",comp:{name:"HBox",hidden:{$expr:"$presenter.metaData.isList"},"box-align":"center",items:[{comp:{name:"VBox",items:[{value:"@ADD_ITEM@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.createItem"}}},{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-587",startPositionY:"-19",tooltipValue:"@DUPLICATE@"}}],css:{cursor:"pointer"},events:{click:"presenter.duplicateItem"}}},{comp:{name:"HSpacer",hidden:{$expr:"$presenter.metaData.hidden"},size:"3"}},{comp:{name:"VBox",hidden:{$expr:"$presenter.metaData.hidden"},items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-668",startPositionY:"-19",tooltipValue:"@HIDE@"}}],css:{cursor:"pointer"},events:{click:"presenter.toggleItemVisibility"}}},{comp:{name:"HSpacer",size:"3"}},{comp:{name:"VBox",items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-770",startPositionY:"-19",tooltipValue:"@DELETE@"}}],css:{cursor:"pointer"},events:{click:"presenter.removeItem"}}}]}},{comp:{name:"VSpacer",size:"15"}},{comp:{name:"HBox",items:[{comp:{name:"VBox",items:[{comp:{name:"VBox",items:{$expr:"$presenter.generatedViewPart"}}},{comp:{name:"HBox",items:[{value:"@ADD_FIELD_TO_ALL_ITEMS@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",events:{"dom:click":"presenter.createField"}},layout:{"box-flex":1,"text-align":"right",spacerAfter:20}}]}},{comp:{name:"VSpacer",size:"15"}}]},layout:{spacerBefore:0,spacerAfter:0,"box-flex":1}}]}},{comp:{name:"VBox",items:[{id:"navigationButtons",comp:{name:"HBox","box-align":"center",items:[{comp:{name:"Button",cssClass:"previous",skin:"wixapps.integration.skins.editor.HorizontalArrowButtonSkin",label:"Previous",events:{click:"presenter.gotoPrev"}},layout:{width:34,height:41,spacerBefore:2}},{value:{$expr:"$presenter.metaData.pagingLabel"},comp:{name:"Label",color:"#595959"},layout:{"box-flex":1,"text-align":"center"}},{comp:{name:"Button",cssClass:"next",skin:"wixapps.integration.skins.editor.HorizontalArrowButtonSkin",label:"Next",events:{click:"presenter.gotoNext"}},layout:{width:34,height:41,spacerAfter:2}}],css:{margin:0,padding:0,height:41,"background-color":"#E0E0E0"}}}]},layout:{spacerBefore:10}}]}},{comp:{name:"VBox",hidden:{$expr:"or (not($presenter.metaData.noItems), $presenter.metaData.noFields)"},items:[{comp:{name:"VSpacer",size:"*"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@NO_ITEMS@",comp:{name:"Label"}},{comp:{name:"VSpacer",size:"5"}},{comp:{name:"VBox",hidden:{$expr:"$presenter.metaData.isList"},items:[{value:"@CLICK_TO_ADD_ITEM@",comp:{name:"Label",bold:"true",css:{"text-decoration":"underline",cursor:"pointer"}}}],events:{click:"presenter.createDataItem"}}}]}},{comp:{name:"HSpacer",size:"*"}}]}},{comp:{name:"VSpacer",size:"*"}}]}},{comp:{name:"VBox",hidden:{$expr:" not($presenter.metaData.noFields) "},items:[{comp:{name:"VSpacer",size:"*"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@NO_FIELDS@",comp:{name:"Label"}},{comp:{name:"VSpacer",size:"5"}},{comp:{name:"VBox",items:[{value:"@CLICK_TO_ADD_FIELD@",comp:{name:"Label",bold:"true",css:{"text-decoration":"underline",cursor:"pointer"}}}],events:{click:"presenter.createField"}}}]}},{comp:{name:"HSpacer",size:"*"}}]}}]}}]}},{name:"DataItemsSelection",forType:"Array",comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{value:"@DATA_ITEMS_SELECTION_SELECT_ALL@",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonSilverSkin",events:{click:"presenter.selectAll"}}},{comp:{name:"HSpacer",size:"10"}},{value:"@DATA_ITEMS_SELECTION_SELECT_NONE@",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonSilverSkin",css:{width:"120px"},events:{click:"presenter.selectNone"}}}],css:{border:"solid 1px #999","border-radius":"5px 5px 0px 0px","border-bottom":"none",padding:"10px 10px"}}},{data:"this",comp:{name:"List2",templates:{item:{comp:{name:"VBox",items:[{comp:{name:"HBox",items:[{data:"selected",comp:{name:"CheckBox",skin:"wixapps.integration.skins.inputs.CheckBoxInputInlineSkin",label:{$expr:"title"},events:{"dom:change":"presenter.onItemClick"}},layout:{spacerBefore:20}}]},layout:{spacer:10}}],css:{"border-bottom":"1px solid #eee"}}}},css:{background:"#fdfdfd",border:"solid 1px #999","border-radius":"0px 0px 5px 5px",padding:"10px 10px",width:"100%",height:"350px","overflow-x":"hidden","overflow-y":"auto"}}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"*"}},{value:{$expr:"$presenter.metaData.selectionCountLabel"},comp:{name:"Label"}},{comp:{name:"HSpacer",size:"*"}}]}}],css:{height:"100%"}}},{name:"FieldEditView",forType:"Object",comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"baseline",items:[{value:"@FIELD_NAME@",comp:{name:"Label"},layout:{spacerAfter:20}},{data:"fieldDisplayName",comp:{name:"TextInput"}}]}}]},customizations:[]},{name:"ListAdded",forType:"[MODEL_TYPE]",comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"30"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"5"}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"5"}},{value:{_type:"wix:Image",title:"",src:"images/icons/list-added.png",width:26,height:26},comp:{name:"Icon"}}]}},{comp:{name:"HSpacer",size:"10"}},{value:"@LIST_ADDED_DIALOG_Title@",comp:{name:"Label",style:"Heading M",color:"#69B647"}}]}},{comp:{name:"VSpacer",size:"20"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"20"}},{value:"@LIST_ADDED_DIALOG_Description@",comp:{name:"Label",style:"Heading S"},layout:{"box-flex":1}}]}},{comp:{name:"VSpacer",size:"10"}},{id:"editList",comp:{name:"Toggle",initialState:"on",toggleGroup:"ListAddedGroup",toggleScope:"sibling",toggleTriggerEvent:"expand-edit-list",toggleTriggerScope:"descendant",seoDisplayState:"on",templates:{on:{comp:{name:"EditListExpanded"}},off:{comp:{name:"EditListCollapsed"}}},css:{padding:"10px 20px",border:"1px solid #e6e6e6","border-top":"1px solid #ccc","border-radius":"5px"}}},{comp:{name:"VSpacer",size:"10"}},{id:"customizeItem",comp:{name:"Toggle",initialState:"off",toggleGroup:"ListAddedGroup",toggleScope:"sibling",toggleTriggerEvent:"expand-customize-item",toggleTriggerScope:"descendant",seoDisplayState:"on",templates:{on:{comp:{name:"CustomizeItemExpanded"}},off:{comp:{name:"CustomizeItemCollapsed"}}},css:{padding:"10px 20px",border:"1px solid #e6e6e6","border-top":"1px solid #ccc","border-radius":"5px"}}},{comp:{name:"VSpacer",size:"10"}},{id:"addList",comp:{name:"Toggle",initialState:"off",toggleGroup:"ListAddedGroup",toggleScope:"sibling",toggleTriggerEvent:"expand-add-list",toggleTriggerScope:"descendant",seoDisplayState:"on",templates:{on:{comp:{name:"AddListExpanded"}},off:{comp:{name:"AddListCollapsed"}}},css:{padding:"10px 20px",border:"1px solid #e6e6e6","border-top":"1px solid #ccc","border-radius":"5px"}}},{comp:{name:"VSpacer",size:"15"}},{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"20"}},{data:"$presenter.dontShowAgain",comp:{name:"CheckBox",skin:"wysiwyg.editor.skins.inputs.CheckBoxSkin",label:"@LIST_ADDED_DIALOG_DontShowAgain@",css:{color:"#444444"},events:{"dom:change":"presenter.onDontShowAgainChange"}}}]}}]},layout:{"box-flex":1}},{comp:{name:"HSpacer",size:"10"}}]}},{name:"EditListExpanded",forType:"[MODEL_TYPE]",comp:{name:"VBox",items:[{comp:{name:"HBox",items:[{value:"@LIST_ADDED_DIALOG_EditList_Title@",comp:{name:"Label",style:"Heading S"},layout:{"box-flex":1}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"2"}},{value:"@LIST_ADDED_DIALOG_Close@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",color:"#0099FF"}}]},layout:{width:"auto"}}],events:{"dom:click":"expand-edit-list"}}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{value:{_type:"wix:Video",videoId:"UAxMzrWZOpY",videoType:"YOUTUBE"},comp:{name:"Video"},layout:{width:"100%",height:"100%"}}]},layout:{"box-flex":1,height:"300px"}}]}},{name:"EditListCollapsed",forType:"[MODEL_TYPE]",comp:{name:"HBox",items:[{value:"@LIST_ADDED_DIALOG_EditList_Title@",comp:{name:"Label",style:"Heading S"},layout:{"box-flex":1}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"2"}},{value:"@LIST_ADDED_DIALOG_LearnMore@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",color:"#0099FF",css:{width:"auto"}}}]},layout:{width:"auto"}}],events:{"dom:click":"expand-edit-list"}}},{name:"CustomizeItemExpanded",forType:"[MODEL_TYPE]",comp:{name:"VBox",items:[{comp:{name:"HBox",items:[{value:"@LIST_ADDED_DIALOG_CustomizeItem_Title@",comp:{name:"Label",style:"Heading S"},layout:{"box-flex":1}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"2"}},{value:"@LIST_ADDED_DIALOG_Close@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",color:"#0099FF"}}]},layout:{width:"auto"}}],events:{"dom:click":"expand-customize-item"}}},{comp:{name:"VSpacer",size:"10"}},{value:"@LIST_ADDED_DIALOG_CustomizeItem_Content@",comp:{name:"Label",style:"Body M"},layout:{"box-flex":1}}]}},{name:"CustomizeItemCollapsed",forType:"[MODEL_TYPE]",comp:{name:"HBox",items:[{value:"@LIST_ADDED_DIALOG_CustomizeItem_Title@",comp:{name:"Label",style:"Heading S"},layout:{"box-flex":1}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"2"}},{value:"@LIST_ADDED_DIALOG_LearnMore@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",color:"#0099FF",css:{width:"auto"}}}]},layout:{width:"auto"}}],events:{"dom:click":"expand-customize-item"}}},{name:"AddListExpanded",forType:"[MODEL_TYPE]",comp:{name:"VBox",items:[{comp:{name:"HBox",items:[{value:"@LIST_ADDED_DIALOG_AddList_Title@",comp:{name:"Label",style:"Heading S"},layout:{"box-flex":1}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"2"}},{value:"@LIST_ADDED_DIALOG_Close@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",color:"#0099FF"}}]},layout:{width:"auto"}}],events:{"dom:click":"expand-add-list"}}},{comp:{name:"VSpacer",size:"10"}},{value:"@LIST_ADDED_DIALOG_AddList_Content@",comp:{name:"Label",style:"Body M"},layout:{"box-flex":1}}]}},{name:"AddListCollapsed",forType:"[MODEL_TYPE]",comp:{name:"HBox",items:[{value:"@LIST_ADDED_DIALOG_AddList_Title@",comp:{name:"Label",style:"Heading S"},layout:{"box-flex":1}},{comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"2"}},{value:"@LIST_ADDED_DIALOG_LearnMore@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",color:"#0099FF",css:{width:"auto"}}}]},layout:{width:"auto"}}],events:{"dom:click":"expand-add-list"}}},{name:"ManageItemsView",forType:"Array",comp:{name:"VBox",items:[{comp:{name:"HBox",hidden:{$expr:"$presenter.metaData.noAvailItems"},items:[{value:"@SELECT_ITEMS@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"},layout:{spacerBefore:15}}],css:{cursor:"pointer"},events:{click:"presenter.selectItems"}}},{comp:{name:"VerticalListEditor",dragEnabled:"true",templates:{item:{comp:{name:"DraggableListItem",orientation:"horizontal",selected:{$expr:"selected"},iconType:{$expr:"iconType"},items:[{data:"title",comp:{name:"Label",singleLine:"true",color:{$expr:"if(selected, '#fff', '')"},css:{height:"15px","line-height":"15px",padding:"8px 0px"}}}],css:{width:"99%"}}}},css:{"max-height":"442px","overflow-y":"auto","padding-bottom":"1px"},events:{itemMoved:"presenter.onItemMoved",itemClick:"presenter.onSelectionChanged"}},layout:{"box-flex":1,spacerBefore:10}}],css:{height:"485px",width:"100%"}}},{name:"ManageItems2",forType:"Array",comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"center",items:[{comp:{name:"VBox",items:[{value:"Select items",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],events:{click:"presenter.selectItems"}},layout:{cursor:"pointer",spacerBefore:5}},{comp:{name:"VBox",items:[{value:"@ADD_ITEM@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],events:{click:"presenter.createItem"}},layout:{cursor:"pointer",spacerBefore:"*"}},{comp:{name:"VBox",items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-587",startPositionY:"-19",tooltipValue:"@DUPLICATE@"}}],events:{click:"presenter.duplicateItem"}},layout:{cursor:"pointer",spacerBefore:"*"}},{comp:{name:"VBox",items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-668",startPositionY:"-19",tooltipValue:"@HIDE@"}}],events:{click:"presenter.toggleItemVisibility"}},layout:{cursor:"pointer",spacerBefore:3}},{comp:{name:"VBox",items:[{value:{_type:"wix:Image",src:"images/icons/appbuilder_sprite.png",height:27,width:27,title:""},comp:{name:"ImageButton",spriteDirection:"horizontal",startPositionX:"-770",startPositionY:"-19",tooltipValue:"@DELETE@"}}],events:{click:"presenter.removeItem"}},layout:{cursor:"pointer",spacerBefore:3}}]},layout:{spacerAfter:10}},{comp:{name:"DragAndDropVList",templates:{item:{comp:{name:"DraggableListItem",orientation:"horizontal","box-align":"center",selected:{$expr:"selected"},iconType:{$expr:"iconType"},items:[{data:"title",comp:{name:"Label",singleLine:"true",color:{$expr:"if(selected, '#fff', '')"}},layout:{height:"15px","box-flex":1}},{comp:{name:"HSpacer",size:{$expr:"if(and(hidden,not(selected)),20,5)"}}},{value:"Edit",comp:{name:"Label",hidden:{$expr:"not(selected)"},underline:"true",color:"'#fff'",events:{"dom:mousedown":"presenter.editItem"}}},{comp:{name:"HSpacer",hidden:{$expr:"not(selected)"},size:{$expr:"if(hidden,35,10)"}}}],events:{"dom:click":"presenter.onSelectionChanged"}}}},events:{itemMoved:"presenter.onItemMoved"}},layout:{"border-left":"1px solid #DDD","border-right":"1px solid #DDD"}}]}},{name:"MoveField",forType:"wix:Object",comp:{name:"VBox",items:[{comp:{name:"Container",skin:"wixapps.integration.skins.dialogs.InputGroupSkin",items:[{comp:{name:"VBox",items:[{value:"@CHOOSE_LOCATION@",comp:{name:"Label"}},{data:"this.possibleContainers",comp:{name:"ComboBox",skin:"wysiwyg.editor.skins.inputs.ComboBoxSkin",css:{width:"260px"}}},{comp:{name:"VSpacer",size:"10"}}]}}],css:{"background-color":"#FFF"}},layout:{spacerBefore:10}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{value:"@CANCEL@",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:"presenter.onCancel"}}},{comp:{name:"HSpacer",size:"*"}},{value:"@MOVE_FIELD@",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:"presenter.onContainerChosen"}}}]}}],css:{width:"99%"}}},{name:"ShowField",forType:"wix:Object",comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"10"}},{comp:{name:"Container",skin:"wixapps.integration.skins.dialogs.InputGroupSkin",items:[{comp:{name:"HBox",items:[{comp:{name:"VBox",items:[{id:"exIcon",value:{_type:"wix:Image",src:"images/icons/hidden.png",width:16,height:16},comp:{name:"Icon"},layout:{spacerBefore:4,width:16,height:16}}]},layout:{spacerAfter:10}},{value:"@FIELD_IS_HIDDEN@",comp:{name:"Label"}}]}}],css:{"background-color":"#CCEBFF"}}},{comp:{name:"VSpacer",size:"10"}},{value:"@TO_SHOW_A_FIELD_LOCATE_IT@",comp:{name:"Label"}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"Container",skin:"wixapps.integration.skins.dialogs.InputGroupSkin",items:[{comp:{name:"VBox",items:[{value:"@CHOOSE_LOCATION@",comp:{name:"Label"}},{data:"this.possibleContainers",comp:{name:"ComboBox",skin:"wysiwyg.editor.skins.inputs.ComboBoxSkin",css:{width:"260px"}}},{comp:{name:"VSpacer",size:"10"}}]}}],css:{"background-color":"#FFF"}}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{value:"Cancel",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:"presenter.onCancel"}}},{comp:{name:"HSpacer",size:"*"}},{value:"Show Field",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:"presenter.onContainerChosen"}}}]}}],css:{width:"100%"}}}]),define.Class("wixapps.integration.managers.AppBuilderLocalizer",function(e){var t=e;
t.inherits("wixapps.integration.managers.BaseLocalizer"),t.fields({}),t.methods({localize:function(e,t){return this._resourceManager.get("WIXAPPS2_LANGUAGE",e,t)||"["+e+"]"},localizeView:function(e){return this._processValue(e,"")},localizeTemplates:function(e){return this._processValue(e,"")}})}),define.Class("wixapps.integration.managers.AppResizeHandler",function(e){var t=e;t.binds(["_onAppResize","_onAppViewCreated","_onProxySizeInvalid","_onThemeChanged"]),t.resources(["W.Theme"]),t.fields({_appHolderView:null,_resizeDispatcher:null,_lastSize:null,_resizeLocked:!1}),t.methods({activateResizeHandler:function(e,t){this._resizeDispatcher&&this.deactivateResizeHandler(this._resizeDispatcher),this._resizeDispatcher=e,this._appHolderView=t,this._resizeDispatcher.addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppResize),this._resizeDispatcher.addEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewCreated),this._resizeDispatcher.addEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,this._onProxySizeInvalid),this.resources.W.Theme.getDataMap().THEME_DATA.addEvent(Constants.DataEvents.DATA_CHANGED,this._onThemeChanged)},deactivateResizeHandler:function(){this._resizeDispatcher.removeEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppResize),this._resizeDispatcher.removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewCreated),this._resizeDispatcher.removeEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,this._onProxySizeInvalid),this.resources.W.Theme.getDataMap().THEME_DATA.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onThemeChanged),this._resizeDispatcher=null,this._appHolderView=null},_onAppViewCreated:function(){this._performResizeAction(this._appHolderView,function(e){e._onAppViewCreated()}),this._checkContentSizeChange()},_onAppResize:function(){this._performResizeAction(this._appHolderView,function(e){e._onAppResize.call()}),this._checkContentSizeChange()},_ignoredThemeProperties:["BASE_THEME_DIRECTORY","BG_DIRECTORY","CONTACT_DIRECTORY","EXTERNAL_LINKS_DIRECTORY","NETWORKS_DIRECTORY","PAGES_DIRECTORY","THEME_DIRECTORY","WEB_THEME_DIRECTORY"],_onThemeChanged:function(e,t){Array.some(t,function(e){return!this._ignoredThemeProperties.contains(e)}.bind(this))&&this._onProxySizeInvalid()},_onProxySizeInvalid:function(){this._resizeLocked=!0,window.requestAnimFrame(function(){this._resizeLocked=!1,this._performResizeAction(this._appHolderView,function(e){e._onAppResize.call()}),this._checkContentSizeChange()}.bind(this))},_checkContentSizeChange:function(){window.requestAnimFrame(function(){var e=!1,t=this._appHolderView.getSize();this._lastSize&&(e=!(t.x===this._lastSize.x&&t.y===this._lastSize.y)),this._lastSize=t,e&&this._resizeDispatcher.fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE)}.bind(this))},_performResizeAction:function(e,t){if(!this._resizeLocked){var i=this,n=e.getElements("[hasproxy]");this._updateGeometry(e);var a=n.filter(function(e){return i._isResizableProxy(e.getViewProxy())}).map(function(t){return{proxy:t.getViewProxy(),depth:i._getElementDepth(e,t)}}).sort(function(e,t){return e.depth-t.depth});a.forEach(function(e){t(e.proxy)})}},_updateGeometry:function(e){if(e.$flexPolyfill)e.$flexPolyfill.updateGeometry();else for(var t=0;e.children.length>t;t++)this._updateGeometry(e.children[t])},_isResizableProxy:function(e){return e._onAppResize&&e._onAppViewCreated},_getElementDepth:function(e,t){return t==e||null==t?0:this._getElementDepth(e,t.getParent())+1}})}),define.Class("wixapps.integration.managers.ApplicationInstance",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["_onDescriptorLoaded","resolveResourcePath"]),t.resources(["W.Utils","W.Config","topology","W.Data"]),t.utilize(["wixapps.core.managers.TypesManager","wixapps.core.dataservice.DataServiceTransport","wixapps.core.data.DataItemFactory","wixapps.core.dataservice.ItemCache","wixapps.core.dataservice.DataService","wixapps.core.views.ViewsCustomizer","wixapps.core.views.ViewDefinitionsRepository","wixapps.integration.managers.ApplicationInstanceUtils","wixapps.integration.managers.applicationhandlers.ZoomHandler","wixapps.core.expressions.FunctionLibrary","wixapps.integration.managers.ApplicationLocalizer"]),t.fields({_localizer:null}),t.methods({initialize:function(e){this._appParts=[],this._appPages=[],this._idInMetasite=e.applicationId,this._appDefinitionId=e.appDefinitionId,this._packageName=e.packageName,this._types=new this.imports.TypesManager,this._funcLibrary=new this.imports.FunctionLibrary,this._dataFactory=new this.imports.DataItemFactory,this._dataFactory.registerFunctionLibrary(this._funcLibrary),this._itemCache=new this.imports.ItemCache(this._dataFactory),this._zoomHandler=new this.imports.ZoomHandler(this),this._localizer=null,"wixapps"==e.type?(this._transport=new this.imports.DataServiceTransport(e.datastoreId,"",""),this._dataService=new this.imports.DataService(this._transport,this._dataFactory,this._itemCache)):"ecommerce"==e.type&&(this._magentoStoreId=e.magentoStoreId),this._customizations=new this.imports.ViewsCustomizer,this._viewDefinitions=new this.imports.ViewDefinitionsRepository(this._dataFactory),this._appBasePath=null;var t=W.Config.getServiceTopologyProperty("scriptsLocationMap");if(!t||!t.wixapps)throw"wixapps topology path is undefined";this._appBasePath=t.wixapps+"/javascript/wixapps/apps/"+this._packageName+"/",this.resources.W.Data.getDataByQuery("#WIXAPPS_EXTERNAL_APPS",function(e){e.get("items")[this._packageName]&&(this._appBasePath=this.resources.topology[this._packageName])}.bind(this)),this._createdApplicationPages={},this._utils=new this.imports.ApplicationInstanceUtils(this)},loadDescriptor:function(){this.resource.getResourceValue("W.Apps",function(e){e.requestAppDescriptor(this._packageName,this._onDescriptorLoaded)}.bind(this))},getAppDefinitionId:function(){return this._appDefinitionId},getPackageName:function(){return this._packageName},getIdInMetasite:function(){return this._idInMetasite},getDataService:function(){return this._dataService},getMagentoStoreId:function(){return this._magentoStoreId},getAppDescriptor:function(){return this._descriptor},getAppBasePath:function(){return this._appBasePath},getAppParts:function(){return this._appParts},getLocalizer:function(){return this._localizer},getUtils:function(){return this._utils},resolveResourcePath:function(e){if(e){var t=e.match(/^(http:\/\/)?(images\/.*)/);if(t)return this.resources.W.Utils.AppsUtils.combinePath(this._appBasePath,t[2])}return e},registerAppPart:function(e){this._appParts.push(e),this.getDescriptorLoaded()&&e.initApp()},registerAppPage:function(e){this._appPages.push(e),this.getDescriptorLoaded()&&e.initApp()},getDescriptorLoaded:function(){return!!this._descriptor},getTypesManager:function(){return this._types},getDataServiceTransport:function(){return this._transport},getDataItemFactory:function(){return this._dataFactory},getItemCache:function(){return this._itemCache},getCustomizations:function(){return this._customizations},getViewDefRepo:function(){return this._viewDefinitions},getPartDefinition:function(e){if(!this._descriptor||!this._descriptor.parts)return null;for(var t=0;this._descriptor.parts.length>t;t++)if(this._descriptor.parts[t].id==e)return this._descriptor.parts[t];return null},getPageDefinition:function(e){return this._descriptor&&this._descriptor.pages?this._descriptor.pages.first(function(t){return t.id==e}):null},_onDescriptorLoaded:function(e){var t,i=e.lang||{};this._localizer=new this.imports.ApplicationLocalizer(i),e=this._localizer.localizeDescriptor(e),this._descriptor=e;var n=Constants.WixAppsSystemTypes;for(t=0;n.length>t;t++)this._types.registerType(n[t]);for(t=0;e.types.length>t;t++)this._types.registerType(e.types[t]);for(this._customizations.addRules(e.customizations),this._addDataEditingCustomizations(),t=0;e.views.length>t;t++)for(var a=this._viewDefinitions.cloneAndMultiply(e.views[t]),s=0;a.length>s;s++)this._customizations.fillMissingIds(a[s]),this._customizations.applyAll(a[s]),this._viewDefinitions.setViewDefinition(a[s]);for(t=0;this._appParts.length>t;t++)this._appParts[t].initApp();for(t=0;this._appPages.length>t;t++)this._appPages[t].initApp();W.Viewer&&W.Viewer.isSiteReady()?this._zoomHandler.validateZoomRelatedData():this._callValidateZoomData()},_callValidateZoomData:function(){W.Viewer&&W.Viewer.isPublicMode()?W.Viewer.addEvent("SiteReady",this._zoomHandler.validateZoomRelatedData):W.Commands.registerCommandListenerByName("EditorCommands.SiteLoaded",this,this._zoomHandler.validateZoomRelatedData)},_addDataEditingCustomizations:function(){var e=this.getDescriptorValue(["dataEditing","typeMetaData"]),t=this.getCustomizations();for(var i in e){var n=e[i];if(n.validationMessages)for(var a in n.validationMessages)t.addRule({forType:i,view:"editorForm",fieldId:a,mode:"*",key:"comp.validationMessage",value:n.validationMessages[a]})}},getDescriptorValue:function(e){return this._getInnerValue(this._descriptor,e)},_getInnerValue:function(e,t){for(var i=e,n=0;t.length>n;n++)if(i=i[t[n]],!i)return null;return i},getZoomHandler:function(){return this._zoomHandler}})}),define.Class("wixapps.integration.managers.ApplicationInstanceUtils",function(e){var t=e;t.fields({_appInstance:null}),t.methods({initialize:function(e){this._appInstance=e},createRunner:function(){return{_tasks:[],_onDone:null,_done:function(){if(1>this._tasks.length)return this._onDone&&this._onDone(),void 0;var e=this._tasks.shift();e.func(this._done.bind(this))},add:function(e,t){this._tasks.push({name:e,func:t})},run:function(e){this._onDone=e,this._done()}}},extractStoreData:function(e){var t,i={},n=this.createRunner();n.add("Loading collection names",function(e){for(var a=t.getDescriptorValue(["collections"]),s=0;a.length>s;s++){var o=a[s].id;n.add("Loading items from "+o,function(e){return function(n){t.getDataService().getTransport().query(e,{},null,0,-1,!1,function(t){i[e]=t.items,n()},function(){n()})}}(o))}n.add("Cleaning items",function(e){Object.each(i,function(e){e.forEach(function(e){delete e._createdAt,delete e._hash,delete e._updatedAt,delete e._vg})}),e()}),e()}),n.run(function(){e(i)})},extractDescriptorData:function(){return this._appInstance.getDescriptorValue(["preLoadedData"])},cleanDataInStore:function(e,t){function i(){r.length+l.length==o&&t&&t({successes:r.length,failures:l,failuresCause:p})}function n(e){return function(){r.push(e),i()}}function a(e){return function(t){-1021==t.code||t.description.indexOf("ItemNotExistsException")>-1?r.push(e):(l.push(e),p.push(t)),i()}}var s=this._appInstance,o=0,r=[],l=[],p=[];Object.each(e,function(e){e.forEach(function(e){e._iid&&o++})}),Object.each(e,function(e,t){e.forEach(function(e){e._iid&&s.getDataService().deleteItem(t,e._iid,n(e),a(e))}.bind(this))}.bind(this))},cleanStore:function(e){var t={},i=this._appInstance,n=this.createRunner();n.add("Loading collection names",function(e){for(var a=i.getDescriptorValue(["collections"]),s=0;a.length>s;s++){var o=a[s].id;n.add("Loading items from "+o,function(e){return function(n){i.getDataService().getTransport().query(e,{},null,0,-1,!1,function(i){t[e]=i.items,n()},function(){n()})}}(o))}n.add("Delete all items",function(e){function n(){a--,0===a&&e()}var a=0;Object.each(t,function(e){a+=e.length}),Object.each(t,function(e,t){e.forEach(function(e){i.getDataService().getTransport().deleteItem(t,e._iid,n,n)})}),e()}),e()}),n.run(e)},uploadData:function(e,t){function i(){r.length+l.length==o&&t&&t({successes:r.length,failures:l.length})}function n(e){return function(){r.push(e),i()}}function a(e){return function(t){l.push(e),p.push(t),i()}}var s=this._appInstance,o=0;Object.each(e,function(e){o+=e.length});var r=[],l=[],p=[];Object.each(e,function(e,t){e.forEach(function(e){var i=Object.clone(e);delete i._createdAt,delete i._hash,delete i._updatedAt,delete i._vg;var o=s.getDataItemFactory().createDataItem(i);s.getDataService().createItem(t,o,n(e),a(e))})})},resetStoreToDescriptorData:function(e){this.cleanStore(function(){var t=this.extractDescriptorData(),i=this._appInstance.getDataService().getItemCache();i&&i.removeAll(),this.uploadData(t,e)}.bind(this))}})}),define.Class("wixapps.integration.managers.ApplicationLocalizer",function(e){var t=e;t.inherits("wixapps.integration.managers.BaseLocalizer"),t.fields({_blackList:["/collections","/permissions","/types","/preLoadedData","/lang"]}),t.methods({initialize:function(e){this._lang=e||{},this.parent()},localizeDescriptor:function(e){return this._processValue(e,"")},localize:function(e,t){return t=t||this._locale,this._getByLocale(e,t)||this._getByLocale(e,this.DEFAULT_LANG)||"["+e+"]"},_getByLocale:function(e,t){return t?this._lang.hasOwnProperty(t)?this._lang[t].hasOwnProperty(e)?this._lang[t][e]:null:null:null}})}),define.Class("wixapps.integration.managers.BaseLocalizer",function(e){var t=e;t.resources(["W.Resources","W.Utils","W.CookiesManager","W.Config"]),t.fields({THINGY_CHAR:"@",DEFAULT_LANG:"en",_blackList:[],_isReady:!1,_resourceManager:null,_utils:null}),t.methods({initialize:function(){this._utils=this.resources.W.Utils.AppsUtils,this._resourceManager=this.resources.W.Resources,this._locale=this._getLangCode(),this._macroPattern=RegExp(this.THINGY_CHAR+"[a-zA-Z_\\-\\.]*"+this.THINGY_CHAR),this._thingyPattern=RegExp(this.THINGY_CHAR,"g"),this._isReady=!1,this._ensureBundleLoaded()},isReady:function(){return this._isReady},_ensureBundleLoaded:function(){},localize:function(){throw"Not implemented: ask my children."},isValidKey:function(e){return this._macroPattern.test(e)},getKeyValue:function(e){return e.replace(this._thingyPattern,"")},_getLangCode:function(){var e=this.resources.W.Config;if(e.isEditorMode())return this._resourceManager.getLanguageSymbol();if(e.isPreviewMode())return this.resources.W.CookiesManager.getCookie("wixLanguage");if(e.isPublicMode()){var t=window.navigator.userLanguage||window.navigator.language;return t.split("-")[0]}throw"Localizer:: Not in Editor, Preview or Public... something is wrong"},_processValue:function(e,t){var i=this._utils.getType(e);if(~this._blackList.indexOf(t))return e;switch(i){case"object":return this._iterateObject(e,t);case"array":return this._iterateArray(e,t);case"string":return this._localize(e);default:return e}},_localize:function(e){for(var t,i,n;null!==(t=this._macroPattern.exec(e));)t=t[0],i=t.replace(this._thingyPattern,""),n=this.localize(i),e=e.replace(t,n);return e},_iterateArray:function(e,t){var i,n=e.length;for(i=0;n>i;i++)e[i]=this._processValue(e[i],t+"["+i+"]");return e},_iterateObject:function(e,t){var i;for(i in e)e.hasOwnProperty(i)&&(e[i]=this._processValue(e[i],t+"/"+i));return e}})}),define.Class("wixapps.integration.managers.FieldHighlightHandler",function(e){var t=e;t.inherits(),t.utilize([]),t.traits([]),t.binds([]),t.fields({_highlightedFields:[],_highlightedContainers:[],_editPanelParams:null}),t.methods({initialize:function(){},_resolveHighlightContainer:function(e){switch(e.$className){case"wixapps.integration.proxies.ImageProxy":case"wixapps.integration.proxies.VideoProxy":return e.getElement().firstChild;default:return e.getElement()}},_createFieldRect:function(e){var t=new Element("div",{styles:{border:"1px solid #FFC700","background-color":"#FFDD55",opacity:.3,position:"absolute",top:"0px",right:"0px",bottom:"0px",left:"0px"}});this._highlightedFields.push(t);var i=this._resolveHighlightContainer(e),n=i.getStyle("position");("static"===n||"inherit"===n)&&(i.oldPosition=n,i.setStyle("position","relative")),i.adopt(t)},_createContainerRect:function(e){e.getElement().setStyles({"outline-style":"dashed","outline-width":"1px","outline-offset":"0px","outline-color":"#FFC700"}),this._highlightedContainers.push(e.getElement())},_clearFieldRects:function(){for(;this._highlightedFields.length;){var e=this._highlightedFields.pop();e&&e.parentElement&&e.parentElement.oldPosition&&e.parentElement.setStyle("position",e.parentElement.oldPosition),e.destroy()}},_clearContainerRects:function(){for(;this._highlightedContainers.length;)this._highlightedContainers.pop().setStyles({"outline-style":null,"outline-width":null,"outline-offset":null,"outline-color":null})},highlightField:function(e){e.isInEditPanel&&(this._editPanelParams=e),null!==this._editPanelParams&&this.removeHighlightField({appPart:e.appPart,isInEditPanel:!1},!0);var t=e.appPart.getViewNode(),i=t.getElements("[vcfield="+e.fieldId+"_proxy]").map(function(e){return e.getViewProxy()}),n=t.getElements("[vcfield="+e.containerId+"]").map(function(e){return e.getViewProxy()}),a=this;n.forEach(function(e){a._createContainerRect(e,t)}),i.forEach(function(e){a._createFieldRect(e,t)})},removeHighlightField:function(e,t){this._clearContainerRects(),this._clearFieldRects(),t!==!0&&(e.isInEditPanel?this._editPanelParams=null:null!==this._editPanelParams&&this.highlightField(this._editPanelParams))},_createFieldRect2:function(e){e.getElement().setStyles({"outline-style":"dashed","outline-width":"1px","outline-offset":"0px","outline-color":"#0033ff"}),this._highlightedFields.push(e.getElement())},_clearFieldRects2:function(){for(;this._highlightedFields.length;)this._highlightedFields.pop().setStyles({"outline-style":null,"outline-width":null,"outline-offset":null,"outline-color":null})}})}),define.Class("wixapps.integration.managers.LifecycleManager",function(e){var t=e;t.binds(["_defaultInvalidateLayoutAction","_onProxyIrrecoverable"]),t.fields({_dispatcher:null,_pendingComponents:[],_pendingActions:{},_irrecoverableContainers:[]}),t.statics({ExecutionOrder:{Early:-1,Normal:0,Late:1}}),t.methods({initialize:function(e){this._dispatcher=e,this._dispatcher.addEvent(Constants.WixAppEvents.PROXY_IRRECOVERABLE,this._onProxyIrrecoverable)},notifyComponentCreated:function(e){-1==this._pendingComponents.indexOf(e)&&this._pendingComponents.push(e)},notifyComponentReady:function(e){var t=this._pendingComponents.indexOf(e);t>-1&&this._pendingComponents.splice(t,1),this._performCleanup(),0===this._pendingComponents.length&&this._executeAllPendingActions()},reset:function(){this._pendingComponents=[],this._pendingActions={}},performAction:function(e,t){t=t||this.ExecutionOrder.Normal,this._pendingActions[t]||(this._pendingActions[t]=[]),-1==this._pendingActions[t].indexOf(e)&&this._pendingActions[t].push(e),this._performCleanup(),0===this._pendingComponents.length&&this._executeAllPendingActions()},_performCleanup:function(){var e=this._pendingComponents;this._pendingComponents=[];for(var t=0;e.length>t;t++){var i=e[t];i.$viewProxy&&i.$viewProxy._disposed===!1&&this._waitsForWixification(i)&&this._pendingComponents.push(i)}},_waitsForWixification:function(e){return!(e.getLogic&&e.getLogic().isReady()===!0)},_executeAllPendingActions:function(){var e=this._pendingActions;this._pendingActions={},Object.keys(e).sort().each(function(t){e[t].each(function(e){e()})})},_defaultInvalidateLayoutAction:function(){this._dispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY)},getDefaultInvalidateLayoutAction:function(){return this._defaultInvalidateLayoutAction},_onProxyIrrecoverable:function(e){var t=Boolean(0===this._irrecoverableContainers.length),i=e.sender,n=i.getElement().getParents("[hasproxy]")[0]?i.getElement().getParents("[hasproxy]")[0].getViewProxy():null;n&&-1===this._irrecoverableContainers.indexOf(n)&&this._irrecoverableContainers.push(n),i.dispose(),t&&window.requestAnimFrame(function(){for(;this._irrecoverableContainers.length;){var e=this._irrecoverableContainers.shift();e.isDisposed()||e._reloadProxy()}}.bind(this))}})}),define.Class("wixapps.integration.managers.ViewHolder",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize(["wixapps.core.events.ProxyEventBus","wixapps.integration.managers.AppResizeHandler","wixapps.integration.managers.LifecycleManager","wixapps.core.views.ProxyFactory","wixapps.integration.proxies.ProxyMap","wixapps.integration.utils.LayoutGeometryMap"]),t.fields({_container:null,_rootProxy:null,_data:null,_viewName:"",_geometryMap:null}),t.methods({initialize:function(e,t,i,n,a,s,o){this._eventDispatcher=new this.imports.ProxyEventBus,this._resizeHandler=new this.imports.AppResizeHandler,this._lifecycleManager=new this.imports.LifecycleManager(this._eventDispatcher,s||!1),this._resourceResolverFunction=n,this._nameSpace=a,this._geometryMap=new this.imports.LayoutGeometryMap,this._proxyFactory=new this.imports.ProxyFactory(e,t,i,this._eventDispatcher,this._resourceResolverFunction,this._nameSpace,this._lifecycleManager,o),(new this.imports.ProxyMap).registerComponentProxies(this._proxyFactory)},setContainer:function(e){this._container&&this.destroyContent(),"static"==e.getStyle("position")&&e.setStyle("position","relative"),this._container=e},setupViewHolder:function(e,t,i){this._mode=i||"view",this._data=e,this._viewName=t,this._container&&this._updateContent()},setContentHeight:function(e){this._rootProxy.getElement().setStyle("height",e)},invalidateSize:function(){this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE)},getGeometryMap:function(){return this._geometryMap},_updateContent:function(){this._rootProxy=this._proxyFactory.createView(this._data,this._viewName,this._mode);var e=this._rootProxy.createComponent();this.destroyContent(),this._container.adopt(e),this._resizeHandler.activateResizeHandler(this._eventDispatcher,e),this._rootProxy.setupProxy(),window.requestAnimFrame(function(){this._lifecycleManager.performAction(function(){this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_CREATED)}.bind(this))}.bind(this))},getRootProxy:function(){return this._rootProxy},getEventDispatcher:function(){return this._eventDispatcher},performActionWhenReady:function(e){this._lifecycleManager.performAction(e)},destroyContent:function(){this._container.empty(),this._geometryMap.dispose()},dispose:function(){this.destroyContent(),this._container=null,this._data=null,this._rootProxy&&(this._rootProxy.dispose(),this._rootProxy=null)}})}),define.Class("wixapps.integration.managers.ViewHolderFactory",function(e){var t=e;t.utilize(["wixapps.integration.managers.ViewHolder","wixapps.core.data.DataItemFactory","wixapps.core.managers.TypesManager","wixapps.core.views.ViewDefinitionsRepository"]),t.methods({intialize:function(){},createViewHolder:function(e,t,n,a){var s=new this.imports.DataItemFactory,o=new this.imports.TypesManager,r=new this.imports.ViewDefinitionsRepository(s),l=Constants.WixAppsSystemTypes;for(i=0;l.length>i;i++)o.registerType(l[i]);t.name="TheGreatView",t.forType="Array"!=t.forType?"wix:Object":"Array",t.vars=t.vars||{},r.setViewDefinition(t,!1);var p=new this.imports.ViewHolder(s,o,r,function(){},"",!1,{getAppPageUrl:function(){return""}});p.setContainer(e);var d=s.createDataItem(n);return p.setupViewHolder(d,"TheGreatView",a),p}})}),define.Class("wixapps.integration.managers.WixAppsEditorData",function(e){var t=e;t.inherits("wixapps.integration.managers.WixAppsEditorDataBase"),t.methods({_setupData:function(){this.addDataPanel("AppPart","wixapps.integration.components.AppPart",{logic:"wixapps.integration.components.editor.AppPartDataPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"}),this.addDataPanel("AppBuilderComponent","wixapps.integration.components.AppPart2",{logic:"wixapps.integration.components.panels.ListSettingsPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"}),this.registerAppPartsInAppStore("faq","9692d594-acfc-42da-9c01-7c140f04beeb","f2c4fc13-e24d-4e99-aadf-4cff71092b88"),this.registerAppPartsInAppStore("menu","e4c4a4fb-673d-493a-9ef1-661fa3823ad7","1660c5f3-b183-4e6c-a873-5d6bbd918224"),this.registerAppPartsInAppStore("news","491f9ddf-cbfd-402b-9991-0ff6e336470d","045dd836-ef5d-11e1-ace3-c0dd6188709b"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","30b4a102-7649-47d9-a60b-bfd89dcca135"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","adbeffec-c7df-4908-acd0-cdd23155a817"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","f72a3898-8520-4b60-8cd6-24e4e20d483d"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","c029b3fd-e8e4-44f1-b1f0-1f83e437d45c"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","cd54a28f-e3c9-4522-91c4-15e6dd5bc514"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","c614fb79-dbec-4ac7-b9b0-419669fadecc"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","5fca0e8b-a33c-4c18-b8eb-da50d7f31e4a"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","31c0cede-09db-4ec7-b760-d375d62101e6"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","1b8c501f-ccc2-47e7-952a-47e264752614"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","33a9f5e0-b083-4ccc-b55d-3ca5d241a6eb"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","f72fe377-8abc-40f2-8656-89cfe00f3a22"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","a38ae0cf-96a6-4f6f-b261-4ca6a7f33dfb"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","ea63bc0f-c09f-470c-ac9e-2a408b499f22"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","4de5abc5-6da2-4f97-acc3-94bb74285072"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","e000b4bf-9ff1-4e66-a0d3-d4b365ba3af5"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","43c2a0a8-f224-4a29-bd19-508114831a3a"),this.registerAppPartsInAppStore("playlist","7f5f4fd6-b932-4ede-93db-8ed46f63218f","64f3d173-b4e2-408d-967d-c9ed2bd28125"),this.registerAppPartsInAppStore("miniposts","bf1334c9-9fc0-47a4-adbb-24b702bdb612","053ad9f8-5dce-4c14-ad1f-97397d5bbfe9"),this.registerAppPartsInAppStore("miniposts","bf1334c9-9fc0-47a4-adbb-24b702bdb612","536f7aa5-d722-4048-a1c7-64c9d9c00b33")}})}),define.Class("wixapps.integration.managers.WixAppsEditorDataBase",function(e){var t=e;t.binds(["_setupData"]),t.methods({initialize:function(){this.appsDefinitionData={}},setup:function(){this._setupData()},_setupData:function(){},addLanguageKey:function(e,t){this.resource.getResourceValue("W.Resources",function(i){i.bundles.EDITOR_LANGUAGE[e]=t})},addDataPanel:function(e,t,i){this.resource.getResourceValue("W.Editor",function(n){n.addDataPanel(e,t,i)})},registerAppPartsInAppStore:function(e,t,i){var n=this.appsDefinitionData[t];n||(n={appDefinitionId:t,widgets:{}},this.appsDefinitionData[t]=n),n.widgets[i]={widgetId:i}}})}),define.Class("wixapps.integration.managers.WixAppsGUIManager",function(e){var t=e;t.inherits(),t.utilize(["wixapps.core.views.ViewsCustomizer","wixapps.integration.managers.AppBuilderLocalizer"]),t.traits([]),t.binds([]),t.resources(["wixapps.integration.gui.WixAppsGUIViews"]),t.fields({_viewDescMap:{},_viewCustomizer:null,_localizer:null,DEFAULT_DIALOG_PROFILE:"basicPopup",_dialogProfiles:{basicPopup:{width:300,position:"side",level:1,allowScroll:!0,showToolbar:!0,nonModal:!0,allowDrag:!0,buttonSet:["OK"]}}}),t.methods({initialize:function(){this._viewCustomizer=new this.imports.ViewsCustomizer,this._localizer=new this.imports.AppBuilderLocalizer,this.registerViewDescriptors(this.resources.wixapps.integration.gui.WixAppsGUIViews)},registerViewDescriptors:function(e){e.forEach(function(e){e=this._viewCustomizer.fillMissingIds(e),this._viewDescMap[e.name]=e}.bind(this))},getViewDescriptor:function(e){if(this._viewDescMap.hasOwnProperty(e)){var t=Object.clone(this._viewDescMap[e]);return this._localizer.localizeView(t)}throw"WixAppsGUI:: view ["+e+"] doesn't exist in map"},openDialog:function(e,t,i,n,a){var s=this.getViewDescriptor(t),o=[];a&&(o=a.map(function(e){return this.getViewDescriptor(e)}.bind(this))),s&&this.resource.getResourceValue("W.EditorDialogs",function(a){a._createAndOpenWDialog(t,"wixapps.integration.components.panels.BuilderDialogPanel","mobile.core.skins.InlineSkin",function(t){t.setupPanel(e,s,i,o)}.bind(this),n,void 0,!0,void 0,!1,!1,!0)}.bind(this))},openWDialog:function(e,t,i,n){this.resource.getResourceValue("W.EditorDialogs",function(a){a._createAndOpenWDialog(e+"_inst",e,n||"wysiwyg.editor.skins.panels.base.AutoPanelSkin",function(e){e.setupPanel(t)}.bind(this),i,void 0,!0,void 0,!1,!1,!0)}.bind(this))},getDialogParams:function(e,t,i){var n=Object.clone(this._dialogProfiles[i]||this._dialogProfiles[this.DEFAULT_DIALOG_PROFILE]);return n.title=e,n.description=t,n},isReady:function(){return!0}})}),define.Class("wixapps.integration.managers.WixAppsLocalizer",function(e){var t=e;t.inherits("wixapps.integration.managers.BaseLocalizer"),t.fields({}),t.binds(["_bundleLoaded"]),t.methods({_ensureBundleLoaded:function(){this._resourceManager.bundles.hasOwnProperty("WIXAPPS_LANGUAGE")||this._resourceManager.loadLanguageBundle("WIXAPPS_LANGUAGE",this._bundleLoaded)},_bundleLoaded:function(){this._isReady=!0},localize:function(e,t){return this._resourceManager.get("WIXAPPS_LANGUAGE",e,t)||"["+e+"]"}})}),define.Class("wixapps.integration.managers.WixAppsManager",function(e){var t=e;t.utilize(["wixapps.integration.managers.ApplicationInstance","wixapps.core.utils.WixAppsLogger"]),t.resources(["scriptLoader","topology","W.Viewer","W.Config","W.Utils","W.Data","W.Experiments","mode"]),t.fields({_isReady:!1,_userRole:"none"}),t.methods({initialize:function(){this._initialize(),this._isReady=!0},_initialize:function(){this._appInstanceMap={},this._appDescriptorMap={},this._descriptionCallBacks={},this._logger=new this.imports.WixAppsLogger,this.resources.W.Utils.AppsUtils.getUserRole(function(e){this._userRole=e}.bind(this)),this._loadInstalledApps()},_loadInstalledApps:function(){var e=this.resources.W.Viewer.getAppDataHandler().getAppsData();Object.each(e,function(e){-1!=["wixapps","ecommerce"].indexOf(e.type)&&this.loadApplication(e)},this)},isReady:function(){return this._isReady},loadApplication:function(e){var t=new this.imports.ApplicationInstance(e);this._appInstanceMap[e.applicationId]=t,t.loadDescriptor()},getApp:function(e){return this._appInstanceMap[e]},getAppByPackageName:function(e){for(var t in this._appInstanceMap)if(this._appInstanceMap[t].getPackageName()==e)return this._appInstanceMap[t];return null},_loadExternalAppManifest:function(e,t,i){var n=this.resources.topology[e],a=this.resources.mode.debug?"index.debug.json":"index.json",s=this;this.resources.scriptLoader.loadManifestFromUrl(n+"/"+a,function(){s.resource.getResourceValue(t,function(e){s.registerAppDescriptor(e),i&&i(e)})},function(){s._logger.reportError(s._logger.Errors.FAILED_TO_LOAD_EXTERNAL_APP_MANIFEST,s.$className,"_loadExternalAppManifest",s._logger.SubCategory.CORE_WIRING)})},requestAppDescriptor:function(e,t){return this._appDescriptorMap[e]?(t(this._appDescriptorMap[e]),void 0):(this.resources.W.Data.getDataByQuery("#WIXAPPS_EXTERNAL_APPS",function(i){var n=i.get("items")[e];if(void 0!=n)this._loadExternalAppManifest(e,n.descriptorResourceName,t);else{var a=this._buildDescriptorURL(e);this._loadDescriptorFile(a,e,t)}}.bind(this)),void 0)},getAppsDeploymentConfig:function(e){this.resource.getResourceValue("WixappsAppsDeployment",e)},_loadDescriptorFile:function(e,t,i){var n={id:"js",url:e},a={onLoad:function(){},onFailed:function(){}};this._descriptionCallBacks[t]=this._descriptionCallBacks[t]||[],this._descriptionCallBacks[t].push(i),this.resources.scriptLoader.loadResource(n,a)},_buildDescriptorURL:function(e){var t=this.resources.topology.wixapps+"/javascript/";return t+"wixapps/apps/"+e+"/descriptor.js"},registerAppDescriptor:function(e){e.experiments&&Object.each(e.experiments,function(t,i){var n=i.split("."),a={};a[n[0]]=n[1],this.resources.W.Experiments.isDeployed(a)&&t.apply(this,[e])}.bind(this));var t=0,i=e.packageName;if(this._appDescriptorMap[i]=e,this._descriptionCallBacks[i]){for(t=0;this._descriptionCallBacks[i].length>t;t++)this._descriptionCallBacks[i][t](e);
delete this._descriptionCallBacks[i]}},getUserRole:function(){return this._userRole},openPermaLink:function(e){var t=e.get("dataItemRef"),i=W.Data.getDataByQuery(t),n=this._appInstanceMap[i.get("appInnerID")];n.getZoomHandler().openZoomFromHash(e)},setPageState:function(e,t){this._stateByPage||(this._stateByPage={}),this._stateByPage[e]=t},getPageState:function(e){var t=this._stateByPage&&this._stateByPage[e];return t||""}})}),define.Class("wixapps.integration.managers.WixAppsManager2",function(e){var t=e;t.utilize(["wixapps.core.apprepo.ApplicationInstance2","wixapps.core.apprepo.AppRepoTransport","wixapps.core.utils.WixAppsLogger","wixapps.core.data.selectors.AllItemsOfTypeDataSelector"]),t.statics({APP_BUILDER_APP_TYPE:"appbuilder",APP_BUILDER_APP_DEFINITION_ID:"3d590cbc-4907-4cc4-b0b1-ddf2c5edf297"}),t.binds(["_onPageTransitionEnded"]),t.resources(["W.Viewer","W.Config"]),t.fields({_appInstanceMap:{},_appInstWaitingList:{},_appRepoTransport:null,_isReady:!1,_dataSelectorsForType:{}}),t.methods({initialize:function(){this._appRepoTransport=new this.imports.AppRepoTransport,this._loadInstalledApps(),this._isReady=!0,this._logger=new this.imports.WixAppsLogger,this.resources.W.Viewer.addEvent("pageTransitionEnded",this._onPageTransitionEnded)},isReady:function(){return this._isReady},_onPageTransitionEnded:function(){var e=this._logger,t=this.resources.W.Viewer.getCurrentPageNode(),i=t.getLogic().getDataItem().getData();if("AppBuilderPage"===i.type){var n=this.resources.W.Config.isPreviewMode(),a=n?e.Events.APP_BUILDER_MOVED_TO_APP_PAGE_IN_PREVIEW:e.Events.APP_BUILDER_MOVED_TO_APP_PAGE_IN_VIEWER;e.reportEvent(a,{c1:i.id,c2:i.appPageId,i1:i.appInnerID})}},registerNewApplication:function(e,t){var i=t.applicationId;return this._registerAppInstance(i,e),t.appDefinitionId=this.APP_BUILDER_APP_DEFINITION_ID,this.resources.W.Viewer.getAppDataHandler().registerAppData(t),i},_registerAppInstance:function(e,t){this._appInstanceMap[e]=t},_loadInstalledApps:function(){var e=this.resources.W.Viewer.getAppDataHandler().getAppsData();Object.each(e,function(e){if(-1!=[this.APP_BUILDER_APP_TYPE].indexOf(e.type)){e.appDefinitionId=this.APP_BUILDER_APP_DEFINITION_ID,this.resources.W.Viewer.getAppDataHandler().registerAppData(e);var t=e.applicationId,i=e.instanceId;this._loadApplicationFromRepo(t,i)}},this)},_isAppInstalled:function(e){return void 0!==this.resources.W.Viewer.getAppDataHandler().getAppsData()[e]},_isAppLoaded:function(e){return void 0!==this._appInstanceMap[e]},_getAppInstanceWaitingList:function(e){var t=this._appInstWaitingList[e];return t||(t=[],this._appInstWaitingList[e]=t),t},_loadApplicationFromRepo:function(e,t){var i=function(i){var n=new this.imports.ApplicationInstance2(t,i);n.setApplicationId(e),n.setSavedInRepo(!0),this._registerAppInstance(e,n);for(var a=this._getAppInstanceWaitingList(e);a.length>0;){var s=a.pop();s(n)}}.bind(this),n=function(e,t){var i=this._logger;i.reportError({code:e,description:t},this.$className,"_loadApplicationFromRepo",i.SubCategory.APP_REPO_SERVICE,i.Severity.ERROR,i.Category.VIEWER)}.bind(this);W.Utils.AppsUtils.isRealPublicMode()?this._appRepoTransport.getPublishedInstance(t,i,n):this._appRepoTransport.getSavedInstance(t,i,n)},getApplicationInstance:function(e,t){this._isAppLoaded(e)?t(this._appInstanceMap[e]):this._isAppInstalled(e)?this._getAppInstanceWaitingList(e).push(t):t(null)},getApplicationInstanceSync:function(e){return this._appInstanceMap[e]},createApplicationInstance:function(e,t){var i=new this.imports.ApplicationInstance2(t);return i.setApplicationId(e),i.setSavedInRepo(!1),i},getApplicationInstances:function(){return this._appInstanceMap},getNextGeneratedApplicationId:function(){var e=this.resources.W.Viewer.getAppDataHandler();return e.getLargestApplicationId()+1},getAppPart2Components:function(){var e=$("SITE_STRUCTURE").getElements("div[comp*='AppPart2']"),t=e.map(function(e){return e.getLogic?e.getLogic():void 0});return t.clean()},getAppPartComponent:function(e){var t=this.getAppPart2Components(),i=t.filter(function(t){return t.getAppPartDefinition().getId()===e});return i&&i[0]},getAllItemsOfTypeDataSelector:function(e,t){var i=t.getDataProviders().getWixDbDataProvider(),n=this._dataSelectorsForType[e];return n||(n=new this.imports.AllItemsOfTypeDataSelector(t,e,i),this._dataSelectorsForType[e]=n,n.addEvent("itemRemoved",this._onTypedSelectorItemRemoved)),this._dataSelectorsForType[e]}})}),define.Class("wixapps.integration.managers.applicationhandlers.ZoomHandler",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["validateZoomRelatedData"]),t.utilize([]),t.resources(["W.Data","W.Commands","W.Components","W.Utils","W.Viewer"]),t.methods({initialize:function(e){this._applicationInstance=e},validateZoomRelatedData:function(){var e=this._applicationInstance.getDescriptorValue(["parts"]).filter(function(e){return!!e.zoomParams}),t=this;this.resources.W.Data.getDataItemsByType("PermaLink",function(i){var n=Object.values(i).map(function(e){return e.get("dataItemRef")});t.resources.W.Data.getDataByQueryList(n,function(n){t._initializePermaLinkAndPartDataMap(e,i,n),t.fireEvent("mapInitialized",t._permaLinkAndPartDataMap)})})},getZoomPartData:function(e,t){this._getPermaLinkAndZoomPartData(e,function(e){t(e&&e.partData)})},_getPermaLinkAndZoomPartData:function(e,t){var i=this,n=function(a){i.removeEvent("mapInitialized",n);var s=a[e];t(s)};this._permaLinkAndPartDataMap?n(this._permaLinkAndPartDataMap):this.addEvent("mapInitialized",n)},_initializePermaLinkAndPartDataMap:function(e,t,i){var n={};Object.forEach(i,function(e){e.get("appInnerID")==this._applicationInstance.getIdInMetasite()&&(n[e.get("appPartName")]=e)},this),this._permaLinkAndPartDataMap={},e.forEach(function(e){var i=this._getPermaLinkAndPartDataForPart(e,t,n);this._permaLinkAndPartDataMap[e.id]=i},this)},_getPermaLinkAndPartDataForPart:function(e,t,i){var n=this._getPermaLinkCorrectId(e),a=t["#"+n];return a||(a=this._getPermaLinkByPartName(t,i,e)),a?{permaLinkData:a,partData:i[e.id]}:this._addPermaLinkAndPartDataItem(e)},_getPermaLinkByPartName:function(e,t,i){var n=i.id,a=t[n]&&t[n].get("id");if(!a)return null;var s=Object.values(e).filter(function(e){return e.get("dataItemRef")=="#"+a}).pick();if(!s)return null;if(this.resources.W.Viewer.getPreviewMode()===!0){var o=this._addPermaLinkItem(i,t[n]);return s.set("correctPermaLinkRef","#"+o.get("id")),o}return s},_addPermaLinkAndPartDataItem:function(e){var t=this._applicationInstance.getIdInMetasite(),i=this.resources.W.Data.addDataItemWithUniqueId("appPart",{type:"AppPart",appInnerID:t,appLogicParams:{},appLogicCustomizations:[],appPartName:e.id,viewName:e.views[0]}),n=this._addPermaLinkItem(e,i.dataObject);return{permaLinkData:n,partData:i.dataObject}},_addPermaLinkItem:function(e,t){return this.resources.W.Data.addDataItem(this._getPermaLinkCorrectId(e),{type:"PermaLink",appType:"ListsApps",dataItemRef:"#"+t.get("id"),mutableSeoTitle:e.zoomParams&&e.zoomParams.urlTitle||""})},_getPermaLinkCorrectId:function(e){if(!e.zoomParams||!e.zoomParams.urlIdPrefix)throw"must define urlIdPrefix on the part definition -> zoomParams which is unique for the app";var t=this._applicationInstance.getIdInMetasite();return e.zoomParams.urlIdPrefix+t},openZoomFromHash:function(e){this._detectCircularZoomUpdate()||this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{item:this._getItemFromHash(),getDisplayerDivFunction:this._getAppPartDivFunction(e),getHashPartsFunction:this._getHashPartsFunction(e)},this)},_detectCircularZoomUpdate:function(){return this._lastOpenedItem&&1e3>(new Date).getTime()-this._lastOpenedItemTimestamp?this._getItemFromHash().id===this._lastOpenedItem.id:!1},openZoomForItemsList:function(e,t,i,n){var a=this;this._lastOpenedItem=e[t],this._lastOpenedItemTimestamp=(new Date).getTime(),this._getPermaLinkAndZoomPartData(i,function(i){var s=i&&i.partData;if(s){var o=a._applicationInstance.getPartDefinition(s.get("appPartName"));s.set("viewName",n.viewName||o.views[0])}var r=i&&i.permaLinkData,l=a.resources.W.Data.createDataItem({type:"list",items:e},"list");a.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:l,currentIndex:t,extraParams:n||{},getDisplayerDivFunction:a._getAppPartDivFunction(r),getHashPartsFunction:a._getHashPartsFunction(r)},a)})},openZoomForNewItem:function(e,t,i){var n=this;this._getPermaLinkAndZoomPartData(e,function(e){var a=e&&e.permaLinkData,s=n.resources.W.Data.createDataItem({type:"list",items:[{title:"untitled",_iid:"newItem"}]},"list");n.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:s,currentIndex:0,extraParams:t||{},getDisplayerDivFunction:n._getAppPartDivFunction(a,i),getHashPartsFunction:n._getHashPartsFunction(a)},n)})},_getAppPartDivFunction:function(e,t){return function(i,n,a){this._createZoomContent(e,i,n,a,t)}.bind(this)},_createZoomContent:function(e,t,i,n,a){var s,o="container"in i?"zoomLayout":"legacy",r=this.resources.W.Data.getDataByQuery(e.get("dataItemRef")),l=this._applicationInstance.getPartDefinition(r.get("appPartName")),p=this._getItemAppPartData(t,e,r,l);s=new Element("div"),"zoomLayout"==o&&i.container.adopt(s);var d=this;this.resources.W.Components.createComponent("wixapps.integration.components.AppPart","wysiwyg.viewer.skins.area.CleanZoomAreaSkin",p,null,function(e){e.setExtraLogicParams(a)},function(e){d.fireEvent("zoomContentChanged",e),"legacy"==o?d._setComponentSize(l,e,i.x,n):e.addEvent("proxyDisplayed",function(t){if(t.className.contains("wixapps.integration.proxies.layout.ZoomLayoutProxy")){var a=function(){e.getViewNode().getParents("body").length&&(e.setWidth(e.getSkinPart("inlineContent").children[0].getSize().x),window.requestAnimFrame(function(){n(e.getViewNode())})),t.removeEvent(Constants.WixAppEvents.APP_ZOOM_READY,a)};t.addEvent(Constants.WixAppEvents.APP_ZOOM_READY,a),t.renderZoomLayout(i.x,i.y)}else d._setComponentSize(l,e,i.x,n)})},null,s)},_getItemAppPartData:function(e,t,i,n){var a=this.resources.W.Data.createDataItem({type:i.getType()},i.getType());a.copySchemaFieldsFrom(i,!0);var s=a.get("appLogicParams"),o=n.zoomParams.itemIdParamName?n.zoomParams.itemIdParamName:"itemId";return s[o]={type:"AppPartParam",value:e.id},a},_setComponentSize:function(e,t,i,n){var a=e.defaultWidth?Math.min(e.defaultWidth,i):i;t.setWidth(a),e.defaultHeight&&t.setHeight(e.defaultHeight),window.requestAnimFrame(function(){t.getMainProxy().updateLayoutWhenReady(function(){t.getEventDispatcher().fireEvent(Constants.WixAppEvents.APP_VIEW_READY),n(t.getViewNode())}.bind(this))}.bind(this))},_getHashPartsFunction:function(e){var t=this.resources.W.Data.getDataByQuery(e.get("dataItemRef")),i=this._applicationInstance.getPartDefinition(t.get("appPartName")).zoomParams;return function(t,n){var a=e.get("mutableSeoTitle"),s=a||i.urlTitle||"";n({id:e.get("id"),title:s,extData:this._getHashExtraDataString(t.id,t.title)})}.bind(this)},_getHashExtraDataString:function(e,t){return e+"/"+encodeURIComponent(t.toLowerCase().replace(/\s+/gi,"-"))},_getItemFromHash:function(){var e=this.resources.W.Utils.hash.getHashParts().extData,t=e.split("/");return{id:t[0],title:t[1]}}})}),define.Const("WixAppsDefaultTypeValues",{String:"Text.",Number:0,Boolean:!1,Array:[],Object:{},"wix:Date":{_type:"wix:Date",iso:"1970-01-01T00:00:00.000Z"},"wix:Image":{_type:"wix:Image",title:"",src:"6c90a0673862c3ba34f0cd12a004aa6f.wix_mp",width:1280,height:850},"wix:Video":{_type:"wix:Video",videoId:"UAxMzrWZOpY",videoType:"YOUTUBE"},"wix:Link":{_type:"wix:Link",linkType:"",href:"",label:"",target:"_blank",icon:""},"wix:NumberInRange":{_type:"wix:NumberInRange",value:0,minValue:0,maxValue:100},"wix:RichText":{_type:"wix:RichText",text:"RichText.",links:[],version:1},"wix:LinkBase":{_type:"wix:LinkBase"},"wix:TextLink":{_type:"wix:TextLink",text:"I am a text link",link:{_type:"wix:LinkBase"}},"wix:Location":{_type:"wix:Location",address:"",addressInfo:"",latitude:1970,longitude:1970}}),define.Const("WixAppsSystemTypes",[{_iid:"wix:Type",_type:"wix:Type",fields:[{name:"name",type:"String"},{name:"fields",type:"Array<wix:Field>"},{name:"validations",type:"Array<wix:Validation>",defaultValue:"[]"}]},{_iid:"wix:Field",_type:"wix:Type",fields:[{name:"name",type:"String"},{name:"type",type:"String"},{name:"defaultValue"},{name:"computed",type:"Boolean",defaultValue:!1},{name:"validations",type:"Array<wix:Validation>",defaultValue:[]}]},{_iid:"wix:Validation",_type:"wix:Type",fields:[{name:"func",type:"String"},{name:"params",type:"Array",defaultValue:[]}]},{_iid:"wix:Object",_type:"wix:Type",fields:[]},{_iid:"wix:Map",_type:"wix:Type",fields:[]},{_iid:"wix:Ref",_type:"wix:Type",fields:[{name:"itemId",type:"String"},{name:"collectionId",type:"String"}]},{_iid:"wix:Permission",_type:"wix:Type",fields:[{name:"collectionId",type:"String"},{name:"operation",type:"String"},{name:"role",type:"String"}]},{_iid:"wix:Customizations",_type:"wix:Type",fields:[{name:"rules",type:"Array<wix:Object>",defaultValue:[]}]},{_iid:"wix:Date",_type:"wix:Type",fields:[{name:"iso",type:"String",defaultValue:"1970-01-01T00:00:00.000Z",validations:[{func:"ne",params:["Invalid Date"]}]}]},{_iid:"wix:Image",_type:"wix:Type",fields:[{name:"title",type:"String",defaultValue:""},{name:"src",type:"String"},{name:"width",type:"Number"},{name:"height",type:"Number"}]},{_iid:"wix:Video",_type:"wix:Type",fields:[{_type:"wix:Field",name:"videoId",type:"String",defaultValue:"UAxMzrWZOpY"},{_type:"wix:Field",name:"videoType",type:"String",defaultValue:"YOUTUBE"}]},{_iid:"wix:Link",_type:"wix:Type",fields:[{name:"linkType",type:"String"},{name:"href",type:"String"},{name:"label",type:"String"},{name:"target",type:"String"},{name:"icon",type:"String"}]},{_iid:"wix:NumberInRange",_type:"wix:Type",fields:[{name:"value",type:"Number"},{name:"minValue",type:"Number"},{name:"maxValue",type:"Number"}]},{_iid:"wix:RichText",_type:"wix:Type",fields:[{name:"text",type:"String",defaultValue:""},{name:"links",type:"Array<wix:PageLink,wix:DocLink,wix:ExternalLink,wix:MailLink>",defaultValue:[]},{name:"version",type:"Number",defaultValue:1}]},{_iid:"wix:LinkBase",_type:"wix:Type",fields:[]},{_iid:"wix:PageLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"pageId",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:DocLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"docId",type:"String"},{name:"docName",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:ExternalLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"address",type:"String"},{name:"target",type:"String"},{name:"protocol",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:MailLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"email",type:"String"},{name:"subject",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:Location",_type:"wix:Type",fields:[{name:"address",type:"String"},{name:"latitude",type:"Number"},{name:"longitude",type:"Number"},{name:"addressInfo",type:"String"}]},{_iid:"wix:TextLink",_type:"wix:Type",fields:[{name:"text",type:"String"},{name:"link",type:"wix:LinkBase"}]},{_iid:"wix:Audio",_type:"wix:Type",fields:[{name:"uri",type:"String"},{name:"title",type:"String"},{name:"originalFilename",type:"String"},{name:"iconUri",type:"String"}]}]),define.Class("wixapps.integration.managers.undoredomanager.AppBuilderChange",function(e){var t=e;t.inherits("wysiwyg.editor.managers.undoredomanager.BaseChange"),t.utilize(["wixapps.core.data.DataItemFactory","wixapps.core.views.ViewsCustomizer"]),t.resources(["W.Preview"]),t.methods({initialize:function(){this._dataFactory=new this.imports.DataItemFactory,W.Commands.registerCommand("WAppsEditor2Commands.Undo.DataChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.DataItemChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.ViewDefinitionChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.CustomizationChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.CustomizationChangeMade",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.DataSelectorChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.TypeChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.FieldRemoved",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.FieldAdded",!0)},startListen:function(){W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.DataChange",this,this._onDataChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.DataItemChange",this,this._onDataItemChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.ViewDefinitionChange",this,this._onViewDefinitionChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.CustomizationChange",this,this._onViewCustomizationChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.DataSelectorChange",this,this._onDataSelectorChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.TypeChange",this,this._onTypeChanged),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.FieldRemoved",this,this._onFieldRemoved),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.FieldAdded",this,this._onFieldAdded)},stopListen:function(){W.Commands.unregisterListener(this)},getPreliminaryActions:function(e){var t=this.injects().UndoRedoManager._constants.PreliminaryActions;switch(e.changeType){case"Data":case"DataItem":case"View":case"Selector":case"Customization":case"Type":case"FieldRemoved":case"FieldAdded":return[t.SELECT_COMPONENT];default:return null}},_onDataChange:function(e){var t={type:this.className,changeType:"Data",dataProvider:e.dataProvider,index:e.index,id:e.id,newValue:e.newValue,oldValue:e.oldValue,appPart:e.appPart,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onDataItemChange:function(e){var t={type:this.className,changeType:"DataItem",dataItem:e.dataItem,newValue:e.newValue,oldValue:e.oldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onViewDefinitionChange:function(e){var t={type:this.className,changeType:"View",viewRepo:e.viewRepo,newValue:e.newValue,oldValue:e.oldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onViewCustomizationChange:function(e){var t={type:this.className,changeType:"Customization",viewDef:e.viewDef,viewRepo:e.viewRepo,newValue:e.newRule,oldValue:e.oldRule,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onDataSelectorChange:function(e){var t={type:this.className,selector:e.selector,changeType:"Selector",changeSubType:e.changeType,dataItemId:e.dataItemId,newValue:e.newValue,oldValue:e.oldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onTypeChanged:function(e){var t={type:this.className,changeType:"Type",dataProvider:e.dataProvider,newValue:e.newValue,oldValue:e.oldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onFieldRemoved:function(e){var t={type:this.className,changeType:"FieldRemoved",fieldName:e.fieldName,viewRepo:e.viewRepo,dataProvider:e.dataProvider,modifiedViews:e.modifiedViews,modifiedItems:e.modifiedItems,typeNewValue:e.typeNewValue,typeOldValue:e.typeOldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onFieldAdded:function(e){var t={type:this.className,changeType:"FieldAdded",fieldName:e.fieldName,viewRepo:e.viewRepo,dataProvider:e.dataProvider,modifiedViews:e.modifiedViews,modifiedItems:e.modifiedItems,typeNewValue:e.typeNewValue,typeOldValue:e.typeOldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},undo:function(e){var t=e.changeType;switch(t){case"Customization":this._applyCustomizationValue(e.viewDef,e.viewRepo,e.oldValue);break;case"Data":this._applyDataChange(e.dataProvider,e.index,e.oldValue,e.newValue,e.appPart);break;case"DataItem":this._applyDataItemChange(e.dataItem,e.oldValue);break;case"View":this._applyViewChange(e.oldValue,e.newValue,e.viewRepo);break;case"Type":this._applyTypeChange(e.oldValue,e.dataProvider);break;case"Selector":this._applySelectorChange(e.selector,e.changeSubType,e.dataItemId,e.oldValue,e.newValue);break;case"FieldRemoved":this._applyAddField(e.viewRepo,e.dataProvider,e.modifiedViews,e.modifiedItems,e.typeOldValue);break;case"FieldAdded":this._applyRemoveField(e.viewRepo,e.dataProvider,e.modifiedViews,e.typeOldValue)}},redo:function(e){var t=e.changeType;switch(t){case"Customization":this._applyCustomizationValue(e.viewDef,e.viewRepo,e.newValue);break;case"Data":this._applyDataChange(e.dataProvider,e.dataSelector,e.index,e.newValue,e.oldValue,e.appPart);break;case"DataItem":this._applyDataItemChange(e.dataItem,e.newValue);break;case"View":this._applyViewChange(e.newValue,e.oldValue,e.viewRepo);break;case"Type":this._applyTypeChange(e.newValue,e.dataProvider);break;case"Selector":this._applySelectorChange(e.selector,e.changeSubType,e.dataItemId,e.newValue,e.oldValue);break;case"FieldRemoved":var i=this._preProcessRedoData(e);this._applyRemoveField(i.viewRepo,i.dataProvider,i.modifiedViews,i.typeNewValue);break;case"FieldAdded":var i=this._preProcessRedoData(e);this._applyAddField(i.viewRepo,i.dataProvider,i.modifiedViews,i.modifiedItems,i.typeNewValue)}},_preProcessRedoData:function(e){var t=e.modifiedViews.map(function(e){return{newValue:e.oldValue,oldValue:e.newValue}}),i={type:e.type,changeType:e.changeType,fieldName:e.fieldName,viewRepo:e.viewRepo,dataProvider:e.dataProvider,modifiedViews:t,modifiedItems:e.modifiedItems,typeNewValue:e.typeNewValue,typeOldValue:e.typeOldValue,changedComponentIds:e.changedComponentIds};return i},_applyCustomizationValue:function(e,t,i){console.log("UNDO: applyCustomizationRule",JSON.stringify(i)),W.Commands.executeCommand("WAppsEditor2Commands.Undo.CustomizationChangeMade",{rule:i}),this.imports.ViewsCustomizer.applyRule(e,i),t.setViewDefinition(e)},_applyDataChange:function(e,t,i,n,a){var s;n?i?(s=this._dataFactory.createDataItem(i),e.updateItem(s)):W.Commands.executeCommand("WAppsEditor2Commands.RemoveDataItem",{fromUndo:!0,dataItemId:n._iid,appPart:a}):W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{fromUndo:!0,rawData:i,appPart:a,atIndex:t})},_applyDataItemChange:function(e,t){e.setValue(t)},_applyViewChange:function(e,t,i){e?i.setViewDefinition(e):i.removeViewDefinition(t)},_applyTypeChange:function(e,t){t.updateType(e)},_applySelectorChange:function(e,t,i,n,a){e.handleUndo(t,i,n,a)},_applyAddField:function(e,t,i,n,a){this._applyTypeChange(a,t);var s,o;for(s=0;i.length>s;s++)o=i[s],this._applyViewChange(o.oldValue,o.newValue,e);if(n)for(s=0;n.length>s;s++)o=n[s],this._applyDataItemChange(o.dataItem,o.oldValue)},_applyRemoveField:function(e,t,i,n){var a,s;for(a=0;i.length>a;a++)s=i[a],this._applyViewChange(s.oldValue,s.newValue,e);this._applyTypeChange(n,t)},_applyViewTypeChange:function(e,t,i,n,a){this._applyViewChange(e,t,i),this._applyTypeChange(n,a)},_applyTypeViewChange:function(e,t,i,n,a){this._applyTypeChange(n,a),this._applyViewChange(e,t,i)}})}),define.Class("wixapps.integration.proxies.AppLinkProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.binds(["_onClicked"]),t.utilize(["wixapps.core.utils.WixAppsLogger"]),t.resources(["W.Config"]),t.methods({createComponent:function(){var e=this.parent();return e.addEvent("click",this._onClicked),this._element.addClass("wixAppsLink"),this._updateLink(),e},_getContainerElementType:function(){return"a"},_onDataChange:function(){this._updateLink()},_updateLink:function(){var e=this._viewContext.getEnvironment().getProxyFactory().getHostingComponent();if(!e||!e.getAppPageUrl)throw"Can't update link for app page in this context";e.getAppPageUrl(this._def.getChildValue("pageId"),this._data,this._def.getChildValue("linkType"),function(e,t,i,n){this.isDisposed()||this._element.set("href","#!"+n)}.bind(this))},_onClicked:function(){if(this.resources.W.Config.isPreviewMode()){var e=new this.imports.WixAppsLogger;e.reportEvent(e.Events.APP_BUILDER_APP_LINK_CLICKED,{g1:this._def.getChildValue("pageId"),c1:this._element.get("href")})}}})}),define.Class("wixapps.integration.proxies.AreaProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.utilize(["wixapps.integration.utils.flex.BoxFlexPolyfill"]),t.binds(["_applyBoxLayout"]),t.fields({}),t.methods({createComponent:function(){this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation();var e=this._createWixComponent("wixapps.integration.components.Area",void 0,{allowDragChildren:!1,styleNS:this._def.getChildValue("styleNS")||"default"});return this._createChildComponents(e),e},_onComponentWixified:function(){this.parent(),this._componentLogic.addEvent(Constants.DisplayEvents.SKIN_CHANGE,this._applyBoxLayout),this._applyBoxLayout()},_applyBoxLayout:function(){var e=this._getLayoutRootElement();if(this.imports.BoxFlexPolyfill.applyBoxFlexPolyfill(e),this._applyBoxStyles(e),this._setupBox(e),this._element.setStyle("position","relative"),this._componentLogic){var t=this._getInlineContent();this._isLayoutBasedHeight()?(this._componentLogic.getSkinPart("bg").setStyle("height","100%"),t.setStyle("position","absolute"),t.setStyle("height","100%")):(t.setStyle("position","relative"),t.setStyle("width","100%"))}},_getLayoutRootElement:function(){return this._getInlineContent()},_getInlineContent:function(){return this._componentLogic&&this._componentLogic.getSkinPart("inlineContent")},_getDefaultOrientation:function(){return"vertical"},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.area.AppleArea",style:"c1"},ecomCouponBox:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_cbx1"},ecomCartHeader:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ch1"},ecomEmptyCartBG:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ecbg1"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},dispose:function(){this._componentLogic&&this._componentLogic.removeEvent(Constants.DisplayEvents.SKIN_CHANGE,this._applyBoxLayout),this.parent()}})}),define.Class("wixapps.integration.proxies.AudioInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onFieldReady"]),t.methods({createComponent:function(){this._createRawData();var e=this._createWixComponent("wysiwyg.editor.components.inputs.AudioInput",null,{labelText:"",buttonText:this._def.getChildValue("label"),uri:this._data.getChildValue("uri"),originalFileName:this._data.getChildValue("originalFileName")});return e.addEvent(Constants.ComponentEvents.READY,this._onFieldReady),e},_getDefaultSkinName:function(){return"wysiwyg.editor.skins.inputs.AudioInputSkin"},_createRawData:function(){var e=this._data.getValue(),t=this._def.getValue();return{type:"AudioPlayer",uri:e.uri,autoPlay:t.autoPlay,loop:t.loop,visible:t.visible,volume:t.volume,title:e.title,description:e.description,icon_uri:void 0,originalFileName:e.title}},_onDataChanged:function(){this._updateAudioInputProxy()},_onFieldReady:function(){this._componentLogic&&(this._componentLogic.setValue(this._createRawData()),this._componentLogic.addEvent("inputChanged",this._onComponentDataChanged))},_onComponentDataChanged:function(){if(this._componentLogic){this._ignoreUpdate=!0;var e=this._componentLogic.getValue();if(e){var t=this._data.getValue(0);t.uri=e.uri,t.originalFileName=e.originalFileName,this._data.setValue(t)}else this._data.setValue(this._getEmptyImage());this._ignoreUpdate=!1}},_updateAudioInputProxy:function(){this._componentLogic},_getAcceptableDataTypes:function(){return["Audio"]}})}),define.Class("wixapps.integration.proxies.AudioPlayerProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.resources(["W.Commands"]),t.methods({createComponent:function(){var e=this._createRawData();return this._createWixComponent("wysiwyg.viewer.components.AudioPlayer",e,void 0)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.AudioPlayerMinimalSkin"},_createRawData:function(){var e=this._data.getValue(),t=this._def.getValue();return{type:"AudioPlayer",uri:e.uri,autoPlay:t.autoPlay,loop:t.loop,visible:t.visible,volume:t.volume,title:e.title,description:e.description,icon_uri:void 0,originalFileName:e.originalFilename}},_onComponentWixified:function(){this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.FinalizeDataItemEditing",this,this._onFinalizeDataItemEditing)},_onFinalizeDataItemEditing:function(){this._componentLogic&&this._componentLogic._stop(),this.resources.W.Commands.unregisterCommand("WAppsEditorCommands.FinalizeDataItemEditing")},_onDataChanged:function(){if(this._componentLogic){var e=this._isPlaying();this._componentLogic._stop();var t=this._data.getValue(0),i=this._componentLogic.getDataItem();i.set("title",t.originalFileName,!0),i.set("originalFileName",t.originalFileName,!0),i.set("uri",t.uri,!0),i.fireDataChangeEvent(),e&&this._componentLogic._play()}},_isPlaying:function(){return this._componentLogic?"stopped"!==this._componentLogic.getState():!1},_getAcceptableDataTypes:function(){return["Audio"]}})}),define.Class("wixapps.integration.proxies.Button2Proxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.utilize([]),t.binds(["_handleSizeChange"]),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait","wixapps.integration.proxies.traits.AppsLinkTrait"]),t.resources(["W.Data"]),t.methods({createComponent:function(){var e=this._createWixComponent("wixapps.integration.components.SiteButton",this._createRawData(),void 0);return this._innerElement.hasAttribute("height")||this._innerElement.setAttribute("height",this._def.getChildValue("height")||"30"),this._hideButtonIfLabelIsEmpty(),e},_hideButtonIfLabelIsEmpty:function(){"String"==this._data.getTypeName()&&""===this._data.getValue()?this._element.collapse():this._element.uncollapse()},_createRawData:function(){return{type:"SiteButton",label:this._getLabel(this._data),href:"",target:"_self",linkType:"FREE_LINK",icon:""}},_getLabel:function(e){var t=null;return t="String"==this._data.getTypeName()&&e.getValue(),t=t||this._def.getChildValue("label"),t=t||e.label},_onDataChanged:function(e){this._refresh(),this.parent(e)},_refresh:function(){this._componentLogic&&(this._hideButtonIfLabelIsEmpty(),this._setNewData())},_setNewData:function(){var e=this._componentLogic.getDataItem();e.setData(this._createRawData())},_getPropSchemaName:function(){return"ButtonProperties"},_setupPropertyHandlers:function(){this._mapToCompProperty("align"),this._mapToCompProperty("margin","margin",function(e){return parseInt(e,10)}),this._handleProperties(["label"],function(){this._refresh()})},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"b3"},ecomViewCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_vc1"},ecomCheckout:{skin:"wysiwyg.viewer.skins.button.DisabledLayerButton",style:"ecom_co1"},ecomAddToCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_atc1"},ecomRemoveFromCart:{skin:"wysiwyg.viewer.skins.button.FixedFontButton",style:"ecom_rfc1"},ecomApplyCoupon:{skin:"wysiwyg.viewer.skins.button.ApplyButtonEcom",style:"ecom_apl1"},ecomAddProduct:{skin:"wysiwyg.viewer.skins.button.AddProductButton",style:"ecom_ap1"},mobileEcomAddProduct:{skin:"ecommerce.skins.mcom.AddProductButton",style:"ecom_ap1_mobile"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";
return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_setNaturalSize:function(){if(this._isCompBasedWidth()){var e=this._getNaturalWidth();this._element.setStyle("width",e),this._innerElement.setStyle("width",e)}if(this._isCompBasedHeight()){var t=this._getNaturalHeight();this._element.setStyle("height",t),this._innerElement.setStyle("height",t)}},_getNaturalWidth:function(){return this._componentLogic.getSizeLimits().minW},_getNaturalHeight:function(){return this._componentLogic.getSizeLimits().minH}})}),define.Class("wixapps.integration.proxies.ButtonProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.utilize([]),t.binds(["_handleSizeChange"]),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait","wixapps.integration.proxies.traits.AppsLinkTrait"]),t.resources(["W.Data"]),t.methods({createComponent:function(){var e=this._createWixComponent("wysiwyg.viewer.components.SiteButton",this._createRawData(),void 0);return this._innerElement.hasAttribute("height")||this._innerElement.setAttribute("height",this._def.getChildValue("height")||"30"),this._hideButtonIfLabelIsEmpty(),e},_hideButtonIfLabelIsEmpty:function(){"String"==this._data.getTypeName()&&""===this._data.getValue()?this._element.collapse():this._element.uncollapse()},_createRawData:function(){var e=this._data.getValue();return{type:"SiteButton",label:this._getLabel(e),href:this._getChildValue("href","",e),target:this._getChildValue("target","_self",e),linkType:this._getChildValue("linkType","FREE_LINK",e),icon:this._getChildValue("icon","",e)}},_getLabel:function(e){var t=null;return t=this._def.getChildValue("label"),t=t||"String"==this._data.getTypeName()&&e,t=t||e.label,t=t||"Submit"},_getChildValue:function(e,t,i){return this._def.getChildValue(e)||(i[e]?i[e]:t)},_onDataChanged:function(e){this._refresh(),this.parent(e)},_refresh:function(){this._componentLogic&&(this._hideButtonIfLabelIsEmpty(),this._setNewData())},_setNewData:function(){var e=this._componentLogic.getDataItem();e.setData(this._createRawData())},_getPropSchemaName:function(){return"ButtonProperties"},_setupPropertyHandlers:function(){this._mapToCompProperty("align"),this._mapToCompProperty("margin","margin",function(e){return parseInt(e,10)}),this._handleProperties(["label"],function(){this._refresh()})},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"b3"},ecomViewCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_vc1"},ecomCheckout:{skin:"wysiwyg.viewer.skins.button.DisabledLayerButton",style:"ecom_co1"},ecomAddToCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_atc1"},ecomRemoveFromCart:{skin:"wysiwyg.viewer.skins.button.FixedFontButton",style:"ecom_rfc1"},ecomApplyCoupon:{skin:"wysiwyg.viewer.skins.button.ApplyButtonEcom",style:"ecom_apl1"},ecomAddProduct:{skin:"wysiwyg.viewer.skins.button.AddProductButton",style:"ecom_ap1"},mobileEcomAddProduct:{skin:"ecommerce.skins.mcom.AddProductButton",style:"ecom_ap1_mobile"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_setNaturalSize:function(){if(this._isCompBasedWidth()){var e=this._getNaturalWidth();this._element.setStyle("width",e),this._innerElement.setStyle("width",e)}if(this._isCompBasedHeight()){var t=this._getNaturalHeight();this._element.setStyle("height",t),this._innerElement.setStyle("height",t)}},_getNaturalWidth:function(){return this._componentLogic.getSizeLimits().minW},_getNaturalHeight:function(){return this._componentLogic.getSizeLimits().minH}})}),define.Class("wixapps.integration.proxies.CheckBoxProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onValidation"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){var e=this._createWixComponent("wysiwyg.viewer.components.inputs.CheckBoxInput",this._createRawData(),{label:this._def.getChildValue("label")});return e},_createRawData:function(){return{type:"Boolean",value:this._data.getValue()}},_onDataChanged:function(e){this._refresh(),this.parent(e)},_refresh:function(){this._componentLogic&&this._setNewData()},_setNewData:function(){var e=this._componentLogic.getDataItem();e.setData(this._createRawData()),e.setMeta("isPersistent",!1)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.CheckBoxInputSkin"},_onComponentDataChanged:function(e){this._data.setValue(!!e.get("value"))},_onValidation:function(e){if(this._componentLogic&&e){if(e.valid)this._componentLogic.setValidationState(!0);else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(t)}this._componentLogic.setValidationState(e.valid)}},_getAcceptableDataTypes:function(){return["Boolean"]},_getDefaultStyleName:function(){return null}})}),define.Class("wixapps.integration.proxies.CheckBoxViewProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.CheckBoxProxy"),t.binds(["_onComponentDataChanged","_onValidation"]),t.methods({_onComponentWixified:function(){this._componentLogic.setDisabled()}})}),define.Class("wixapps.integration.proxies.CheckBoxGroupProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onValidation"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){var e=Number.random(0,99999).toString(36),t="x_group_"+e;return this._createWixComponent("wixapps.integration.components.inputs.CheckBoxGroupInput",this._createRawData(),{checkboxGroupName:t})},_createRawData:function(){var e=this._data.getChildByRef("items").getValue(),t=e.map(this._getOptionWDataItem),i=this._data.getChildByRef("selectedValues").getValue(),n=[];return i.each(function(e){var i=t.filter(function(t){return t.get("value")==e});i.length>0&&n.push(i[0])}),{type:"MultiSelectableList",items:t,selected:n}},_getOptionWDataItem:function(e){var t={type:"SelectOption",value:e.value,text:e.text,enabled:e.enabled,description:e.description},i=W.Data.createDataItem(t);return i.setMeta("isPersistent",!1),i},_onComponentDataChanged:function(e,t){if("selected"==t&&e){for(var i=e.get("selected"),n=[],a=0;i.length>a;a++){var s=i[a].get("value");n.push(s)}this._data.getChildByRef("selectedValues").setValue(n)}},_onDataChanged:function(e){var t=e.target.getParent().getChildRef(e.target);"selectedValues"!==t&&this._refreshComponentData()},_refreshComponentData:function(){if(this._componentLogic){var e=this._createRawData(),t=this._componentLogic.getDataItem();t.setData(e),t.setMeta("isPersistent",!1)}},_onValidation:function(e){if(this._componentLogic&&e){if(e.valid===!1){var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(t)}this._componentLogic.setValidationState(e.valid)}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.CheckBoxGroupInputSkin"},_getDefaultStyleName:function(){return"wa_cbg1"}})}),define.Class("wixapps.integration.proxies.ClippedParagraphProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.LabelProxy"),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),t.methods({_getCompName:function(){return"wixapps.integration.components.ClippedParagraph"},_getPropSchemaName:function(){return"ClippedParagraphProperties"},_isLayoutBasedHeight:function(){return this._def.getChildValue("maxLines")?!1:this.parent()},_setupPropertyHandlers:function(){this.parent(),this._handleProperties(["maxLines","minLines","pack"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())}),this._mapToCompProperties(["maxLines","minLines","pack","showTooltip"])},_getDefaultSkinName:function(){return"wixapps.integration.skins.ClippedParagraphSkin"}})}),define.Class("wixapps.integration.proxies.ComboBoxProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onValidation","_onComponentDataChanged"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.inputs.ComboBoxInput",this._createRawData())},_createRawData:function(){var e=this,t=this.getData().getChildValue("items"),i=this.getData().getChildValue("selectedValue"),n=null,a=t.map(function(t){var a=e._createOptionDataItem(t);return t.value==i&&(n=a),a});return{type:"SelectableList",items:a,selected:n}},_createOptionDataItem:function(e){var t={type:"SelectOption",value:e.value,text:e.text,enabled:e.enabled,description:e.description},i=W.Data.createDataItem(t);return i.setMeta("isPersistent",!1),i},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["hasPrompt","promptText"])},_getOptionWDataItem:function(e){var t={type:"SelectOption",value:e.value,text:e.text,enabled:e.enabled,description:e.description},i=W.Data.createDataItem(t);return i.setMeta("isPersistent",!1),i},_getPropSchemaName:function(){return"ComboBoxInputProperties"},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.input.ComboBoxInputSkinNoValidation",style:"wa_cb1"},ecomComboBox:{skin:"wixapps.integration.skins.ecommerce.inputs.ComboBoxInputSkin",style:""},ecomShippingComboBox:{skin:"wysiwyg.viewer.skins.appinputs.EcomComboBoxInputSkin",style:"ecom_scb1"},wixAppsGui:{skin:"wixapps.integration.skins.inputs.ComboBoxInputSkin",style:""}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&(this._refreshComponentData(),this._updateEnabledItemsState())},_onComponentDataChanged:function(e,t,i){"selected"==t&&i.selected&&(this._ignoreUpdate=!0,this.getData().getChildByRef("selectedValue").setValue(i.selected.get("value")),this._ignoreUpdate=!1)},_updateEnabledItemsState:function(){for(var e=this._componentLogic.getDataItem().get("items"),t=this.getData().getChildValue("items"),i=0;e.length>i;i++){var n=void 0!==t[i].enabled?t[i].enabled:!0;e[i].set("enabled",n)}},_findSelectedWDataItem:function(){var e=this.getData().getChildValue("selectedValue");if(void 0===e||!this._componentLogic)return void 0;for(var t=this._componentLogic.getDataItem().get("items"),i=0;t.length>i;i++){var n=t[i].get("value");if(n===e)return t[i]}return void 0},_refreshComponentData:function(){if(this._componentLogic){var e=this._createRawData(),t=this._componentLogic.getDataItem();t.setData(e),t.setMeta("isPersistent",!1)}},_onValidation:function(e){if(this._componentLogic&&e){if(e.valid===!1){var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(t)}this._componentLogic.setValidationState(e.valid)}}})}),define.Class("wixapps.integration.proxies.ContainerProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WCompositeProxy"),t.binds(["_handleSizeChange","_handleSizeChange"]),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),t.fields({_inlineDiv:null}),t.methods({createComponent:function(){var e=this._createWixComponent("mobile.core.components.Container",void 0,{allowDragChildren:!1});return this._createChildProxies(),this._createChildComponents(this._innerElement),e},_onComponentWixified:function(){this._doStuff()},_onSkinChange:function(){this._doStuff()},_doStuff:function(){this._autoStretchContent(),this.updateLayoutWhenReady(function(){this._handleSizeChange(),this._resizeMechanismActivated||this._activateResizeMechanism(),setTimeout(function(){this._updateComponentDimension("x")}.bind(this),2e3)}.bind(this))},_onLayoutChange:function(){this._autoStretchContent();var e={};this._isLayoutBasedWidth()&&this._updateComponentDimension("x",e),this._isLayoutBasedHeight()&&this._updateComponentDimension("y",e),window.requestAnimFrame(this._handleSizeChange),W.Utils.forceBrowserRepaint(this._innerElement,150,["safari","chrome"]),W.Utils.forceBrowserRepaint(this._componentLogic.getSkinPart("bg"),150,["safari","chrome"])},_autoStretchContent:function(){"stretch"!=this._def.getChildValue("heightMode")&&(this._inlineDiv&&this._inlineDiv.getParent()||(this._inlineDiv=this._componentLogic.getSkinPart("inlineContent"),this._inlineDiv.setStyles({height:"false"==this._def.getChildValue("packHeight")||this._def.getChildValue("packHeight")===!1?"100%":"auto",position:"relative"})))},_getComponentHeight:function(){return this._componentLogic.getSkinPart("inlineContent").getSize().y},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.area.AppleArea",style:"c1"},ecomCouponBox:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_cbx1"},ecomCartHeader:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ch1"},ecomEmptyCartBG:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ecbg1"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style}})}),define.Class("wixapps.integration.proxies.DateProxy",function(e){var t=function(){var e=/d{1,5}|m{1,5}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[\-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,a=function(e,t){for(e+="",t=t||2;t>e.length;)e="0"+e;return e};return function(s,o,r){var l=t;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(o=s,s=void 0),s=s?new Date(s):new Date,isNaN(s))throw"invalid date";o=(l.masks[o]||o||l.masks["default"])+"","UTC:"==o.slice(0,4)&&(o=o.slice(4),r=!0);var p=r?"getUTC":"get",d=s[p+"Date"](),h=s[p+"Day"](),c=s[p+"Month"](),u=s[p+"FullYear"](),m=s[p+"Hours"](),g=s[p+"Minutes"](),_=s[p+"Seconds"](),f=s[p+"Milliseconds"](),y=r?0:s.getTimezoneOffset(),v={d:d,dd:a(d),ddd:l.i18n.dayNames[h],dddd:l.i18n.dayNames[h+7],ddddd:l.i18n.dayNames[h].toUpperCase(),m:c+1,mm:a(c+1),mmm:l.i18n.monthNames[c],mmmm:l.i18n.monthNames[c+12],mmmmm:l.i18n.monthNames[c].toUpperCase(),yy:(u+"").slice(2),yyyy:u,h:m%12||12,hh:a(m%12||12),H:m,HH:a(m),M:g,MM:a(g),s:_,ss:a(_),l:a(f,3),L:a(f>99?Math.round(f/10):f),t:12>m?"a":"p",tt:12>m?"am":"pm",T:12>m?"A":"P",TT:12>m?"AM":"PM",Z:r?"UTC":((s+"").match(i)||[""]).pop().replace(n,""),o:(y>0?"-":"+")+a(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][d%10>3?0:(10!=d%100-d%10)*d%10]};return o.replace(e,function(e){return e in v?v[e]:e.slice(1,e.length-1)})}}();t.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},t.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};var i=e;i.inherits("wixapps.integration.proxies.LabelProxy"),i.methods({_getInnerText:function(){var e="",i=this._def.getChildValue("prefix"),n=this._def.getChildValue("postfix");i&&(e+=i);var a=this._def.getChildValue("format")||"default",s=this._data.getValue(),o=s.iso||s,r=new Date(o);return r.getTime()>0&&(e+=t(r,a)),n&&(e+=n),e},_setupPropertyHandlers:function(){this._handleProperties(["format"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())}),this.parent()},getProxyMetaTags:function(){return["text"]},_getAcceptableDataTypes:function(){return["wix:Date","String"]}})}),define.Class("wixapps.integration.proxies.DateSelectorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onValidation"]),t.methods({createComponent:function(){this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation);var e="wixapps.integration.components.inputs.DateInput";this.useSkinsInsteadOfStyles();var t=this._getIsoDate();return this._createWixComponent(e,{type:"Text",text:t})},_getPropSchemaName:function(){return"DateInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["allowEmpty"])},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.appinputs.DateInputSkin"},_getIsoDate:function(){var e=this._data.getValue(),t=new Date(e.iso);return this._allowEmpty()||!isNaN(t.getTime())&&t.getTime()!=new Date(0).getTime()||(e.iso=(new Date).toISOString(),this._userInputChange=!0,this._data.setValue(e),this._userInputChange=!1),e.iso},_onDataChanged:function(){!this._userInputChange&&this._element&&this._element.getLogic()&&this._element.getLogic().getDataItem().set("text",this._getIsoDate())},_onComponentDataChanged:function(){var e=this._element.getLogic().getDataItem().get("text");this._userInputChange=!0,this._data.setValue({_type:"wix:Date",iso:e}),this._userInputChange=!1},_onValidation:function(e){if(this._componentLogic)if(e.valid)this._componentLogic.resetInvalidState();else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(t)}},_allowEmpty:function(){return!(this._def.getChildValue("allowEmpty")===!1||"false"===this._def.getChildValue("allowEmpty"))},_getAcceptableDataTypes:function(){return["wix:Date"]}})}),define.Class("wixapps.integration.proxies.DeckProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ListProxy2"),t.binds(["_onSelectionChange"]),t.methods({_getInitialSelection:function(){var e=this.getViewDefinition().getChildValue("initialSelection");return void 0!==e&&(e=parseInt(e,10)),void 0!==e&&e>=0?e:-1},_onComponentWixified:function(){var e=this.getViewDefinition().getChildValue("selectionChangeScope"),t=this.getViewDefinition().getChildValue("selectionChangeEvent");this.addEventFilteredByScope(e,t,this._onSelectionChange);var i=this._getInitialSelection();i>=0&&this._selectIndex(i)},_onSelectionChange:function(e){if(!this._disposed){for(var t=e.data,i=this._data.getChildren(),n=0,a=0,s=i.length;s>a;a++){var o=i[a];if(o==t){n=a;break}}this._selectIndex(n)}},_selectIndex:function(e){for(var t=this._rootElement.children,i=0;t.length>i;i++){var n=t[i];i===e?n.uncollapse():n.collapse()}}})}),define.Class("wixapps.integration.proxies.DraggableListItemProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n);var a=this._def.getChildValue("dragEnabled");this._dragEnabled=!("false"===a||a===!1),this._selected=this._def.getChildValue("selected"),this._iconType=this._def.getChildValue("iconType"),this._hideEditLink=this._def.getChildValue("hideEditLink"),this._proxyFactory=this._viewContext.getEnvironment().getProxyFactory()},createComponent:function(){this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation();var e=this._createRawData(),t=this._createWixComponent("wixapps.integration.components.editor.DraggableListItem",e,{dragEnabled:this._dragEnabled,selected:this._selected,iconType:this._iconType,hideEditLink:this._hideEditLink,isHeader:!1});return this._nativeEvents.forEach(function(e){t.addEvent(e.type,e.fn)}),this._createChildComponents(t),t},_onComponentWixified:function(){this.parent(),this._setupBox(this._getLayoutRootElement())},_onDataChanged:function(){if(this._componentLogic&&!this._componentLogic.getIsDisposed()){var e=this._data.getChildValue("selected"),t=this._data.getChildValue("iconType");this._componentLogic.setSelected(e),this._componentLogic.setIcon(t)}},_getLayoutRootElement:function(){return this._componentLogic&&this._componentLogic.getLayoutElement()},_getDefaultOrientation:function(){return"vertical"},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.DraggableListItemSkin"},_createRawData:function(){return{type:""}}})}),define.Class("wixapps.integration.proxies.EditLinkProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ZoomLinkProxy"),t.binds(["_onClicked"]),t.fields({_eventString:"wix:edit-link:open-editor"})}),define.Class("wixapps.integration.proxies.EmptyProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.methods({createComponent:function(){return this._createElement("div")}})}),define.Class("wixapps.integration.proxies.ExpanderProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.methods({createComponent:function(){var e=this._viewContext.getEnvironment().getProxyFactory(),t=this._def.getChildByRef("items"),i=this.getViewDefinition().getChildValue("initialState"),n=this.getViewDefinition().getChildValue("noIcon");if(2!=t.getChildren().length)throw"Expander must have two children, for summary and content.";var a=t.getChildByIndex(0),s=e.createProxyFromItemDefinition(this._viewContext,a).proxy,o=t.getChildByIndex(1),r=e.createProxyFromItemDefinition(this._viewContext,o).proxy;this._childrenLeftToBeReady=2;var l=function(e){e.grab(s.createComponent()),s.setupProxy(this._onChildReady)}.bind(this),p=function(e){e.grab(r.createComponent()),r.setupProxy(this._onChildReady)}.bind(this);return this._createWixComponent("wixapps.integration.components.Expander",void 0,{createSummaryFunc:l,createContentFunc:p,initialState:i,noIcon:n})},_getDefaultSkinName:function(){return"wixapps.integration.skins.ExpanderSkin"}})}),define.Class("wixapps.integration.proxies.FlowListProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ListProxy"),t.methods({getRepeaterClass:function(){return"wixapps.integration.components.HorizontalRepeater"},setComponentStyles:function(e){return e},onChildCreate:function(e,t){var i={};i.display="inline-block";var n=this.getViewDefinition().getChildValue("margin");return this._data.getChildren().length-1>t&&(i["margin-right"]=n+"px"),e.setStyles(i),e}})}),define.Class("wixapps.integration.proxies.FormattedPriceProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.LabelProxy"),t.fields({_currencySymbols:{GBP:"",USD:"$",NIS:""}}),t.methods({_getInnerText:function(){var e=this._data.getValue();return this._currencySymbols[e.currency]+e.amount.toFixed(2)}})}),define.Class("wixapps.integration.proxies.GalleryProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ListProxy"),t.binds(["_sequencingHook","_sequencingRolloverHook"]),t.utilize(["wysiwyg.viewer.utils.GalleryUtils"]),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._galleryUtils=new this.imports.GalleryUtils,this._rolloverTemplate&&(this._repeaterArgs.rolloverHook=this._sequencingRolloverHook),this._repeaterArgs.fixedRowNumber=!0},getRepeaterClass:function(){return"wixapps.integration.components.PaginatedGridGallery"},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("*",function(){this.resetResizingCache()}),this._mapToCompProperties(["transition","autoplayInterval","transDuration"]),this._mapToCompProperty("columns","numCols"),this._mapToCompProperty("rows","maxRows"),this._mapToCompProperty("gap","margin"),this._mapToCompProperty("autoplay","autoplay",function(e){return e===!0||"true"==e}),this._mapToCompProperty("expandEnabled","expandEnabled",function(e){return e===!0||"true"==e})},_getPropSchemaName:function(){return"PaginatedGridGalleryProperties"},_sequencingHook:function(e,t,i){var n=this._createGalleryDisplayer(e,t,i,this._itemTemplate),a=new Element("div",{"class":"displayerBackground"});return a.inject(n,"top"),n},_sequencingRolloverHook:function(e,t,i){return this._createGalleryDisplayer(e,t,i,this._rolloverTemplate)},_createGalleryDisplayer:function(e,t,i,n){var a=this._viewContext.getEnvironment().getProxyFactory(),s=this._viewContext.newContextForData(e);this._addPositionInParentVars(s,t,i.length);var o=a.createProxyFromItemDefinition(s,n).proxy,r=o.createComponent();if(r.setStyles({overflow:"hidden",width:"1px",height:"1px"}),Browser.firefox){var l=new Element("div");l.getViewProxy=function(){return o},l.$viewProxy=o,l.adopt(r),r.setStyles({width:"100%",height:"100%"}),r=l}return this._galleryUtils.createMinimalGalleryDisplayer(r,e),r},_updateSequencerListeners:function(){this.parent(),this._rolloverSequencer||(this._rolloverSequencer=this._componentLogic.getRolloverSequencer()),this._rolloverSequencer&&(this._rolloverSequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,function(){this.updateLayoutWhenReady()}.bind(this)),this._rolloverSequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,function(e){if("create"==e.method){var t=e.compView.getViewProxy();t.setupProxy()}}.bind(this)),this.addEvent("showRollover",function(){this._componentLogic&&this._componentLogic._onMouseMove({page:this._componentLogic._skinParts.itemsContainer.getPosition()})}.bind(this)),this.addEvent("hideRollover",function(){this._componentLogic&&this._componentLogic._resetRollOver()}.bind(this)))},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridDefaultSkin",style:"pagg1"},productGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridSimple",style:"pgg_cg0"},contentGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg1"},minipostGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg2"},hoverGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoBG",style:"pgg_cg3"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._rolloverTemplate=this._getItemTemplate("rollover")},_onStylePropertiesChange:function(e){Object.values(e).contains(Constants.SkinParamTypes.SIZE)&&this.updateLayoutWhenReady()},_onComponentWixified:function(){this.parent(),this._activateResizeMechanism(),this._onLayoutChange()}})}),define.Class("wixapps.integration.proxies.GoogleMapProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),t.methods({createComponent:function(){var e="wysiwyg.viewer.components.GoogleMap",t=this._data.getValue(),i={type:"GeoMap",address:t.address,latitude:t.latitude,longitude:t.longitude,addressInfo:t.addressInfo};return this._createWixComponent(e,i)},_getPropSchemaName:function(){return"GoogleMapProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["showZoom","showPosition","showStreetView","showMapType","mapDragging","mapType"])},_getDefaultStyleName:function(){return"gm1"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.GoogleMapSkin"},_onDataChanged:function(){if(this._componentLogic){var e=this._data.getValue(),t=this._componentLogic.getDataItem();t.set("address",e.address,!0),t.set("latitude",e.latitude,!0),t.set("longitude",e.longitude,!0),t.set("addressInfo",e.addressInfo,!0),t.fireDataChangeEvent()}},_getAcceptableDataTypes:function(){return["wix:Location"]}})}),define.Class("wixapps.integration.proxies.GooglePlusOneProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.methods({createComponent:function(){var e=this._createWixComponent("wysiwyg.viewer.components.WGooglePlusOne",this._createRawData());return e},_createRawData:function(){return this._data.getValue(),{size:{type:"string","enum":["small","medium","standard","tall"],"default":"standard",description:"The button size to render"},annotation:{type:"string","enum":["none","bubble","inline"],"default":"inline",description:"The annotation to display next to the button."},width:{type:"string","default":"",description:"If annotation is set to *inline*, the width in pixels to use for the button and its inline annotation. If omitted, a button and its inline annotation use 450px."}}}})}),define.Class("wixapps.integration.proxies.HelpProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.resources(["W.Commands","W.Data","W.Utils"]),t.fields({_tooltipId:null,_tooltipsData:null}),t.methods({createComponent:function(){return this._tooltipsData=this.resources.W.Data.getDataByQuery("#TOOLTIPS.toolTips"),this._createTooltipData(),this._createWixComponent("mobile.core.components.base.BaseComponent",void 0,void 0)},_onDataChanged:function(){this._updateTooltipData()},_createTooltipData:function(){if(null!==this._tooltipId)throw"Tooltip data item already exists.";this._tooltipId=this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId("wixapps_tooltip"),this._tooltipsData.set(this._tooltipId,{isMoreLess:!1,isDontShowAgain:!1,content:"<p>"+this._data.getValue()+"</p>",isPublished:!0,help:{isMoreHelp:!1,text:null,url:""}})},_updateTooltipData:function(){var e=this._tooltipsData.get(this._tooltipId);e.content="<p>"+this._data.getValue()+"</p>"},_onComponentWixified:function(){var e=this,t=this._element;t.addEvent("mouseenter",function(){e.resources.W.Commands.executeCommand("Tooltip.ShowTip",{id:e._tooltipId},t)}.bind(this)),t.addEvent("mouseleave",function(){e.resources.W.Commands.executeCommand("Tooltip.CloseTip")}.bind(this))},_getDefaultSkinName:function(){return"wixapps.integration.skins.HelpQuestionMarkIconSkin"},_getAcceptableDataTypes:function(){return["String"]}})}),define.Class("wixapps.integration.proxies.HorizontalLineProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.methods({createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.FiveGridLine",void 0,void 0,void 0)},_onComponentWixified:function(){if(this.parent(),this._componentLogic&&this._componentLogic.getViewNode){var e=this._componentLogic.getViewNode();e&&e.setStyle("position","relative")}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.FiveGridLineSkin"},_getDefaultStyleName:function(){return"hl1"}})}),define.Class("wixapps.integration.proxies.IconProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.methods({createComponent:function(){var e=this._createRawData();return this._createWixComponent("wixapps.integration.components.Icon",e,void 0)},_getDefaultSkinName:function(){return"wixapps.integration.skins.IconSkin"},_createRawData:function(){var e=this._data.getValue();return{type:"Icon",url:this._toAppImageUrl(e.src),width:e.width,height:e.height,title:e.title}},_onDataChanged:function(){this._updateIcon()},_updateIcon:function(){if(this._componentLogic){var e=this._data.getValue();this._componentLogic.getDataItem().set("url",this._toAppImageUrl(e.src),!1),this._componentLogic.getDataItem().set("width",e.width,!1),this._componentLogic.getDataItem().set("height",e.height,!1),this._componentLogic.getDataItem().set("title",e.title,!1),this._componentLogic.getDataItem().fireDataChangeEvent()}},_toAppImageUrl:function(e){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e)},_getAcceptableDataTypes:function(){return["wix:Image"]}})}),define.Class("wixapps.integration.proxies.ImageButtonProxy",function(e){var t=e;
t.inherits("wixapps.integration.proxies.WProxy"),t.resources(["W.Commands","W.Data","W.Utils"]),t.fields({_tooltipsData:null,_tooltipId:null}),t.methods({_getCompName:function(){return"wixapps.integration.components.ImageButton"},_getPropSchemaName:function(){return"ImageButtonProperties"},_getDefaultSkinName:function(){return"wixapps.integration.skins.ImageButtonSkin"},createComponent:function(){return this._tooltipsData=this.resources.W.Data.getDataByQuery("#TOOLTIPS.toolTips"),this._createTooltipData(),this._createWixComponent(this._getCompName(),this._createRawData())},_toAppImageUrl:function(e){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e)},_createRawData:function(){var e=this._data.getValue();return{type:"Icon",url:this._toAppImageUrl(e.src),width:e.width,height:e.height,title:e.title}},_createTooltipData:function(){if(null!==this._tooltipId)throw"Tooltip data item already exists.";this._tooltipId=this._def.getChildValue("tooltipId");var e=this._def.getChildValue("tooltipValue");void 0!==e&&(this._tooltipId=this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId("wixapps_tooltip"),this._tooltipsData.set(this._tooltipId,{isMoreLess:!1,isDontShowAgain:!1,content:"<p>"+e+"</p>",isPublished:!0,help:{isMoreHelp:!1,text:null,url:""}}))},_onComponentWixified:function(){var e=this,t=this._element;t.addEvent("mouseenter",function(){e.resources.W.Commands.executeCommand("Tooltip.ShowTip",{id:e._tooltipId},t)}.bind(this)),t.addEvent("mouseleave",function(){e.resources.W.Commands.executeCommand("Tooltip.CloseTip")}.bind(this))},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["isSprite","spriteDirection","startPositionX","startPositionY"])}})}),define.Class("wixapps.integration.proxies.ImageInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onFieldReady"]),t.methods({createComponent:function(){this._createRawData();var e=this._createWixComponent("wysiwyg.editor.components.inputs.ImageInput",null,{labelText:"",width:"100%",height:"100%",buttonText:this._def.getChildValue("selectImageLabel"),galleryConfigID:this._def.getChildValue("galleryConfigID"),deleteText:this._def.getChildValue("removeImageLabel")});return e.addEvent(Constants.ComponentEvents.READY,this._onFieldReady),e},_createRawData:function(){if(this._isEmptyData())return null;var e=this._data.getValue();return{type:"Image",uri:this._toAppImageUrl(e.src),title:e.title,width:e.width,height:e.height}},_toAppImageUrl:function(e){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e)},_isEmptyData:function(){var e=this._getEmptyImage();return void 0===e?!1:e.src===this._data.getChildValue("src")},_getEmptyImage:function(){return this._def.getChildValue("emptyImage")},_onFieldReady:function(){this._componentLogic&&(this._componentLogic.setValue(this._createRawData()),this._componentLogic.addEvent("inputChanged",this._onComponentDataChanged))},_onDataChanged:function(){!this._ignoreUpdate&&this._componentLogic&&this._componentLogic.setValue(this._createRawData())},_onComponentDataChanged:function(){if(this._componentLogic){this._ignoreUpdate=!0;var e=this._componentLogic.getValue();if(e){var t=this._data.getValue();t.width=parseInt(e.width,10),t.height=parseInt(e.height,10),t.src=e.uri,t.title=e.title,this._data.setValue(t)}else this._data.setValue(this._getEmptyImage());this._ignoreUpdate=!1}},_getDefaultSkinName:function(){return"wysiwyg.editor.skins.inputs.ImageInputSkin"},_getAcceptableDataTypes:function(){return["wix:Image"]},dispose:function(){this._componentLogic&&this._componentLogic.removeEvent("inputChanged",this._onComponentDataChanged),this._element.removeEvent(Constants.ComponentEvents.READY,this._onFieldReady),this.parent()}})}),define.Class("wixapps.integration.proxies.ImageProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_handleSizeChange"]),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),t.methods({createComponent:function(){var e=this._createRawData();return this._createWixComponent("wixapps.integration.components.WPhoto",e)},_toAppImageUrl:function(e){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e)},getImageMode:function(){return this._def.getChildValue("imageMode")||"fill"},_fixedAspectRatioModes:["fitWidth","fitHeight"],hasFixedAspectRatio:function(){var e=this.getImageMode();return this._fixedAspectRatioModes.contains(e)},getAspectRatio:function(){var e=this._data.getValue();return parseFloat(e.width)/parseFloat(e.height)},_createRawData:function(){var e=this._data.getValue();return{type:"Image",uri:this._toAppImageUrl(e.src),title:e.title,width:e.width,height:e.height}},_onDataChanged:function(){if(this._componentLogic){var e=this._data.getValue();this._componentLogic.getDataItem().set("uri",this._toAppImageUrl(e.src),!1),this._componentLogic.getDataItem().set("title",e.title,!1),this._componentLogic.getDataItem().set("width",e.width,!1),this._componentLogic.getDataItem().set("height",e.height)}},_getPropSchemaName:function(){return"WPhotoProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperty("imageMode","displayMode",function(e){var t=e||"fill";return"fitWidth"==e?t="fitWidthStrict":"fitHeight"==e&&(t="fitHeightStrict"),this._innerElement&&(this._innerElement.style.height=null,this._innerElement.style.width=null),this.resetResizingCache(),t}.bind(this))},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.photo.NoSkinPhoto"},_getDefaultStyleName:function(){return"wp1"},_isLayoutBasedWidth:function(){var e=this.getImageMode();return"fitWidth"==e?!0:"fitHeight"==e?!1:this.parent()},_isLayoutBasedHeight:function(){var e=this.getImageMode();return"fitWidth"==e?!1:"fitHeight"==e?!0:this.parent()},_checkMinHeight:function(){},getSourceSize:function(){return{width:this.getData().getChildValue("width"),height:this.getData().getChildValue("height")}}})}),define.Class("wixapps.integration.proxies.ImageSelectorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ImageProxy"),t.binds(["_openReplaceMedia","_onImgSelect","_onImgReset"]),t.methods({createComponent:function(){var e=this.parent();return this._galleryTypeID=this._def.getChildValue("galleryConfigID")||"photos",e.addEvent("click",this._openReplaceMedia),e.setStyle("cursor","pointer"),e.grab(new Element("div")),e},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("defaultImage",function(){this._refreshResetState()})},_onComponentWixified:function(){this._componentLogic&&(this._resetButton=this._componentLogic.getViewNode().getElement("div[skinpart=reset]"),this._resetButton&&this._resetButton.addEvent("click",this._onImgReset),this._refreshResetState())},_refreshResetState:function(){if(this._componentLogic){var e=this._getDefaultImage(),t=e&&e.src!=this._data.getChildValue("src");this._componentLogic.getViewNode().set("reset",t?"enabled":"disabled")}},_getDefaultImage:function(){return this._def.getChildValue("defaultImage")},_openReplaceMedia:function(){W.EditorDialogs.openMediaDialog(this._onImgSelect,!1,this._galleryTypeID,!1)},_onImgReset:function(){return this._data.setValue(this._getDefaultImage()),this._refreshResetState(),!1},_onImgSelect:function(e){var t=this._data.getValue();t.width=parseInt(e.width,10),t.height=parseInt(e.height,10),t.src=e.uri,t.title=e.title,this._data.setValue(t),this._refreshResetState()},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.ImageSelectorSkin"},_onDataChanged:function(){this.parent(),this._refreshResetState()},dispose:function(){this._resetButton&&(this._resetButton.removeEvent("click",this._onImgReset),this._resetButton=void 0),this.parent()}})}),define.Class("wixapps.integration.proxies.InlineTextInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged"]),t.methods({createComponent:function(){var e=this._createRawData();return this._createWixComponent("wixapps.integration.components.inputs.InlineTextInput",e)},_getPropSchemaName:function(){return void 0},_createRawData:function(){var e=this._data.getValue(),t=document.createElement("div");return t.innerHTML=e,e=t.innerText||t.text||t.textContent,{type:"Text",text:e}},_onComponentWixified:function(){},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._data.getValue())},_onComponentDataChanged:function(e,t,i){this._ignoreUpdate=!0,this._data.setValue(i.text),this._ignoreUpdate=!1},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.InlineTextInputSkin"}})}),define.Class("wixapps.integration.proxies.InlineTextProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.LabelProxy"),t.methods({_createFormattedText:function(){var e=this._data.getValue(),t=this._getTextAsRichTextElement(e);return t=this._applyDefaultStyleOnText(t),this._isSingleLine()&&t.getFirst().addClass("singleLine"),t.innerHTML},_getAcceptableDataTypes:function(){return["String","Number"]},_getBlockDefaultStyledElement:function(e){return new Element("span",{"class":e})},_getViewElement:function(){return"span"},_getCompName:function(){return"wixapps.integration.components.InlineText"},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"}})}),define.Class("wixapps.integration.proxies.LabelProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onAppPartResize"]),t.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),t.utilize(["wysiwyg.common.utils.TextMigrationHandler","wysiwyg.common.utils.TextMigrationDomHelper"]),t.resources(["W.Theme"]),t.fields({_styleString:""}),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._migrationHandler=new this.imports.TextMigrationHandler,this._migrationDomHelper=new this.imports.TextMigrationDomHelper},createComponent:function(){this.useSkinsInsteadOfStyles();var e=this._createRawData();return this._createWixComponent(this._getCompName(),e)},_setupPropertyHandlers:function(){this._handleProperties(["postfix","prefix","disableLinks","lineThrough","underline","singleLine","color","bold","noWrap","style","italic"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())})},_createRawData:function(){return{type:"StyledText",text:this._createFormattedText()}},_createFormattedText:function(){var e=this._getInnerText();e=this._prepareLinks(e);var t=this._getTextAsRichTextElement(e);if(t=this._applyDefaultStyleOnText(t),this._isSingleLine()){var i=t.getFirst();i.addClass("singleLine");var n=this._def.getChildValue("color");n&&(this._isCustomColor(n)?i.setStyle("color",n):i.addClass(n))}return t.innerHTML},_prepareLinks:function(e){return W.Editor||this._def.getChildValue("disableLinks")?e=e.replace(/<a\b[^>]*>(.*?)<\/a>/gi,"$1"):this._updateLinkDataItems(),e},_getInnerText:function(){var e="";if("wix:RichText"===this._data.getTypeName()){var t=this._def.getChildrenRefs().some(function(e){return["prefix","postfix"].contains(e)});if(t)throw"Warning:: type [wix:RichText] does not support [prefix] or [postfix].";this._migrateHtml(),e=this._data.getChildValue("text")}else{var i=this._def.getChildValue("prefix"),n=this._def.getChildValue("postfix"),a=this._data.getValue();i&&(e+=i),a&&(e+=(a+"").trim()),n&&(e+=n)}return e},_getTextAsRichTextElement:function(e){this._isSingleLine()&&(e+="",e=e.replace(/(<p>|<\/p>|<br\/?>)/gi,""));var t=new Element("div");if("wix:RichText"!==this._data.getTypeName()){var i=new Element(this._getDefaultStylePlaceHolderTag());i.set("html",e),t.grab(i)}else t.set("html",e);if(this._isSingleLine()){var n=t.getFirst();t.empty(),t.grab(n)}return t},_applyDefaultStyleOnText:function(e){var t=e.getElements(this._getDefaultStylePlaceHolderTag());return t.forEach(function(e){this._replaceDefaultStyledElement(e)},this),e},_replaceDefaultStyledElement:function(e){var t=this._getDefaultStyleElement();t.innerElement.innerHTML=e.innerHTML,this._copyAttributesFromOneElementToAnother(e,t),this._copyStylesFromOneElementToAnother(e,t),e.parentNode.replaceChild(t.outerElement,e)},_getDefaultStyleElement:function(){var e=Constants.WixApps.TEXT_STYLES[this._def.getChildValue("style")]||this._getDefaultStyleName(),t=this._getBlockDefaultStyledElement(e),i=t,n=this._def.getChildValue("bold")===!0||"true"===this._def.getChildValue("bold"),a=this._def.getChildValue("italic")===!0||"true"===this._def.getChildValue("italic"),s=this._def.getChildValue("lineThrough")===!0||"true"===this._def.getChildValue("lineThrough"),o=this._def.getChildValue("underline")===!0||"true"===this._def.getChildValue("underline"),r=parseFloat(this._def.getChildValue("line-height")),l=this._getDefaultColorElement(),p=parseFloat(this._def.getChildValue("fontSize"));if(isNaN(r)||t.setStyle("line-height",r+"em"),l&&(i=this._insertElementToParentElement(i,l)),n&&(i=this._insertElementToParentElement(i,new Element("strong"))),a&&(i=this._insertElementToParentElement(i,new Element("em"))),s&&(i=this._insertElementToParentElement(i,new Element("strike"))),o&&(i=this._insertElementToParentElement(i,new Element("u"))),!isNaN(p)){var d=new Element("span");d.setStyle("font-size",p+"px"),i=this._insertElementToParentElement(i,d)}return{outerElement:t,innerElement:i}},_insertElementToParentElement:function(e,t){return e.grab(t),t},_getBlockDefaultStyledElement:function(e){var t=this._getSeoTagForStyleCssClass(e),i=new Element(t,{"class":e});return i},_getDefaultColorElement:function(){var e=null,t=this._def.getChildValue("color");return t&&(e=new Element("span"),this._isCustomColor(t)?e.setStyle("color",t):e.addClass(t)),e},_migrateHtml:function(){var e=this._data.getValue();e.hasOwnProperty("version")&&1!==e.version||(e.text=this._migrationHandler.migrateText(e.text,this._getDefaultStylePlaceHolderTag(),this._getDefaultStyleName()),e.version=2,this._data.setValue(e))},_copyAttributesFromOneElementToAnother:function(e,t){for(var i=this._migrationDomHelper.getAllAttributes(e),n=0;i.length>n;n++){var a=i[n],s=a.name;if("style"===s||"class"===s)return;var o=e.getAttribute(s);o&&t.outerElement.setAttribute(s,o)}},_copyStylesFromOneElementToAnother:function(e,t){var i=this._createElementStyleMap(e),n=this._createElementStyleMap(t.outerElement);for(var a in i)n[a]=i[a];t.outerElement.setStyles(n)},_createElementStyleMap:function(e){var t={},i=[],n=e.getAttribute("style");return n&&(n.trim().lastIndexOf(";")===n.length-1&&(n=n.substring(0,n.length-1)),i=n.split(";")),i.forEach(function(e){var i=e.split(":");2==i.length&&(t[i[0].trim()]=i[1].trim())}),t},_trimText:function(e){return e.replace(/\s+/," ").replace(/^\s*/,"").replace(/\s*$/,"")},_isSingleLine:function(){if(null==this._def)return!1;var e=this._def.getChildValue("singleLine");return e===!0||"true"==e},getStyleString:function(){var e=Constants.WixApps.TEXT_STYLES[this._def.getChildValue("style")]||this._getDefaultStyleName(),t=this._def.getChildValue("color");return t?e+" "+t:e},_onComponentWixified:function(){this._viewContext.getEnvironment().getEventsDispatcher().addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppPartResize),this._onAppPartResize(),window.setTimeout(this._setTooltip.bind(this),100),Browser.firefox&&this._isSingleLine()&&this._element.setStyle("min-width","100%");var e=this._def.getChildValue("noWrap");(e===!0||"true"===e)&&this._element.setStyle("white-space","nowrap")},_onDataChanged:function(){this._componentLogic&&!this._componentLogic.getIsDisposed()&&(this._componentLogic.getDataItem().set("text",this._createFormattedText()),Browser.ie&&this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID))},_onAppPartResize:function(){this._disposed||this._setTooltip()},_setTooltip:function(){if(this._element)if(this._shouldShowTooltip(this._element)){var e=this._getInnerText();e=new Element("div").set("html",e).get("text"),this._element.setAttribute("title",this._trimText(e))}else this._element.removeAttribute("title")},_shouldShowTooltip:function(e){if(!this._def)return!1;var t=this._def.getChildValue("showTooltip");if(this._isSingleLine()&&("true"===t||t===!0)){var i=e;return e.getFirst()&&(i=e.getFirst()),i.scrollWidth>i.offsetWidth}return!1},_isCustomColor:function(e){return"#"===e.slice(0,1)},_getCompName:function(){return"wysiwyg.viewer.components.WRichText"},_getSeoTagForStyleCssClass:function(){return"p"},_getDefaultStyleName:function(){return"font_8"},_getDefaultStylePlaceHolderTag:function(){return"hatul"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.WRichTextNewSkin"},_getAcceptableDataTypes:function(){return["String","wix:RichText","Number"]},getProxyMetaTags:function(){return["text"]},_preventReflowCssClass:function(){return null}})}),define.Class("wixapps.integration.proxies.LinkProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),t.methods({createComponent:function(){var e=this.parent();return this._element.addClass("wixAppsLink"),this._updateLink(),e},_getDefaultOrientation:function(){return"vertical"},_checkDataValidity:function(){if(!this._viewContext.getEnvironment().getTypesManager().isOf(this._data.getTypeName(),"wix:LinkBase"))throw"Link selector only accepts links of type wix:LinkBase or extending. Received ["+this._data.getTypeName()+"]"},_getContainerElementType:function(){return"a"},_onDataChanged:function(){this._updateLink()},_updateLink:function(){this._updateAnchorLink(this._element,this._data.getValue())}})}),define.Class("wixapps.integration.proxies.LinkSelectorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onClick","_onLinkDialogClosing"]),t.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),t.methods({createComponent:function(){var e=this._createRawData();return this._createWixComponent("wixapps.integration.components.LinkSelector",e,{descriptionVisible:this._getDescriptorVisibility(),isEditable:this._getIsEditable()})},_createRawData:function(){return{type:"Text",text:this._getLinkDescription()}},_getDefaultSkinName:function(){return"wixapps.integration.skins.LinkSelectorSkin"},_getDescriptorVisibility:function(){var e=this._def.getChildValue("showDescription");return e===!0||"true"==e},_getIsEditable:function(){var e=this._def.getChildValue("isEditable");return void 0===e?!0:e},_onDataChanged:function(e){this._componentLogic&&(this._componentLogic.getDataItem().set("text",this._getLinkDescription()),this._componentLogic.setDescriptionVisibility(this._getDescriptorVisibility())),this.parent(e)},_onComponentWixified:function(){this._componentLogic.addEvent(Constants.CoreEvents.CLICK,this._onClick)},_onClick:function(){var e=this._viewContext.getEnvironment().getProxyFactory().getNameSpace()||this._fieldId,t=this._data.getValue();this._openLinkDialog(t,e,this._onLinkDialogClosing)},_onLinkDialogClosing:function(e,t,i,n){var a=this;this.resource.getResources(["W.EditorDialogs"],function(s){if(n.result!=s.W.EditorDialogs.DialogButtons.CANCEL){e.copySchemaFieldsFrom(i);var o=a._createAppsLink(e).getValue();t!==Constants.LinkState.NO_LINK&&o._type||(o={_type:"wix:LinkBase"}),a._data.setValue(o)}})},_getLinkDescription:function(){var e="Click to add link",t=this._data.getValue();switch(t._type){case"wix:PageLink":var i=W.Preview.getPreviewManagers().Data.getDataByQuery("#"+t.pageId,function(){});e=i?"page:"+i.get("title"):"page:<Unknown page>";break;case"wix:ExternalLink":e=t.protocol+"://"+t.address;break;case"wix:DocLink":e=t.docName;break;case"wix:MailLink":e="mailto:"+t.email}return e},_getAcceptableDataTypes:function(){return["wix:LinkBase"]}})}),define.Class("wixapps.integration.proxies.ListProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WArrayProxy"),t.binds(["_sequencingHook"]),t.utilize(["wixapps.core.data.DataItemUtils"]),t.fields({_sequencerCompleted:!1,_sequencer:null,_repeaterArgs:{}}),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._undisposedChildren=[],this._repeaterArgs.sequencingHook=this._sequencingHook,this._dataItemUtils=new this.imports.DataItemUtils},getRepeaterClass:function(){},setComponentStyles:function(){},onChildCreate:function(){},createComponent:function(){var e=this._createRawData(),t=this._createWixComponent(this.getRepeaterClass(),e,this._repeaterArgs);return this._childrenLeftToBeReady=this._data.getChildren().length,this.setComponentStyles(t),t},_sequencingHook:function(e,t,i){var n=this._viewContext.getEnvironment().getProxyFactory(),a=this._itemTemplate;0===t&&this._firstTemplate?a=this._firstTemplate:t==i.length-1&&this._lastTemplate&&(a=this._lastTemplate);var s=this._viewContext.newContextForData(e);a=n.createNewEvaluationScope(a,s),this._addPositionInParentVars(s,t,i.length);var o=n.createProxyFromItemDefinition(s,a).proxy,r=o.createComponent();return this._undisposedChildren.push(o),this.onChildCreate(r,t),r},_updateSequencerListeners:function(){null===this._sequencer&&(this._sequencer=this._componentLogic.getSequencer()),this._sequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,function(){this.updateLayoutWhenReady()}.bind(this)),this._sequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,function(e){if("create"==e.method){var t=e.compView.getViewProxy();t.setupProxy()}}.bind(this))},_createRawData:function(){var e=this._data.getChildren();return{type:"ImageList",items:e}},_onDataChanged:function(e){if(e.phase==Constants.DataItemEventPhase.ON_TARGET){var t=this._dataItemUtils.createDataChangeEventList(e,this._data),i=t.some(function(e){return"add"==e.type||"delete"==e.type||e.item.isRef()});if(i){for(;this._undisposedChildren.length>0;){var n=this._undisposedChildren.pop();n.dispose()}this._dataItem.set("items",[]),this._dataItem.set("items",this._data.getChildren())}}},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._firstTemplate=this._getItemTemplate("first"),this._lastTemplate=this._getItemTemplate("last")},_getItemTemplate:function(e){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(e)},_getDefaultStyleName:function(){return null},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"},_onComponentWixified:function(){this._updateSequencerListeners(),this._componentLogic.getSequencer().isPending()||this.updateLayoutWhenReady()},dispose:function(){if(!this._disposed){for(;this._undisposedChildren.length>0;){var e=this._undisposedChildren.pop();e.dispose()}this.parent()}}})}),define.Class("wixapps.integration.proxies.ListProxy2",function(e){var t=e;t.inherits("wixapps.integration.proxies.WArrayProxy"),t.binds([]),t.fields({_rootElement:null,_childrenTemplateMap:[]}),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n)},_getLogicClassName:function(){return"mobile.core.components.base.BaseComponent"},_createRawData:function(){return void 0},_getLogicArgs:function(){return void 0},setComponentStyles:function(){},onChildCreate:function(){},createComponent:function(){var e=this._createWixComponent(this._getLogicClassName(),this._createRawData(),this._getLogicArgs());return this._childrenTemplateMap=[],this._createChildren(),this._createChildComponents(e),this.setComponentStyles(e),this._rootElement=e,e},_onDataChanged:function(e){if(e.phase==Constants.DataItemEventPhase.ON_TARGET){for(var t=this._dataItemUtils.createDataChangeEventList(e,this._data),i=t.filter(function(e){var t=1==e.path.length;return t&&("add"==e.type||"delete"==e.type||e.item.isRef())}.bind(this)),n=0;i.length>n;n++){var a=i[n];"add"===a.type?this._addChildAndSetup(a.item,a.path[0],this._children.length+1):"delete"===a.type?this._removeChild(a.path[0]):a.item&&a.item.isRef()&&this._refreshChildAtIndex(a.path[0])}this._updateItemTemplates()}},_updateItemTemplates:function(){for(var e=this._children.length,t=0;e>t;t++){var i=this._resolveTemplateType(t,e);this._childrenTemplateMap[t]!==i.type&&this._refreshChildAtIndex(t);var n=this._children[t].getViewContext();this._addPositionInParentVars(n,t,e)}},_insertElementAt:function(e,t){var i=this._rootElement.getChildren();if(0>t||t>i.length)throw"Invalid index. cannot insert the element at index "+t+".";0===t?this._rootElement.grab(e,"top"):t===i.length?this._rootElement.grab(e,"bottom"):i[t-1].grab(e,"after")},_refreshChildAtIndex:function(e){var t=this._children[e].getData();this._removeChild(e),this._addChildAndSetup(t,e,this._children.length)},_removeChild:function(e){var t=this._children.splice(e,1);t[0].dispose(),this._childrenTemplateMap.splice(e,1)},_addChildAndSetup:function(e,t,i){var n=this._addChild(e,t,i);if(n){var a=n.createComponent();this._insertElementAt(a,t),n.setupProxy()}},_addChild:function(e,t,i){var n=this._resolveTemplateType(t,i);this._childrenTemplateMap.splice(t,0,n.type);var a=this._viewContext.getEnvironment().getProxyFactory(),s=this._viewContext.newContextForData(e);this._addPositionInParentVars(s,t,i);var o=a.createNewEvaluationScope(n.def,s),r=a.createProxyFromItemDefinition(s,o).proxy;return this._children.splice(t,0,r),r},_resolveTemplateType:function(e,t){var i=this._itemTemplate,n="item";return 0===e&&this._firstTemplate?(i=this._firstTemplate,n="first"):e==t-1&&this._lastTemplate&&(i=this._lastTemplate,n="last"),{def:i,type:n}},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._firstTemplate=this._getItemTemplate("first"),this._lastTemplate=this._getItemTemplate("last")},_getItemTemplate:function(e){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(e)},_getDefaultStyleName:function(){return null},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"},_onComponentWixified:function(){}})}),define.Class("wixapps.integration.proxies.LocationSelectorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged"]),t.methods({createComponent:function(){var e="wixapps.integration.components.inputs.LocationSelector",t=this._data.getValue(),i={type:"GeoMap",address:t.address,latitude:t.latitude,longitude:t.longitude,addressInfo:t.addressInfo};return this.useSkinsInsteadOfStyles(),this._createWixComponent(e,i)},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.LocationSelectorSkin"},_onDataChanged:function(){if(!this._userInputChange&&this._componentLogic){var e=this._data.getValue(),t=this._componentLogic.getDataItem();t.set("address",e.address,!0),t.set("latitude",e.latitude,!0),t.set("longitude",e.longitude,!0),t.set("addressInfo",e.addressInfo,!0),t.fireDataChangeEvent()}},_onComponentDataChanged:function(){var e=this._componentLogic.getDataItem(),t={_type:"wix:Location",address:e.get("address"),latitude:e.get("latitude"),longitude:e.get("longitude"),addressInfo:e.get("addressInfo")};this._userInputChange=!0,this._data.setValue(t),this._userInputChange=!1},_getAcceptableDataTypes:function(){return["wix:Location"]}})}),define.Class("wixapps.integration.proxies.MultiColumnListProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ListProxy"),t.methods({getRepeaterClass:function(){return"wixapps.integration.components.MultiColumnList"}})}),define.Class("wixapps.integration.proxies.NumberInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.TextInputProxy"),t.methods({createComponent:function(){this.parent();var e=this._createRawData();return this._createWixComponent("wysiwyg.viewer.components.inputs.NumberInput",e)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.NumberInputSkin"},_getDefaultStyleName:function(){return"numi1"},_getPropSchemaName:function(){return"NumberInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperty("minValue","minValue",Number),this._mapToCompProperty("maxValue","maxValue",Number)}})}),define.Class("wixapps.integration.proxies.NumericStepperProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged"]),t.methods({createComponent:function(){this.parent();var e=this._createRawData();return this._createWixComponent("wysiwyg.viewer.components.inputs.NumberInput",e)},_createRawData:function(){var e=this._data.getValue();return{type:"Text",text:e.value}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.NumberInputSkin"},_createCompProperties:function(){return this._getPropertiesFromData()},_getPropertiesFromData:function(){var e=this._data.getValue();return{type:"NumberInputProperties",minValue:e.minValue,maxValue:e.maxValue}},_onDataChanged:function(){if(this._componentLogic&&!this._ignoreUpdate){this._componentLogic.getDataItem().set("text",this._data.getValue().value);var e=this._getPropertiesFromData();this._componentLogic.setComponentProperty("minValue",e.minValue),this._componentLogic.setComponentProperty("maxValue",e.maxValue)}},_onComponentDataChanged:function(e,t,i){this._ignoreUpdate=!0;var n=this._data.getValue();n.value=Number(i.text),this._data.setValue(n),this._ignoreUpdate=!1},_getDefaultStyleName:function(){return"numi1"}})}),define.Class("wixapps.integration.proxies.OptionListInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.TextInputProxy"),t.binds(["_onComponentDataChanged"]),t.methods({createComponent:function(){var e=this._createRawData();return this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this._createWixComponent("wixapps.integration.components.inputs.TextInput",e)},_getPropSchemaName:function(){return"TextInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["label","placeholder"])},_createRawData:function(){return this._data.getValue(),{type:"Text",text:this._getOptionsAsText()}},_getOptionsAsText:function(){for(var e=this._data.getValue(),t="",i=0;e.items.length>i;i++)t+=e.items[i].text+"\n";return t},_getOptionsFromText:function(e){for(var t=e.split("\n"),i=[],n=0;t.length>n;n++)t[n].length>0&&i.push({_type:"Option",value:n,text:t[n]});return i},_onComponentWixified:function(){},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._getOptionsAsText())},_onComponentDataChanged:function(e,t,i){this._ignoreUpdate=!0,this._data.getChildByRef("items").setValue(this._getOptionsFromText(i.text)),this._ignoreUpdate=!1},_getDefaultStyleName:function(){return"ti1"},_getDefaultSkinName:function(){return"wixapps.integration.skins.TextAreaSkin"}})}),define.Class("wixapps.integration.proxies.OptionsListProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onValidation"]),t.traits(["wixapps.integration.proxies.traits.WDataExchangeTrait"]),t.statics({listType:{text:{compType:"wysiwyg.viewer.components.inputs.TextOption",compSkin:"wixapps.integration.skins.ecommerce.options.TextOptionSkin"},color:{compType:"wysiwyg.viewer.components.inputs.ColorOption",compSkin:"wixapps.integration.skins.ecommerce.options.ColorOptionSkin"}}}),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._listType=this._data.getChildValue("optionType")||"text";var a=i.getChildValue("optionSkin");a&&(this.listType[this._listType].compSkin=a),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){return this.useSkinsInsteadOfStyles(),this._createWixComponent("wysiwyg.common.components.inputs.OptionsListInput",this._createRawData(),this.listType[this._listType])},_createRawData:function(){var e=this._data.getChildByRef("items").getValue(),t=e.map(this._getOptionWDataItem);
return{type:"SelectableList",items:t,selected:null}},_getOptionWDataItem:function(e){var t={type:"SelectOption",value:e.value,text:e.text,enabled:e.enabled,description:e.description},i=W.Data.addDataItemWithUniqueId("apps",t).dataObject;return i.setMeta("isPersistent",!1),i},_onDataChanged:function(){if(this._componentLogic&&!this._ignoreUpdate){for(var e=null,t=this.getData().getChildValue("selectedValue"),i=this._componentLogic.getDataItem().get("items"),n=this.getData().getChildValue("items"),a=0;i.length>a;a++){var s=i[a].get("value");s==t&&(e=i[a]);var o=n[a].enabled;i[a].set("enabled",o)}this._componentLogic.getDataItem().set("selected",e),!e&&this._componentLogic._selectedItem&&this._refreshComponentData()}},_onComponentDataChanged:function(e,t,i){"selected"==t&&i.selected&&(this._ignoreUpdate=!0,this.getData().getChildByRef("selectedValue").setValue(i.selected.get("value")),this._ignoreUpdate=!1)},_setupPropertyHandlers:function(){this._handleProperties(["align","margin","label","href","target","linkType","icon"],function(){this._refreshComponentData()})},_onValidation:function(e){this._componentLogic&&e&&this._componentLogic.setValidationState(e.valid)},_refreshComponentData:function(){if(this._componentLogic){var e=this._createRawData(),t=this._componentLogic.getDataItem(),i=this._convertWItemDataToRawData(t);this._rawDataEquals(this._convertWItemDataToRawData(e),i)||(t.setData(e),t.setMeta("isPersistent",!1))}},_replaceAllTable:function(){var e=this._element,t=this.createComponent();e.parentNode.replaceChild(t,e),this.setupProxy()},_getDefaultSkinName:function(){return"wixapps.integration.skins.ecommerce.options.OptionsListInputSkin"}})}),define.Class("wixapps.integration.proxies.ProxyMap",function(e){var t=e;t.utilize(["wixapps.integration.proxies.VerticalLineProxy","wixapps.integration.proxies.HorizontalLineProxy","wixapps.integration.proxies.SwitchProxy","wixapps.integration.proxies.LabelProxy","wixapps.integration.proxies.ClippedParagraphProxy","wixapps.integration.proxies.DateProxy","wixapps.integration.proxies.DateSelectorProxy","wixapps.integration.proxies.TimeSelectorProxy","wixapps.integration.proxies.InlineTextProxy","wixapps.integration.proxies.TextInputProxy","wixapps.integration.proxies.StringArrayInputProxy","wixapps.integration.proxies.InlineTextInputProxy","wixapps.integration.proxies.NumberInputProxy","wixapps.integration.proxies.NumericStepperProxy","wixapps.integration.proxies.RichTextEditorProxy","wixapps.integration.proxies.RichTextEditorInlineProxy","wixapps.integration.proxies.FormattedPriceProxy","wixapps.integration.proxies.ImageProxy","wixapps.integration.proxies.ImageSelectorProxy","wixapps.integration.proxies.ImageInputProxy","wixapps.integration.proxies.VerticalListProxy","wixapps.integration.proxies.FlowListProxy","wixapps.integration.proxies.MultiColumnListProxy","wixapps.integration.proxies.ButtonProxy","wixapps.integration.proxies.Button2Proxy","wixapps.integration.proxies.LinkProxy","wixapps.integration.proxies.LinkSelectorProxy","wixapps.integration.proxies.layout.CssLayoutProxy","wixapps.integration.proxies.layout.BoxLayoutProxy","wixapps.integration.proxies.layout.StackLayoutProxy","wixapps.integration.proxies.layout.FieldProxy","wixapps.integration.proxies.layout.SwitchBoxProxy","wixapps.integration.proxies.layout.OptionalAreaProxy","wixapps.integration.proxies.layout.FieldBoxProxy","wixapps.integration.proxies.layout.TextFieldProxy","wixapps.integration.proxies.layout.DataEditFieldProxy","wixapps.integration.proxies.SpacerProxy","wixapps.integration.proxies.GalleryProxy","wixapps.integration.proxies.SuperFlowProxy","wixapps.integration.proxies.VerticalListEditorProxy","wixapps.integration.proxies.DraggableListItemProxy","wixapps.integration.proxies.TableProxy","wixapps.integration.proxies.OptionsListProxy","wixapps.integration.proxies.OptionListInputProxy","wixapps.integration.proxies.ComboBoxProxy","wixapps.integration.proxies.RadioGroupProxy","wixapps.integration.proxies.CheckBoxGroupProxy","wixapps.integration.proxies.TabMenuProxy","wixapps.integration.proxies.TextAreaProxy","wixapps.integration.proxies.AreaProxy","wixapps.integration.proxies.SliderGalleryProxy","wixapps.integration.proxies.VideoProxy","wixapps.integration.proxies.VideoThumbProxy","wixapps.integration.proxies.ExpanderProxy","wixapps.integration.proxies.IconProxy","wixapps.integration.proxies.VideoSelectorProxy","wixapps.integration.proxies.ExpanderProxy","wixapps.integration.proxies.ToggleProxy","wixapps.integration.proxies.DeckProxy","wixapps.integration.proxies.ContainerProxy","wixapps.integration.proxies.ZoomLinkProxy","wixapps.integration.proxies.AppLinkProxy","wixapps.integration.proxies.layout.ZoomLayoutProxy","wixapps.integration.proxies.layout.FixedRatioLayoutProxy","wixapps.integration.proxies.CheckBoxProxy","wixapps.integration.proxies.CheckBoxViewProxy","wixapps.integration.proxies.GoogleMapProxy","wixapps.integration.proxies.LocationSelectorProxy","wixapps.integration.proxies.EmptyProxy","wixapps.integration.proxies.TagInputProxy","wixapps.integration.proxies.ListProxy2","wixapps.integration.proxies.UnstyledLabelProxy","wixapps.integration.proxies.TooltipIconProxy","wixapps.integration.proxies.HelpProxy","wixapps.integration.proxies.ImageButtonProxy","wixapps.integration.proxies.AudioPlayerProxy","wixapps.integration.proxies.AudioInputProxy"]),t.methods({registerComponentProxies:function(e){e.registerProxy("Label",this.imports.LabelProxy,"String",[{forType:"String",forMode:"view"},{forType:"Number",forMode:"view"},{forType:"wix:RichText",forMode:"view"}]),e.registerProxy("ClippedParagraph",this.imports.ClippedParagraphProxy,"String"),e.registerProxy("Date",this.imports.DateProxy,"wix:Date"),e.registerProxy("DateEdit",this.imports.DateSelectorProxy,"wix:Date"),e.registerProxy("TimeEdit",this.imports.TimeSelectorProxy,"wix:Date"),e.registerProxy("InlineText",this.imports.InlineTextProxy,"String"),e.registerProxy("InlineTextInput",this.imports.InlineTextInputProxy,"String"),e.registerProxy("TextInput",this.imports.TextInputProxy,"String",[{forType:"String",forMode:"edit"}]),e.registerProxy("NumberInput",this.imports.NumberInputProxy,"Number",[{forType:"Number",forMode:"edit"}]),e.registerProxy("NumericStepper",this.imports.NumericStepperProxy,"Number",[{forType:"NumberInRange",forMode:"edit"}]),e.registerProxy("CheckBox",this.imports.CheckBoxProxy,"Boolean",[{forType:"Boolean",forMode:"edit"}]),e.registerProxy("CheckBoxViewProxy",this.imports.CheckBoxViewProxy,"Boolean",[{forType:"Boolean",forMode:"view"}]),e.registerProxy("RichTextEditor",this.imports.RichTextEditorProxy,"wix:RichText"),e.registerProxy("RichTextEditorInline",this.imports.RichTextEditorInlineProxy,"wix:RichText",[{forType:"wix:RichText",forMode:"edit"}]),e.registerProxy("Price",this.imports.FormattedPriceProxy,"Price",[{forType:"Price",forMode:"view"}]),e.registerProxy("Image",this.imports.ImageProxy,"wix:Image",[{forType:"wix:Image",forMode:"view"}]),e.registerProxy("Video",this.imports.VideoProxy,"wix:Video",[{forType:"Video",forMode:"view"},{forType:"wix:Video",forMode:"view"}]),e.registerProxy("VideoSelector",this.imports.VideoSelectorProxy,"wix:Video",[{forType:"Video",forMode:"edit"},{forType:"wix:Video",forMode:"edit"}]),e.registerProxy("VideoThumb",this.imports.VideoThumbProxy,""),e.registerProxy("ImageSelector",this.imports.ImageSelectorProxy,"wix:Image",[{forType:"wix:Image",forMode:"edit"}]),e.registerProxy("ImageInput",this.imports.ImageInputProxy,""),e.registerProxy("VerticalList",this.imports.VerticalListProxy,"Array",[{forType:"Array",forMode:"view"},{forType:"Array",forMode:"edit"}]),e.registerProxy("FlowList",this.imports.FlowListProxy,""),e.registerProxy("MultiColumn",this.imports.MultiColumnListProxy,""),e.registerProxy("VerticalListEditor",this.imports.VerticalListEditorProxy,""),e.registerProxy("DraggableListItem",this.imports.DraggableListItemProxy,""),e.registerProxy("Gallery",this.imports.GalleryProxy,""),e.registerProxy("Box",this.imports.BoxLayoutProxy,""),e.registerProxy("VBox",this.imports.BoxLayoutProxy,""),e.registerProxy("HBox",this.imports.BoxLayoutProxy,""),e.registerProxy("Field",this.imports.FieldProxy,""),e.registerProxy("FieldBox",this.imports.FieldBoxProxy,""),e.registerProxy("TextField",this.imports.TextFieldProxy,""),e.registerProxy("DataEditField",this.imports.DataEditFieldProxy,""),e.registerProxy("Stack",this.imports.StackLayoutProxy,""),e.registerProxy("Css",this.imports.CssLayoutProxy,""),e.registerProxy("VSpacer",this.imports.SpacerProxy,""),e.registerProxy("HSpacer",this.imports.SpacerProxy,""),e.registerProxy("InlineSpacer",this.imports.SpacerProxy,""),e.registerProxy("HorizontalLine",this.imports.HorizontalLineProxy,""),e.registerProxy("VerticalLine",this.imports.VerticalLineProxy,""),e.registerProxy("Switch",this.imports.SwitchProxy,""),e.registerProxy("SwitchBox",this.imports.SwitchBoxProxy,""),e.registerProxy("OptionalArea",this.imports.OptionalAreaProxy,""),e.registerProxy("SuperFlow",this.imports.SuperFlowProxy,""),e.registerProxy("Button",this.imports.ButtonProxy,""),e.registerProxy("Button2",this.imports.Button2Proxy,""),e.registerProxy("Table",this.imports.TableProxy,""),e.registerProxy("Expander",this.imports.ExpanderProxy,""),e.registerProxy("Deck",this.imports.DeckProxy,""),e.registerProxy("TabMenu",this.imports.TabMenuProxy,""),e.registerProxy("Icon",this.imports.IconProxy,""),e.registerProxy("StringArrayInput",this.imports.StringArrayInputProxy,""),e.registerProxy("Toggle",this.imports.ToggleProxy,""),e.registerProxy("AudioPlayer",this.imports.AudioPlayerProxy,""),e.registerProxy("AudioInput",this.imports.AudioInputProxy,""),e.registerProxy("Link",this.imports.LinkProxy,"wix:LinkBase",[{forType:"wix:LinkBase",forMode:"view"}]),e.registerProxy("LinkSelector",this.imports.LinkSelectorProxy,"wix:LinkBase",[{forType:"wix:LinkBase",forMode:"edit"}]),e.registerProxy("OptionsList",this.imports.OptionsListProxy,"OptionsList",[{forType:"OptionsList",forMode:"view"}]),e.registerProxy("OptionsListInput",this.imports.OptionListInputProxy,"OptionsList",[{forType:"ComboOptionsList",forMode:"edit"},{forType:"OptionsList",forMode:"edit"}]),e.registerProxy("ComboBox",this.imports.ComboBoxProxy,"ComboOptionsList",[{forType:"ComboOptionsList",forMode:"view"}]),e.registerProxy("RadioGroup",this.imports.RadioGroupProxy,"ComboOptionsList",[{forType:"ComboOptionsList",forMode:"view"}]),e.registerProxy("CheckBoxGroup",this.imports.CheckBoxGroupProxy,"MultiOptionsList",[{forType:"MultiOptionsList",forMode:"view"}]),e.registerProxy("TextArea",this.imports.TextAreaProxy,"String"),e.registerProxy("Area",this.imports.AreaProxy),e.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array",[{forType:"Array<wix:Image>",forMode:"view"}]),e.registerProxy("Container",this.imports.ContainerProxy,""),e.registerProxy("ZoomLink",this.imports.ZoomLinkProxy,""),e.registerProxy("AppLink",this.imports.AppLinkProxy,""),e.registerProxy("ZoomLayout",this.imports.ZoomLayoutProxy,""),e.registerProxy("FixedRatioLayout",this.imports.FixedRatioLayoutProxy,""),e.registerProxy("GoogleMap",this.imports.GoogleMapProxy,"wix:Location"),e.registerProxy("LocationSelector",this.imports.LocationSelectorProxy,"wix:Location"),e.registerProxy("Empty",this.imports.EmptyProxy,"",[]),e.registerProxy("TagInput",this.imports.TagInputProxy,""),e.registerProxy("List2",this.imports.ListProxy2,"Array",[{forType:"Array",forMode:"view"},{forType:"Array",forMode:"edit"}]),e.registerProxy("UnstyledLabel",this.imports.UnstyledLabelProxy,"String"),e.registerProxy("TooltipIcon",this.imports.TooltipIconProxy,""),e.registerProxy("Help",this.imports.HelpProxy,""),e.registerProxy("ImageButton",this.imports.ImageButtonProxy,"")}})}),define.Class("wixapps.integration.proxies.RadioGroupProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ComboBoxProxy"),t.binds(["_onComponentDataChanged"]),t.methods({createComponent:function(){var e=Number.random(0,99999).toString(36),t="radio_group_"+e;return this._createWixComponent("wysiwyg.viewer.components.inputs.RadioGroupInput",this._createRawData(),{radioGroupName:t,selectedValue:this._data.getChildValue("selectedValue")})},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.RadioGroupInputSkin"},_getDefaultStyleName:function(){return"wa_rg1"}})}),define.Class("wixapps.integration.proxies.RichTextEditorInlineProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_linkIdGenerator","_onEditingCompleted"]),t.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),t.utilize(["wysiwyg.common.utils.TextMigrationHandler"]),t.resources(["W.Data","W.Commands"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._stylesMap=this.resources.W.Data.getDataByQuery("#WIXAPPS_EDITOR_STYLES"),this._migrationHandler=new this.imports.TextMigrationHandler},createComponent:function(){this.useSkinsInsteadOfStyles();var e=W.Data;return W.Editor&&(e=W.Preview.getPreviewManagers().Data),this._updateLinkDataItems(e),this._createWixComponent("wysiwyg.editor.components.richtext.WRichTextEditor",null,{isFixedHeight:!0,isPersistent:!1,generateLinkIdFunc:this._linkIdGenerator,isFixedToolbar:!1,isDraggable:!1,isAutoClosing:!1,isInitiallyCollapsed:!1})},_onComponentWixified:function(){var e=this._def.getChildValue("height"),t=this._element.getWidth();this._migrateHtml();var i=this._data.getChildValue("text");this._componentLogic.addEvent(Constants.ComponentEvents.READY,function(){this._componentLogic.startEditing(i,e,t,this._stylesMap)}.bind(this)),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.FinalizeDataItemEditing",this,this._onFinalizeDataItemEditing)},_onFinalizeDataItemEditing:function(){var e=this._componentLogic.endEditing();this._onEditingCompleted(e),this.resources.W.Commands.unregisterCommand("WAppsEditorCommands.FinalizeDataItemEditing")},_onEditingCompleted:function(e){var t=this._data.getValue();t.text=e,t.links=this._getLinksDataFromHtml(t.text),t.version=2,this._data.setValue(t)},_migrateHtml:function(){var e=this._data.getValue();e.hasOwnProperty("version")&&1!==e.version||(e.text=this._migrationHandler.migrateText(e.text,this._getDefaultStylePlaceHolderTag(),this._getDefaultStyleName()),e.version=2,this._data.setValue(e))},_getLinksDataFromHtml:function(e){for(var t=e.match(/dataQuery="[^"]*/gi)||[],i=[],n=0;t.length>n;n++){var a=t[n].split('"')[1],s=W.Preview.getPreviewManagers().Data.getDataByQuery(a);i.push(this._createAppsLink(s))}return i},dispose:function(){this._componentLogic&&this._componentLogic.dispose(),this.parent()},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.WRichTextInlineEditorSkin"},_getDefaultStyleName:function(){return this._stylesMap.get("items").div.cssClass},_getDefaultStylePlaceHolderTag:function(){return this._stylesMap.get("items").div.seoTag},_onComponentDataChanged:function(){for(var e=this._componentLogic.getDataItem().get("text"),t=e.match(/dataQuery="[^"]*/gi)||[],i=[],n=0;t.length>n;n++){var a=t[n].split('"')[1],s=W.Preview.getPreviewManagers().Data.getDataByQuery(a);i.push(this._createAppsLink(s))}this._data.getChildByRef("links").setValue(i),this._data.getChildByRef("text").setValue(e)},_linkIdGenerator:function(){return this.generateLinkId(this._viewContext.getEnvironment().getProxyFactory().getNameSpace())}})}),define.dataItem.multi({WIXAPPS_EDITOR_STYLES:{type:"map",metaData:{isPersistent:!1},items:{h1:{tag:"h1",cssClass:"font_3"},h2:{tag:"h2",cssClass:"font_4"},h3:{tag:"h3",cssClass:"font_5"},h4:{tag:"h4",cssClass:"font_6"},h5:{tag:"h5",cssClass:"font_7"},h6:{tag:"h6",cssClass:"font_8"},p:{tag:"p",cssClass:"font_9"},div:{tag:"div",cssClass:"font_8",label:"default",seoTag:"hatul"}}}}),define.Class("wixapps.integration.proxies.RichTextEditorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.UnstyledLabelProxy"),t.resources(["W.Data","W.Utils","W.Commands"]),t.binds(["_linkIdGenerator","_onPreviewClicked","_onEditingCompleted"]),t.fields({_editorElement:void 0,_editorData:void 0,_editorLogic:void 0,_onEditorReady:[],_ignoreEditorDataChange:void 0}),t.methods({_linkIdGenerator:function(){return this.generateLinkId("appbuilder")},_onComponentWixified:function(){var e=this._def.getChildValue("height");this._componentLogic.setHeight(e);var t=this._componentLogic.getSkinPart("frame");t.setStyle("height",e+"px"),this._componentLogic.getSkinPart("richTextContainer").addEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._createRTEditorComponent()},_createRTEditorComponent:function(){var e=W.Data;W.Editor&&(e=W.Preview.getPreviewManagers().Data),this._updateLinkDataItems(e);var t=new Element("DIV");t.set("comp","wysiwyg.editor.components.richtext.WRichTextEditor"),t.set("skin","wixapps.integration.skins.editor.WRichTextEditorAppBuilderSkin"),t.set("pos",""),this._editorElement=t,this._editorElement.addEvent(Constants.ComponentEvents.WIXIFIED,function(){}.bind(this)),this._editorElement.addEvent(Constants.ComponentEvents.READY,function(){this._editorLogic=t.getLogic(),this._editorLogic.addEvent("richTextEditorReady",function(){this._componentLogic.getSkinPart("richTextContainer").setStyle("visibility","hidden")}.bind(this)),this._notifyEditorReady()}.bind(this)),this._componentLogic.getSkinPart("frame").grab(t);var i={isFixedHeight:!0,isPersistent:!1,generateLinkIdFunc:this._linkIdGenerator};this._editorElement.wixify(i,this._editorData)},_onPreviewClicked:function(){this._getEditorComponent(function(e){var t=this._element.getWidth(),i=this._def.getChildValue("height"),n=this._data.getChildValue("text");e.addEvent("endEditing",this._onEditingCompleted),this.resources.W.Commands.registerCommand("WAppsEditor2Commands.BeforeListItemSelectionMadafaka",!0),this.resources.W.Commands.registerCommandListenerByName("WAppsEditor2Commands.BeforeListItemSelectionMadafaka",this,this._onBeforeDataItemChanged),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.BeforeStartEditingText"),e.startEditing(n,i,t,this._stylesMap)}.bind(this))},_onBeforeDataItemChanged:function(){this.resources.W.Commands.executeCommand("WEditorCommands.StopEditingText")},_getEditorComponent:function(e){this._editorLogic?e(this._editorLogic):this._registerToEditorReadyNotification(e)},_onEditingCompleted:function(e){var t=this._data.getValue();t.text=e,t.links=this._getLinksDataFromHtml(t.text),this._data.setValue(t),this._componentLogic.getSkinPart("richTextContainer").setStyle("visibility","inherit"),this._editorLogic.removeEvent("endEditing");var i=this.resources.W.Commands.getCommand("WAppsEditor2Commands.BeforeListItemSelectionMadafaka");i&&i.unregisterListener(this)},_getLinksDataFromHtml:function(e){for(var t=e.match(/dataQuery="[^"]*/gi)||[],i=[],n=0;t.length>n;n++){var a=t[n].split('"')[1],s=W.Preview.getPreviewManagers().Data.getDataByQuery(a);i.push(this._createAppsLink(s))}return i},_isSingleLine:function(){return!1},_registerToEditorReadyNotification:function(e){this._onEditorReady.push(e)},_notifyEditorReady:function(){for(;this._onEditorReady.length>0;){var e=this._onEditorReady.shift();e(this._editorLogic)}},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.RichTextEditorSkin"},_getAcceptableDataTypes:function(){return["wix:RichText"]},dispose:function(){this._componentLogic&&this._componentLogic.getSkinPart("richTextContainer").removeEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._editorLogic&&this._editorLogic.dispose(),this.parent()}})}),define.Class("wixapps.integration.proxies.SliderGalleryProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.methods({createComponent:function(){this.useSkinsInsteadOfStyles();var e=this._createWixComponent("wysiwyg.viewer.components.SelectableSliderGallery",this._createRawData(),null);return e.setStyle("position","relative"),e},_createRawData:function(){var e=this._data.getChildren(),t=[];return e.forEach(function(e){t.push(this._getWImage(e.getValue()))},this),{type:"ImageList",items:t}},_getWImage:function(e){var t={type:"Image",title:"",uri:e.src,description:"",height:e.height,width:e.width,borderSize:"",alt:""},i=W.Data.createDataItem(t);return i.setMeta("isPersistent",!1),i},_getPropSchemaName:function(){return"SliderGalleryProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["showAutoplay","loop","showCounter","expandEnabled"])},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.galleryselectableslider.SelectableSliderGalleryDefaultSkin"}})}),define.Class("wixapps.integration.proxies.SpacerProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.fields({_spacerType:"",_spacerSize:10,_sizePropMap:{HSpacer:"width",VSpacer:"height",InlineSpacer:"word-spacing"}}),t.methods({_preventReflowCssClass:function(){return null},getSpacerType:function(){return this._spacerType},createComponent:function(){var e=this._createElement("div");return this._updateSpacerSize(e),e},isBoxFlexEnabled:function(){return"InlineSpacer"!==this._spacerType},getSpacerSize:function(){return this._spacerSize},_setupPropertyHandlers:function(){this._handleProperty("size",function(){this._updateSpacerSize(this._element)})},_updateSpacerSize:function(e){var t;this._spacerType=this._def.getChildValue("name");var i={};"InlineSpacer"===this._spacerType?(this._spacerType="InlineSpacer",i.display="inline",this._element.set("text"," ")):e.setStyle("display","box");var n=this._def.getChildValue("size");void 0!==n&&(this._spacerSize=n),t=this._sizePropMap[this._spacerType];var a="width"===t?"height":"width";i[a]=0,"*"===this._spacerSize?(i[t]=0,i["box-flex"]="1"):t&&(i[t]=parseInt(this._spacerSize,10)+"px",i["box-flex"]="none"),e.setStyles(i)},getProxyMetaTags:function(){var e=["spacer"];return"InlineSpacer"===this._spacerType&&e.push("inline"),e}})}),define.Class("wixapps.integration.proxies.StringArrayInputProxy",function(e){var t=e,i={none:function(e){return e},toLower:function(e){return e.toLowerCase()},toUpper:function(e){return e.toUpperCase()}};t.inherits("wixapps.integration.proxies.TextInputProxy"),t.methods({_createRawData:function(){var e=this._data.getValue(),t=this._arrayToString(e);return{type:"Text",text:t}},_arrayToString:function(e){var t=this._def.getChildValue("joinSeparator")||", ";return e.join(t)},_stringToArray:function(e){var t=this._def.getChildValue("splitRegex")||"\\s*,\\s*",n=this._def.getChildValue("filterEmpty");n=n!==!1&&"false"!==n;var a=this._def.getChildValue("filterDuplicates");a=a!==!1&&"false"!==a;var s=i[this._def.getChildValue("conversion")||"none"],o=s(e).split(RegExp(t)),r=n?o.filter(function(e){return!!e}):o;if(a){var l={};r=r.filter(function(e){return l[e]!==!0?(l[e]=!0,!0):!1})}return r},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._arrayToString(this._data.getValue()))},_onComponentDataChanged:function(e,t,i){this._ignoreUpdate=!0,this._data.setValue(this._stringToArray(i.text)),this._ignoreUpdate=!1},_getAcceptableDataTypes:function(){return["Array"]}})}),define.Class("wixapps.integration.proxies.SuperFlowProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WCompositeProxy"),t.utilize(["wixapps.core.layouts.SuperFlowLayout"]),t.fields({_components:[],_layout:null,_layoutModel:null}),t.methods({createComponent:function(){var e=this.setWidth;this.setWidth=function(t){e.apply(this,[t]),this._setWidth(t)}.bind(this);var t=this._createWixComponent("core.components.Container");return this._layout=new this.imports.SuperFlowLayout,this._buildLayoutModel(),this._createChildComponents(t),this._components.forEach(function(e){e.setStyle("position","absolute")}),t},_buildLayoutModel:function(){var e=this._def.getValue(),t={items:[]};e.regions&&(t.regions=Object.clone(e.regions)),e.items.forEach(function(e){var i={};e.layout&&Object.each(e.layout,function(e,t){i[t]=e}),t.items.push(i)}),this._layoutModel=t},applyLayout:function(){this._layout.setModel(this._layoutModel,this._children),this._layout.positionElements(),this._element.setStyle("height",this._layout.getHeight())},_setWidth:function(e){this._layoutModel.minWidth=e,this.applyLayout()},_onDefinitionsChanged:function(){this.applyLayout()},_getDefaultStyleName:function(){return"c1"},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"}})}),define.Class("wixapps.integration.proxies.SwitchProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.fields({_child:null,_prevCaseId:null}),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n)},_setupPropertyHandlers:function(){this.parent(),this._handleProperties(["cases"],function(){this._updateSwitchState()&&(this._child.setupProxy(),this._child.updateLayoutWhenReady())})},_updateSwitchState:function(){var e=!1,t=this._data?""+this._data.getValue():"";if(t!==this._prevCaseId&&(this._prevCaseId=t,this._child&&(this._child.dispose(),this._child=null),this._def.getChildByRef("cases"))){var i=this._def.getChildByRef("cases").getChildByRef(t)||this._def.getChildByRef("cases").getChildByRef("default");if(i&&"NO_PROXY"===i.getValue())this._element.collapse();else{this._element.uncollapse(),this._child=this._viewContext.getEnvironment().getProxyFactory().createProxyFromItemDefinition(this._viewContext,i).proxy;var n=this._child.createComponent();if(n){this._element.adopt(n);var a=i.getChildValue("layout")||{};this._applyStyle(n,a),e=!0}}}return e},setupProxy:function(e){this.parent(),this._child?this._child.setupProxy(e):e&&e()},createComponent:function(){var e=this._createElement();return e.setStyles({"flex-direction":"column",display:"flex"}),this._updateSwitchState(),e},_onDataChanged:function(){this._updateSwitchState()&&(this._child.setupProxy(),this._child.updateLayoutWhenReady())},dispose:function(){this._child&&(this._child.dispose(),this._child=null)}})}),define.Class("wixapps.integration.proxies.TabMenuProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onSelectionChanged","_onSelectionChangeRequested"]),t.methods({createComponent:function(){return this._initialSelectedIndex=this.getViewDefinition().getChildValue("initialSelectedIndex")||0,this._selectionRequestEvent=this.getViewDefinition().getChildValue("selectionRequestEvent"),this._selectionRequestEventScope=this.getViewDefinition().getChildValue("selectionRequestScope")||"any",this._titleExpression=this._def.getChildValue("titleExpression")||"this",this._selectionChangedEvent=this.getViewDefinition().getChildValue("selectionChangedEvent"),this._createWixComponent("wixapps.integration.components.TabMenu",this._createRawData(),{initialSelectedIndex:this._initialSelectedIndex})},_createRawData:function(){for(var e=this._data.getChildren(),t=[],i=0;e.length>i;i++)t.push(e[i].evaluatePath(this._titleExpression).getValue(0));return{type:"TextList",items:t}},setSelectedIndex:function(e){this._componentLogic&&this._componentLogic.setSelectedIndex(e)},_onComponentWixified:function(){this._componentLogic.addEvent("selectionChanged",this._onSelectionChanged),this._selectionRequestEvent&&this.addEventFilteredByScope(this._selectionRequestEventScope,this._selectionRequestEvent,this._onSelectionChangeRequested);var e=this._getInitialSelection();e>=0&&this.setSelectedIndex(e)},_onSelectionChanged:function(){this._selectionChangedEvent&&this.fireEvent(this._selectionChangedEvent,{sender:this,data:this.data.getChildren()[this._componentLogic.getSelectedIndex()],context:this.getViewContext(),def:this.getViewDefinition()})},_onSelectionChangeRequested:function(e){var t=e.data;if(t)for(var i=this._data.getChildren(),n=0;i.length>n;n++){var a=i[n];if(a==t)return this.setSelectedIndex(n),void 0}},_setupPropertyHandlers:function(){this._handleProperty("initialSelectedIndex",function(e){e=e||0,e!=this._initialSelectedIndex&&(this._initialSelectedIndex=e,this.setSelectedIndex(e))})},_getDefaultSkinName:function(){return"wixapps.integration.skins.TabMenuSkin"},_getAcceptableDataTypes:function(){return["Array"]},dispose:function(){this._selectionRequestEvent&&this.removeEvent(this._selectionRequestEvent,this._onSelectionChangeRequested),this._componentLogic&&this._componentLogic.removeEvent("selectionChanged",this._onSelectionChanged),this.parent()}})}),define.Class("wixapps.integration.proxies.TableProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_bodyCellHookMethod","_headerAndFooterCellHookMethod"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._proxyFactory=this._viewContext.getEnvironment().getProxyFactory(),this._columnsDefinition=this._getColumnsDef()},createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.TableComponent",this._createRawData(),{SequencingHook:this._bodyCellHookMethod,HeaderFooterSequencingHook:this._headerAndFooterCellHookMethod})},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperty("minHeight"),this._handleProperties(["rowsDataArray","columns"],function(){this._columnsDefinition=this._getColumnsDef(),this._refreshComponentData()})},_bodyCellHookMethod:function(e){var t=this._columnsDefinition[e.index].getChildByRef("item");return this._getCellElement(e.data,t)},_headerAndFooterCellHookMethod:function(e){return e.data?this._getCellElement(this._viewContext,e.data):null},_getCellElement:function(e,t){var i=this._proxyFactory.createProxyFromItemDefinition(e,t).proxy,n=i.createComponent();return i.setupProxy(function(){i.updateLayoutWhenReady()}),n},_createRawData:function(){var e=this._getColumnsDef(),t=this._getRowsListRawData(this._getRowsDataArray(),e),i=this._getHeaderOrFooterRawData(e,"header"),n=this._getHeaderOrFooterRawData(e,"footer");return{type:"Table",items:t,header:i,footer:n}},_getRowsDataArray:function(){var e=this._viewContext;if(this._def.getChildByRef("rowsDataArray")){var t=this._def.getChildValue("rowsDataArray");e=this._data.getChildByRef(t)}return e},_onDataChanged:function(e){this.parent(e),e.phase==Constants.DataItemEventPhase.ON_TARGET&&this._refreshComponentData()},_refreshComponentData:function(){if(this._dataItem){var e=this._createRawData();this._dataItem.setData(e),this._dataItem.setMeta("isPersistent",!1)}},_getColumnsDef:function(){return this._def.getChildByRef("columns").getChildren()},_getRowsListRawData:function(e,t){var i=[];return e.getChildren().forEach(function(e){for(var n=[],a=0;t.length>a;a++)n[a]={data:this._viewContext.newContextForData(e),index:a,styleData:t[a].getChildValue("item").styleData};i.push(n)}.bind(this)),i},_getHeaderOrFooterRawData:function(e,t){var i=!1,n=[];return e.forEach(function(e,a){var s=e.getChildByRef(t);s?(i=!0,n.push({data:s,index:a})):n.push({data:null,index:a})}),i?n:null},_getPropSchemaName:function(){return"TableComponentProperties"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.table.TableComponentDefaultSkin"},_getDefaultStyleName:function(){return"tblc1"}})}),define.Class("wixapps.integration.proxies.TagInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),t.binds(["_tagClick","_tagMouseOver","_tagMouseOut","_tagsReceived","_userTyped"]);var i=0;t.fields({_uid:null,_tags:null,_visibleTags:null}),t.methods({initialize:function(e,t,n,a){this._uid=a+ ++i,e.getEnvironment().getEventsDispatcher().addEvent(this._uid+"_tag_click",this._tagClick),e.getEnvironment().getEventsDispatcher().addEvent(this._uid+"_tag_mouse_over",this._tagMouseOver),e.getEnvironment().getEventsDispatcher().addEvent(this._uid+"_tag_mouse_out",this._tagMouseOut),e.getEnvironment().getEventsDispatcher().addEvent(this._uid+"_input_changed",this._userTyped),this.parent(e,t,n,a)},_rewriteDefinition:function(e,t,i,n){this._tags||(i.getEnvironment().setVar(this._uid+"_tagList",[]),this._updateTags());var a=this,s={id:n+"_input",comp:{name:"StringArrayInput",joinSeparator:", ",splitRegex:"\\s*[,;]\\s*",conversion:"toLower",events:{inputChanged:a._uid+"_input_changed"}}};
t.data&&(s.data=t.data),t.value&&(s.value=t.value);var o={id:n+"_tagContainer",comp:{name:"HBox",css:{"box-align":"baseline"},items:[{id:n+"_tag",comp:{name:"Label",color:"#379ACF",events:{"dom:click":a._uid+"_tag_click","dom:mouseover":a._uid+"_tag_mouse_over","dom:mouseout":a._uid+"_tag_mouse_out"}},layout:{cursor:"pointer",spacerAfter:10}}]}},r={id:n+"_cssForInline",comp:{name:"Css",items:[o],css:{display:"inline-block"}}},l={id:n+"_tagList",data:"$"+a._uid+"_tagList",comp:{name:"List2",templates:{item:r}}};return{name:"VBox",items:[s,l]}},_tagClick:function(e){var t=e.data.getValue(0),i=this._data.getValue();this._lastStringValue=this._lastStringValue||"";var n=this._lastStringValue.split(",").pop().trim();0==t.indexOf(n)&&i[i.length-1]==n&&i.pop(),i.push(t),this._data.setValue(i),this._updateVisibleTags()},_tagMouseOver:function(e){var t=e.sender.getElement().getElements("span")[0];t.setStyle("text-decoration","underline")},_tagMouseOut:function(e){var t=e.sender.getElement().getElements("span")[0];t.setStyle("text-decoration","none")},_updateTags:function(){var e=this._origDef.getChildValue("tagFullFieldName").split(".");if(3!=e.length)throw"'tagFullFieldName' definition should be collectionId.typeName.field to group by for the tags";var t=e[0],i=e[1],n=e[2],a={};this._getDataService().groupByAndCount(t,i,a,n,this._tagsReceived,function(){})},_onDataChanged:function(){},_userTyped:function(e){this._lastStringValue=e.cause.value;var t=this._lastStringValue.split(",").pop();t=t.trim(),this._updateVisibleTags(t)},_getDataService:function(){return this._viewContext.getEnvironment().getProxyFactory().getHostingComponent().getEnvironment().getDataService()},_tagsReceived:function(e){var t=e.getValue();this._tags=Object.keys(t).sort(function(e,i){return t[e]>t[i]?-1:t[e]==t[i]?0:1}),this._updateVisibleTags()},_updateVisibleTags:function(e){var t=this._data.getValue().slice(),i=this._tags;e&&(i=i.filter(function(t){return 0==t.indexOf(e)})),i=i.filter(function(e){return!t.contains(e)}),i=i.slice(0,10),this._viewContext.getEnvironment().setVar(this._uid+"_tagList",i)},dispose:function(){this._viewContext.getEnvironment().getEventDispatcher().removeEvent(this._uid+"_tag_click",this._tagClick),this._viewContext.getEnvironment().getEventDispatcher().removeEvent(this._uid+"_tag_mouse_over",this._tagMouseOver),this._viewContext.getEnvironment().getEventDispatcher().removeEvent(this._uid+"_tag_mouse_out",this._tagMouseOut),this._viewContext.getEnvironment().getEventDispatcher().removeEvent(this._uid+"_input_changed",this._userTyped),this.parent()}})}),define.Class("wixapps.integration.proxies.TextAreaProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.TextInputProxy"),t.binds(["_onValidation"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){var e=this._createRawData(),t={maxLength:this._def.getChildValue("maxLength")};return this._createWixComponent("wysiwyg.viewer.components.inputs.TextAreaInput",e,t)},_onValidation:function(e){if(this._componentLogic&&e){if(e.valid)this._componentLogic.setValidationState(!0);else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(t)}this._componentLogic.setValidationState(e.valid)}},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.input.TextAreaInputSkin",style:"wa_tai1"},ecomTextArea:{skin:"wixapps.integration.skins.ecommerce.inputs.TextAreaInputSkin",style:""}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style}})}),define.Class("wixapps.integration.proxies.TextInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onValidation"]),t.methods({createComponent:function(){var e=this._createRawData(),t=document.createElement("div");return t.innerHTML=e.text,e.text=t.innerText||t.text||t.textContent,this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this._createWixComponent("wixapps.integration.components.inputs.TextInput",e)},_getPropSchemaName:function(){return"TextInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["label","placeholder"])},_createRawData:function(){var e=this._data.getValue();return{type:"Text",text:e}},_onComponentWixified:function(){},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._data.getValue())},_onComponentDataChanged:function(e,t,i){this._ignoreUpdate=!0,this._data.setValue(i.text),this._ignoreUpdate=!1},_onValidation:function(e){if(this._componentLogic)if(e.valid)this._componentLogic.resetInvalidState();else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(t)}},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.appinputs.AppsTextInputSkin",style:"wa_ti1"},ecomTextInput:{skin:"wysiwyg.viewer.skins.appinputs.EcomTextInputSkin",style:"ecom_ti1"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style}})}),define.Class("wixapps.integration.proxies.TimeSelectorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onValidation"]),t.methods({createComponent:function(){this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation);var e="wixapps.integration.components.inputs.TimeInput";this.useSkinsInsteadOfStyles();var t=this._getIsoDate();return this._createWixComponent(e,{type:"Text",text:t})},_getPropSchemaName:function(){return"TimeInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["resolution","hourFormat","allowEmpty"])},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.TimeInputSkin"},_getIsoDate:function(){var e=this._data.getValue(),t=new Date(e.iso);return this._allowEmpty()||!isNaN(t.getTime())&&t.getDate()!=new Date(0).getDate()||(e.iso=(new Date).toISOString(),this._data.setValue(e)),e.iso},_onDataChanged:function(){!this._userInputChange&&this._element&&this._element.getLogic()&&this._element.getLogic().getDataItem().set("text",this._getIsoDate())},_onComponentDataChanged:function(){var e=this._element.getLogic().getDataItem().get("text");this._userInputChange=!0,this._data.setValue({_type:"wix:Date",iso:e}),this._userInputChange=!1},_onValidation:function(e){if(this._componentLogic)if(e.valid)this._componentLogic.resetInvalidState();else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(t)}},_allowEmpty:function(){return!(this._def.getChildValue("allowEmpty")===!1||"false"===this._def.getChildValue("allowEmpty"))},_getAcceptableDataTypes:function(){return["wix:Date"]}})}),define.Class("wixapps.integration.proxies.ToggleProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_handlePeerToggleEvent","toggle"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._loadTemplates()},createComponent:function(){var e=this._viewContext.getEnvironment().getProxyFactory();this._initialState=this.getViewDefinition().getChildValue("initialState")||"off";var t=e.createProxyFromItemDefinition(this._viewContext,this._onTemplate).proxy,i=e.createProxyFromItemDefinition(this._viewContext,this._offTemplate).proxy;this._childrenLeftToBeReady=1;var n=function(e){e.grab(t.createComponent()),t.setupProxy(this._onChildReady)}.bind(this),a=function(e){e.grab(i.createComponent()),i.setupProxy(this._onChildReady)}.bind(this);this._toggleTriggerEvent=this._def.getChildValue("toggleTriggerEvent");var s=this._createWixComponent("wixapps.integration.components.Toggle",void 0,{createOnHook:n,createOffHook:a,initialState:this._initialState,listensToPartsClick:!this._toggleTriggerEvent});if(this._toggleTriggerEvent){var o=this._def.getChildValue("toggleTriggerScope")||"same";this.addEventFilteredByScope(o,this._toggleTriggerEvent,this.toggle)}return s},_onComponentWixified:function(){this._componentLogic.addEvent("wix:toggle",function(e){this.fireEvent("wix:toggle",{state:e.state,toggleGroup:this.getToggleGroup()}),this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE)}.bind(this)),this.addEventFilteredByScope(this.getToggleScope(),"wix:toggle",this._handlePeerToggleEvent)},getToggleGroup:function(){return this.getViewDefinition().getChildValue("toggleGroup")},getToggleScope:function(){return this.getViewDefinition().getChildValue("toggleScope")},turnOff:function(){this._componentLogic.turnOff()},turnOn:function(){this._componentLogic.turnOn()},toggle:function(){this._componentLogic.toggle()},_setupPropertyHandlers:function(){this._handleProperties(["initialState"],function(){this._loadTemplates();var e=this.getViewDefinition().getChildValue("initialState")||"off";e!=this._initialState&&(this._initialState=e,"on"==e?this.turnOn():this.turnOff())})},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._onTemplate=this._getItemTemplate("on")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_on",comp:{}},this._def),this._offTemplate=this._getItemTemplate("off")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_off",comp:{}},this._def)},_getItemTemplate:function(e){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(e)},_handlePeerToggleEvent:function(e){var t=e.state,i=e.toggleGroup;e.sender!=this&&"on"==t&&i&&i==this.getToggleGroup()&&this.turnOff()},_getDefaultSkinName:function(){return"wixapps.integration.skins.ToggleSkin"},dispose:function(){this._toggleTriggerEvent&&this.removeEvent(this._toggleTriggerEvent,this.toggle),this.removeEvent("wix:toggle",this._handlePeerToggleEvent),this.parent()}})}),define.Class("wixapps.integration.proxies.TooltipIconProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.IconProxy"),t.resources(["W.Commands","W.Data","W.Utils"]),t.fields({_tooltipsData:null,_tooltipId:null}),t.methods({createComponent:function(){return this._tooltipsData=this.resources.W.Data.getDataByQuery("#TOOLTIPS.toolTips"),this._createTooltipData(),this.parent()},_createTooltipData:function(){if(null!==this._tooltipId)throw"Tooltip data item already exists.";this._tooltipId=this._def.getChildValue("tooltipId");var e=this._def.getChildValue("tooltipValue");void 0!==e&&(this._tooltipId=this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId("wixapps_tooltip"),this._tooltipsData.set(this._tooltipId,{isMoreLess:!1,isDontShowAgain:!1,content:"<p>"+e+"</p>",isPublished:!0,help:{isMoreHelp:!1,text:null,url:""}}))},_onComponentWixified:function(){var e=this,t=this._element;t.addEvent("mouseenter",function(){e.resources.W.Commands.executeCommand("Tooltip.ShowTip",{id:e._tooltipId},t)}.bind(this)),t.addEvent("mouseleave",function(){e.resources.W.Commands.executeCommand("Tooltip.CloseTip")}.bind(this))}})}),define.Class("wixapps.integration.proxies.UnstyledLabelProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.LabelProxy"),t.resources(["W.Data"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n),this._stylesMap=this.resources.W.Data.getDataByQuery("#WIXAPPS_EDITOR_STYLES")},_createFormattedText:function(){var e=this.parent(),t=new Element("div");return t.innerHTML=e,this._removeStyleAttributesFromSpans(t),this._replaceAllStylesWithDefault(t),t.innerHTML},_removeStyleAttributesFromSpans:function(e){var t=e.getElements("span");t.forEach(function(e){e.removeAttribute("style"),e.removeAttribute("class")})},_getDefaultStyleElement:function(){var e=this._getBlockDefaultStyledElement();return{outerElement:e,innerElement:e}},_getBlockDefaultStyledElement:function(){var e=this._stylesMap.get("items").div.cssClass,t=this._getSeoTagForStyleCssClass(e);return new Element(t,{"class":e})},_replaceAllStylesWithDefault:function(e){var t=this._stylesMap.get("items").div.cssClass,i=e.getElements('[class*="font_"]');i.forEach(function(e){var i=e.getAttribute("class");i=i.replace(/\bfont_\d\b/gi,t),e.setAttribute("class",i)})}})}),define.Class("wixapps.integration.proxies.VerticalLineProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.methods({createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.VerticalLine",void 0,void 0,void 0)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.VerticalLineSkin"},_getDefaultStyleName:function(){return"vl1"}})}),define.Class("wixapps.integration.proxies.VerticalListEditorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.VerticalListProxy"),t.binds(["onDragItemCopyCreated","disposeDragItemCopy"]),t.methods({initialize:function(e,t,i,n){this.parent(e,t,i,n);var a=i.getChildValue("dragEnabled");this._repeaterArgs.dragEnabled="false"!==a&&this._dragEnabled!==!1,this._repeaterArgs.dragEventHandler=this,this._repeaterArgs.maxDragIndex=i.getChildValue("maxDragIndex")},onDragItemCopyCreated:function(e){var t=e.getViewProxy();t.setupProxy()},disposeDragItemCopy:function(e){var t=e.getViewProxy();this._undisposedChildren.erase(t),t.dispose()},getRepeaterClass:function(){return"wixapps.integration.components.VerticalListEditor"},_getDefaultStyleName:function(){return void 0},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.VerticalListEditorSkin"}})}),define.Class("wixapps.integration.proxies.VerticalListProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ListProxy"),t.fields({_stylesMap:{"default":{style:"vr1"},ecomOptionsList:{style:null}}}),t.methods({getRepeaterClass:function(){return"wysiwyg.viewer.components.VerticalRepeater"},setComponentStyles:function(e){return e.setStyles({display:"flex","flex-direction":"column"}),e},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_onComponentWixified:function(){this.parent();var e=this._componentLogic.getSkinPart("inlineContent");e&&(e.$flexPolyfill||this.imports.BoxFlexPolyfill.applyBoxFlexPolyfill(e),e.setStyles({display:"flex","flex-direction":"column"}))}})}),define.Class("wixapps.integration.proxies.VideoProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),t.methods({createComponent:function(){var e=this._createRawData(this._data.getValue()),t={type:"Video"};return this._createWixComponent("wysiwyg.viewer.components.Video",e,void 0,t)},_createRawData:function(e){var t={type:"Video",videoId:e.videoId,videoType:e.videoType};return t},_getPropSchemaName:function(){return"VideoProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["autoplay","loop","showinfo","lightTheme","showControls"])},_onDataChanged:function(){if(this._componentLogic&&!this._ignoreUpdate){var e=this._data.getValue(),t=this._componentLogic.getDataItem();t.set("videoId",e.videoId,!0),t.set("videoType",e.videoType,!0),t.fireDataChangeEvent()}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.video.VideoDefault"},_getDefaultStyleName:function(){return"vl"}})}),define.Class("wixapps.integration.proxies.VideoSelectorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.TextInputProxy"),t.binds(["_onComponentDataChanged","_onInputBlur"]),t.traits(["wysiwyg.viewer.components.traits.VideoUtils"]),t.methods({_onComponentWixified:function(){this._componentLogic.addEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},_onInputBlur:function(){this._componentLogic&&(this._ignoreUpdate=!0,this._componentLogic.getDataItem().set("text",this._getVideoUrlForInput()),this._ignoreUpdate=!1)},_createRawData:function(){return{type:"Text",text:this._getVideoUrlForInput()}},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._getVideoUrlForInput())},_onComponentDataChanged:function(e){if(!this._ignoreUpdate){this._ignoreUpdate=!0;var t=this._getDefaultVideo();if(0===e.get("text").trim().length&&t)this._data.setValue(t);else{var i=this._getVideoDataFromVideoUrl(e.get("text"));i&&i.videoType&&i.videoId&&(i._type="wix:Video",this._data.setValue(i))}this._ignoreUpdate=!1}},_getVideoUrlForInput:function(){var e=this._getDefaultVideo(),t=this._data.getValue(),i=e&&t.videoId===e.videoId&&t.videoType===e.videoType;return i?"":this._getVideoUrlFromVideoData(this._data.getValue())},_getDefaultVideo:function(){return this._def.getChildValue("defaultVideo")}})}),define.Class("wixapps.integration.proxies.VideoThumbProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.ImageProxy"),t.binds(["_showPic"]),t.traits(["wysiwyg.viewer.components.traits.VideoUtils"]),t.methods({_createRawData:function(){var e=this._data.getValue(),t=this._getServices()[e.videoType],i="84770f_7ce1ddb86000aefa86f1a05553079857.jpg_256";return i=t.getPreviewUrl(e.videoId,this._showPic)||i,{type:"Image",uri:i,title:"",width:480,height:360}},_onDataChanged:function(){var e=this._createRawData();this._showPic(e.uri)},_showPic:function(e){this._componentLogic?this._componentLogic.getDataItem().set("uri",e):this._videoThumbUrl=e},_onComponentWixified:function(){this._element.addClass("videoIndicator"),this._showPic(this._videoThumbUrl),this.parent()}})}),define.Class("wixapps.integration.proxies.WArrayProxy",function(e){var t=e;t.inherits("wixapps.core.views.proxies.ArrayProxy"),t.traits(["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"]),t.methods({})}),define.Class("wixapps.integration.proxies.WCompositeProxy",function(e){var t=e;t.inherits("wixapps.core.views.proxies.CompositeProxy"),t.traits(["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"]),t.methods({})}),define.Class("wixapps.integration.proxies.WIntegrationTrait",function(e){var t=e;t.utilize(["wixapps.integration.utils.flex.BoxFlexPolyfill"]),t.binds(["_onStyleChangeInternal","_onSkinChange","_onAutoSizeChange","_onHover","_onHoverOut","_onWixComponentWixifiedInternal"]),t.fields({_dataItem:null,_element:null,_initArgs:null,_componentLogic:null,_applyAfterWixifiedActions:[],_prefix:"",_onReadyCallback:null,_childrenLeftToBeReady:0,_useSkinsInsteadOfStyles:!1,_cssPropDict:{},_lifecycleManager:null,_nativeEventHandlers:[]}),t.methods({initialize:function(){W&&W.Viewer&&W.Editor&&this.useSkinsInsteadOfStyles();var e=(this.injects().Utils.getCSSBrowserFeature("boxOrient")||"")+"";e&&(this._prefix=e.match(/^\-[a-z]+\-/)[0]||"")},_createElement:function(e){var t,i=this;this._lifecycleManager=this._viewContext.getEnvironment().getLifecycleManager();var n=this._viewContext.getEnvironment();t=new Element(e||this._getViewElement()),t.getViewProxy=function(){return i},t.$viewProxy=i,t.setAttribute("hasProxy","true"),t.setAttribute("vctype",n.getForType()),t.setAttribute("vcview",n.getViewName()),t.setAttribute("vcfield",this.getFieldId()),t.setAttribute("pos",this._getDefaultPosition()),this._element=t,this.imports.BoxFlexPolyfill.applyBoxFlexPolyfill(this._element);var a=this._def.getChildValue("cssClass");a&&(t.addClass(a),this._cssClass=a);var s=this._def.getChildValue("hidden");("true"==s||s===!0)&&t.collapse();var o=this._def.getChildValue("hoverVar");return o&&(this._viewContext.getEnvironment().setVar(o,!1),t.addEvent("mouseover",this._onHover),t.addEvent("mouseout",this._onHoverOut)),this._nativeEventHandlers.forEach(function(e){t.addEvent(e.type,e.handler)}),t},_createWixComponent:function(e,t,i){i=i||{},this._initArgs=i,this._isWixificationPending=!0;var n,a,s=this._createCompProperties()||{};!this._def.getChildValue("style")&&this._def.getChildValue("skin")&&this.useSkinsInsteadOfStyles(),a=this._def.getChildValue("style")||this._getDefaultStyleName(),n=this._def.getChildValue("skin")||this._getDefaultSkinName(),this._styleNameSpace=this._def.getChildValue("styleNS")||this._getDefaultStyleNameSpace(),this._initArgs.styleNameSpace=this._styleNameSpace;var o=this._createElement();if(this._lifecycleManager.notifyComponentCreated(o),o.setAttribute("comp",e),a&&!this._useSkinsInsteadOfStyles&&o.setAttribute("styleid",a),o.setAttribute("skin",n),t&&(this._dataItem=W.Data.createDataItem(t),this._dataItem.setMeta("isPersistent",!1),this._dataItem.addEvent(Constants.DataEvents.DATA_CHANGED,this._onComponentDataChanged)),s.type){var r=W.ComponentData.addDataItemWithUniqueId("wixApps",s);r&&(r.dataObject.setMeta("isPersistent",!1),o.setAttribute("propertyquery","#"+r.id))}return o.addEvent(Constants.ComponentEvents.WIXIFIED,this._onWixComponentWixifiedInternal),o.addEvent(Constants.ComponentEvents.READY,function(){this._onWixComponentReadyInternal(o)}.bind(this)),o},isWixificationPending:function(){return this._isWixificationPending},useSkinsInsteadOfStyles:function(){this._useSkinsInsteadOfStyles=!0},updateLayoutWhenReady:function(e){this._lifecycleManager.performAction(e||this._lifecycleManager.getDefaultInvalidateLayoutAction())},setupProxy:function(){this._applyCssNode(this._element),this._children&&this._children.each(function(e){e.setupProxy()}.bind(this)),this._componentLogic||(this._element.wixify&&this._element.get("comp")?this._element.wixify(this._initArgs,this._dataItem,"vwprxy"):this._element.wixifySubElement&&this._element.wixifySubElement(this._initArgs,this._dataItem,"vwprxy"));var e=this;window.requestAnimFrame(function(){e._disposed||e._onProxySetup()})},_onReady:function(){},_onWixComponentWixifiedInternal:function(e){this._disposed||(this._componentLogic=e,this._updateComponentState(),this._applyAccumulatedPropertyChanges(),this._onComponentWixified(),this._registerStyleChangeHandler(),this._applyAfterWixifiedActions.forEach(function(e){e.apply(this)}.bind(this)),this._applyAfterWixifiedActions=[],this._componentLogic.addEvent("autoSizeChange",this._onAutoSizeChange),this._isWixificationPending=!1)},_onWixComponentReadyInternal:function(e){this._defferedDataChangeEvent&&this._onDataChanged(this._defferedDataChangeEvent),this._onWixComponentReadyInternalNotifyLifecycle(e)},_onWixComponentReadyInternalNotifyLifecycle:function(e){this._lifecycleManager.notifyComponentReady(e)},_onAutoSizeChange:function(){this._viewContext.getEnvironment().getEventsDispatcher().fireEvent("innerCompResize",this._componentLogic)},_onHover:function(){var e=this._def.getChildValue("hoverVar");this._viewContext.getEnvironment().setVar(e,!0)},_onHoverOut:function(){var e=this._def.getChildValue("hoverVar");this._viewContext.getEnvironment().setVar(e,!1)},_registerProxyEvents:function(e,t){0===e.indexOf("dom:")?this._nativeEventHandlers.push({type:e.slice(4),handler:t}):this._applyAfterWixified(function(){this._componentLogic.addEvent(e,t)}.bind(this))},_applyAfterWixified:function(e){this._componentLogic?e.apply(this):this._applyAfterWixifiedActions.push(e)},_onComponentWixified:function(){},_onComponentDataChanged:function(){},_onDataChangedInternal:function(e){if(!this._disposed){if(this._isWixificationPending===!0)return this._defferedDataChangeEvent=e,void 0;this.parent(e),this._componentLogic&&!this._componentLogic.getIsDisplayed()&&this._componentLogic.invalidateComponent&&this._componentLogic.invalidateComponent()}},_onProxySetup:function(){},setWidth:function(e){this._element.setStyle("width",e)},getWidth:function(){return this._element.getWidth()},getHeight:function(){return this._element.getHeight()},setPos:function(e,t){this._element.setStyles({left:e,top:t})},_getViewElement:function(){return"div"},_getDefaultStyleName:function(){return""},_getDefaultSkinName:function(){return""},_getDefaultStyleNameSpace:function(){return null},refreshSize:function(){},_onLayoutChange:function(){},_applyStyle:function(e,t){if(e){var i={};Object.each(t,function(e,t){("width"==t||"height"==t)&&("string"!=typeOf(e)||String.contains(e,"%")||"auto"===e||(e=parseInt(e,10))),i[t]=e}.bind(this)),e.setStyles(i)}},_registerStyleChangeHandler:function(){this._styleObj&&(this._styleObj.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.removeEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange)),this._styleObj=this._componentLogic.getStyle(),this._styleObj&&(this._styleObj.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.addEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange))},_onStyleChangeInternal:function(e){this._onStylePropertiesChange(e.properties)},_onSkinChange:function(){},_onStylePropertiesChange:function(){},_isLayoutBasedWidth:function(){var e=this._def.getParent().getChildValue("layout");if(this._getImplicitDimensions().contains("width"))return!1;if(e&&("width"in e||"zoomExpand"in e))return!0;var t=this.getParentProxy(),i=t&&t.getLayoutOrientation?t.getLayoutOrientation():"";return"vertical"===i?!0:"horizontal"===i?Boolean(e&&("box-flex"in e||"flex"in e)):!1},_isLayoutBasedHeight:function(){var e=this._def.getParent().getChildValue("layout");if(this._getImplicitDimensions().contains("height"))return!1;if(e&&"height"in e)return!0;var t=this.getParentProxy(),i=t&&t.getLayoutOrientation?t.getLayoutOrientation():"";return"horizontal"===i?t?t._isLayoutBasedHeight():!0:"vertical"===i?e&&("box-flex"in e||"flex"in e):!1},_isCompBasedWidth:function(){return!this._isLayoutBasedWidth()},_isCompBasedHeight:function(){return!this._isLayoutBasedHeight()},_getImplicitDimensions:function(){return[]},_getParentLayoutOrientation:function(){var e=this.getParentProxy();return e&&e.getLayoutOrientation?e.getLayoutOrientation():void 0},_isNBC:function(){return this._componentLogic?!!this._componentLogic.NEW_BASE_COMP:!1},getParentProxy:function(){for(var e=this._element.parentNode;e;){if(e.hasAttributes("hasproxy"))return e.$viewProxy;e=e.parentNode}return null},getProxyMetaTags:function(){return[]},hasMetaTag:function(e){return this.getProxyMetaTags().contains(e)},_getDefaultPosition:function(){return""},getCompLogic:function(){return this._componentLogic},getElement:function(){return this._element},getSourceSize:function(){return void 0},hasFixedAspectRatio:function(){return!1},getAspectRatio:function(){return 0/0},dispose:function(){this._disposed||(this._isWixificationPending=!1,this._dataItem&&this._dataItem.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onComponentDataChanged),this._children&&this._children.forEach(function(e){e.dispose()}),this._deactivateResizeMechanism&&this._deactivateResizeMechanism(this._element),this._styleObj&&(this._styleObj.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.removeEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange),this._styleObj=null),this._nativeEventHandlers.forEach(function(e){this._element.removeEvent(e.type,e.handler)}.bind(this)),this._nativeEventHandlers=null,this._element.removeEvent("mouseover",this._onHover),this._element.removeEvent("mouseout",this._onHoverOut),this._componentLogic?this._componentLogic.dispose():this._element.destroy(),this._dataItem=null,this._componentLogic=null,this._element=null,this.parent())}})}),define.Class("wixapps.integration.proxies.WProxy",function(e){var t=e;t.inherits("wixapps.core.views.proxies.Proxy"),t.traits(["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"]),t.methods({})}),define.Class("wixapps.integration.proxies.ZoomLinkProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.binds(["_onClicked"]),t.fields({_eventString:"wix:zoom-link:open-zoom"}),t.methods({createComponent:function(){var e=this.parent();return e.addEvent("click",this._onClicked),e},_getContainerElementType:function(){return"a"},_dispose:function(){this._element&&this._element.removeEvent("click",this._onClicked)},_onClicked:function(){var e=this._data,t=this._def.getChildValue("listExpression"),i=t?this._viewContext.evaluatePath(t).getChildren():[e],n=this._def.getChildValue("idField")||"_iid",a=this._def.getChildValue("titleField")||"title",s=this._getZoomParams(i,e,a,n);return this.fireEvent(this._eventString,{zoomParams:s}),!1},_getZoomParams:function(e,t,i,n){i=i||"title",n=n||"_iid";var a=t.getChildByRef(n).getValue(),s=e.map(function(e){return{id:e.getChildByRef(n).getValue(),title:e.getChildByRef(i).getValue()}}),o=s.getIndexByField("id",a),r={hideNextPrevBtns:this._def.getChildValue("hideNextPrevBtns")===!0||"true"===this._def.getChildValue("hideNextPrevBtns")};return{list:s,selectedIndex:o,extraParams:r}}})}),define.Class("wixapps.integration.proxies.layout.BoxLayoutProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.CssLayoutProxy"),t.fields({_prefix:"",_orientation:"vertical",_spacers:[],_alignPropMap:{vertical:{left:"start",center:"center",right:"end"},horizontal:{top:"start",middle:"center",bottom:"end",left:"start",center:"center",right:"end",baseline:"baseline"}}}),t.methods({createComponent:function(){var e=this.parent();return this._applyBoxStyles(e),e},_applyBoxStyles:function(e){this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation(),e.setStyles({display:"box","box-orient":this._orientation}),this._updateBoxAlign()},getLayoutOrientation:function(){return this._orientation},_getDefaultOrientation:function(){return"HBox"===this._def.getChildValue("name")?"horizontal":"vertical"},_reloadProxy:function(){this._spacers.forEach(function(e){void 0!==e&&Object.each(e,function(e){e.onRemove()})}),this._spacers=[],this._applyBoxStyles(this._element),this.parent()},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("box-align",this._updateBoxAlign),this._handleProperty("orientation",function(e){this._orientation=e,this._reloadProxy()})},_updateBoxAlign:function(){var e=this._def.getChildValue("box-align");e&&this._getLayoutRootElement().setStyle("box-align",this._translateBoxAlignValues(this._orientation,e))},_translateBoxAlignValues:function(e,t){return this._alignPropMap[e][t]},_processChildLayoutDef:function(e,t){return this._processSpacers(this._components[t],e,t),e},_processSpacers:function(e,t,i){this._processSpacer(e,t,i,"before"),this._processSpacer(e,t,i,"after")},_processSpacer:function(e,t,i,n,a){var s="before"==n?"spacerBefore":"spacerAfter",o=void 0!==t[s]?t[s]:t.spacer;void 0===o&&(o="none");var r=this._spacers[i]||{},l=this._getLayoutRootElement();if(e){if(e.getViewProxy){var p=e.getViewProxy().isHidden();(p===!0||"true"===p)&&(o="none")}}else o="none";if(r[n]&&"none"==o)r[n].onRemove(),delete r[n];else if(r[n]||"none"==o){if(!r[n]&&"none"==o)return;r[n].updateSize(o)}else{var d=e.getViewProxy(),h=this._children[i].getFieldId()+"_spacer_"+n,c={id:h,comp:{name:"vertical"==this._orientation?"VSpacer":"HSpacer",hidden:!1,size:o},layout:{}};d.hasClassAncestor("wixapps.integration.components.InlineText")&&(c.comp.name="InlineSpacer");var u=this._viewContext.getEnvironment(),m=u.getDataItemFactory().createDataItem(c),g=u.getProxyFactory().createProxyFromItemDefinition(this._viewContext,m).proxy,_=g.createComponent();_.updateSize=function(e){m.getChildByRef("comp").getChildByRef("size").setValue(e)},_.onProxyDefChange=function(){m.getChildByRef("comp").getChildByRef("hidden").setValue(d.isHidden())},_.onRemove=function(){d.getViewDefinition().removeEvent(Constants.DataItemEvents.CHANGE,_.onProxyDefChange),_.destroy()},d.getViewDefinition().addEvent(Constants.DataItemEvents.CHANGE,_.onProxyDefChange),r[n]=_;
var f=m.getChildValue("layout");if(_.setStyles(f),a)l.appendChild(_);else if("before"==n)l.insertBefore(_,this._components[i]);else{var y=this._components[i].nextSibling;y?l.insertBefore(_,y):l.appendChild(_)}g.setupProxy(),this.updateLayoutWhenReady()}this._spacers[i]=r},_applyLayoutsAsCss:function(e){var t={};this._def.getParent().getParent()||(t=this._def.getParent().getChildValue("layout")||{}),t=this._processLayoutDef(t)||t,this._applyStyle(e,t);var i=this._def.getChildValue("childLayout")||{},n=null,a=this._def.getChildByRef("items");for(a&&(n=a.getChildren());e.lastChild;)e.removeChild(e.lastChild);for(var s=0;this._components.length>s;s++){var o=this._components[s];if(this._applyStyle(o,i),n){var r=n[s].getChildValue("layout")||{};this._processSpacer(o,r,s,"before",!0),this._applyStyle(o,r),e.appendChild(o),this._processSpacer(o,r,s,"after",!0)}else e.appendChild(o)}},_onChildLayoutPropertyChange:function(e){for(var t=0;e.length>t;t++){var i=e[t],n=i.path[0],a=parseInt(i.path[2],10);if(!isNaN(a)){var s={};s[n]=i.item.getValue(),0===n.indexOf("spacer")?(("spacer"==n||"spacerBefore"==n)&&this._processSpacer(this._components[a],s,a,"before"),("spacer"==n||"spacerAfter"==n)&&this._processSpacer(this._components[a],s,a,"after")):(this._applyStyle(this._components[a],s),this.getViewContext().getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,{proxy:this}))}}this.parent(e)},_finalizeLayout:function(){}})}),define.Class("wixapps.integration.proxies.layout.CssLayoutProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WCompositeProxy"),t.fields({_nativeEvents:[]}),t.methods({createComponent:function(){var e=this._createElement(this._getContainerElementType());return this._nativeEvents.forEach(function(t){e.addEvent(t.type,t.fn)}),this._createChildComponents(e),e},_createChildComponents:function(e){this._createChildProxies(),e.set("html",""),this.parent(e);var t=this._def.getChildByRef("items");if(t)var i=t.getChildren();this._children.forEach(function(e,t){var n=i[t].getChildValue("layout");if(n){var a=this._components[t];n.hasOwnProperty("width")&&!(n.width+"").contains("%")&&a.setAttribute("width",parseInt(n.width,10)),n.hasOwnProperty("height")&&!(n.height+"").contains("%")&&a.setAttribute("height",parseInt(n.height,10))}}.bind(this))},_getContainerElementType:function(){return"div"},_onProxySetup:function(){var e=this._getLayoutRootElement();e&&this._setupBox(e),this.updateLayoutWhenReady()},_setupBox:function(e){this._applyLayoutsAsCss(e)},_applyLayoutsAsCss:function(e){var t={};this._def.getParent().getParent()||(t=this._def.getParent().getChildValue("layout")||{}),t=this._processLayoutDef(t)||t,this._applyStyle(e,t);var i=this._def.getChildValue("childLayout")||{};this._components.forEach(function(e){this._applyStyle(e,i)}.bind(this));var n=this._def.getChildByRef("items");if(n){var a=n.getChildren();this._children.forEach(function(e,t){var i=a[t].getChildValue("layout")||{};i=this._processChildLayoutDef(i,t)||i,this._applyStyle(this._components[t],i)}.bind(this))}},_processLayoutDef:function(e){return e},_processChildLayoutDef:function(e){return e},_registerProxyEvents:function(e,t){this.parent(e,t),this._nativeEvents.push({type:e,fn:t})},_reloadProxy:function(){this.parent(),this._createChildComponents(this._getLayoutRootElement()),this.setupProxy()},_onChildLayoutPropertyChange:function(e){if(this._getLayoutRootElement())for(var t,i=0;e.length>i;i++){var n=e[i],a=n.path[0],s=parseInt(n.path[2],10);t={},t[a]=n.item.getValue(),this._applyStyle(this._components[s],t)}},_getLayoutRootElement:function(){return this._element}})}),define.Class("wixapps.integration.proxies.layout.DataEditFieldProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.LinkableRewriteBoxProxy"),t.methods({_rewriteDefinition:function(e,t){return t}})}),define.Class("wixapps.integration.proxies.layout.FieldBoxProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),t.methods({_rewriteDefinition:function(e,t,i,n){var a={},s=t.orientation||"vertical";a.name="Box",a.orientation="vertical"==s?"vertical":"horizontal",a.items=t.items||[],a.events=t.events||{};for(var o=0;a.items.length>o;o++){var r=a.items[o];if(["Field","TextField"].contains(r.comp.name)){r.comp.orientation=s;var l=i.getEnvironment().getProxyFactory().getProxyClassByName(r.comp.name);if(l.getLayoutDefinitions){var p=l.getLayoutDefinitions(r.comp);r.layout=r.layout||{},r.layout=Object.merge({},r.layout,p)}}}var d="vertical"==s?"VSpacer":"HSpacer",h={id:n+"_pack_start",comp:{name:d,size:0}},c={id:n+"_pack_end",comp:{name:d,size:0}};return a.items.unshift(h),a.items.push(c),"center"===t.pack&&(h.comp.size="*",c.comp.size="*"),"end"===t.pack&&(h.comp.size="*"),a}})}),define.Class("wixapps.integration.proxies.layout.FieldProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.LinkableRewriteBoxProxy"),t.statics({getLayoutDefinitions:function(e){var t={};return e.spacers&&void 0!==e.spacers.before&&(t.spacerBefore=e.spacers.before),e.spacers&&void 0!==e.spacers.after&&(t.spacerAfter=e.spacers.after),t},_isEmptyValue:function(e){var t=this._typeEmptyCheckers[e.getTypeName()];return t&&t(e)},_typeEmptyCheckers:{"wix:Image":function(e){return"http://images/noimage.png"===e.getChildValue("src")},"wix:Video":function(e){return"YOUTUBE"===e.getChildValue("videoType")&&"xLk7JoPDx4Q"===e.getChildValue("videoId")}}}),t.methods({_rewriteDefinition:function(e,t,i,n){if(!t.items||1!==t.items.length)throw"field proxy accepts exactly one child";var a={},s=t.orientation||"vertical",o=t.heightMode||"manual";a.name="Box",a.hidden=t.hidden===!0||"true"===t.hidden||this._isEmptyValue(e),a.orientation="vertical"==s?"horizontal":"vertical",a.items=[],a.events=t.events||{};var r=t.items[0];r.layout=r.layout||{},r.layout.spacerBefore=t.spacers&&t.spacers["xax-before"]||0,r.layout.spacerAfter=t.spacers&&t.spacers["xax-after"]||0;var l=t["box-align"]||"start",p="vertical"==s?"VSpacer":"HSpacer",d={id:n+"_box_align_spacer_before",comp:{name:p,size:0}},h={id:n+"_box_align_spacer_after",comp:{name:p,size:0}};switch(l){case"center":d.comp.size="*",h.comp.size="*";break;case"end":d.comp.size="*"}var c=void 0!==t.width?t.width:100,u=void 0!==t.height?t.height:100,m=0;return t.layout&&t.layout["min-width"]&&(m=t.layout["min-width"]),r.layout.width=m>c?m:c,r.layout["min-width"]=m,r.layout.height="manual"==o?u:"auto",a.items.push(d),a.items.push(this._linkify(r,n,t.pageLink)),a.items.push(h),a},getInnerProxy:function(){var e=this._children&&3==this._children.length&&this._children[1];return e&&e._element&&"a"==e._element.tagName.toLowerCase()?e&&e._children&&e._children.length&&e._children[0]:e}})}),define.Class("wixapps.integration.proxies.layout.FixedRatioLayoutProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.binds(["_onAppResize"]),t.methods({_onAppResize:function(){this._updateLayoutSize()},_onAppViewCreated:function(){this._updateLayoutSize()},getAspectRatio:function(){return this._def.getChildValue("aspectRatio")||1},hasFixedAspectRatio:function(){return!0},_updateLayoutSize:function(){var e=this.getAspectRatio(),t=parseFloat(e);"golden"==e&&(t=1.61803);var i=this._element.getSize();if(this._isLayoutBasedWidth()){var n=Math.floor(i.x/t);this._element.setStyle("height",n)}else{var a=Math.floor(i.y*t);this._element.setStyle("width",a)}}})}),define.Class("wixapps.integration.proxies.layout.LinkableRewriteBoxProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),t.binds(["_onLinksDataChanged"]),t.fields({_linkPath:null}),t.methods({initialize:function(e,t,i,n){this._linkPath=this._getLinkPath(i),this.parent(e,t,i,n);var a=e.evaluatePath("links");a&&a.addEvent(Constants.DataItemEvents.CHANGE,this._onLinksDataChanged)},_onLinksDataChanged:function(e){var t=this._dataItemUtils.createDataChangeEventList(e,this._data),i=t.some(function(e){return e.path.slice(0,2).reverse().join(".")===this._linkPath}.bind(this));if(!i)return this._checkForCleanup(t),void 0;var n=this._origDef.getValue(0),a=this._rewriteDefinition(this._data,n,this._viewContext,this._fieldId);this._def.setValue(a),this._element&&this._element.$flexPolyfill.updateGeometry(),this._flaggedToReloadAfterRewrite&&(this._flaggedToReloadAfterRewrite=!1,this._reloadProxy())},_checkForCleanup:function(e){var t=e.some(function(e){return e.path.slice(0).reverse().join(".")===this._linkPath+"._type"&&"wix:LinkBase"===e.item.getValue()}.bind(this));if(t){var i=this._viewContext.evaluatePath("links"),n=i.getValue(),a=this._linkPath.split(".").pop();delete n[a],i.setValue(n)}},_linkify:function(e,t,i){var n;if(i)n={data:"this",id:t+"_app_link",comp:{name:"AppLink",pageId:i,items:[e]},layout:Object.clone(e.layout)};else{var a=this._getLinkData();if(!a)return e;if("wix:LinkBase"===a.getTypeName())return e;if("wix:PageLink"===a.getTypeName()){var s=W.Data.getDataByQuery("#"+a.getChildValue("pageId"),function(){});if(!s)return e}n={data:this._linkPath,id:t+"_link",comp:{name:"Link",items:[e]},layout:Object.clone(e.layout)}}return delete e.layout.spacer,delete e.layout.spacerBefore,delete e.layout.spacerAfter,n},_getLinkPath:function(e){var t="",i=e.getValue(),n=i.items[0];if(i.hasOwnProperty("link")&&i.link)t+=i.link;else if(n.hasOwnProperty("data")&&n.data)t="links."+n.data;else{var a=e.getParent();t="links."+a.getChildValue("data")}return t},_getLinkData:function(){return this._viewContext.evaluatePath(this._linkPath)},dispose:function(){var e=this._viewContext._data.getChildByRef("links");e&&e.removeEvent(Constants.DataItemEvents.CHANGE,this._onLinksDataChanged),this.parent()}})}),define.Class("wixapps.integration.proxies.layout.OptionalAreaProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),t.methods({_rewriteDefinition:function(e,t,i,n){var a={};a.name=t.name,a.orientation="horizontal"===t.orientation?"horizontal":"vertical",a.events=t.events||{},a.layout=t.layout||{},a.css=t.css||{};var s=e.getValue();return a.items="false"!=s&&s?[{comp:{name:"Area",styleNS:t.styleNS,items:t.items||[]},id:n+"_area",layout:{},css:{}}]:t.items||[],a.hidden=t.hidden===!0||"true"===t.hidden||0==a.items.length,a}})}),define.Class("wixapps.integration.proxies.layout.RewriteBoxProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.binds(["_updateOnOriginalDefinitionChange"]),t.fields({_origName:null,_origDef:null,_flaggedToReloadAfterRewrite:!1,_viewContext:null}),t.methods({initialize:function(e,t,i,n){this._viewContext=e,this._origDef=i;var a=this._rewriteDefinition(t,i.getValue(0),e,n),s=e.getEnvironment().getDataItemFactory().createDataItem(a);s.getParent=function(){return i.getParent()},this._origName=i.getChildValue("name"),this.parent(e,t,s,n),this._origDef.addEvent(Constants.DataItemEvents.CHANGE,this._updateOnOriginalDefinitionChange)},_onDataChanged:function(){this.parent(),this._updateOnOriginalDefinitionChange()},_updateOnOriginalDefinitionChange:function(){var e=this._origDef.getValue(0);if(e.name==this._origName){var t=this._rewriteDefinition(this._data,e,this._viewContext,this._fieldId);this._def.setValue(t),this._element&&this._element.$flexPolyfill.updateGeometry(),this._flaggedToReloadAfterRewrite&&(this._flaggedToReloadAfterRewrite=!1,this._reloadProxy())}},_rewriteDefinition:function(){throw"not implemented (should return the manipulated json definition)"},_requestReloadAfterNextRewrite:function(){this._flaggedToReloadAfterRewrite=!0},dispose:function(){this._origDef.removeEvent(Constants.DataItemEvents.CHANGE,this._updateOnOriginalDefinitionChange),this._origDef=void 0,this.parent()}})}),define.Class("wixapps.integration.proxies.layout.StackLayoutProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.CssLayoutProxy"),t.methods({_processLayoutDef:function(e){e.position="relative"},_processChildLayoutDef:function(e,t){var i="absolute";0===t&&(i="layout"==this._def.getChildValue("stackType")?"absolute":"static"),e.position=e.position||i,e.left=e.left||"0px",e.top=e.top||"0px"}})}),define.Class("wixapps.integration.proxies.layout.SwitchBoxProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),t.methods({_rewriteDefinition:function(e,t){var i={};i.name=t.name,i.orientation="horizontal"===t.orientation?"horizontal":"vertical",i.items=[];var n=""+e.getValue();return i.items=t.cases[n]?t.cases[n]:t.cases["default"],i.hidden=t.hidden===!0||"true"===t.hidden||0==i.items.length,i.events=t.events||{},i.layout=t.layout||{},i.css=t.css||{},i}})}),define.Class("wixapps.integration.proxies.layout.TextFieldProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.LinkableRewriteBoxProxy"),t.statics({defaultManualWidth:150,defaultManualHeight:150,getLayoutDefinitions:function(e){var t={};return"horizontal"===e.orientation&&(t["max-width"]=void 0!==e.width?parseInt(e.width,10):this.defaultManualWidth),e.spacers&&void 0!==e.spacers.before&&(t.spacerBefore=e.spacers.before),e.spacers&&void 0!==e.spacers.after&&(t.spacerAfter=e.spacers.after),t}}),t.resources(["W.Utils"]),t.fields({_lastWidthMode:void 0}),t.methods({_rewriteDefinition:function(e,t,i,n){if(!t.items||1!==t.items.length)throw"field proxy accepts exactly one child";var a=t["width-mode"]||"auto";void 0===this._lastWidthMode&&(this._lastWidthMode=a),this._lastWidthMode!==a&&(this._lastWidthMode=a,this._requestReloadAfterNextRewrite());var s={},o=t.orientation||"vertical";s.name="Box",s.hidden=this._shouldHide(e,t),s.orientation="vertical"==o?"horizontal":"vertical",s.events=t.events||{},s.items=[];var r=t.items[0],l="manual"===a;r.layout=r.layout||{},r.layout.spacerBefore=t.spacers&&t.spacers["xax-before"]||0,r.layout.spacerAfter=t.spacers&&t.spacers["xax-after"]||0;var p=t["box-align"]||"start";l||"vertical"!==o||(p="start");var d="vertical"==o?"VSpacer":"HSpacer",h={id:n+"_box_align_spacer_before",comp:{name:d,size:0}},c={id:n+"_box_align_spacer_after",comp:{name:d,size:0}};switch(p){case"center":h.comp.size="*",c.comp.size="*";break;case"end":h.comp.size="*"}var u=void 0!==t["height-mode"]?t["height-mode"]:"auto",m=parseInt(t["min-lines"],10)||0,g=parseInt(t["max-lines"],10)||0;return g>0&&m>g&&(g=m),r.layout=r.layout||{},l&&(r.layout.width=void 0!==t.width?parseInt(t.width,10):this.defaultManualWidth),l||"vertical"!=o||(r.layout["box-flex"]=1),r.comp.name="Label","auto"==u?r.comp.singleLine=!1:"lines"==u&&0===m&&1===g&&"String"===e.getTypeName()?r.comp.singleLine=!0:"lines"==u&&g>0?(r.comp.name="ClippedParagraph",r.comp.minLines=m,r.comp.maxLines=g):"pixels"==u&&(r.comp.name="ClippedParagraph",r.comp.minLines=0,r.comp.maxLines=0,r.layout.height=void 0!==t.height?parseInt(t.height,10):this.defaultManualHeight),s.items.push(h),s.items.push(this._linkify(r,n,t.pageLink)),s.items.push(c),s},_isHiddenInDef:function(e){return e.hidden===!0||"true"===e.hidden},_shouldHide:function(e,t){if(this._isHiddenInDef(t))return!0;var i="String"==e.getTypeName()&&!e.getValue()||"wix:RichText"==e.getTypeName()&&!e.getChildValue("text"),n=parseInt(t["min-lines"],10)||0;return i&&0===n},getInnerProxy:function(){return this._children&&3==this._children.length&&this._children[1]}})}),define.Class("wixapps.integration.proxies.layout.ZoomLayoutProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.CssLayoutProxy"),t.utilize(["wixapps.integration.utils.LayoutGeometryMap"]),t.fields({_geometryMap:null,_childProxiesWithAspectRatioCache:null,_resizableProxiesCache:null,_richContentListCache:null,_richContentProxies:["wixapps.integration.proxies.ImageProxy","wixapps.integration.proxies.VideoProxy"]}),t.methods({initialize:function(e,t,i,n){e&&t&&i&&(this.parent(e,t,i,n),this._geometryMap=new this.imports.LayoutGeometryMap)},renderZoomLayout:function(e,t){var i=this;this._resetCaches(),e=e||window.innerWidth-200,t=t||window.innerHeight-82;var n=this._element.children[0];this._geometryMap.setContainer(n);var a=this._element.getParents('[skinpart="blockingLayer"]')[0]||this._element;this._getResizableProxies(n).each(this._deactivateChildResizeMechanism),this._limitSizeToNative(n),this._element.setStyles({position:"absolute"}),a.setStyle("overflow","hidden"),this.updateLayoutWhenReady(function(){window.requestAnimFrame(function(){i._contractContainer(n,e,t,function(){i.updateLayoutWhenReady(function(){i._getResizableProxies(n).each(i._activateChildResizeMechanism);var e=i._viewContext.getEnvironment().getEventsDispatcher();e.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),e.fireEvent(Constants.WixAppEvents.APP_ZOOM_READY),a.setStyle("overflow","auto")})})})})},_resetCaches:function(){this._childProxiesWithAspectRatioCache=null,this._resizableProxiesCache=null,this._richContentListCache=null},_contractContainer:function(e,t,i,n){var a=this,s=7,o=4;a._childProxiesWithAspectRatioCache=null,a._checkContainerSizes(e,0,t,s,function(s){var r=a._findBestFit(s,t,i);a._checkContainerSizes(e,r[0].appliedWidth,r[1].appliedWidth,o,function(s){var o=a._findBestFit(s,t,i);a._setContainerWidth(e,o[0].appliedWidth),window.requestAnimFrame(function(){a._recalcChildProxiesAspectRatio(e),n()})})})},_checkContainerSizes:function(e,t,i,n,a){var s=Math.floor((i-t)/n);0===s?a([{width:t},{width:i}]):this._checkContainerSizesRecursive(e,i,s,n,[],a)},_checkContainerSizesRecursive:function(e,t,i,n,a,s){var o=this;this._setContainerWidth(e,t),window.requestAnimFrame(function(){o._recalcChildProxiesAspectRatio(e),window.requestAnimFrame(function(){o._geometryMap.updateMap(e);var r=o._geometryMap.get(e),l=a.concat({appliedWidth:t,width:r.width,height:r.height,richContentArea:o._calcRichContentArea(e,r.width,r.height),overflowCount:o._getOverflowCount(e),index:a.length});n>0?o._checkContainerSizesRecursive(e,t-i,i,n-1,l,s):s(l)})})},_findBestFit:function(e,t,i){var n=e.slice(0).sort(this._getSizeInfoCmpFunc(t,i)),a=n[0],s=a.index<e.length-1?a.index+1:a.index-1,o=e[s];return[a,o]},_getSizeInfoCmpFunc:function(e,t){var i=e/t;return function(e,n){var a=0;if(e.height>t&&t>=n.height)a=1;else if(n.height>t&&t>=e.height)a=-1;else if(0===a)if(t>=e.height&&t>=n.height){if(a=e.overflowCount-n.overflowCount,0===a)if(e.richContentArea>0&&n.richContentArea>0)a=n.richContentArea-e.richContentArea,0===a&&(a=e.width-n.width);else{var s=e.width/e.height,o=n.width/n.height;a=Math.abs(s-i)-Math.abs(o-i)}}else a=e.height-n.height,0===a&&(a=e.width-n.width);return a}},_setContainerWidth:function(e,t){e.setStyle("width",t)},_recalcChildProxiesAspectRatio:function(e){this._getChildProxiesWithAspectRatio(e).each(function(e){var t=e.getElement(),i=t.getSize(),n=Math.round(i.x/e.getAspectRatio());t.setStyle("height",n)})},_getChildProxiesWithAspectRatio:function(e){return this._childProxiesWithAspectRatioCache||(this._childProxiesWithAspectRatioCache=e.getElements("[hasproxy]").map(function(e){return e.getViewProxy()}).filter(function(e){return e.hasFixedAspectRatio()})),this._childProxiesWithAspectRatioCache},_getResizableProxies:function(e){return this._resizableProxiesCache||(this._resizableProxiesCache=e.getElements("[hasproxy]").filter(function(e){return Boolean(e.getViewProxy()._activateResizeMechanism)})),this._resizableProxiesCache},_getRichContentList:function(e){return this._richContentListCache||(this._richContentListCache=e.getElements("[hasproxy]").filter(function(e){return this._richContentProxies.contains(e.getViewProxy().getOriginalClassName())}.bind(this))),this._richContentListCache},_calcRichContentArea:function(e,t,i){var n=this,a={left:0,right:t,top:0,bottom:i,width:t,height:i},s=this._getRichContentList(e).reduce(function(e,t){var i=n._geometryMap.get(t),s=n._getRectIntersection(a,i);return s?e+s.width*s.height:e},0);return s},_getRectIntersection:function(e,t){var i=Math.max(e.left,t.left),n=Math.max(e.top,t.top),a=Math.min(e.right,t.right),s=Math.min(e.bottom,t.bottom);return a>=i&&s>=n?{left:i,right:a,top:n,bottom:s,width:a-i,height:s-n}:void 0},_getOverflowCount:function(e){return e.getElements("[hasproxy]").reduce(function(t,i){return this._isOverflowElement(e,i)===!0?t+1:t}.bind(this),0)},_isOverflowElement:function(e,t){var i=t.getParents("[hasproxy]"),n=i.indexOf(e);return n>-1?i.slice(0,n+1).some(function(e){var i=this._geometryMap.get(e),n=this._geometryMap.get(t),a=this._isCoordIntersection(i,n);return a}.bind(this)):void 0},_isCoordIntersection:function(e,t){return!(t.left>=e.left&&t.right<=e.right&&t.top>=e.top&&t.bottom<=e.bottom)},_activateChildResizeMechanism:function(e){if(e.getViewProxy){var t=e.getViewProxy();t&&t._activateResizeMechanism&&t._activateResizeMechanism()}},_deactivateChildResizeMechanism:function(e){if(e.getViewProxy){var t=e.getViewProxy();t&&t._deactivateResizeMechanism&&t._deactivateResizeMechanism(e)}},_limitSizeToNative:function(e){var t=e.getElements("[hasproxy]").map(function(e){return{element:e,nativeSize:e.getViewProxy().getSourceSize()}}).filter(function(e){return void 0!==e.nativeSize});t.each(function(e){e.element.setStyle("max-width",e.nativeSize.width)})}})}),define.Class("wixapps.integration.proxies.traits.AppsLinkTrait",function(e){var t=e;t.methods({_updateLinkDataItems:function(e){if("wix:RichText"==this._data.getTypeName())for(var t=this._data.getChildValue("links"),i=0;t.length>i;i++)W.Data.getDataByQuery("#"+t[i].linkId,function(){})||this._createWLink(t[i],e)},_updateAnchorLink:function(e,t){var i=this._createWLink(t);e.set("href",i.get("href"));var n=i.get("target");W.Viewer.isPublicMode()&&n?e.set("target",n):e.set("target",t._type.match(/^wix:(PageLink|MailLink)$/)?"_self":"_blank")},_createRawLinkData:function(e,t){var i={type:"TextLink"};switch(t=t||W.Data,e._type){case"wix:PageLink":var n=t.getDataByQuery("#"+e.pageId,function(){});i.linkType="PAGE",i.target="_self",i.href=n?"#!"+n.get("pageUriSEO")+"/"+e.pageId:"";break;case"wix:ExternalLink":i.linkType="WEBSITE",i.target=e.target,i.href=e.protocol+"://"+e.address;break;case"wix:DocLink":i.linkType="DOCUMENT",i.href=W.Config.getServiceTopologyProperty("staticDocsUrl")?W.Config.getServiceTopologyProperty("staticDocsUrl")+"/"+e.docId:"",i.text=e.docName,i.target="_blank";break;case"wix:MailLink":i.linkType="EMAIL",i.target="_self",i.href="mailto:"+e.email,i.text=e.subject}return i},_createWLink:function(e,t){t=t||W.Data;var i=this._createRawLinkData(e,t),n=t.addDataItem(e.linkId,i);return n.setMeta("isPersistent",!1),n},_createAppsLink:function(e){var t,i=this._viewContext.getEnvironment().getDataItemFactory(),n={linkId:e.get("id")};switch(e.get("linkType")){case"PAGE":n._type="wix:PageLink",n.pageId=e.get("href").split("/")[1];break;case"WEBSITE":n._type="wix:ExternalLink",n.target=e.get("target"),t=e.get("href").split("://"),n.protocol=t[0],n.address=t[1];break;case"DOCUMENT":n._type="wix:DocLink",t=e.get("href").split("/"),n.docId=t[t.length-1],n.docName=e.get("text");break;case"EMAIL":n._type="wix:MailLink",n.email=e.get("href").split(":")[1],n.subject=e.get("text")}return i.createDataItem(n)},_openLinkDialog:function(e,t,i){var n=this;this.resource.getResources(["W.Preview","W.Commands"],function(a){var s;if("wix:LinkBase"==e._type){var o=n.generateLinkId(t);s=a.W.Preview.getPreviewManagers().Data.addDataItem(o,{type:"TextLink"}),s.setMeta("isPersistent",!1)}else s=n._createWLink(e,a.W.Preview.getPreviewManagers().Data);a.W.Commands.executeCommand("WEditorCommands.OpenLinkDialogCommand",{position:Constants.DialogWindow.POSITIONS.CENTER,previewComponent:n._previewComponent,data:s,state:s.get("linkType")||Constants.LinkState.NO_LINK,closeCallback:function(e,t,n){i(s,e,t,n)}})})},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),generateLinkId:function(e){for(var t,i=this._CHARS,n=[],a=0,s=0;8>s;s++)2>=a&&(a=0|33554432+16777216*Math.random()),t=15&a,a>>=4,n[s]=i[19==s?8|3&t:t];var o=n.join("");return e+"_"+o}})}),define.Class("wixapps.integration.proxies.traits.ProxyPropertyChangeTrait",function(e){var t=e;t.fields({_propHandlers:{},_compProperties:[],_postWixificationChanges:{}}),t.methods({initialize:function(){this._setupDefaultHandlers(),this._setupPropertyHandlers()},_handleProperty:function(e,t){this._propHandlers[e]=t},_handleProperties:function(e,t){e.forEach(function(e){this._handleProperty(e,function(){t.call(this)})}.bind(this))},_mapToCompProperty:function(e,t,i){t=t||e,this._compProperties.push({propName:e,compPropName:t,setterFunc:i}),this._handleProperty(e,function(e){this._componentLogic.setComponentProperty(t,i?i(e):e)})},_mapToCompProperties:function(e){e.forEach(function(e){this._mapToCompProperty(e)}.bind(this))},_setupPropertyHandlers:function(){},_setupDefaultHandlers:function(){this._handleProperty("name",function(){this._goBellyUp()}),this._handleProperty("enabled",function(){this._updateComponentState()}),this._handleProperty("style",function(){this._updateCompStyle()}),this._handleProperty("css",function(){this._applyCssNode(this._element)}),this._handleProperty("hidden",function(e){"true"==e||e===!0?this._element.collapse():(this._element.uncollapse(),this.updateLayoutWhenReady())}),this._handleProperty("cssClass",function(e){var t=this._cssClass;e!=t&&(this._cssClass=e,t&&this._element.removeClass(t),e&&this._element.addClass(e))})},_onDefPropertyChanged:function(e){var t,i;if(this._isWixificationPending===!0)return this._accumulateChanges(e),void 0;this._propHandlers["*"]&&this._propHandlers["*"].call(this);for(var n=0;e.length>n;n++)i=e[n].path[0],t=this._propHandlers[i],t&&t.call(this,this._def.getChildValue(i))},_accumulateChanges:function(e){e.forEach(function(e){this._postWixificationChanges[e.path[0]]=e}.bind(this))},_applyAccumulatedPropertyChanges:function(){this._onDefPropertyChanged(Object.values(this._postWixificationChanges))},isHidden:function(){if(this._disposed)return!0;var e=this._def.getChildValue("hidden");return e===!0||"true"===e},_createCompProperties:function(){var e=this._getPropSchemaName(),t={};return e&&(t={type:e}),this._compProperties.forEach(function(e){var i=this._def.getChildValue(e.propName);t[e.compPropName]=e.setterFunc?e.setterFunc(i):i}.bind(this)),t},_updateCompProperties:function(e){var t=this._getPropMap(),i=this._def;e.forEach(function(e){var n=e.path[0],a=t[n];a&&this._componentLogic.setComponentProperty(a,this._processPropValue(n,i.getChildValue(n)))}.bind(this))},_processPropValue:function(e,t){return t},_getPropMap:function(){return{}},_getPropSchemaName:function(){},_updateCompStyle:function(){var e=this._def.getChildValue("style")||this._getDefaultStyleName();e&&!this.getProxyMetaTags().contains("text")&&void 0===Constants.WixApps.TEXT_STYLES[e]&&W.Theme.getStyle(e,function(e){e&&(this._componentLogic.setStyle(e),this._registerStyleChangeHandler())}.bind(this),this._getDefaultSkinName())},_updateComponentState:function(){var e=this._def.getChildValue("enabled");void 0!==e&&("false"===e||e===!1?this._componentLogic.disable():this._componentLogic.enable())},_applyCssNode:function(e){var t=this._def.getChildValue("css");t&&this._applyStyle(e,t)},_goBellyUp:function(){this.fireEvent(Constants.WixAppEvents.PROXY_IRRECOVERABLE,{})}})}),define.Class("wixapps.integration.proxies.traits.WDataExchangeTrait",function(e){var t=e;t.methods({initialize:function(){},_convertWItemDataToRawData:function(e){var t=["metaData"],i={array:Array,object:Object},n=function(e){var a=typeOf(e);if("array"==a||"object"==a){var s=i[a],o=e;"object"==a&&e.hasOwnProperty("_data")&&(o=e._data);var r=s.filter(o,function(e,i){return!t.contains(i)});return s.map(r,function(e){return n(e)})}return e};return n(e)},_rawDataEquals:function(e,t){return JSON.stringify(e)==JSON.stringify(t)}})}),define.dataSchema("AppBuilderComponent",{appInnerID:"string",appPartName:"string"}),define.dataSchema("AppPage",{"extends":"Page",appPageId:"string",appInnerID:"number",appPageType:"string"}),define.dataSchema("AppPart",{appInnerID:"string",appLogicParams:"object",appLogicCustomizations:"array",appPartName:"string",viewName:"string"}),define.dataSchema("AppPartProperties",{direction:{type:"string","enum":["ltr","rtl"],"default":"ltr"}}),define.dataSchema("ClippedParagraphProperties",{minLines:{type:"number","default":0},maxLines:{type:"number","default":0},pack:{type:"string","enum":["top","bottom","middle","none"],"default":"none"},showTooltip:{type:"boolean","default":!1}}),define.dataSchema("Icon",{url:"string",width:"number",height:"number",title:"string"}),define.dataSchema("ImageButtonProperties",{isSprite:{type:"boolean","default":!0},spriteDirection:{type:"string","enum":["horizontal","vertical"],"default":"vertical"},startPositionX:{type:"number","default":0},startPositionY:{type:"number","default":0}}),define.dataSchema("MultiSelectableList",{items:"refList",selected:"refList"}),define.skin("wixapps.integration.skins.ClippedParagraphSkin",function(e){var t=e;t.inherits("wysiwyg.viewer.skins.WRichTextNewSkin"),t.html('<div skinPart="richTextContainer" class=""></div>'),t.css([" {word-wrap: break-word;}"," ul { list-style-type: disc; padding-left: 1.3em; margin-left: 0.5em; line-height: normal; letter-spacing: normal;}"," ol {  list-style-type: decimal;padding-left: 1.3em; margin-left: 0.5em; line-height: normal; letter-spacing: normal;}",' ul[dir="rtl"] {padding-right: 1.3em; margin-right: 0.5em;}',' ol[dir="rtl"] {padding-right: 1.3em; margin-right: 0.5em;}'," ul ul {list-style-type: circle;}"," ol ul {list-style-type: circle;}"," ol ol ul {list-style-type: square;}"," ol ul ul {list-style-type: square;}"," ul ol ul {list-style-type: square;}"," ul ul ul {list-style-type: square;}"," li{ color: inherit; font-size: inherit; font-family: inherit; font-style: inherit; font-weight: inherit; line-height: normal; letter-spacing: normal;}"," p {margin: 0; line-height: normal; letter-spacing: normal;}"," h1 {margin: 0;line-height: normal; letter-spacing: normal;}"," h2 {margin: 0;line-height: normal; letter-spacing: normal;}"," h3 {margin: 0;line-height: normal; letter-spacing: normal;}"," h4 {margin: 0;line-height: normal; letter-spacing: normal;}"," h5 {margin: 0;line-height: normal; letter-spacing: normal;}"," h6 {margin: 0;line-height: normal; letter-spacing: normal;}"," a { color: inherit}"])}),define.skin("wixapps.integration.skins.DropTargetSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"$BorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"webThemeDir",type:"themeUrl",defaultTheme:"WEB_THEME_DIRECTORY"}]),t.html('<div skinPart="inlineContent"></div>'),t.css(["{[$BorderRadius] position:relative; [box] height:34px; line-height:34px; border:dashed 1px #A0A0A0; background:#f8f8f8; }","%inlineContent%{ margin:0px 10px 10px 10px; line-height:30px; }","%inlineContent% .disabled { opacity: 0.4; }"])}),define.skin("wixapps.integration.skins.ExpanderSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"sel",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"}]),t.html('<div skinPart="icon"></div><div skinPart="summary" class="label"></div><div skinPart="content"></div>'),t.css(["{ width: 100%; height: 100%; }","%icon% {cursor: pointer;  height: 10px; width:10px;  display:inline-block; vertical-align: 50%; margin-right: 5px}",'[state="collapsed"] > %icon% { background: transparent url([tdr]arrow-left.png) no-repeat; }','[state="expand"] > %icon% { background: transparent url([tdr]arrow-down.png) no-repeat; }',"%summary% { display:inline-block; cursor: pointer; [sel]; width: 90%}",'[state="collapsed"] > %content% { display: none;}','[state="expand"] > %content% { display: block; margin-top: 3px;}'])}),define.skin("wixapps.integration.skins.HelpQuestionMarkIconSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"}]),t.html('<img skinPart="img" src="icons/property_panel_help_sprite.png" />'),t.css()
}),define.skin("wixapps.integration.skins.IconSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.html('<img skinPart="img"></img>')}),define.skin("wixapps.integration.skins.ImageButtonSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.html(""),t.css([])}),define.skin("wixapps.integration.skins.LinkSelectorSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"}]),t.html('<p skinPart="description"></p>'),t.css(["%description% { background:transparent url([baseThemeDir]wix_apps/link-selector-button.png) left center no-repeat; cursor:pointer; padding-bottom: 3px; padding-left:20px; min-width:1px; min-height:16px; }"])}),define.skin("wixapps.integration.skins.LinkSelectorSkinII",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"maxWidth",type:Constants.SkinParamTypes.SIZE,defaultValue:"245px"}]),t.html('<p class="container singleLine"><span class="sepLine">&nbsp;</span><span skinPart="description"></span></p>'),t.css([" .singleLine { white-space:nowrap; display:block; overflow:hidden; text-overflow:ellipsis; word-wrap:normal; }","%.container% { width:100%; background:transparent url([baseThemeDir]wix_apps/link_sprite.png) 2px top no-repeat; font-size: 1em;  border-radius: 3px; border: 1px solid #B4B4B4; border-image: initial; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 1px 1px 0px inset; background-color: #FFF;margin: 0px 0px 5px; cursor:pointer; padding: 0px 3px; padding-left:20px; min-width:1px; min-height:23px; line-height: 23px; vertical-align: middle;}","[state=nonEditable] %.container% { cursor: default; }",'%description% {font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; }',"%.sepLine% { width: 1px; border-left: solid 1px #B4B4B4; margin-right: 5px; margin-left: 4px;}"])}),define.skin("wixapps.integration.skins.TextAreaSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.3"}]),t.html('<div class="clearfix"><label skinpart="label"></label><textarea skinpart="input" ></textarea><div skinpart="message"></div></div>'),t.css(["%.clearfix% {height:100%}","%input% {width:100%; height:100%; padding:12px; line-height: 1.3em;  font-size:1em; border: 1px solid #e3e3e3; box-shadow: 0 1px 1px 0 [shadowColor] inset;}","%input%:hover{border-color: #a3d9f6; }","%input%:focus{border-color: #19a0e9; }",'[state~="hasLabel"] %label% {display:block; padding-bottom: 5px;}',"[disabled] %label% {opacity:0.5}",'[state~="invalid"] input%input%{background: #f6e0dd; border-color: #de4c3a}','[state~="invalid"] %message% {color: #de4c3a; font-size: .916em;}',"input%input%.isPlaceholder{color: #999;}"])}),define.skin("wixapps.integration.skins.ToggleSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"sel",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"}]),t.html('<div skinPart="on" class="label"></div><div skinPart="off"></div>'),t.css(["{ width: 100%; height: 100%; }",'[state="on"] > %off% { display: none;}','[state="off"] > %off% { display: block; margin-top: 3px; cursor: pointer; } ','[state="on"] > %on% { display: block; margin-top: 3px; cursor: pointer; }','[state="off"] > %on% { display: none;}'])}),define.skin("wixapps.integration.skins.WixAppsButtonSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"4px"},{id:"borderColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#c4c4c4"},{id:"borderColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#89a4af"},{id:"bgColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f9fafc"},{id:"bgColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f2f3f5"},{id:"bgColorPressed",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f3f3f3"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.2"},{id:"shadowInsetColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.7"},{id:"shadowInsetColorOver",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"255,255,255,.7"},{id:"labelColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#24a0c4"}]),t.html('<div skinPart="icon"></div><div skinPart="label"></div><div skinPart="link"></div>'),t.css(["{padding: 0 10px; border: 1px solid [borderColor]; [$borderRadius] background:[bgColor] url([webThemeDir]button/button-gradient.png) repeat-x 0 50%; position:relative; text-align:center; cursor:pointer;}",'[state~="over"] {border:1px solid [borderColorOver]; background:[bgColorOver] none; box-shadow:0 2px 3px 0 [shadowColor], 0 1px 2px 0 [shadowInsetColorOver] inset; }','[state~="selected"] { background: [bgColorPressed] none; border-color: transparent; box-shadow: 0 1px 3px 0 [shadowInsetColor] inset; }','[state~="pressed"]  { background: [bgColorPressed] none; border-color: transparent; box-shadow: 0 1px 3px 0 [shadowInsetColor] inset; }',"%icon%     { position:absolute; left: 5px; top: 50%; width:24px; height:24px; margin-top:-12px; }","%label%    { color: [labelColor]; height:30px; line-height:30px; }","[disabled] {opacity: .5;}"])}),define.skin("wixapps.integration.skins.dialogs.AddFieldDialogSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"}]),t.compParts({nameYourFieldInput:{skin:"wysiwyg.editor.skins.inputs.InputSkin"},positionYourFieldInput:{skin:"wysiwyg.editor.skins.inputs.ComboBoxSkin"}}),t.html('<div class="clearfix"><div class="compsPerFieldTypeLayout"><strong skinPart="contentLabel"></strong><div skinPart="content"><strong class="sectionTitle"></strong></div></div><div class="previewContainer"><div class="preview"><div skinPart="fieldDescription"></div></div><div skinPart="newFieldSettings"><div skinPart="nameYourFieldContainer"><label skinPart="nameYourFieldLabel"></label><div skinPart="nameYourFieldInput"></div></div><div skinPart="positionYourFieldContainer"><label skinPart="positionYourFieldLabel"></label><div skinPart="positionYourFieldInput"></div></div></div><div skinPart="defaultValueContainer"></div></div></div>'),t.css(["{position: relative;}","%.compsPerFieldTypeLayout% {float:left; width:160px;}","%contentLabel% {line-height:22px;}","%content% {overflow:auto; height:200px; margin-bottom: 5px; background-color:white; border:1px solid #b4b4b4; border-top:1px solid #ccc; [borderRadius]; padding:4px 15px 10px 15px}","%content%:hover{border-color: #a3d9f6; }","%content% .sectionTitle{ display: block; line-height: 20px; color: #4c4c4c; padding-top:6px;}","%fieldDescription% {padding:10px 20px 0}","%.previewContainer% {float:left; margin-left: 0px; padding-top: 19px; width:318px; overflow-x:hidden; overflow-y:visible; min-height:240px}","%.preview% {text-align:left; margin:0 auto; max-height: 280px;}","%newFieldSettings% { }","%nameYourFieldContainer% {padding:10px 20px 0;}","%positionYourFieldContainer% {padding:10px 20px 0;}","%nameYourFieldLabel% {line-height:22px;}","%positionYourFieldLabel% {line-height:22px;}","%nameYourFieldInput% {padding-top:5px}","%defaultValueContainer% { }"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDataPanelSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"trans",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"background-position 0.7s ease 0.2s"},{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"noShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0 0 #000"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 5px 0"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="topBar"><strong skinPart="panelLabel"></strong><div skinPart="help" class="help"><span>&nbsp;</span></div><div skinPart="close"><span>&nbsp;</span></div></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),t.css(["{background:#f7f7f7; width:[panelWidth]; [$panelBorderRadius] [noShadow]}","[state=expanded] { [$contentAreaShadow] }","%topBar% {width:100%; height:40px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move; position:relative}","%panelLabel% {display:inline-block; font-size:[titleFontSize]; padding:0 0 0 8px; margin-left: 8px; overflow:hidden; text-overflow:ellipsis; width:180px; height:40px; line-height:40px; }","%panelDescription% {font-size: 14px; padding:15px; line-height:1.2em; border-top:1px solid #fff; color:#444}","%close% {position:absolute; top:1px; right:0; height:38px; width:34px; border-left:1px solid #ccc; cursor:pointer; [$closeBorderRadius]}",'%close% span {position:absolute; left:8px; top:11px; width:15px; height:15px; display:block; background:url("[webThemeDir]icons/top-bar-icons.png") 0 0 no-repeat}',"%close%:hover span {background-position:0 -140px}","%.help% {width:35px; height:38px; position:absolute; right:35px; top:1px; cursor:default;}","%.help% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:11px; cursor:pointer}","%.help% span:hover { background-position: 0 -16px}","%.help% span:active { background-position: 0 -33px}","%inlineContent% { top:10px; padding:0; }"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDialogExpandablePanelSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"noShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0 0 #000"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 0 5px"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"innerPanelMinHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"150px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"borderColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#5b8fa7"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"4px"},{id:"bgColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#2aa7ea"},{id:"btnShadowInset",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"inset 0 1px 3px 0 rgba(0, 0, 0, 0.7)"},{id:"btnShadowInsetOver",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"inset 0 1px 2px 0 rgba(68,175,233, 0.7)"},{id:"bgColorOver",type:Constants.SkinParamTypes.BGC,defaultValue:"#179ce1"},{id:"borderColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#237aa7"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="topBar"><h4 skinPart="panelLabel"></h4><div skinPart="paneCloseBtn"></div></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),t.css(["{background:#f7f7f7; width:[panelWidth]; height:600px; [$panelBorderRadius] [$contentAreaShadow] position:relative; }","%topBar% {width:100%; height: 40px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move;}",'%panelLabel% {font-family: "Helvetica Neue Medium"; display: inline-block; font-size:[titleFontSize]; padding:0px; margin-left: 8px; width:200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; height:40px; line-height:40px; }',"%panelDescription% {font-size: 14px; margin:21px 15px; line-height:1.2em; border-top:1px solid #fff; color:#444; height:34px; overflow-y:auto; }","%.topBarActions% {position:absolute; width:100%; right:0; top:0; [$BorderTopRightRadius]}","%paneCloseBtn% {display: inline-block; position:absolute; top:7px; right:8px; padding: 0 10px 1px 20px; font-size: 11px; background: [bgColor] url([webThemeDir]button/button-gradient.png) repeat-x 0 50%; text-align: center; cursor: pointer;color:white; border: 1px solid [borderColor]; [$borderRadius]; line-height:25px; }",'%paneCloseBtn%:after {content:""; display:block; position:absolute; top:8px; left:7px; width:10px; height:10px; background:url([webThemeDir]lists/appbuilder_sprite.png) -150px 50% no-repeat; }',"%paneCloseBtn%:hover {background: [bgColorOver] none; border-color: [borderColorOver]; [btnShadowInsetOver]}","%paneCloseBtn%:active {background: [bgColor] none; border-color: transparent; [btnShadowInset]}","%icon% {position:absolute; left: 5px; top: 50%; width:24px; height:24px; margin-top: -12px;}","%inlineContent% { padding-bottom:25px; margin: 0 0 35px 0; font-size: 12px; line-height: 1.2em;}"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDialogPanelSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 5px 0"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"innerPanelMinHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"150px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="topBar"><strong skinPart="panelLabel"></strong><div skinPart="help" class="help"><span>&nbsp;</span></div><div skinPart="close"><span>&nbsp;</span></div></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),t.css(["{background:#f7f7f7; width:[panelWidth]; [$panelBorderRadius] [$contentAreaShadow]}","%topBar% {width:100%; height:40px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move; position:relative}","%panelLabel% {display:inline-block; font-size:[titleFontSize]; padding:0 0 0 8px; overflow:hidden; margin: 0 40px 0 0; text-overflow:ellipsis; width:180px; height:40px; line-height:40px; }","%panelDescription% {font-size: 14px; margin:21px 15px; line-height:1.2em; border-top:1px solid #fff; color:#444; height:58px; overflow-y:auto; }","%close% {position:absolute; top:1px; right:0; height:38px; width:34px; border-left:1px solid #ccc; cursor:pointer; [$closeBorderRadius]}",'%close% span {position:absolute; left:8px; top:11px; width:15px; height:15px; display:block; background:url("[webThemeDir]icons/top-bar-icons.png") 0 0 no-repeat}',"%close%:hover span {background-position:0 -140px}","%.help% {width:35px; height:38px; position:absolute; right:35px; top:1px; cursor:default;}","%.help% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:11px; cursor:pointer}","%.help% span:hover { background-position: 0 -16px}","%.help% span:active { background-position: 0 -33px}","%inlineContent% { top:10px; padding:0 0 0 12px; margin: 0 0 35px 0; font-size: 12px; line-height: 1.2em; }"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDialogWindowSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"26px"},{id:"nameFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"14px"},{id:"appIconHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"50px"}]),t.html('<div class="z-dialog" skinPart="blockLayer"></div><div class="z-dialog" skinPart="dialogBox"><div class="dialogLayout"><div class="z-dialog" skinPart="dragArea"></div><strong skinPart="dialogTitle"></strong><span skinPart="dialogSubTitle"></span><div skinPart="dialogDescription"></div><div skinPart="helplet"></div><div skinPart="xButton"><div skinPart="x"></div></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="buttonContainer" class="buttons"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),t.css(["{ position:relative; }","%dialogTitle% {display:none;}","%dialogSubTitle% {display:none;}","%dialogDescription% {display:none;}","%xButton% {display:none;}","%x% {display:none;}","%helplet% {display:none;}","%buttonContainer% {display:none;}","%.tabs% { height:42px; position:relative; display:none; }",".tab {height:22px; padding-top:10px; margin-right:3px; width:135px; float:left; border: solid 1px #dedede; border-bottom:none; background:#fff; color:#4c4c4c; text-align:center; [tabRadius] cursor:pointer;  }",".selectedTab { background:#7d53db; border-color:#7d53db; color:#fff; cursor:default; }"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderManageDialogSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"10px 10px 0 0"},{id:"closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"tabsShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"transTabs",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"width 0.7s ease 0s"},{id:"transPanel",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"left 0.7s ease 0s"}]),t.compParts({manageItemsPane:{skin:"wixapps.integration.skins.dialogs.AppBuilderDialogExpandablePanelSkin"},itemDataPane:{skin:"wixapps.integration.skins.dialogs.AppBuilderDataPanelSkin"},customizeItemTemplatePane:{skin:"wixapps.integration.skins.dialogs.AppBuilderDialogPanelSkin"}}),t.html('<div class="shadow left"></div><div class="shadow right"></div><div skinPart="manageItemsPane" class="panel"></div><div skinPart="customizeItemTemplatePane" class="panel"></div><div skinPart="itemDataPane" class="panel"></div><div skinPart="tabs"><div rel="dataPane" class="tab selectedTab">Tab A</div><div rel="templatePane" class="tab">Tab B</div></div>'),t.css(["{ position:relative; }","%.panel% { position:absolute; top:42px; height:600px; width:300px; }","%.shadow% { height:42px; width:135px; position:absolute; top:0; left:0; [tabsShadow] [tabRadius] }","%.right% { left:140px; }","%tabs% { height:42px; position:absolute; top:0; left:0; [transTabs] }","[state*=expanded] %tabs% { width:600px; }","[state*=collapsed] %tabs% { width:300px;}",'[state*=dataPane]  %tabs%:before {content:""; position:absolute; bottom:0; right:0; left:0; height:10px; [closeRadius]  background:#7d53db url([webThemeDir]lists/appbuilder_sprite.png) left 6px repeat-x; }'," .tab {height:22px; padding-top:10px; margin-right:3px; width:135px; float:left; border: solid 1px #7d53db; border-bottom:none; background:#fff; color:#000; text-align:center; [tabRadius] cursor:pointer;  }"," .tab:hover { color:#09f;}"," .selectedTab,  .selectedTab:hover { background:#7d53db; border-color:#7d53db; color:#fff; cursor:default; }","[state*=templatePane] %tabs% { width:300px; }",'[state*=templatePane]  %tabs%:before {content:""; position:absolute; bottom:0; left:0; width:300px; height:10px; [closeRadius]  background:#7d53db url([webThemeDir]lists/appbuilder_sprite.png) left 6px repeat-x; }',"[state*=templatePane] %manageItemsPane% {display: none; }","[state*=templatePane] %itemDataPane% {display: none;}","[state*=templatePane] %customizeItemTemplatePane% {display: inline-block;}","[state*=dataPane] %manageItemsPane% {}","[state*=dataPane][state*=expanded] %itemDataPane% { left:300px; [transPanel] }","[state*=dataPane][state*=collapsed] %itemDataPane% {left:0; [transPanel] }","[state*=dataPane] %customizeItemTemplatePane% {display:none;}"])}),define.skin("wixapps.integration.skins.dialogs.ChooseTemplateDialogWindowSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="dialogLayout"><div skinPart="dragArea"></div><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="xButton"><div skinPart="x"></div></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="buttonContainer"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),t.css(["{position:absolute;width:850px;height:100%;}","%.dialogLayout% {background:#fdfdfd; padding-bottom: 10px; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:34px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal] %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:34px; height:34px; cursor:pointer; border-left:1px solid #ccc; [$closeRadius]}","%xButton%:hover {background:#ddd;}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:15px 10px 5px; background:#fdfdfd; [$borderRadiusBottom]}","%buttonContainer% .leftButton {float:left;}","%buttonContainer% .rightButton {float:right;}","%buttonContainer% .rightButton >div {float:right;margin-left:5px;}","%dialogTitle% {font-size:[titleFontSize]; display:block; padding:0 20px; border-bottom:1px solid #ccc; line-height:34px; }","%.dialogDescriptionWrapper% {border-top:1px solid #fff; padding:20px 45px}","%dialogDescription% {margin-bottom:4px;}","%helplet% {margin-top:10px; cursor:pointer; color:#09f; font-size:90%; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:hidden;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton%:hover {background:#ddd;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}"])}),define.oldSkin({name:"wixapps.integration.skins.dialogs.EditFieldPanelSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_params:[],_html:'<div skinPart="content"></div>',_css:["%content% { margin:none !important}"]}}),define.skin("wixapps.integration.skins.dialogs.GrayDialogWindowSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="dialogLayout"><div skinPart="dragArea"></div><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="xButton"><div skinPart="x"></div></div><div skinPart="helpButton" class="hidden"><span></span></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="buttonContainer" class="buttons"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),t.css(["{position:absolute;width:100%;height:100%;}","%.dialogLayout% {background:#f7f7f7; padding-bottom: 10px; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:39px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal] %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:39px; height:39px; cursor:pointer; border-left:1px solid #ccc; [$closeRadius]}","%xButton%:hover {background:#ddd;}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:15px 10px 5px; background:#f7f7f7; [$borderRadiusBottom]}","%buttonContainer% .leftButton {float:left;}","%buttonContainer% .rightButton {float:right;}","%buttonContainer% .rightButton >div {float:right;margin-left:5px;}","%dialogTitle% {font-size:[titleFontSize]; display:block; padding:0 10px; border-bottom:1px solid #ccc; line-height:39px; }","%.dialogDescriptionWrapper% {border-top:1px solid #fff;}","%dialogDescription% {padding:15px 10px; line-height:14px; font-size:12px;}","%helplet% {padding:0px 10px 15px; margin-top: -10px; cursor:pointer; color:#379acf; font-size: .83em; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:auto;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}"])
}),define.skin("wixapps.integration.skins.dialogs.InputGroupSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"$BorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"webThemeDir",type:"themeUrl",defaultTheme:"WEB_THEME_DIRECTORY"}]),t.html('<div skinPart="inlineContent"></div>'),t.css(["{ height:30px; border:1px solid #c8e5f7; border-top-color:#bfdbf0; [$BorderRadius]}","%inlineContent%{ margin:0px 10px 10px 10px; line-height:30px; }"])}),define.oldSkin({name:"wixapps.integration.skins.dialogs.MessageDialogWithOptOutSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_params:[],_html:'<div skinPart="contentWrapper" class="contentWrapper selectableChildren"><div skinPart="text" class="text"></div><em skinPart="details" class="details"></em><div skinpart="isDontShowAgainCont"><input type="checkbox" skinpart="isDontShowAgain" /></div></div>',_css:["%contentWrapper% {padding:10px 0 0;}","%text% {line-height:1.3em;}","%details% {padding-top:10px; color: #666; display:block;}"," p {margin-bottom: 10px;}","%isDontShowAgainCont% {margin-top: 20px; text-align: right;}"]}}),define.skin("wixapps.integration.skins.dialogs.NoTitleDialogWindowSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="dialogLayout"><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="helpButton" class="hidden"><span></span></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="xButton"><div skinPart="x"></div></div><div skinPart="dragArea"></div><div skinPart="buttonContainer" class="buttons"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),t.css(["{position:absolute;width:100%;height:100%;}","%.dialogLayout% {background:#fdfdfd; padding-bottom: 10px; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:34px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal] %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:34px; height:34px; cursor:pointer; [$closeRadius]}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:15px 10px 5px; background:#fdfdfd; [$borderRadiusBottom]}","%buttonContainer% .leftButton {float:left;}","%buttonContainer% .rightButton {float:right;}","%buttonContainer% .rightButton >div {float:right;margin-left:5px;}","%dialogTitle% {display:none;}","%.dialogDescriptionWrapper% {display:none;}","%dialogDescription% {padding:15px 10px; line-height:14px; font-size:12px;}","%helplet% {padding:0px 10px 15px; margin-top: -10px; cursor:pointer; color:#379acf; font-size: .83em; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:auto;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}",' .font_5 { font:normal normal normal 25px/1.4em "Helvetica Neue Light", sans-serif; color:#717070; }',' .font_6 { font:normal normal normal 15px/1.4em "Helvetica Neue Medium", sans-serif; color:#404040; }',' .font_8 { font:normal normal normal 13px/1.3em "Helvetica Neue Light", sans-serif; color:#444444; }'])}),define.skin("wixapps.integration.skins.ecommerce.inputs.ComboBoxInputSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams(),t.html('<select skinpart="collection"></select>'),t.css(["{position:relative;}",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:""; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.skin("wixapps.integration.skins.ecommerce.inputs.TextAreaInputSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:"box-sizing:border-box; -webkit-box-sizing:border-box -moz-box-sizing:border-box;"},{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"#ffffff",enableEdit:!0},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#e3e3e3",enableEdit:!0},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"1px"},{id:"brdh",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#a3d9f6",enableEdit:!0},{id:"brdf",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#19a0e9",enableEdit:!0},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultValue:"#000000",enableEdit:!0},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px"}]),t.html('<textarea skinPart="textarea"></textarea><p skinPart="errorMessage"></p>'),t.css(["{ position:relative;}","%textarea% {text:[txt] [box] [bg] [rd] resize: none; width:100%  !important; min-height:100px; height:100%; overflow:auto; font-size:14px; border:[brw] solid [brd]; box-shadow: 0 1px 1px 0 rgba(0,0,0,.3) inset; }","%textarea%:hover {border-color: [brdh]; }","%textarea%:focus {border-color: [brdf]; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center; bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px; color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:""; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.skin("wixapps.integration.skins.ecommerce.options.ColorOptionSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams(),t.html('<div skinPart="tooltip" skin="wixapps.integration.skins.ecommerce.options.InfoTipSkin"></div><div class="olo"></div>'),t.css(["%.olo% { height:20px; position:relative; }",'[state~="selected"] %.olo%:after { content:""; position:absolute; left:50%; bottom:-10px; margin-left:-6px; color:#444; font-weight:bold; font-size:12px; font-family:Arial; line-height:1;  }','[state~="disabled"] { display:none; }',"%tooltip%           { min-width:100px !important; margin:-4px 0 0 14px; font-size:12px; text-transform:uppercase; text-align:center; }",'%tooltip%:after     { content:""; position:absolute; left:50%; bottom:-10px; margin-left:-6px;  color:#fffedf; font-size:12px; font-family:Arial; line-height:1; text-shadow:0 1px 2px rgba(0, 0, 0, 0.5); }'])}),define.skin("wixapps.integration.skins.ecommerce.options.InfoTipSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"bgcolor",type:Constants.SkinParamTypes.OTHER,defaultValue:"#fffedf"},{id:"txtcolor",type:Constants.SkinParamTypes.OTHER,defaultValue:"#656565"},{id:"fnt",type:Constants.SkinParamTypes.OTHER,defaultValue:'font-family: font-family: "Helvetica Neue", "HelveticaNeueW01-55Roma", "HelveticaNeueW02-55Roma", "HelveticaNeueW10-55Roma", Helvetica, Arial, sans-serif; font-size:12px; line-height:16px; '},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 4px rgba(0, 0, 0, 0.6);"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px"},{id:"max",type:Constants.SkinParamTypes.OTHER,defaultValue:"min-height:10px; min-width:10px; max-width:300px;"}]),t.html('<div class="toolTipContainer"><p skinPart="content"></p></div>'),t.css(["{  [fnt][rd][shd][max] color:[txtcolor]; background:[bgcolor]; position:absolute;  padding:5px; top:0px; left: 0px;}","p {display:block; margin:0 0 5px 0; }","strong, b, i, big { font-size:12px; }",'[state~="hidden"] {visibility:hidden!important;}'])}),define.oldSkin({name:"wixapps.integration.skins.ecommerce.options.OptionsListInputSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_params:[],_html:"",_css:["{position:relative;}"," > div { border:1px solid #444; display:inline-block; min-width:26px; line-height:20px; height:20px; margin:0 3px; text-align:center; text-transform:uppercase; cursor:pointer; }"," > div:first-child { margin-left:0; }"," > div:last-child { margin-right:0; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:""; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }']}}),define.oldSkin({name:"wixapps.integration.skins.ecommerce.options.TextOptionSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_params:[],_html:'<div skinPart="tooltip" skin="wixapps.integration.skins.ecommerce.options.InfoTipSkin"></div><div skinPart="size"/>',_css:["{ background:#fff;  }","%size% {  position:relative; }",'[state~="selected"] %size%:after { content:""; position:absolute; left:50%; bottom:-10px; margin-left:-6px; color:#444; ont-weight:bold; font-size:12px;  font-family:Arial; line-height:1;  }','[state~="disabled"] { display:none; }',"%tooltip%           { min-width:100px !important; margin:-4px 0 0 14px; font-size:12px; text-transform:uppercase; text-align:center; }",'%tooltip%:after     { content:""; position:absolute; left:50%; bottom:-10px; margin-left:-6px;  color:#fffedf; font-size:12px; font-family:Arial; line-height:1; text-shadow:0 1px 2px rgba(0, 0, 0, 0.5); }']}}),define.dataThemeItem("RTInlineAppsToolBar",{type:"TopLevelStyle",skin:"wixapps.integration.skins.editor.RichTextInlineToolBarSkin",metaData:{isPersistent:!1},style:{properties:{"boxShadowToggleOn-shd":!0},groups:{toolbarBtn:{properties:{hover:"border:1px solid #ddd !important; background-color:#fff; box-shadow: 0 1px 0 rgba(0,0,0,0.1)",sel:"border:1px solid #fff; background-color:#d5effe; box-shadow: inset 0 1px 0 rgba(0,0,0,0.4)"},groups:{},propertiesSource:{minWidth:"value",minHeight:"value",icnoWidth:"value",iconHeight:"value",labelDisplay:"value",iconDisplay:"value",hover:"value",sel:"value"}},ddFontSize:{properties:{optionsWidth:"105px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddStyle:{properties:{optionsWidth:"215px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddFont:{properties:{optionsWidth:"180px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddSize:{properties:{selectPadding:"padding-left:28px;"},groups:{},propertiesSource:{selectPadding:"value"}}},propertiesSource:{}}}),define.dataThemeItem("RTAppBuilderToolBar",{type:"TopLevelStyle",skin:"wixapps.integration.skins.editor.WixAppsToolBarSkin",metaData:{isPersistent:!1},style:{properties:{"boxShadowToggleOn-shd":!0},groups:{toolbarBtn:{properties:{hover:"border:1px solid #ddd !important; background-color:#fff; box-shadow: 0 1px 0 rgba(0,0,0,0.1)",sel:"border:1px solid #fff; background-color:#d5effe; box-shadow: inset 0 1px 0 rgba(0,0,0,0.4)"},groups:{},propertiesSource:{minWidth:"value",minHeight:"value",icnoWidth:"value",iconHeight:"value",labelDisplay:"value",iconDisplay:"value",hover:"value",sel:"value"}},ddFontSize:{properties:{optionsWidth:"105px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddStyle:{properties:{optionsWidth:"215px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddFont:{properties:{optionsWidth:"180px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddSize:{properties:{selectPadding:"padding-left:28px;"},groups:{},propertiesSource:{selectPadding:"value"}}},propertiesSource:{}}}),define.oldSkin({name:"wixapps.integration.skins.inputs.BUISelectorSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_tags:[],_params:[],_html:'<div skinPart="bold" skin="wysiwyg.editor.skins.inputs.CheckBoxImageSkin"></div><div skinPart="underline" skin="wysiwyg.editor.skins.inputs.CheckBoxImageSkin"></div><div skinPart="italic" skin="wysiwyg.editor.skins.inputs.CheckBoxImageSkin"></div>',_css:["{ margin-left:4px; }","%bold%, %underline%, %italic%{ display:inline-block; }"]}}),define.skin("wixapps.integration.skins.inputs.CheckBoxInputInlineSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"bg",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#ffffff",enableEdit:!0},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#999999",enableEdit:!0},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"1px",enableEdit:!0},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0px 0px rgba(0, 0, 0, 0.0)",enableEdit:!0},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px",enableEdit:!0},{id:"trns",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"opacity 0.5s ease 0s, border 0.5s ease 0s, color 0.5s ease 0s"},{id:"app",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-appearance:none !important; -moz-appearance:none !important; appearance:none !important;"},{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:"box-sizing:border-box; -moz-box-sizing:border-box; -ms-box-sizing:border-box; -webkit-box-sizing:border-box;"}]),t.html('<fieldset class="fieldSet"><input skinPart="checkBox" type="checkbox"/></fieldset><label skinPart="label"></label>'),t.css(["%.fieldSet% { display: inline-block; margin-right: 10px; vertical-align: middle; }","{ position:relative; cursor:pointer; }",'input[type="checkbox"]         { [app][box][rd][shd] width:18px; height:18px; border:[brw] solid [brd]; background:[bg] url([tdr]vi.png) no-repeat -999px -999px; margin:0px; cursor:pointer; }','input[type="checkbox"]:checked { background-position: 50% 50%; }',"p       { [trns][rd] opacity:0; position:absolute; right:0; bottom:18px; width:140px; padding:10px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.6) }",'p:after { content:""; position:absolute; bottom:-12px; right:10px; color:#fff; text-shadow:0 1px 3px rgba(0,0,0,0.6);  }','[state~="invalid"] :hover + p {  opacity:1; color:#d00; }'])}),define.skin("wixapps.integration.skins.inputs.CheckBoxInputSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"bg",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#ffffff"},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#aaaaaa"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"sz",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"},{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:"box-sizing:border-box !important; -moz-box-sizing:border-box !important; -ms-box-sizing:border-box !important; -webkit-box-sizing:border-box !important;"}]),t.html('<input skinPart="checkBox" type="checkbox"/><div></div><label skinPart="label"></label>'),t.css(["{ position:relative; width:[sz]; height:[sz]; margin-right:[sz]; display:inline-block; overflow:visible;}","input[type=checkbox] { position:absolute; top:-9999px; left:-9999px; overflow:visible; }","label { width:[sz]; height:[sz]; display:block;  position:absolute; top:0; left:0; cursor:pointer;}","div   { width:[sz]; height:[sz]; border:1px solid [brd]; background:[bg] url([tdr]vi.png) no-repeat -999px -999px; [rd][box]}","input[type=checkbox]:checked ~ div { background-position: 50% 50%; }","input%input%.isPlaceholder{color: #999;}"])}),define.skin("wixapps.integration.skins.inputs.ComboBoxInputSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"4px"},{id:"borderColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#c4c4c4"},{id:"borderColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#89a4af"},{id:"bgColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f9fafc"},{id:"bgColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f2f3f5"},{id:"bgColorPressed",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f3f3f3"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.2"},{id:"shadowInsetColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.7"},{id:"shadowInsetColorOver",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"255,255,255,.7"}]),t.html('<select skinpart="collection"></select>'),t.css(['::after{content: ""; position: absolute;right: 3px ;top: 2px; color:#3095CB; font-size:25px;}',"%collection% {width: 200px; border: none; -webkit-appearance: none; background-color: transparent; padding: 5px;  cursor:pointer;}","{width:200px; border: 1px solid [borderColor]; [$borderRadius] background:[bgColor] url([webThemeDir]button/button-gradient.png) repeat-x 0 50%; position:relative; text-align:center;}",":hover {border:1px solid [borderColorOver]; background:[bgColorOver] none; box-shadow:0 2px 3px 0 [shadowColor], 0 1px 2px 0 [shadowInsetColorOver] inset; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:""; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.oldSkin({name:"wixapps.integration.skins.inputs.InlineTextInputSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_tags:[],_params:[],_html:'<div><div skinpart="preview"></div><input skinpart="input" type="text"></div></div>',_css:['[state~="preview"] %input% { display: none; }','[state~="input"] %preview% { display: none; }',"%preview%:hover { border:1px solid #C3C3C3; padding:1px 3px; }"]}}),define.skin("wixapps.integration.skins.inputs.LocationSelectorSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"}]),t.html('<div class="clearfix"><div skinpart="container"><input skinpart="address" type="text" /><div skinpart="viewMode"></div></div><div skinpart="message"></div></div>'),t.css(["%container% { height:30px; line-height:30px; padding-right:35px; position:relative; }","%address% { width:100% }","%viewMode% { width:30px; height:30px; position:absolute; right:0px; top:0px; }",'[state~="loading"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/loading.gif) center center no-repeat; }','[state~="error"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/icon_x.png) center center no-repeat; }','[state~="found"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/icon_v.png) center center no-repeat; }','[state~="search"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/spy_glass.png) center center no-repeat; cursor:pointer; }','[state~="invalid"] %message% { height:20px; line-height:20px; color:#d00; font-size:12px; }'])}),define.skin("wixapps.integration.skins.inputs.RichTextEditorSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"f0",type:"cssFont",defaultTheme:"font_0",name:"",usedInLogic:!0},{id:"f1",type:"cssFont",defaultTheme:"font_1",name:"",usedInLogic:!0},{id:"f2",type:"cssFont",defaultTheme:"font_2",name:"",usedInLogic:!0},{id:"f3",type:"cssFont",defaultTheme:"font_3",name:"",usedInLogic:!0},{id:"f4",type:"cssFont",defaultTheme:"font_4",name:"",usedInLogic:!0},{id:"f5",type:"cssFont",defaultTheme:"font_5",name:"",usedInLogic:!0},{id:"f6",type:"cssFont",defaultTheme:"font_6",name:"",usedInLogic:!0},{id:"f7",type:"cssFont",defaultTheme:"font_7",name:"",usedInLogic:!0},{id:"f8",type:"cssFont",defaultTheme:"font_8",name:"",usedInLogic:!0},{id:"f9",type:"cssFont",defaultTheme:"font_9",name:"",usedInLogic:!0},{id:"f10",type:"cssFont",defaultTheme:"font_10",name:"",usedInLogic:!0},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.1"}]),t.html('<div skinPart="frame"><div skinPart="richTextContainer" class="richTextContainer"></div></div>'),t.css(["{ background-color:#fff; }","%frame% { [$borderRadius]; border: 1px solid #b4b4b4; box-shadow: 0 1px 1px 0 [shadowColor] inset; padding:2px; position: relative; }","%richTextContainer% { position:relative; width:100%; height:100%; overflow-y:auto; word-wrap: break-word; }"])}),define.skin("wixapps.integration.skins.inputs.SubmitInputMessageAboveButtonSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.1"}]),t.compParts({button:{skin:"wysiwyg.editor.skins.buttons.ButtonSmallerSkin"}}),t.html('<div class="clearfix"><label skinpart="label"></label><input skinpart="input" type="text" /><div skinpart="message"></div><div class="submitInputContainer"><div skinpart="button"></div></div></div>'),t.css(['[state~="hasLabel"] %label% {display:block; padding-bottom: 5px;}',"input%input% {width:100%; margin:0 0 5px 0; padding: 0 3px; line-height: 1.1em; height: 1.8em; font-size:1em; [$borderRadius]; border: 1px solid #b4b4b4; box-shadow: 0 1px 1px 0 [shadowColor] inset;}","%input%:hover{border-color: #a3d9f6; }","%input%:focus{border-color: #19a0e9; }","%.submitInputContainer%{text-align:right;}","%button% {display:inline-block;}","[disabled] %label% {opacity:0.5;}",'[state~="invalid"] input%input%{background: #f6e0dd; border-color: #de4c3a}','[state~="invalid"] %message% {color: #de4c3a; font-size: .916em;}',"input%input%.isPlaceholder {color: #999; }"])}),define.skin("wixapps.integration.skins.inputs.TextInputWithIconSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:"themeUrl",defaultTheme:"WEB_THEME_DIRECTORY"}]),t.html('<div class="clearfix"><label skinpart="label"></label><p class="container"><span class="sepLine"></span><input skinpart="input" type="text"></p><div skinpart="message"></div></div>'),t.css([" .singleLine { white-space:nowrap; display:block; overflow:hidden; text-overflow:ellipsis; word-wrap:normal; }","%.container% { position:relative; background:transparent url([webThemeDir]lists/appbuilder_sprite.png) -558px -19px     no-repeat; font-size: 1em;  border-radius: 3px; border: 1px solid #B4B4B4; border-image: initial; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 1px 1px 0px inset; background-color: #FFF;margin: 0px 0px 5px; cursor:pointer; padding: 0px 3px; padding-left:20px; min-width:1px; min-height:23px; line-height: 23px; vertical-align: middle;}","%input% { border: none; width: 100%; padding-left: 10px; font-size: 14px;}","%.sepLine% { position: absolute; height:19px; top:3px; left: 24px; absolute; width: 1px; border-left: solid 1px #B4B4B4; margin-right: 5px; }"])}),define.skin("wixapps.integration.skins.inputs.TextLinkSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"f0",type:"cssFont",defaultTheme:"font_0",name:"",usedInLogic:!0},{id:"f1",type:"cssFont",defaultTheme:"font_1",name:"",usedInLogic:!0},{id:"f2",type:"cssFont",defaultTheme:"font_2",name:"",usedInLogic:!0},{id:"f3",type:"cssFont",defaultTheme:"font_3",name:"",usedInLogic:!0},{id:"f4",type:"cssFont",defaultTheme:"font_4",name:"",usedInLogic:!0},{id:"f5",type:"cssFont",defaultTheme:"font_5",name:"",usedInLogic:!0},{id:"f6",type:"cssFont",defaultTheme:"font_6",name:"",usedInLogic:!0},{id:"f7",type:"cssFont",defaultTheme:"font_7",name:"",usedInLogic:!0},{id:"f8",type:"cssFont",defaultTheme:"font_8",name:"",usedInLogic:!0},{id:"f9",type:"cssFont",defaultTheme:"font_9",name:"",usedInLogic:!0},{id:"f10",type:"cssFont",defaultTheme:"font_10",name:"",usedInLogic:!0}]),t.html(""),t.css(["{ position:relative; cursor:pointer; color:#09f; width:100%; height:100%; word-wrap: break-word; }"," span { color:#09f; }"," span:hover { text-decoration:underline }"," p { color:#09f; }"," p:hover { text-decoration:underline }"])}),define.oldSkin({name:"wixapps.integration.skins.inputs.TimeInputSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_tags:[],_params:[],_html:'<div class="clearfix"><select skinpart="hours24"></select><select skinpart="hours12"></select><select skinpart="minutes"></select><select skinpart="seconds"></select><select skinpart="ampm"></select><div skinpart="message"></div></div>',_css:['[state~="24h"] %hours24% { display: inline; }','[state~="24h"] %hours12% { display: none; }','[state~="24h"] %ampm% { display: none; }','[state~="12h"] %hours24% { display: none; }','[state~="12h"] %hours12% { display: inline; }','[state~="12h"] %ampm% { display: inline; }','[state~="hours"] %minutes% { display: none; }','[state~="hours"] %seconds% { display: none; }','[state~="half-hour"] %seconds% { display: none; }','[state~="quarter-hour"] %seconds% { display: none; }','[state~="minutes"] %minutes% option { display: inline; }','[state~="minutes"] %seconds% { display: none; }','[state~="allowEmpty"] option.empty { display: inline; }','[state~="hideEmpty"] option.empty { display: none; }',"%message% { visibility:hidden; height:20px; line-height:20px; color:#d00; font-size:12px; }",'[state~="invalid"] %message% { visibility:visible; }']}}),define.Class("wixapps.integration.utils.FlexBoxIESupport",function(e){var t=e;t.binds(["_ie_recalcFlexes","_ie_onAppPartResize","_ie_resizeHandler"]),t.statics({_boxProxies:[]}),t.fields({_boxFlexes:[],_boxFlexList:[],_ie_boxAlignCssMap:{vertical:{start:"left",center:"center",end:"right"},horizontal:{start:"top",center:"middle",end:"bottom",baseline:"baseline"}}}),t.methods({initialize:function(){},_boxFlexes:[],_boxFlexList:[],_ie_boxAlignCssMap:{vertical:{start:"left",center:"center",end:"right"},horizontal:{start:"top",center:"middle",end:"bottom",baseline:"baseline"}},applyIESupport:function(){this._applyDisplayStyle=this._ie_applyDisplayStyle,this._processBoxFlex=this._ie_processBoxFlex,this._finalizeLayout=this._ie_recalcFlexes,this._ie_replaceResizeEventMechanism(this._element),Array.forEach(this._element.children,function(e){this._ie_replaceResizeEventMechanism(e)}.bind(this)),this._registerResizeListeners();var e=this._getParentBoxProxies();0===e.length&&(this.addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._ie_onAppPartResize),this._finalizeLayout=this._ie_onAppPartResize),window._boxProxies=window._boxProxies||[],window._boxProxies.push({proxy:this,depth:e.length})},_ie_replaceResizeEventMechanism:function(e){e.onresize||(e.onresize=function(){e.fireEvent("resize")})},_ie_onAppPartResize:function(){if(this._element){var e=window._boxProxies.sort(function(e,t){return e.depth-t.depth});e.reverse().forEach(function(e){e.proxy._ie_onResize()}),e.forEach(function(e){e.proxy._ie_onResize()})}},_registerResizeListeners:function(){this._element.addEvent("resize",this._ie_resizeHandler),Array.forEach(this._element.children,function(e){e.addEvent("resize",this._ie_resizeHandler)}.bind(this))},_ie_resizeHandler:function(){this._ie_onResize()},_ie_onResize:function(){this._element&&("horizontal"===this._orientation,this._ie_recalcFlexes())},_ie_applyDisplayStyle:function(e){var t="horizontal"==e?"inline-block":"block",i="horizontal"==e?"height":"width",n={display:t},a=this._def.getChildValue("box-align"),s=a?this._translateBoxAlignValues(e,a):"start";"horizontal"===e?n["vertical-align"]=this._ie_boxAlignCssMap[e][s]:n["text-align"]=this._ie_boxAlignCssMap[e][s],this._applyToChildren(function(e){e.setStyles(n)}),"height"===i&&"start"==s&&this._ie_stretchChildrenVertically()},_ie_resetChildrenToStretch:function(){this._childrenToStretch&&this._childrenToStretch.forEach(function(e){e.style.height="",e.style["min-height"]="0"})},_ie_stretchChildrenVertically:function(){var e=this._element.getSize().y;this._ie_resetChildrenToStretch(),e>0&&(this._childrenToStretch=this._ie_getChildrenToStretch(),this._ie_getChildrenToStretch().forEach(function(t){t.setStyle("min-height",e-2),t.setStyle("height","100%")}.bind(this)))},_ie_getChildrenToStretch:function(){return Array.filter(this._element.children,function(e){return!e.style.height})},_ie_processBoxFlex:function(e,t){void 0===t["box-flex"]||this._boxFlexList.contains(e)||(this._element.setStyle("white-space","nowrap"),void 0===t["white-space"]&&(t["white-space"]="normal"),this._boxFlexList.push(e),this._boxFlexes.push({element:e,flex:t["box-flex"]})),delete t["box-flex"]},_applyToChildren:function(e){for(var t=0;this._element.children.length>t;t++)e.call(this,this._element.children[t],t,this._element.children.length)},_ie_recalcFlexes:function(){var e=0,t=0,i=0,n=0;this._applyToChildren(function(t){this._boxFlexList.contains(t)||(e+=this._getSize(t,!0))
}.bind(this)),t=this._getSize(this._element,!1)-e,this._boxFlexes.forEach(function(e){n+=parseInt(e.flex,10)}),i=t/n,this._boxFlexes.forEach(function(e){this._setSize(e.element,Math.floor(i*e.flex)-1)}.bind(this))},_getSize:function(e,t){var i,n=e.getSize(),a=t===!0?this._getExtraSpace(e,this._orientation):0;return i="horizontal"==this._orientation?n.x+a:n.y+a},_setSize:function(e,t){var i,n=0;n=this._getExtraSpace(e,this._orientation),i="horizontal"==this._orientation?"width":"height";var a=Math.max(t-n,0),s=e.getStyle(i),o=s.contains("%")?1/0:parseInt(s,10);Math.abs(a-o)>1&&e.setStyle(i,a+"px")},_getExtraSpace:function(e,t){var i;return t=t||this._orientation,i="horizontal"==t?(parseInt(e.getComputedStyle("margin-left"),10)||0)+(parseInt(e.getComputedStyle("margin-right"),10)||0):(parseInt(e.getComputedStyle("margin-top"),10)||0)+(parseInt(e.getComputedStyle("margin-bottom"),10)||0)},_getParentBoxProxies:function(){var e=Array.filter(this._element.getParents("[hasproxy]"),function(e){return e.getViewProxy().className.contains("BoxLayoutProxy")});return e.reverse()},dispose:function(){this.removeEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._ie_onAppPartResize),this._element.removeEvent("resize",this._ie_resizeHandler),Array.forEach(this._element.children,function(e){e.removeEvent("resize",this._ie_resizeHandler)}.bind(this)),this.parent()}})}),define.Class("wixapps.integration.utils.FunctionCallThrottle",function(e){var t=e;t.statics({createThrottle:function(e,t){var i=!1,n=null;return function(){var a=Array.from(arguments);i?n={args:a,that:this}:(e.apply(this,a),i=!0,window.setTimeout(function(){i=!1,null!==n&&(e.apply(n.that,n.args),n=null)},t))}},debounceFunction:function(e,t){var i=!1,n=null,a=null;return function(){i=!0,n={args:Array.from(arguments),that:this},null!==a&&(window.clearTimeout(a),a=null),a=window.setTimeout(function(){null!==n&&(e.apply(n.that,n.args),n=null),i=!1,a=null},t)}}})}),define.Class("wixapps.integration.utils.GeometryUtils",function(e){var t=e;t.fields({}),t.utilize(["wixapps.core.utils.Map"]),t.methods({calculateBoundaryOverflowSum:function(e,t){var i={width:0,height:0};return this.getOverflowRegions(e,t).forEach(function(e){i.width+=e.left+e.right,i.height+=e.top+e.bottom}),i},getOverflowRegions:function(e,t){var i=new this.imports.Map,n=Array.slice(e.getElementsByTagName("*"));return n.unshift(e),n.forEach(function(e){if(1==e.nodeType&&e.getAttribute("hasproxy")){var n=t.get(e),a=t.get(e.parentNode),s=i.get(e.parentNode);s||(s={container:e.parentNode,left:0,top:0,right:0,bottom:0},i.put(e.parentNode,s)),(n.width>0||n.height>0)&&(n.left<a.left&&(s.left=Math.max(s.left,a.left-n.left)),n.right>a.right&&(s.right=Math.max(s.right,n.right-a.right)),n.top<a.top&&(s.top=Math.max(s.top,a.top-n.top)),n.bottom>a.bottom&&(s.bottom=Math.max(s.bottom,n.bottom-a.bottom)))}}.bind(this)),i.getValues().filter(function(e){return Boolean(e.left||e.right||e.top||e.bottom)})}})}),define.Class("wixapps.integration.utils.LayoutGeometryMap",function(e){var t=e;t.utilize(["wixapps.core.utils.Map"]),t.fields({_container:null,_elementMap:null}),t.methods({initialize:function(){this._elementMap=new this.imports.Map},setContainer:function(e){this._container=e,this._elementMap.clear()},get:function(e){var t=this._elementMap.get(e);return void 0===t&&(t=this._createInfo(this._container,e),this._elementMap.put(e,t)),t},updateMap:function(e){this._elementMap.clear();var t=function(e){e.getAttribute("hasproxy")&&this.get(e)}.bind(this);t(e);for(var i=e.getElementsByTagName("*"),n=0;i.length>n;n++)t(i[n])},reset:function(){this._elementMap.clear()},_createInfo:function(e,t){return t.getCoordinates(e)},dispose:function(){this._container=null,this._elementMap.clear()}})}),define.Class("wixapps.integration.utils.ParagraphClipping",function(e){var t=e;t.fields({_reusable:!1,_lastTextContent:null,_lineRectCache:null,_spanList:null,_cache:[],_ellipsisSpan:null,_container:null,_maxWidth:0/0,_maxHeight:0/0,_lastCropIndex:-1,_ellipsisShown:!1}),t.methods({clipParagraph:function(e,t,i,n){if(this._maxWidth!==i||this._maxHeight!==n||e!==this._lastTextContent){this._container=t,this._lastTextContent!==e&&(this._lastTextContent=e,this.rebuildCache(e,t));var a=i-this._maxWidth,s=n-this._maxHeight;this._reusable||this.rebuildCache(e,t),0!==a&&(this._cache=[]),this._maxWidth=i,this._maxHeight=n,isNaN(a)||a>.1*i||s>.1*n?this._cropParagraph(this._spanList,function(){return this._searchBinary(0,this._spanList.length-1)}.bind(this)):a>0||0===a&&s>0?this._cropParagraph(this._spanList,function(){return this._searchSequentially(this._lastCropIndex,1)}.bind(this)):this._cropParagraph(this._spanList,function(){return this._searchSequentially(this._lastCropIndex,-1)}.bind(this))}},rebuildCache:function(e,t){this.resetCache(),this._reusable=!0,this._prepareContent(e,t),this._createEllipsisSpan(t),this._cache=[]},getLastTextContent:function(){return this._lastTextContent},resetCache:function(){this._reusable=!1,this._maxWidth=0/0,this._maxHeight=0/0,this._lastCropIndex=-1},isClipped:function(){return this._ellipsisShown},showEllipsis:function(){this._ellipsisSpan&&this._ellipsisSpan.setStyles({display:"inline"})},hideEllipsis:function(){this._ellipsisSpan&&this._ellipsisSpan.setStyles({display:"none"})},_prepareContent:function(e,t){var i=this._wrapWordsInSpans(e);t.set("html",i),this._spanList=t.getElements("span").filter(function(e){return 1==e.childNodes.length&&3==e.firstChild.nodeType&&e!==this._ellipsisSpan}.bind(this))},_createEllipsisSpan:function(){this._spanList.length>0&&(this._ellipsisSpan=new Element("span"),this._ellipsisSpan.setStyles({position:"absolute"}),this._spanList[this._spanList.length-1].getParent().adopt(this._ellipsisSpan))},_showSpan:function(e){e.setStyle("visibility","visible")},_hideSpan:function(e){e.setStyle("visibility","hidden")},_getSpanRect:function(e){return this._cache[e]||(this._cache[e]=this._spanList[e].getContentRect(this._container)),this._cache[e]},_testPoint:function(e){var t;if(e>=0&&this._spanList.length>e){var i=this._getSpanRect(e);t=i.bottom<=this._maxHeight}else t=!1;return t},_searchSequentially:function(e,t){if(this._testPoint(e)&&!this._testPoint(e+1))return e;var i=e+t;return i>=0&&this._spanList.length>i?this._searchSequentially(e+t,t):-1},_searchBinary:function(e,t){var i=Math.floor((e+t)/2),n=this._testPoint(i);return n&&!this._testPoint(i+1)?i:n?this._searchBinary(i,t):this._searchBinary(e,i)},_cropParagraph:function(e,t){var i;i=this._testPoint(0)===!1?0:this._testPoint(e.length-1)?e.length-1:t(),-1!==i&&(i=this._addEllipsis(i),this._lastCropIndex=i,e.forEach(function(e,t){i>t?this._showSpan(e):this._hideSpan(e)}.bind(this)),!this._ellipsisShown&&this._spanList[i]&&this._showSpan(this._spanList[i]))},_addEllipsis:function(e){if(e>=0&&this._spanList.length-1>e){this._ellipsisShown=!0;var t=this._spanList[e];this._ellipsisSpan.set("text",t.firstChild.nodeValue+""+"...");var i=t.getContentRect(this._container),n=this._getFontStyleShorthand(t),a=t.getStyle("color");if(this._ellipsisSpan.setStyles({visibility:"visible",left:i.left,top:i.top,font:n,color:a}),this._ellipsisSpan.getContentRect(this._container).right>this._maxWidth)return this._addEllipsis(e-1)}else this._ellipsisShown=!1,this._ellipsisSpan&&this._ellipsisSpan.setStyles({visibility:"hidden"});return e},_getFontStyleShorthand:function(e){var t=e.getStyle("font");return t?t.replace(/\/\S+/,"/normal"):Array.reduce(["font-style","font-variant","font-weight","font-size","line-height","font-family"],function(t,i){var n=e.getStyle(i);return"line-height"==i?t+"/normal ":t+" "+n},[])},_wrapWordsInSpans:function(e){for(var t=e.replace(/</g," <").replace(/>/g,"> "),i=t.split(/\s+/),n=this._joinHtmlTags(i),a="",s=!1,o=0;n.length>o;o++){var r=n[o].trim();r&&r.test(/^[^<>]*$/)?(a+=s?" ":"",a+="<span>"+r+"</span>",s=!0):(a+=r,s=!1)}return a},_joinHtmlTags:function(e){var t,i=[],n="",a="";for(t=0;e.length>t;t++)n=e[t],0!==n.length&&("<"!==n.substr(0,1)||n.contains(">")?">"!==n.substr(-1)?a.length?a+=" "+n:i.push(n.trim()):(a+=" "+n,i.push(a.trim()),a=""):a=n);return i}})}),define.Class("wixapps.integration.utils.ParagraphLinesMap",function(e){var t=e;t.binds(["_isParagraph"]);var i=[/^p$/,/^div$/,/^h\d+$/];t.fields({_lineMap:[],_maxWidth:0,_maxLines:0/0}),t.methods({updateMap:function(e){this._lineMap=this.getContainerRectList(e),this._containerTop=e.getBoundingClientRect().top},getLineNum:function(){return this._lineMap.length},getParagraphHeight:function(e){var t=Math.min(this._lineMap.length,e);return t>0?this._lineMap[t-1].bottom-this._containerTop+1:0},_isParagraph:function(e){var t=e.tagName.toLowerCase();return Array.some(i,function(e){return t.match(e)})},getContainerRectList:function(e){var t,i=e.getElements("*").filter(this._isParagraph);0===i.length&&(i=[e]);var n=i.reduce(function(e,t){return e.concat(Array.slice(t.children,0))},[]);t=n.length>0?n.reduce(function(e,t){return e.concat(Array.slice(t.getClientRects(),0))},[]):i.reduce(function(e,t){return e.concat(Array.slice(t.getClientRects(),0))},[]),0===t.length&&(t=Array.slice(e.getClientRects()));var a=t.reduce(function(e,t){if(0===e.length)return[t];var i=e.indexOfByPredicate(function(e){var i=t.top<=e.top&&t.bottom>=e.bottom,n=e.top<=t.top&&e.bottom>=t.bottom;return i||n});return-1===i?e.concat(t):(e[i].height<t.height&&(e[i]=t),e)},[]);return a}})}),define.Class("wixapps.integration.utils.PerformanceTracker",function(e){var t=e,i=0,n={},a=[];t.methods({startTracking:function(e,t){var s=i++;return n[s]={label:e,start:(new Date).getTime()},this._markTimeline(this._createStartString(s)),t&&console.profile&&(console.profile(e),n[s].cpuProfileOn=!0),a.push(s),s},endTracking:function(e){var t=n[e];t&&(t.end=(new Date).getTime(),this._markTimeline(this._createEndString(e)),t.cpuProfileOn&&console.profileEnd())},_createEndString:function(e){var t=n[e],i=t.end-t.start;return"[ END ] [ "+t.label+" ][ "+i+"ms ][ "+e+" ] "},_createStartString:function(e){var t=n[e];return t.end-t.start,"[ START ] [ "+t.label+" ][ "+e+" ] "},_markTimeline:function(e){console.markTimeline?console.markTimeline(e):console.timeStamp&&console.timeStamp(e)},printReport:function(e){for(var t=0;a.length>t;t++){var i=a[t],s=n[i];if(s){if(e&&s.label!=e)return;var o=s.end-s.start;console.log(i+"[ "+s.label+"] took "+o)}}},clearTimeTracking:function(){}})}),define.Class("wixapps.integration.utils.ProxySelector",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["_onMouseMove","_onContentSelectorDblClick","_onContentSelectorDown"]),t.statics({SELECTION_ACTION:"selectionAction",ACTION_MOUSE_DOWN:"actionMouseDown",ACTION_DOUBLE_CLICK:"actionDoubleClick",ACTION_ROLL_OVER:"actionRollOver"}),t.fields({_editedComponent:null,_selectionFilter:null,_editBoxView:null,_stopClickPropagation:!1}),t.methods({activateProxySelector:function(e,t){this._editedComponent=e,this._selectionFilter=t;var i=this._getEditingLayer();i.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onContentSelectorDown),i.addEvent("dblclick",this._onContentSelectorDblClick)},deactivateProxySelector:function(){var e=this._getEditingLayer();e.removeEvent(Constants.CoreEvents.MOUSE_DOWN,this._onContentSelectorDown),e.removeEvent("dblclick",this._onContentSelectorDblClick),this._editedComponent=null,this._selectionFilter=null},deactivateProxySelectorIfActivated:function(){var e=this._getEditingLayer();e&&this.deactivateProxySelector()},stopClickPropagation:function(){this._stopClickPropagation=!0},enableClickPropagation:function(){this._stopClickPropagation=!1},_getEditingLayer:function(){return $$("#editorUI")[0].getLogic().getSkinPart("componentEditBox").getViewNode()},_getRelatedComponents:function(e){var t=e.getViewProxy().getViewDefinition(),i=this._editedComponent.getSkinPart("inlineContent").getElements("[hasproxy]");return i.filter(function(e){return e.getViewProxy().getViewDefinition()===t})},_calcComponentCoordinates:function(e){return e.getCoordinates()},_isInside:function(e,t){return e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom},_filterByPosition:function(e,t){var i=this._calcComponentCoordinates(t);if("span"===t.get("tag")){var n=t.getClientRects(),a=window.getScroll();return Array.map(n,function(e){return e=Object.clone(e),e.top+=a.y,e.bottom+=a.y,e}).some(function(t){return this._isInside(e,t)}.bind(this))}return this._isInside(e,i)},_listElements:function(e,t){var i=[],n=t.getChildren();return Array.forEach(n,function(t){var n=!1;this._filterByPosition(e,t)?(i.push(t),n=!0):("absolute"===t.getStyle("position")||"a"==t.get("tag"))&&(n=!0),n&&(i=i.concat(this._listElements(e,t)))}.bind(this)),i},_findComponents:function(e){var t=this._listElements(e,this._editedComponent.getSkinPart("inlineContent"));return t.reverse().filter(function(e){return e.hasAttribute("hasproxy")}).map(function(e){return e.getViewProxy()}).filter(this._selectionFilter)},_onMouseMove:function(e){this._handleMouseAction(e,this.ACTION_ROLL_OVER)},_onContentSelectorDown:function(e){this._stopClickPropagation&&(e.stopPropagation(),e.preventDefault()),this._handleMouseAction(e,this.ACTION_MOUSE_DOWN)},_onContentSelectorDblClick:function(e){this._handleMouseAction(e,this.ACTION_DOUBLE_CLICK)},_handleMouseAction:function(e,t){var i=this.injects().Preview.editorToPreviewCoordinates(e.client),n=this._findComponents(i);n.length>0&&this._sendNotification(t,n)},_sendNotification:function(e,t){this.fireEvent(this.SELECTION_ACTION,{action:e,proxyList:t})}})}),define.Class("wixapps.integration.utils.RichTextClippingUtils",function(e){var t=e;t.methods({findClippedText:function(e,t,i,n){this._findClippedTextCommon(e,t,function(e){return this._isAcceptableSize(e,i,n)}.bind(this))},findClippedTextByLines:function(e,t,i,n){this._findClippedTextCommon(e,t,function(e){return this._isAcceptableByLines(e,i,n)}.bind(this))},_findClippedTextCommon:function(e,t,i){var n=e.replace(/</g," <").replace(/>/g,"> "),a=n.split(/\s+/),s=this._joinHtmlTags(a);this._findClippedTextRecursive(s,t,i,0,s.length,0)},_joinHtmlTags:function(e){var t,i=[],n="",a="";for(t=0;e.length>t;t++)n=e[t],0!==n.length&&(/<\/\w+>/.test(n)?i[i.length-1]+=n:"<"!==n.substr(0,1)||n.contains(">")?">"!==n.substr(-1)?a.length?a+=" "+n:i.push(n):(a+=" "+n,i.push(a),a=""):a=n);return i},_findClippedTextRecursive:function(e,t,i,n,a,s){for(var o,r=Math.floor((n+a)/2),l=Boolean(e.length-1>r),p=l?e.slice(0,r):e;/<.+>/.test(p[p.length-1]);)o=p.pop(),"<"!==o.charAt(0)&&p.push(o.split("<")[0]);var d=p.join(" ").concat(l?"...":"");if(t.set("html",d),15>s){var h=i(t);if(1==h)return this._findClippedTextRecursive(e,t,i,n,r,s+1),void 0;if(-1==h)return this._findClippedTextRecursive(e,t,i,r,a,s+1),void 0}"..."==t.get("text")&&t.set("text","")},_isAcceptableSize:function(e,t,i){var n=0,a=this.getContainerRectList(e);if(a.length>0){var s=a[a.length-1].bottom-a[0].top,o=a[a.length-1].width;s>i?n=1:i-s>20?n=-1:.9>o/t&&(n=-1)}return n},_isAcceptableByLines:function(e,t,i){var n=0,a=this.getContainerRectList(e);if(a.length>0){var s=a[a.length-1].width;a.length>i?n=1:i>a.length?n=-1:.9>s/t&&(n=-1)}return n},getMinimalHeight:function(e,t){var i=this.getContainerRectList(e);if(i.length>=t)return i[t-1].bottom-i[0].top;var n=(i[i.length-1].bottom-i[0].top)/i.length;return Math.round(n*t)},getContainerRectList:function(e){var t,i=e.getElements("*").filter(function(e){return"block"==e.getStyle("display")});0===i.length&&(i=[e]);var n=i.reduce(function(e,t){return e.concat(Array.slice(t.children,0))},[]);t=n.length>0?n.reduce(function(e,t){return e.concat(Array.slice(t.getClientRects(),0))},[]):i.reduce(function(e,t){return e.concat(Array.slice(t.getClientRects(),0))},[]),0===t.length&&(t=Array.slice(e.getClientRects()));var a=t.reduce(function(e,t){if(0===e.length)return[t];var i=e.indexOfByPredicate(function(e){var i=t.top<=e.top&&t.bottom>=e.bottom,n=e.top<=t.top&&e.bottom>=t.bottom;return i||n});return-1===i?e.concat(t):(e[i].height<t.height&&(e[i]=t),e)},[]);return a}})}),define.Class("wixapps.integration.utils.SelectionMarker",function(e){var t=e;t.fields({_markedElements:[]}),t.methods({markSelectedSubComponent:function(e){this.markSingleComponent(e),this._tooltipShown===!1&&(this._tooltipShown=!0)},unmarkSelectedSubComponent:function(){this._markedElements.forEach(this.unMarkSingleComponent),this._markedElements=[]},getMarkedElements:function(){return this._markedElements},markSingleComponent:function(e,t){var i=2;"inline"===e.getStyle("display")&&(i=0),e.setStyles({"outline-style":"dashed","outline-width":"1px","outline-color":t===!0?this._selectionEditColor:this._selectionRollOverColor,"outline-offset":i+"px"}),this._markedElements.push(e)},unMarkSingleComponent:function(e){e.setStyles({outline:"none"})},initUIColors:function(e,t){var i=e.getPropertiesAccordingToType("color"),n=i.map(function(t){return e.getProperty(t)}),a=this._getParentCompBgColor(e,t)||this._getDocumentBgColor(e);if(a){var s=this._getHighlightColors(a,n);this._selectionRollOverColor=s[0],this._selectionEditColor=s[1]}else this._selectionRollOverColor="#999",this._selectionEditColor="#333"},_getParentCompBgColor:function(e,t){var i="",n=t.getParentComponent();if(n&&n.getStyle()){var a=n.getStyle(),s=(a.get||a.getProperty).call(n.getStyle(),"bg");if(s){var o=a.getPropertySource("bg");"theme"==o?i=e.getProperty(s):"value"==o&&(i=s)}}return i},_getDocumentBgColor:function(e){var t,i=e.getProperty("siteBg");return i&&(t=i.getColorReference()),e.getProperty(t||"color_0")},_getHighlightColors:function(e,t){var i=this,n=t.map(function(t){return{color:t,contrast:i._getContrastValue(t,e)}}).sort(function(e,t){return t.contrast-e.contrast}).map(function(e){return""+e.color}).filter(function(e,t,i){return!i.slice(0,t).contains(e)});return[n[2],n[4]]},_getContrastValue:function(e,t){return Math.abs(e._l-t._l)}})}),define.Class("wixapps.integration.utils.flex.BoxFlexPolyfill",function(e){var t=e;t.utilize(["wixapps.integration.utils.flex.ComputedFlex","wixapps.integration.utils.flex.NativeFlex","wixapps.integration.utils.flex.WebkitFlex","wixapps.integration.utils.flex.FirefoxFlex","wixapps.integration.utils.flex.MSIEFlex"]),t.statics({forceComputedFlex:void 0,forceLegacyFlex:void 0,applyBoxFlexPolyfill:function(e){void 0===this.forceComputedFlex&&(this.forceComputedFlex="true"===W.Utils.getQueryParam("forceComputedFlex")),void 0===this.forceLegacyFlex&&(this.forceLegacyFlex="true"===W.Utils.getQueryParam("forceLegacyFlex"));var t=this.createFlexPolyfill(e);this._applyPolyfillToElement(e,t)},_applyPolyfillToElement:function(e,t){e.$flexPolyfill=t;var i=e.setStyle.bind(e);e.setStyle=function(e,n){t.setStyle(e,n,i)}},createFlexPolyfill:function(e){var t;if(this.forceComputedFlex||!Modernizr.flexbox&&!Modernizr.flexboxlegacy)t=new this.prototype.imports.ComputedFlex(e);else{var i=this.forceLegacyFlex===!0||!Boolean(Modernizr.flexbox);t=Browser.chrome||Browser.safari?new this.prototype.imports.WebkitFlex(i):Browser.firefox?new this.prototype.imports.FirefoxFlex(i):Browser.ie?new this.prototype.imports.MSIEFlex:new this.prototype.imports.NativeFlex}return t}})}),define.Class("wixapps.integration.utils.flex.ComputedFlex",function(e){var t=e;t.utilize(["wixapps.integration.utils.flex.FlexGeometry"]),t.fields({_element:null,_direction:"column",_flexSuperNode:null,_depth:0,_flexGeometry:null,_flexValue:0/0,_alignment:"",_styleCache:{},_box0:null}),t.methods({initialize:function(e){this._element=e},setStyle:function(e,t,i){this._styleCache[e]=t,"display"!==e||"box"!==t&&"flex"!==t?"box-orient"===e?this._setFlexDirection("horizontal"===t?"row":"column"):"flex-direction"===e?this._setFlexDirection(t):"box-flex"===e||"flex"===e?this.setFlexValue(t):"align-items"==e||"box-align"==e?this._setAlignment(t):i(e,t):this._isFlexDisplay=!0},getCachedStyle:function(e){return this._styleCache[e]},hasCachedStyle:function(e){return void 0!==this._styleCache[e]},clearCachedStyle:function(e){e?delete this._styleCache[e]:this._styleCache={}},getFlexProperties:function(){if(this._element.parentNode.$flexPolyfill){var e=this._element.parentNode.$flexPolyfill.getDirection();return"column"===e?["height","min-height"]:["width"]}return[]},getFlexValue:function(){return this._flexValue},setFlexValue:function(e){if(e=parseInt(e,10),!e&&this._flexValue){var t=this._element.parentNode.$flexPolyfill.getDirection();"row"===t?this._element.style.width="initial":"column"===t&&(this._element.style.height="",this._element.style["min-height"]="")}this._flexValue=e},getDirection:function(){return this._direction},updateGeometry:function(){this._flexGeometry=this._flexGeometry||new this.imports.FlexGeometry,this._flexGeometry.clear(),this._updateChildrenStyles();var e=this._updateDescendants();this._traverseDescendants(this._element,function(e){e.parentNode&&e.parentNode.$flexPolyfill&&this._flexGeometry.registerNodeFlexInfo(e,e.$flexPolyfill.getFlexValue(),e.parentNode.$flexPolyfill.getDirection())}.bind(this)),this.isAutoHeight()&&e.unshift(this._element),this._flexGeometry.recalculateFlexNodes(),e.reverse().forEach(function(e){e.$flexPolyfill.updateAutoHeight()}),e.length>0&&this._flexGeometry.recalculateFlexNodes()},_updateDescendants:function(){var e=[];return this._traverseDescendants(this._element,function(t){t.$flexPolyfill&&(t.$flexPolyfill._updateChildrenStyles(),t.$flexPolyfill.isAutoHeight()&&(t.style.height="",e.push(t)))}),e},_traverseDescendants:function(e,t){for(var i=e.getElementsByTagName("*"),n=0;i.length>n;n++){var a=i[n];a.$flexPolyfill&&t(a)}},_setFlexDirection:function(e){"horizontal"===e&&(e="row"),this._direction!==e&&Array.forEach(this._element.children,function(e){e!==this._box0&&e.$flexPolyfill&&e.$flexPolyfill.clearFlexCache()}),this._direction=e},clearFlexCache:function(){this._flexValue&&this.getFlexProperties().forEach(function(e){this.clearCachedStyle(e)}.bind(this))},_setAlignment:function(e){0===e.indexOf("flex-")&&(e=e.substring(5)),this._alignment=e},_updateChildrenStyles:function(){this._updateBox0(),this._isFlexDisplay&&this._element.setStyle("white-space","row"===this._direction?"nowrap":"normal");var e=this._getChildCss(),t=""===this._alignment||"stretch"===this._alignment;Array.forEach(this._element.children,function(i){i!==this._box0&&i.setStyles&&i.style&&(t&&this._applyCrossAxisStretch(i),i.setStyles(e))}.bind(this))},isAutoHeight:function(){return"row"===this._direction&&!this.hasCachedStyle("height")},updateAutoHeight:function(){this._element.style.height=this._element.getSize().y+"px"},_getChildCss:function(){var e={};return this._isFlexDisplay&&(e=this._getAlignmentCss(),e.display="row"===this._direction?"inline-block":"block"),e},_getAlignmentCss:function(){var e={};if("column"===this._direction)switch(this._alignment){case"start":e["margin-left"]="0",e["margin-right"]="auto";break;case"center":e["margin-left"]="auto",e["margin-right"]="auto";break;case"end":e["margin-left"]="auto",e["margin-right"]="0";break;default:e["margin-left"]="",e["margin-right"]=""}else if("row"===this._direction)switch(this._alignment){case"start":e["vertical-align"]="top";break;case"center":e["vertical-align"]="middle";break;case"end":e["vertical-align"]="bottom";break;case"baseline":e["vertical-align"]="baseline";break;default:e["vertical-align"]="top"}return e},_updateBox0:function(){var e=!this._box0&&this._element.children.length>0||this._box0&&this._element.children.length>1,t="row"===this._direction&&e;if(t){if(!this._box0){this._box0=new Element("div");var i=Object.merge({display:"inline-block",width:0},this._getAlignmentCss());"middle"===i["vertical-align"]&&(i["vertical-align"]="baseline"),this._box0.setStyles(i),this._element.insertBefore(this._box0,this._element.children[0])}this._box0.setStyle("height",this._determineBox0Height())}else this._box0&&(this._box0.parentNode&&this._box0.parentNode.removeChild(this._box0),this._box0=null)},_determineBox0Height:function(){switch(this._alignment){case"center":return"50%";case"end":return"100%";default:return"0"}},_applyCrossAxisStretch:function(e){var t="row"==this._direction?"height":"width",i=e.$flexPolyfill?e.$flexPolyfill.hasCachedStyle(t):!0;i||e.setStyle(t,"100%")}})}),define.Class("wixapps.integration.utils.flex.FirefoxFlex",function(e){var t=e;t.inherits("wixapps.integration.utils.flex.NativeFlex"),t.fields({}),t.methods({initialize:function(e){var t;t=e?{display:{box:"-moz-box",flex:"-moz-box"},"box-orient":{_propName_:"-moz-box-orient"},"flex-direction":{_propName_:"-moz-box-orient",column:"vertical",row:"horizontal"},"box-flex":{_propName_:"-moz-box-flex",none:0},flex:{_propName_:"-moz-box-flex"},"align-items":{_propName_:"-moz-box-align","flex-start":"start",center:"center","flex-end":"end","flex-baseline":"baseline"},"box-align":{_propName_:"-moz-box-align"}}:{display:{box:"flex",flex:"flex"},"box-orient":{_propName_:"flex-direction",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"flex-direction"},"box-flex":{_propName_:"flex"},flex:{_propName_:"flex"},"align-items":{_propName_:"align-items"},"box-align":{_propName_:"align-items",start:"flex-start",center:"center",end:"flex-end",baseline:"baseline"}},this.parent(t)}})}),define.Class("wixapps.integration.utils.flex.FlexGeometry",function(e){var t=e;t.utilize(["wixapps.core.utils.Map"]),t.fields({_nodeMap:null,_containerMap:null,_enableBorderWidth:!0}),t.methods({initialize:function(){this._nodeMap=new this.imports.Map,this._containerMap=new this.imports.Map},clear:function(){this._nodeMap.clear(),this._containerMap.clear()},registerNodeFlexInfo:function(e,t,i){if(t=parseInt(t,10)){var n={element:e,flexValue:t};this._nodeMap.put(e,n);var a=e.parentNode,s=this._containerMap.get(a);void 0===s&&(s={element:a,depth:this._getElementDepth(a),direction:i},this._containerMap.put(a,s)),n.containerInfo=s,n.flexProperties=this._getFlexProperties(s)}else this._removeNodeFromMap(e)},_getElementDepth:function(e){return e.parentNode?this._getElementDepth(e.parentNode)+1:0},_removeNodeFromMap:function(e){this._nodeMap.remove(e);var t=e.parentNode;this._nodeMap.getValues().some(function(e){return e.containerInfo.element===t})||this._containerMap.remove(t)},_getFlexProperties:function(e){var t=e.direction;return"column"===t?["height","min-height"]:["width"]},recalculateFlexNodes:function(){this._containerMap.getValues().forEach(function(e){e.extraSpace=0/0,e.flexSubTotal=0});var e=this._nodeMap.getValues().sort(function(e,t){return e.containerInfo.depth-t.containerInfo.depth});e.forEach(function(e){e.containerInfo.flexSubTotal+=e.flexValue,e.flexProperties.forEach(function(t){e.element.setStyle(t,"")})}),e.forEach(function(e){var t=e.containerInfo.direction;isNaN(e.containerInfo.extraSpace)&&(e.containerInfo.extraSpace=this._getContainerExtraSpace(e.containerInfo.element,t));var i=Math.floor(e.flexValue/e.containerInfo.flexSubTotal*e.containerInfo.extraSpace);e.flexProperties.forEach(function(t){e.element.setStyle(t,i)})}.bind(this))},_getContainerExtraSpace:function(e,t){var i="row"===t?"x":"y",n=0;this._enableBorderWidth===!0&&(n="row"===t?parseInt(e.getStyle("border-left-width"),10)+parseInt(e.getStyle("border-right-width"),10):parseInt(e.getStyle("border-top-width"),10)+parseInt(e.getStyle("border-bottom-width"),10));var a=Array.filter(e.children,function(e){return!this._nodeMap.containsKey(e)}.bind(this)).reduce(function(e,t){return e+t.getSize()[i]},0);return Math.max(0,e.getSize()[i]-a-n)}})}),define.Class("wixapps.integration.utils.flex.MSIEFlex",function(e){var t=e;t.inherits("wixapps.integration.utils.flex.NativeFlex"),t.fields({}),t.methods({initialize:function(){var e={display:{box:"-ms-flexbox",flex:"-ms-flexbox"},"box-orient":{_propName_:"msFlexDirection",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"msFlexDirection"},"box-flex":{_propName_:"msFlex"},flex:{_propName_:"msFlex"},"align-items":{_propName_:"msFlexAlign","flex-start":"start","flex-end":"end"},"box-align":{_propName_:"msFlexAlign"}};this.parent(e)}})}),define.Class("wixapps.integration.utils.flex.NativeFlex",function(e){var t=e;t.fields({_cssPropMap:{display:{box:"flex"},"box-orient":{_propName_:"flex-direction",horizontal:"row",vertical:"column"},"box-flex":{_propName_:"flex"},"box-align":{_propName_:"align-items",start:"flex-start",end:"flex-end"}}}),t.methods({initialize:function(e){e&&(this._cssPropMap=e)},setStyle:function(e,t,i){var n,a,s=this._cssPropMap[e];s?(n=s.hasOwnProperty("_propName_")?s._propName_:e,a=s.hasOwnProperty(t)?s[t]:t,i(n,a)):i(e,t)},updateGeometry:function(){}})}),define.Class("wixapps.integration.utils.flex.WebkitFlex",function(e){var t=e;t.inherits("wixapps.integration.utils.flex.NativeFlex"),t.fields({}),t.methods({initialize:function(e){var t;t=e?{display:{box:"-webkit-box",flex:"-webkit-box"},"box-orient":{_propName_:"-webkit-box-orient"},"flex-direction":{_propName_:"-webkit-box-orient",column:"vertical",row:"horizontal"},"box-flex":{_propName_:"-webkit-box-flex"},flex:{_propName_:"-webkit-box-flex"},"align-items":{_propName_:"-webkit-box-align","flex-start":"start",center:"center","flex-end":"end",baseline:"baseline"},"box-align":{_propName_:"-webkit-box-align"}}:{display:{box:"-webkit-flex",flex:"-webkit-flex"},"box-orient":{_propName_:"-webkit-flex-direction",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"-webkit-flex-direction"},"box-flex":{_propName_:"-webkit-flex"},flex:{_propName_:"-webkit-flex"},"align-items":{_propName_:"-webkit-align-items"},"box-align":{_propName_:"-webkit-align-items",start:"flex-start",center:"center",end:"flex-end",baseline:"baseline"}},this.parent(t)},setStyle:function(e,t,i){("flex"===e||"box-flex"===e)&&i("min-width",0),this.parent.apply(this,arguments)}})});
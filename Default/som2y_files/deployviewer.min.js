function hashToLowerCase(a){var b={};for(var c in a)b[c.toLowerCase()]=a[c].toLowerCase();return b}function setExperimentsFromQuery(){for(var a=window.location.search.toLowerCase().replace("?",""),b=a.split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if("experiment"==d[0]){var e=d[1].split(":");window.rendererModel.runningExperiments[e[0]]=e[1]}}}function getTags(){window.rendererModel.runningExperiments=hashToLowerCase(window.rendererModel.runningExperiments),setExperimentsFromQuery();var a=["common","viewer"],b=rendererModel.runningExperiments;for(var c in b)a.push(c.toLowerCase()+":"+b[c].toLowerCase());return a}define.resource("tags",getTags()),define.resource("mode",{debug:"debug"===rendererModel.debugMode,test:!1}),define.deployment("wysiwyg.deployment.PrepViewer",function(a){a.atPhase(PHASES.BOOTSTRAP,function(){window.wixData&&resource.getResources(["dataFixer"],function(a){var b=a.dataFixer.fix(window.wixData);this.define.dataItem.multi(b.document_data),this.define.dataPropertyItem.multi(b.component_properties),this.define.dataThemeItem.multi(b.theme_data)})}),a.atPhase(PHASES.MANAGERS,function(a){a.createClassInstance("W.SiteMembers","wysiwyg.viewer.managers.SiteMembersManager"),a.createClassInstance("W.MessagesController","wysiwyg.viewer.utils.MessageViewController")}),a.atPhase(PHASES.POST_DEPLOY,function(a){if("preview"===window.viewMode)return null;if(window.siteHeader&&window.rendererModel&&"UGC"===rendererModel.documentType){var b=a.getClassManagerInstance();b.getClass("core.utils.BeatStatisticsAndKeepAlive",function(a){window.BeatStatisticsAndKeepAliveInstance=new a("hve",siteHeader.id,$$("title")[0].innerHTML,siteHeader.documentType,!1,rendererModel.metaSiteId,function(){})})}})}),resource.getResources(["mode","scriptLoader"],function(a){window.getIndexTopology.call(a,{debug:a.mode.debug},{aliases:{web:"wysiwyg"},exclude:{langs:!0,mock:!0,sitemembers:!0,ecommerce:!0,"tpa-client":a.scriptLoader.isTPAArtifactOpen()?void 0:!0},baseUrls:{external_apis:""}},function(b){define.resource("topology",b.all),a.mode.test&&b.manifestsUrls.unshift(getTestManifestFromTheSpecRunner()),define.resource("manifestsUrls",b.manifestsUrls),define.deployment("wysiwyg.deployment.Wysiwyg-Common",function(a){a.atPhase(PHASES.MANAGERS,function(a){a.createClassInstance("W.Layout","wysiwyg.common.managers.LayoutManager"),a.createClassInstance("W.CookiesManager","wysiwyg.managers.WCookiesManager"),a.createClassInstance("W.Viewer","wysiwyg.common.managers.WViewManager"),a.createClassInstance("W.TPA","wysiwyg.viewer.managers.TPAManager")})}),a.scriptLoader.loadAllIndexes(b.manifestsUrls,function(){define.resource("deployment",define.createBootstrapClassInstance("bootstrap.bootstrap.deploy.Deploy").init(window))})})}),define.deployment("core.deployment.DeployViewer",function(a){function b(a){if(!this.alreadyLoadedInPrev340&&(this.alreadyLoadedInPrev340=W.Viewer.isSiteReady(),(!window.viewMode||"site"===window.viewMode)&&LOG.isThisSiteInEventSampleRatio(wixEvents.LOAD_PAGE_DATA.sampleRatio))){for(var b=-1!==document.referrer.indexOf("editor.wix.com/html/editor"),c=deployStatus.logs.pageLoad||[],e=deployStatus.logs.pageDataLoad||[],f=deployStatus.logs.viewerRender||[],g=deployStatus.logs.phases||[],h={},i=0;i<c.length;++i){var j=c[i],k=j.pageId,l=h[k]=h[k]||{};l.steps=l.steps||[];var m={time:j.time,host:j.host,step:j.type};j.errorDesc&&(m.error=j.errorDesc.substr(0,50)),void 0!==j.httpsStatus&&(m.status=j.httpsStatus),l.steps.push(m),l.time=j.time,l.step=j.type}var n=-1,o=-1,p=-1,q=-1,r=-1,s=-1;e.length>0&&(o=e[0].time),e.length>1&&(p=e[1].time),f.length>2&&"site ready"===f[2].step&&(q=f[2].time,s=f[2].time),f.length>0&&(r=f[0].time),g.length>0&&(n=_.last(g).time);for(var t={},u=0,i=0;i<g.length;i++)t[i]=g[i].time-u,u=g[i].time;var v={isFromEditor:b,isMobile:W.Config.mobileConfig?W.Config.mobileConfig.isMobileOrTablet():"unknown",isLoaded:W.Viewer.isSiteReady(),siteReadyTime:q,classRepoIsReadyTime:deployStatus.classRepoIsReadyTime,experimentsIsReadyTime:deployStatus.experimentsIsReadyTime,deployment:{start:0,done:n,phases:t},pages:{start:o,done:p,pages:h},render:{start:r,done:s}};LOG.reportEvent(wixEvents.LOAD_PAGE_DATA,{c1:JSON.stringify(v),c2:JSON.stringify(d()).replace(/"/g,""),i1:a})}}function c(){function a(a){return a.width*a.height}function b(b,c){var d=a(b);return Math.abs(d-c)}function c(a,c){a.sort(function(a,d){var e=b(a,c),f=b(d,c);return e-f})}function d(a,b,d){return c(a,b),a.slice(0,d)}if(window._imagePerformance){for(var e=d(window._imagePerformance.timing,5e3,3),f=d(window._imagePerformance.timing,5e5,3),g={_5k:0,_500k:0,_over500k:0},h=0,i=0;i<window._imagePerformance.timing.length;i++){var j=window._imagePerformance.timing[i],k=a(j);5e3>k?g._5k++:5e5>k?g._500k++:g._over500k++,j.hadError&&h++}var l={loading:window._imagePerformance.started-window._imagePerformance.timing.length,imagesBySize:g,imagesSamples:{_5k:e,_500k:f},errors:h};LOG.reportEvent(wixEvents.LOAD_IMAGES_DATA,{c1:JSON.stringify(l)})}}function d(){function a(a,b){return a==b?0:Number(a)>Number(b)?-1:1}for(var b,c={},d=Object.keys(deployStatus.files),e=0;e<d.length;e++)b=deployStatus.files[d[e]].end-deployStatus.files[d[e]].start,c[b]=d[e];var f=Object.keys(c);f.reverse(a);for(var g,h,i=f.slice(0,10),j={},e=0;e<i.length;e++)g=c[i[e]].split("/"),h="index.json"==g[g.length-1]||"index.debug.json"==g[g.length-1]?g[g.length-3]:g[g.length-1],j[h]=i[e];return j}setTimeout(function(){b(10),c()},1e4),setTimeout(function(){b(20)},2e4),setTimeout(function(){b(30)},3e4),a.atPhase(PHASES.INIT,function(){function a(){W.Pages.isPageLoadingCompleted()?W.Data.getDataByQuery("#SITE_STRUCTURE",function(a){b("afterLoad");var c="preview"!=window.viewMode;W.Viewer.setSite($("SITE_STRUCTURE"),a,c)}):W.Utils.callLater(a,[],this,10)}function b(a){deployStatus("pageDataLoad",{step:a,time:LOG.getSessionTime()})}W.Experiments.isDeployed({NoAnchorsFromServer:"New"})||null==window.anchors||W.Layout.setSavedAnchor(window.anchors),W.ComponentLifecycle.setComponentErrorHandler(function(a,b,c){"use strict";var d=a.component.$className;LOG.reportError(wixErrors.COMPONENT_ERROR,d,c,b.stack)}),resource.getResourceValue("status.structure.loaded",function(c){if(!c)throw new Error("Site structure failed to load");W.Pages&&W.Pages.loadSite&&!window.wixData?(b("beforeLoad"),W.Pages.loadSite(),a()):W.Data.getDataByQuery("#SITE_STRUCTURE",function(a){var b="preview"!=window.viewMode;W.Viewer.setSite($("SITE_STRUCTURE"),a,b)})})}),a.atPhase(PHASES.MANAGERS,function(a){a.createClassInstance("W.Pages","wysiwyg.viewer.managers.PageManager"),W.Experiments.isDeployed({EditorScripting:"New"})&&a.createClassInstance("W.ScriptingManager","wysiwyg.common.managers.ScriptingManager")})});